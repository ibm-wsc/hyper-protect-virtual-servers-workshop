{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Hyper Protect Virtual Server Wildfire Workshop \u00b6 Welcome to our Hyper Protect Virtual Server workshop. Hyper Protect Virtual Server is IBM\u2019s open application environment that is uniquely engineered for trusted computing. This workshop provides a primer on Hyper Protect Virtual Server and practical use cases relevant to the enterprise. In addition, you will gain hands-on experience with IBM\u2019s unique secure image build process to build a secure image and deploy it inside a FIPS 197-compliant protected memory enclave. Next, you will learn about Hyper Protect Virtual Server\u2019s crypto service built on a FIPS 140-2 Level 4-compliant HSM. Lastly, you will gain hands-on experience exploiting the crypto service. Agenda \u00b6 Introduction to Hyper Protect Virtual Server Hyper Protect Use Cases & Demo Introduction to the Secure Image Build Process Lab: Build and Deploy Your First Hyper Protect Virtual Server Image Introduction to HSM-backed Crypto Service Lab: Crypto Service Exploitation Next Steps on Your Journey & Wrap Up Acknowledgements \u00b6 Thanks to the following contributors: Workshop owners \u00b6 Barry Silliman Garrett Woodworth Jin VanStee","title":"Home"},{"location":"#hyper-protect-virtual-server-wildfire-workshop","text":"Welcome to our Hyper Protect Virtual Server workshop. Hyper Protect Virtual Server is IBM\u2019s open application environment that is uniquely engineered for trusted computing. This workshop provides a primer on Hyper Protect Virtual Server and practical use cases relevant to the enterprise. In addition, you will gain hands-on experience with IBM\u2019s unique secure image build process to build a secure image and deploy it inside a FIPS 197-compliant protected memory enclave. Next, you will learn about Hyper Protect Virtual Server\u2019s crypto service built on a FIPS 140-2 Level 4-compliant HSM. Lastly, you will gain hands-on experience exploiting the crypto service.","title":"Hyper Protect Virtual Server Wildfire Workshop"},{"location":"#agenda","text":"Introduction to Hyper Protect Virtual Server Hyper Protect Use Cases & Demo Introduction to the Secure Image Build Process Lab: Build and Deploy Your First Hyper Protect Virtual Server Image Introduction to HSM-backed Crypto Service Lab: Crypto Service Exploitation Next Steps on Your Journey & Wrap Up","title":"Agenda"},{"location":"#acknowledgements","text":"Thanks to the following contributors:","title":"Acknowledgements"},{"location":"#workshop-owners","text":"Barry Silliman Garrett Woodworth Jin VanStee","title":"Workshop owners"},{"location":"glossary/","text":"This glossary of terms consolidates the terms for the Hyper Protect Virtual Server offering in alphabetical order to help both customers and internal team members to understand our offering better. Appliance \u00b6 IBM Secure Service Container based appliance provided by an Appliance Vendor. From Hosting Appliance perspective, it is the combination of IBM Secure Service Container and the Hyper Protect Virtual Server Hosting Appliance. Appliance Administrator \u00b6 The person administrating an appliance which includes tasks, such as configuring storage, or memory to the appliance or performing other configuration tasks through the API provided by SSC/the Hosting Appliance. Appliance Operational Data \u00b6 Metrics, logs, appliance dump data, error logs, stack traces, kernel dump, etc. Appliance Protected Data \u00b6 Appliance secrets, workload data, configuration data, settings, and other internal information stored by an appliance. Appliance Vendor \u00b6 An internal, or external exploiter of SSC, packaging SSC into an appliance. BYOK \u00b6 The abbreviation of Bring Your Own Key, which allows you to import your existing keys to Hyper Protect Crypto Services service instances that protect your keys with advanced encryption. BYOI \u00b6 The abbreviation of Bring Your Own Image, which is a part of IBM Hyper Protect Virtual Server solution to support the development and deployment of your own container images on top of the Secure Service Container framework. Container \u00b6 A runtime instance of an Open Container Image (OCI) image. Crypto administrator \u00b6 The person who signs commands that are issued to the crypto units. Multiple administrators can be added to one crypto unit to increase security. Crypto units \u00b6 A single unit that represents a hardware security module and the corresponding software stack that is dedicated to the hardware security module for cryptography. Data encryption keys \u00b6 A cryptographic key used to encrypt data that is stored in an application. Datapool \u00b6 Synonyms for Storage Pool. Docker Content Trust \u00b6 Docker Content Trust (DCT) is a feature in the Docker containerization platform that provides the ability to use digital signatures for data sent to and received from remote Docker registries. These signatures allow client-side or runtime verification of the integrity and publisher of specific image tags. Through DCT, image publishers can sign their images and image consumers can ensure that the images they pull are signed. Publishers could be individuals or organizations manually signing their content or automated software supply chains signing content as part of their release process. Docker registry \u00b6 A Docker registry is a storage and content delivery system, holding named Docker images, available in different tagged versions. EP11 \u00b6 The abbreviation of Enterprise PKCS #11, which is specifically designed for customers seeking support for open standards and enhanced security. The EP11 library provides an interface very similar to the industry-standard PKCS #11 API. Envelope encryption \u00b6 The process of encrypting data with a data encryption key and then encrypting the key with a root key that can be fully managed. FIPS 140-2 compliance \u00b6 An organization\u2019s adherence to the Federal Information Processing Standards (FIPS) 140-2 standards. This standard specifies the security requirements that will be satisfied by a cryptographic module utilized within a security system protecting sensitive information. FIPS 140-2 outlines four levels of security: Level 1 - the lowest level of security. It covers the basic security features in a cryptographic module. Level 2 - improves the physical security aspects of cryptographic modules. Examples of required physical security measures are tamper-evident coatings, seals, or pick-resistant locks. Role-based authentication is included in this security level and ensures the operator accessing the module is authorized and is limited to their assigned actions. Level 3 - requires enhanced physical security, potentially with products available from the private sector. A multi-chip embedded module has to be contained in a strong enclosure that zeroizes critical security parameters when it is removed. This security level also uses identity-based authentication. Level 4 - requires tamper detection circuits to be able to detect any device penetration. This level is best for when cryptographic modules are in a physically unprotected environment that intruders can access. Modules must be able to detect fluctuations and zeroize themselves. Level 4 also protects against security compromises due to environmental conditions. FIPS 197 compliance \u00b6 An organization\u2019s adherence to Federal Information Processing Standards (FIPS) 197 which is an algorithmic standard that addresses the Advanced Encryption Standard (AES). AES specifies a FIPS-approved cryptographic algorithm that can be used to protect electronic data. The AES algorithm is a symmetric block cipher that can encrypt and decrypt information. GPG \u00b6 The abbreviation of Gnu Privacy Guard, which is an open standard used for signing, encrypting, and decrypting texts with public and private keys to increase the security of communications. GREP11 \u00b6 Represents Enterprise PKCS #11 (EP11) APIs over gRPC calls, which is designed to be a stateless interface for cryptographic operations on cloud. gRPC \u00b6 A modern open source high performance remote procedure call (RPC) framework that can connect services in and across data centers for load balancing, tracing, health checking, and authentication. Hardware security module \u00b6 A physical appliance that provides on-demand encryption, key management, and key storage as a managed service. Hosting Appliance \u00b6 A technical component within IBM Secure Service Container based appliances, providing the enablement for running Docker-based workloads. Image \u00b6 The basis of the containers. An image is an ordered collection of root file system changes and the corresponding execution parameters for use within a container runtime. ISV \u00b6 The abbreviation of Independent Software Vendor, who provides software solutions by developing and deploying containerized applications to the Secure Service Container partitions. Master key \u00b6 An encryption key that is used to protect a crypto unit. The master key provides full control of the hardware security module and ownership of the root of trust that encrypts the chain keys, including the root key and standard key. Management Utilities \u00b6 A set of applications to provide an alternate way of configuring Hyper Protect Crypto Services service instances using signature keys and master key parts stored on smart cards. Management server \u00b6 An x86 or s390x Linux management server used to run the commands provided by the Hyper Protect Virtual Servers offering, and administer the offering. Manifest \u00b6 A manifest is generated by the Secure Build for audit purpose, which contains a copy of the github project cloned by the Secure Build container, a copy of the build log, and a build.json with the build status. Manifest public key \u00b6 A manifest public key is used to verify the manifest generated by the Secure Build. Manifest private key \u00b6 A manifest private key is used to sign the manifest during the Secure Build. Mutual TLS \u00b6 Mutual authentication or two-way authentication refers to two parties authenticating each other at the same time. Mutual TLS is doing this over the TLS protocol. Namespace \u00b6 A namespace such as ibmzcontainers that contains a number of unique images. For examples, the images include hpvsop-base, hyperpcons-worker, hyperpcons-riaas, and so on. Partition \u00b6 A partition is the logic partition (LPAR) on the mainframe, and can be created by using the logic partitioning tools such as Hardware Management Console (HMC) or other logical partitioning tools. PKCS #11 \u00b6 The abbreviation of Public-Key Cryptography Standards #11, which defines a platform-independent API to cryptographic tokens, such as HSM and smart cards. Protected memory enclave \u00b6 Defined private regions of memory whose contents are protected and unable to be read or saved to any process outside the enclave itself. Quotagroup \u00b6 The storage assigned to a workload running on an appliance. The appliance administrator assigns FCP, or ECKD based storage to an appliance. He then creates quotagroups, representing parts of the underlying storage. He finally assigns quotagroups to workloads through the appliance API. Root keys \u00b6 A symmetric wrapping key that is used for encrypting and decrypting other keys that are stored in a data service. Registry \u00b6 A Registry is a hosted service containing repositories of container images that responds to the Registry API. For example, Docker Hub. Repository \u00b6 A repository is a set of containerized images. A repository can be shared by pushing it to a registry server. Different images in the repository can be labeled using tags. For example, hpvsop-base. Repository definition files \u00b6 An encrypted registration file or a repository definition file is used to register the repository, for authentication or validation reasons, such that a Hosting Appliance will trust that the image, when pulled from the registry, is authentic. Repository registration files \u00b6 A cleartext Python or JSON format file, which is generated by the Secure Build container when the container is created. The JSON format repository registration file can be used as the direct input to generate an encrypted repository definition file. Secondary node \u00b6 A cluster member that replicates the contents of the primary database in Hyper Protect DBaaS. Smart cards \u00b6 An HSM that looks like a credit card with an embedded chip. The chip is capable of performing a limited set of cryptographic operations and is loaded with custom software. Smart card readers \u00b6 A device that attaches to a workstation and allows the workstation to communicate with a smart card. Smart Card Utility Program \u00b6 The application installed as part of the Management Utilities. It sets up and manages the smart cards used by the Trusted Key Entry (TKE) application. Signature key \u00b6 An encryption key that is used by the crypto unit administrator to sign commands that are issued to the crypto unit. Standard key \u00b6 Another resources in Hyper Protect Crypto Services to directly encrypt and decrypt data. runc \u00b6 A CLI tool for spawning and running containers according to the Open Container Initiative (OCI) specification. runq \u00b6 An open-sourced hypervisor-based Docker runtime environment, which is based on runc to run regular containerized images in a lightweight KVM or Qemu virtual machine. s390x \u00b6 The underlying architecture of IBM Z or LinuxONE mainframe. Secure Build / Secure Image Build \u00b6 The process of building the application code from a Git-like source repository into a container image for s390x architecture, signing the image by using the authentication keys, and publishing the image to the remote repository for later integration. Secure Service Container \u00b6 A container framework based on the runq technology, that is supported by the IBM Z or LinuxONE servers. Secure Service Container partition \u00b6 A type of logic partitions (LPARs) on the mainframe that runs the Secure Service Container framework. SSH \u00b6 The abbreviation of Secure Shell, which is a cryptographic network protocol for operating network services securely over an unsecured network by using public and private keys. Storage Pool \u00b6 A storage pool is a uniquely named collection of storage disks on which the appliance file system is mounted. System Administrator \u00b6 This role includes the system administrator of a machine, storage administrators, and network administrators. tag \u00b6 A tag is used to version images in a repository. For example, latest, 1.2.3.4-develop-a0d3aea, or s390x-develop-54a9045. Trusted Key Entry application \u00b6 The application installed as part of the Management Utilities. It uses smart cards to load master keys in service instances and to perform other configuration tasks for service instances. Workload \u00b6 The application and data provided and generated by a (running) Workload Image. Workload Data \u00b6 Workload user or workload client data, workload logs, workload secrets stored in the appliance. Workload Image \u00b6 A container-based image, provided by the Workload Vendor. An appliance only runs workload images which have been registered with the appliance through a repository definition file. Workload User \u00b6 The end-user of a workload. Workload Vendor \u00b6 The creator of a Docker image running on top of Hosting Appliance.","title":"Glossary of terms"},{"location":"glossary/#appliance","text":"IBM Secure Service Container based appliance provided by an Appliance Vendor. From Hosting Appliance perspective, it is the combination of IBM Secure Service Container and the Hyper Protect Virtual Server Hosting Appliance.","title":"Appliance"},{"location":"glossary/#appliance-administrator","text":"The person administrating an appliance which includes tasks, such as configuring storage, or memory to the appliance or performing other configuration tasks through the API provided by SSC/the Hosting Appliance.","title":"Appliance Administrator"},{"location":"glossary/#appliance-operational-data","text":"Metrics, logs, appliance dump data, error logs, stack traces, kernel dump, etc.","title":"Appliance Operational Data"},{"location":"glossary/#appliance-protected-data","text":"Appliance secrets, workload data, configuration data, settings, and other internal information stored by an appliance.","title":"Appliance Protected Data"},{"location":"glossary/#appliance-vendor","text":"An internal, or external exploiter of SSC, packaging SSC into an appliance.","title":"Appliance Vendor"},{"location":"glossary/#byok","text":"The abbreviation of Bring Your Own Key, which allows you to import your existing keys to Hyper Protect Crypto Services service instances that protect your keys with advanced encryption.","title":"BYOK"},{"location":"glossary/#byoi","text":"The abbreviation of Bring Your Own Image, which is a part of IBM Hyper Protect Virtual Server solution to support the development and deployment of your own container images on top of the Secure Service Container framework.","title":"BYOI"},{"location":"glossary/#container","text":"A runtime instance of an Open Container Image (OCI) image.","title":"Container"},{"location":"glossary/#crypto-administrator","text":"The person who signs commands that are issued to the crypto units. Multiple administrators can be added to one crypto unit to increase security.","title":"Crypto administrator"},{"location":"glossary/#crypto-units","text":"A single unit that represents a hardware security module and the corresponding software stack that is dedicated to the hardware security module for cryptography.","title":"Crypto units"},{"location":"glossary/#data-encryption-keys","text":"A cryptographic key used to encrypt data that is stored in an application.","title":"Data encryption keys"},{"location":"glossary/#datapool","text":"Synonyms for Storage Pool.","title":"Datapool"},{"location":"glossary/#docker-content-trust","text":"Docker Content Trust (DCT) is a feature in the Docker containerization platform that provides the ability to use digital signatures for data sent to and received from remote Docker registries. These signatures allow client-side or runtime verification of the integrity and publisher of specific image tags. Through DCT, image publishers can sign their images and image consumers can ensure that the images they pull are signed. Publishers could be individuals or organizations manually signing their content or automated software supply chains signing content as part of their release process.","title":"Docker Content Trust"},{"location":"glossary/#docker-registry","text":"A Docker registry is a storage and content delivery system, holding named Docker images, available in different tagged versions.","title":"Docker registry"},{"location":"glossary/#ep11","text":"The abbreviation of Enterprise PKCS #11, which is specifically designed for customers seeking support for open standards and enhanced security. The EP11 library provides an interface very similar to the industry-standard PKCS #11 API.","title":"EP11"},{"location":"glossary/#envelope-encryption","text":"The process of encrypting data with a data encryption key and then encrypting the key with a root key that can be fully managed.","title":"Envelope encryption"},{"location":"glossary/#fips-140-2-compliance","text":"An organization\u2019s adherence to the Federal Information Processing Standards (FIPS) 140-2 standards. This standard specifies the security requirements that will be satisfied by a cryptographic module utilized within a security system protecting sensitive information. FIPS 140-2 outlines four levels of security: Level 1 - the lowest level of security. It covers the basic security features in a cryptographic module. Level 2 - improves the physical security aspects of cryptographic modules. Examples of required physical security measures are tamper-evident coatings, seals, or pick-resistant locks. Role-based authentication is included in this security level and ensures the operator accessing the module is authorized and is limited to their assigned actions. Level 3 - requires enhanced physical security, potentially with products available from the private sector. A multi-chip embedded module has to be contained in a strong enclosure that zeroizes critical security parameters when it is removed. This security level also uses identity-based authentication. Level 4 - requires tamper detection circuits to be able to detect any device penetration. This level is best for when cryptographic modules are in a physically unprotected environment that intruders can access. Modules must be able to detect fluctuations and zeroize themselves. Level 4 also protects against security compromises due to environmental conditions.","title":"FIPS 140-2 compliance"},{"location":"glossary/#fips-197-compliance","text":"An organization\u2019s adherence to Federal Information Processing Standards (FIPS) 197 which is an algorithmic standard that addresses the Advanced Encryption Standard (AES). AES specifies a FIPS-approved cryptographic algorithm that can be used to protect electronic data. The AES algorithm is a symmetric block cipher that can encrypt and decrypt information.","title":"FIPS 197 compliance"},{"location":"glossary/#gpg","text":"The abbreviation of Gnu Privacy Guard, which is an open standard used for signing, encrypting, and decrypting texts with public and private keys to increase the security of communications.","title":"GPG"},{"location":"glossary/#grep11","text":"Represents Enterprise PKCS #11 (EP11) APIs over gRPC calls, which is designed to be a stateless interface for cryptographic operations on cloud.","title":"GREP11"},{"location":"glossary/#grpc","text":"A modern open source high performance remote procedure call (RPC) framework that can connect services in and across data centers for load balancing, tracing, health checking, and authentication.","title":"gRPC"},{"location":"glossary/#hardware-security-module","text":"A physical appliance that provides on-demand encryption, key management, and key storage as a managed service.","title":"Hardware security module"},{"location":"glossary/#hosting-appliance","text":"A technical component within IBM Secure Service Container based appliances, providing the enablement for running Docker-based workloads.","title":"Hosting Appliance"},{"location":"glossary/#image","text":"The basis of the containers. An image is an ordered collection of root file system changes and the corresponding execution parameters for use within a container runtime.","title":"Image"},{"location":"glossary/#isv","text":"The abbreviation of Independent Software Vendor, who provides software solutions by developing and deploying containerized applications to the Secure Service Container partitions.","title":"ISV"},{"location":"glossary/#master-key","text":"An encryption key that is used to protect a crypto unit. The master key provides full control of the hardware security module and ownership of the root of trust that encrypts the chain keys, including the root key and standard key.","title":"Master key"},{"location":"glossary/#management-utilities","text":"A set of applications to provide an alternate way of configuring Hyper Protect Crypto Services service instances using signature keys and master key parts stored on smart cards.","title":"Management Utilities"},{"location":"glossary/#management-server","text":"An x86 or s390x Linux management server used to run the commands provided by the Hyper Protect Virtual Servers offering, and administer the offering.","title":"Management server"},{"location":"glossary/#manifest","text":"A manifest is generated by the Secure Build for audit purpose, which contains a copy of the github project cloned by the Secure Build container, a copy of the build log, and a build.json with the build status.","title":"Manifest"},{"location":"glossary/#manifest-public-key","text":"A manifest public key is used to verify the manifest generated by the Secure Build.","title":"Manifest public key"},{"location":"glossary/#manifest-private-key","text":"A manifest private key is used to sign the manifest during the Secure Build.","title":"Manifest private key"},{"location":"glossary/#mutual-tls","text":"Mutual authentication or two-way authentication refers to two parties authenticating each other at the same time. Mutual TLS is doing this over the TLS protocol.","title":"Mutual TLS"},{"location":"glossary/#namespace","text":"A namespace such as ibmzcontainers that contains a number of unique images. For examples, the images include hpvsop-base, hyperpcons-worker, hyperpcons-riaas, and so on.","title":"Namespace"},{"location":"glossary/#partition","text":"A partition is the logic partition (LPAR) on the mainframe, and can be created by using the logic partitioning tools such as Hardware Management Console (HMC) or other logical partitioning tools.","title":"Partition"},{"location":"glossary/#pkcs-11","text":"The abbreviation of Public-Key Cryptography Standards #11, which defines a platform-independent API to cryptographic tokens, such as HSM and smart cards.","title":"PKCS #11"},{"location":"glossary/#protected-memory-enclave","text":"Defined private regions of memory whose contents are protected and unable to be read or saved to any process outside the enclave itself.","title":"Protected memory enclave"},{"location":"glossary/#quotagroup","text":"The storage assigned to a workload running on an appliance. The appliance administrator assigns FCP, or ECKD based storage to an appliance. He then creates quotagroups, representing parts of the underlying storage. He finally assigns quotagroups to workloads through the appliance API.","title":"Quotagroup"},{"location":"glossary/#root-keys","text":"A symmetric wrapping key that is used for encrypting and decrypting other keys that are stored in a data service.","title":"Root keys"},{"location":"glossary/#registry","text":"A Registry is a hosted service containing repositories of container images that responds to the Registry API. For example, Docker Hub.","title":"Registry"},{"location":"glossary/#repository","text":"A repository is a set of containerized images. A repository can be shared by pushing it to a registry server. Different images in the repository can be labeled using tags. For example, hpvsop-base.","title":"Repository"},{"location":"glossary/#repository-definition-files","text":"An encrypted registration file or a repository definition file is used to register the repository, for authentication or validation reasons, such that a Hosting Appliance will trust that the image, when pulled from the registry, is authentic.","title":"Repository definition files"},{"location":"glossary/#repository-registration-files","text":"A cleartext Python or JSON format file, which is generated by the Secure Build container when the container is created. The JSON format repository registration file can be used as the direct input to generate an encrypted repository definition file.","title":"Repository registration files"},{"location":"glossary/#secondary-node","text":"A cluster member that replicates the contents of the primary database in Hyper Protect DBaaS.","title":"Secondary node"},{"location":"glossary/#smart-cards","text":"An HSM that looks like a credit card with an embedded chip. The chip is capable of performing a limited set of cryptographic operations and is loaded with custom software.","title":"Smart cards"},{"location":"glossary/#smart-card-readers","text":"A device that attaches to a workstation and allows the workstation to communicate with a smart card.","title":"Smart card readers"},{"location":"glossary/#smart-card-utility-program","text":"The application installed as part of the Management Utilities. It sets up and manages the smart cards used by the Trusted Key Entry (TKE) application.","title":"Smart Card Utility Program"},{"location":"glossary/#signature-key","text":"An encryption key that is used by the crypto unit administrator to sign commands that are issued to the crypto unit.","title":"Signature key"},{"location":"glossary/#standard-key","text":"Another resources in Hyper Protect Crypto Services to directly encrypt and decrypt data.","title":"Standard key"},{"location":"glossary/#runc","text":"A CLI tool for spawning and running containers according to the Open Container Initiative (OCI) specification.","title":"runc"},{"location":"glossary/#runq","text":"An open-sourced hypervisor-based Docker runtime environment, which is based on runc to run regular containerized images in a lightweight KVM or Qemu virtual machine.","title":"runq"},{"location":"glossary/#s390x","text":"The underlying architecture of IBM Z or LinuxONE mainframe.","title":"s390x"},{"location":"glossary/#secure-build-secure-image-build","text":"The process of building the application code from a Git-like source repository into a container image for s390x architecture, signing the image by using the authentication keys, and publishing the image to the remote repository for later integration.","title":"Secure Build / Secure Image Build"},{"location":"glossary/#secure-service-container","text":"A container framework based on the runq technology, that is supported by the IBM Z or LinuxONE servers.","title":"Secure Service Container"},{"location":"glossary/#secure-service-container-partition","text":"A type of logic partitions (LPARs) on the mainframe that runs the Secure Service Container framework.","title":"Secure Service Container partition"},{"location":"glossary/#ssh","text":"The abbreviation of Secure Shell, which is a cryptographic network protocol for operating network services securely over an unsecured network by using public and private keys.","title":"SSH"},{"location":"glossary/#storage-pool","text":"A storage pool is a uniquely named collection of storage disks on which the appliance file system is mounted.","title":"Storage Pool"},{"location":"glossary/#system-administrator","text":"This role includes the system administrator of a machine, storage administrators, and network administrators.","title":"System Administrator"},{"location":"glossary/#tag","text":"A tag is used to version images in a repository. For example, latest, 1.2.3.4-develop-a0d3aea, or s390x-develop-54a9045.","title":"tag"},{"location":"glossary/#trusted-key-entry-application","text":"The application installed as part of the Management Utilities. It uses smart cards to load master keys in service instances and to perform other configuration tasks for service instances.","title":"Trusted Key Entry application"},{"location":"glossary/#workload","text":"The application and data provided and generated by a (running) Workload Image.","title":"Workload"},{"location":"glossary/#workload-data","text":"Workload user or workload client data, workload logs, workload secrets stored in the appliance.","title":"Workload Data"},{"location":"glossary/#workload-image","text":"A container-based image, provided by the Workload Vendor. An appliance only runs workload images which have been registered with the appliance through a repository definition file.","title":"Workload Image"},{"location":"glossary/#workload-user","text":"The end-user of a workload.","title":"Workload User"},{"location":"glossary/#workload-vendor","text":"The creator of a Docker image running on top of Hosting Appliance.","title":"Workload Vendor"},{"location":"prerequisites/","text":"Prerequisites \u00b6 Create a GitHub \u00b6 Create a GitHub account (if you don't already have one) here . Create a Docker Hub \u00b6 Create a Docker Hub account (if you don't already have one) following the instructions here . Create a Docker access Token \u00b6 Create an access token for Docker Hub access during the lab (you will delete it if after finishing the lab) following the instructions here .","title":"Prerequisites"},{"location":"prerequisites/#prerequisites","text":"","title":"Prerequisites"},{"location":"prerequisites/#create-a-github","text":"Create a GitHub account (if you don't already have one) here .","title":"Create a GitHub"},{"location":"prerequisites/#create-a-docker-hub","text":"Create a Docker Hub account (if you don't already have one) following the instructions here .","title":"Create a Docker Hub"},{"location":"prerequisites/#create-a-docker-access-token","text":"Create an access token for Docker Hub access during the lab (you will delete it if after finishing the lab) following the instructions here .","title":"Create a Docker access Token"},{"location":"proposechange/","text":"How to propose a change \u00b6 On the page you want to make a change to, click on the pencil icon next to the page's title. This will take you to edit the page in Github. You will see a message similar to the following: \"You\u2019re editing a file in a project you don\u2019t have write access to. Submitting a change to this file will write it to a new branch in your fork, so you can send a pull request.\" Make your changes in Markdown. And submit for review. The owners of this repo will review your pull request and accept or deny your change proposal. There are other ways of doing a pull request, a Google search will lead you to those tutorials.","title":"Propose a change"},{"location":"proposechange/#how-to-propose-a-change","text":"On the page you want to make a change to, click on the pencil icon next to the page's title. This will take you to edit the page in Github. You will see a message similar to the following: \"You\u2019re editing a file in a project you don\u2019t have write access to. Submitting a change to this file will write it to a new branch in your fork, so you can send a pull request.\" Make your changes in Markdown. And submit for review. The owners of this repo will review your pull request and accept or deny your change proposal. There are other ways of doing a pull request, a Google search will lead you to those tutorials.","title":"How to propose a change"},{"location":"resources/","text":"Other Resources \u00b6 Hyper Protect Virtual Server Resources \u00b6 Knowledge Center Redbook Hyper Protect Resources \u00b6 IBM Cloud Hyper Protect Services Hyper Protect Digital Assets Platform","title":"Other resources"},{"location":"resources/#other-resources","text":"","title":"Other Resources"},{"location":"resources/#hyper-protect-virtual-server-resources","text":"Knowledge Center Redbook","title":"Hyper Protect Virtual Server Resources"},{"location":"resources/#hyper-protect-resources","text":"IBM Cloud Hyper Protect Services Hyper Protect Digital Assets Platform","title":"Hyper Protect Resources"},{"location":"grep11-lab/assignments/","text":"Grep11 Lab Assignments \u00b6 Name Skytap URL VPN ID OPEN http://ibm.biz/grep11team01 zblock01 OPEN http://ibm.biz/grep11team02 zblock02 OPEN http://ibm.biz/grep11team03 zblock03 OPEN http://ibm.biz/grep11team04 zblock04 OPEN http://ibm.biz/grep11team05 zblock05 OPEN http://ibm.biz/grep11team06 zblock06 OPEN http://ibm.biz/grep11team07 zblock07 OPEN http://ibm.biz/grep11team08 zblock08 OPEN http://ibm.biz/grep11team09 zblock09 OPEN http://ibm.biz/grep11team10 zblock10 OPEN http://ibm.biz/grep11team11 zblock11 OPEN http://ibm.biz/grep11team12 zblock12 OPEN http://ibm.biz/grep11team13 zblock13 OPEN http://ibm.biz/grep11team14 zblock14 OPEN http://ibm.biz/grep11team15 zblock15 OPEN http://ibm.biz/grep11team16 zblock16 OPEN http://ibm.biz/grep11team17 zblock17 OPEN http://ibm.biz/grep11team18 zblock18 OPEN http://ibm.biz/grep11team19 zblock19 OPEN http://ibm.biz/grep11team20 zblock20 OPEN http://ibm.biz/grep11team21 zblock21 OPEN http://ibm.biz/grep11team22 zblock22 OPEN http://ibm.biz/grep11team23 zblock23 OPEN http://ibm.biz/grep11team24 zblock24 OPEN http://ibm.biz/grep11team25 zblock25 OPEN http://ibm.biz/grep11team26 zblock26 OPEN http://ibm.biz/grep11team27 zblock27 OPEN http://ibm.biz/grep11team28 zblock28 OPEN http://ibm.biz/grep11team29 zblock29 OPEN http://ibm.biz/grep11team30 zblock30 OPEN http://ibm.biz/grep11team31 zblock31 OPEN http://ibm.biz/grep11team32 zblock32 OPEN http://ibm.biz/grep11team33 zblock33 OPEN http://ibm.biz/grep11team34 zblock34 OPEN http://ibm.biz/grep11team35 zblock35 OPEN http://ibm.biz/grep11team36 zblock36 OPEN http://ibm.biz/grep11team37 zblock37 OPEN http://ibm.biz/grep11team38 zblock38 OPEN http://ibm.biz/grep11team39 zblock39 OPEN http://ibm.biz/grep11team40 zblock40","title":"GREP11 Lab virtual machine assignments"},{"location":"grep11-lab/assignments/#grep11-lab-assignments","text":"Name Skytap URL VPN ID OPEN http://ibm.biz/grep11team01 zblock01 OPEN http://ibm.biz/grep11team02 zblock02 OPEN http://ibm.biz/grep11team03 zblock03 OPEN http://ibm.biz/grep11team04 zblock04 OPEN http://ibm.biz/grep11team05 zblock05 OPEN http://ibm.biz/grep11team06 zblock06 OPEN http://ibm.biz/grep11team07 zblock07 OPEN http://ibm.biz/grep11team08 zblock08 OPEN http://ibm.biz/grep11team09 zblock09 OPEN http://ibm.biz/grep11team10 zblock10 OPEN http://ibm.biz/grep11team11 zblock11 OPEN http://ibm.biz/grep11team12 zblock12 OPEN http://ibm.biz/grep11team13 zblock13 OPEN http://ibm.biz/grep11team14 zblock14 OPEN http://ibm.biz/grep11team15 zblock15 OPEN http://ibm.biz/grep11team16 zblock16 OPEN http://ibm.biz/grep11team17 zblock17 OPEN http://ibm.biz/grep11team18 zblock18 OPEN http://ibm.biz/grep11team19 zblock19 OPEN http://ibm.biz/grep11team20 zblock20 OPEN http://ibm.biz/grep11team21 zblock21 OPEN http://ibm.biz/grep11team22 zblock22 OPEN http://ibm.biz/grep11team23 zblock23 OPEN http://ibm.biz/grep11team24 zblock24 OPEN http://ibm.biz/grep11team25 zblock25 OPEN http://ibm.biz/grep11team26 zblock26 OPEN http://ibm.biz/grep11team27 zblock27 OPEN http://ibm.biz/grep11team28 zblock28 OPEN http://ibm.biz/grep11team29 zblock29 OPEN http://ibm.biz/grep11team30 zblock30 OPEN http://ibm.biz/grep11team31 zblock31 OPEN http://ibm.biz/grep11team32 zblock32 OPEN http://ibm.biz/grep11team33 zblock33 OPEN http://ibm.biz/grep11team34 zblock34 OPEN http://ibm.biz/grep11team35 zblock35 OPEN http://ibm.biz/grep11team36 zblock36 OPEN http://ibm.biz/grep11team37 zblock37 OPEN http://ibm.biz/grep11team38 zblock38 OPEN http://ibm.biz/grep11team39 zblock39 OPEN http://ibm.biz/grep11team40 zblock40","title":"Grep11 Lab Assignments"},{"location":"grep11-lab/exercise-overview/","text":"An overview of the exercises \u00b6 Expand the lab folder in your Visual Studio Code explorer pane so that you can see the source code files in the folder, similar to what is shown in the screen snippet below: Running the go test -v command in the golang/examples directory was good for ensuring that our GREP11 server setup works and that our client application can access it. But there is not a lot of output produced by this test, so we took the functions used in the test and added statements in many places to produce output for educational purposes. We also added some flexibility to the functions by adding some function arguments that would let us modify function behavior, again, for educational purposes. We left the golang/examples directory intact, and copied the source code into a new directory that we created, golang/lab , and made our program modifications in that directory. Note These exercises are meant to illustrate various concepts for learning about the functionality that the GREP11 server and the Crypto Express card in EP11 mode provide, and are not meant to illustrate Go programming lanuage best practices! In fact, we violated one best practice (DRY - Don't Repeat Yourself) when we copied the examples directory into the lab directory! Feel free to copy our source code and use it as you see fit, but it is provided \"as is\", without support or warranty of any kind. Other than adding a whole bunch of statements to print output, at a high level, the following changes in program structure were made after copying the source code from golang/examples into golang/labs The routine to set the variables needed to connect to the GREP11 server was moved into a separate file, callopt.go . This routine specifies the IP address and port where the GREP11 server is listening, and it also contains variables specifying the certificates and keys necessary to establish a session between our program and the GREP11 server using mutual TLS authentication. A main() function, which is the entry point for the program, was created, in the file main.go . It uses arguments to determine which of the four exercises to invoke. (You can actually invoke any combination of them in one program invocation but in our lab instructions we only have you do one at a time). We added some extra arguments that work with exercises two, three, and four, in order to illustrate concepts of interest. There are four separate source files, exercise1.go , exercise2.go , exercise3.go , and exercise4.go each of which was created by copying one of the Example_ test functions from golang/examples/server_test.go , modifying the name of the function to remove Example_ from its name to reinforce the point that it was no longer a function suitable for using with the go test command. exercise1.go began life as Example_getMechanismInfo() exercise2.go started out as Example_encryptAndDecrypt() exercise3.go was Example_signAndVerifyUsingECDSAKeyPair() exercise4.go had its origins as Example_wrapAndUnwrapKey() We deleted some of the files that we copied over that were not needed to run our lab exercises. It's time to start the first exercise. Enjoy!","title":"An overview of the Exercises"},{"location":"grep11-lab/exercise-overview/#an-overview-of-the-exercises","text":"Expand the lab folder in your Visual Studio Code explorer pane so that you can see the source code files in the folder, similar to what is shown in the screen snippet below: Running the go test -v command in the golang/examples directory was good for ensuring that our GREP11 server setup works and that our client application can access it. But there is not a lot of output produced by this test, so we took the functions used in the test and added statements in many places to produce output for educational purposes. We also added some flexibility to the functions by adding some function arguments that would let us modify function behavior, again, for educational purposes. We left the golang/examples directory intact, and copied the source code into a new directory that we created, golang/lab , and made our program modifications in that directory. Note These exercises are meant to illustrate various concepts for learning about the functionality that the GREP11 server and the Crypto Express card in EP11 mode provide, and are not meant to illustrate Go programming lanuage best practices! In fact, we violated one best practice (DRY - Don't Repeat Yourself) when we copied the examples directory into the lab directory! Feel free to copy our source code and use it as you see fit, but it is provided \"as is\", without support or warranty of any kind. Other than adding a whole bunch of statements to print output, at a high level, the following changes in program structure were made after copying the source code from golang/examples into golang/labs The routine to set the variables needed to connect to the GREP11 server was moved into a separate file, callopt.go . This routine specifies the IP address and port where the GREP11 server is listening, and it also contains variables specifying the certificates and keys necessary to establish a session between our program and the GREP11 server using mutual TLS authentication. A main() function, which is the entry point for the program, was created, in the file main.go . It uses arguments to determine which of the four exercises to invoke. (You can actually invoke any combination of them in one program invocation but in our lab instructions we only have you do one at a time). We added some extra arguments that work with exercises two, three, and four, in order to illustrate concepts of interest. There are four separate source files, exercise1.go , exercise2.go , exercise3.go , and exercise4.go each of which was created by copying one of the Example_ test functions from golang/examples/server_test.go , modifying the name of the function to remove Example_ from its name to reinforce the point that it was no longer a function suitable for using with the go test command. exercise1.go began life as Example_getMechanismInfo() exercise2.go started out as Example_encryptAndDecrypt() exercise3.go was Example_signAndVerifyUsingECDSAKeyPair() exercise4.go had its origins as Example_wrapAndUnwrapKey() We deleted some of the files that we copied over that were not needed to run our lab exercises. It's time to start the first exercise. Enjoy!","title":"An overview of the exercises"},{"location":"grep11-lab/grep11-display/","text":"Displaying your GREP11 environment \u00b6 List Crypto Domains on your Hyper Protect Virtual Servers LPAR \u00b6 List your available domains with the Hyper Protect Virtual Server CLI: hpvs crypto list Example output hpvs crypto list +---------------+--------+ | CRYPTO.DOMAIN | STATUS | +---------------+--------+ | 08.0016 | in use | | 0a.0016 | in use | +---------------+--------+ A value of in use in the STATUS column indicates that each crypto domain has a GREP11 server connected to it. Display the GREP11 servers \u00b6 Display the virtual servers running on the Hyper Protect Virtual Servers LPAR: hpvs vs list Example output +----------------------+---------+----------------------+----------------------------------------------------------+ | NAMES | STATE | STATUS | IMAGE | +----------------------+---------+----------------------+----------------------------------------------------------+ | collectd | running | Up 2 weeks | ibmzcontainers/collectd-host:1.2.1 | | grep11-08-0016-9876 | running | Up 9 days | ibmzcontainers/hpcs-grep11-prod:1.2.1 | | sbserver_00 | running | Up 9 days | ibmzcontainers/secure-docker-build:1.2.1-release-9b63b43 | | sbserver_19 | running | Up 9 days | ibmzcontainers/secure-docker-build:1.2.1-release-9b63b43 | | grep11-0a-0016-19876 | running | Up 9 days | ibmzcontainers/hpcs-grep11-prod:1.2.1 | | hpvs_bc_08 | running | Up 2 weeks | mplccblockchain/hpvs_bc:latest | | sbserver_08 | running | Up 2 weeks | ibmzcontainers/secure-docker-build:1.2.1-release-9b63b43 | | monitoring | running | Up 2 weeks | ibmzcontainers/monitoring:1.2.1 | | hpvs_grafana | running | Up 8 days | jinxiong/hpvs_grafana:latest | | prom0630_19 | running | Up 9 days | jinxiong/prom0630:latest | | sbserver_07 | running | Up 10 days | ibmzcontainers/secure-docker-build:1.2.1-release-9b63b43 | +----------------------+---------+----------------------+----------------------------------------------------------+ Observe that there are two servers listed whose name starts with grep11 . These are the two GREP11 servers that we have provided. One accessible from host port 9876 and one from host port 19876. Display details about one of the GREP11 servers with this command: hpvs vs show --name grep11-08-0016-9876 Example output \u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502 PROPERTIES \u2502 VALUES \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 Name \u2502 grep11-08-0016-9876 \u2502 \u2502 Status \u2502 Up 9 days \u2502 \u2502 CPU \u2502 1 \u2502 \u2502 Memory \u2502 4096 \u2502 \u2502 Networks \u2502 Network:bridge \u2502 \u2502 \u2502 IPAddress:172.31.0.10 \u2502 \u2502 \u2502 Gateway:172.31.0.1 \u2502 \u2502 \u2502 Subnet:16 \u2502 \u2502 \u2502 MacAddress:02:42:ac:1f:00:0a \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 Ports \u2502 LocalPort:9876/tcp \u2502 \u2502 \u2502 GuestPort:9876 \u2502 \u2502 \u2502 \u2502 \u2502 Quotagroups \u2502 appliance_data \u2502 \u2502 \u2502 \u2502 \u2502 State \u2502 running \u2502 \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f","title":"Displaying your GREP11 environment"},{"location":"grep11-lab/grep11-display/#displaying-your-grep11-environment","text":"","title":"Displaying your GREP11 environment"},{"location":"grep11-lab/grep11-display/#list-crypto-domains-on-your-hyper-protect-virtual-servers-lpar","text":"List your available domains with the Hyper Protect Virtual Server CLI: hpvs crypto list Example output hpvs crypto list +---------------+--------+ | CRYPTO.DOMAIN | STATUS | +---------------+--------+ | 08.0016 | in use | | 0a.0016 | in use | +---------------+--------+ A value of in use in the STATUS column indicates that each crypto domain has a GREP11 server connected to it.","title":"List Crypto Domains on your Hyper Protect Virtual Servers LPAR"},{"location":"grep11-lab/grep11-display/#display-the-grep11-servers","text":"Display the virtual servers running on the Hyper Protect Virtual Servers LPAR: hpvs vs list Example output +----------------------+---------+----------------------+----------------------------------------------------------+ | NAMES | STATE | STATUS | IMAGE | +----------------------+---------+----------------------+----------------------------------------------------------+ | collectd | running | Up 2 weeks | ibmzcontainers/collectd-host:1.2.1 | | grep11-08-0016-9876 | running | Up 9 days | ibmzcontainers/hpcs-grep11-prod:1.2.1 | | sbserver_00 | running | Up 9 days | ibmzcontainers/secure-docker-build:1.2.1-release-9b63b43 | | sbserver_19 | running | Up 9 days | ibmzcontainers/secure-docker-build:1.2.1-release-9b63b43 | | grep11-0a-0016-19876 | running | Up 9 days | ibmzcontainers/hpcs-grep11-prod:1.2.1 | | hpvs_bc_08 | running | Up 2 weeks | mplccblockchain/hpvs_bc:latest | | sbserver_08 | running | Up 2 weeks | ibmzcontainers/secure-docker-build:1.2.1-release-9b63b43 | | monitoring | running | Up 2 weeks | ibmzcontainers/monitoring:1.2.1 | | hpvs_grafana | running | Up 8 days | jinxiong/hpvs_grafana:latest | | prom0630_19 | running | Up 9 days | jinxiong/prom0630:latest | | sbserver_07 | running | Up 10 days | ibmzcontainers/secure-docker-build:1.2.1-release-9b63b43 | +----------------------+---------+----------------------+----------------------------------------------------------+ Observe that there are two servers listed whose name starts with grep11 . These are the two GREP11 servers that we have provided. One accessible from host port 9876 and one from host port 19876. Display details about one of the GREP11 servers with this command: hpvs vs show --name grep11-08-0016-9876 Example output \u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502 PROPERTIES \u2502 VALUES \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 Name \u2502 grep11-08-0016-9876 \u2502 \u2502 Status \u2502 Up 9 days \u2502 \u2502 CPU \u2502 1 \u2502 \u2502 Memory \u2502 4096 \u2502 \u2502 Networks \u2502 Network:bridge \u2502 \u2502 \u2502 IPAddress:172.31.0.10 \u2502 \u2502 \u2502 Gateway:172.31.0.1 \u2502 \u2502 \u2502 Subnet:16 \u2502 \u2502 \u2502 MacAddress:02:42:ac:1f:00:0a \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 Ports \u2502 LocalPort:9876/tcp \u2502 \u2502 \u2502 GuestPort:9876 \u2502 \u2502 \u2502 \u2502 \u2502 Quotagroups \u2502 appliance_data \u2502 \u2502 \u2502 \u2502 \u2502 State \u2502 running \u2502 \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f","title":"Display the GREP11 servers"},{"location":"grep11-lab/grep11-setup/","text":"How to set up a GREP11 server \u00b6 Hyper Protect Virtual Servers LPAR setup \u00b6 Hyper Protect Virtual Servers runs in an LPAR that is defined in Secure Service Container (SSC) mode. Defining an LPAR is a normal task for an IBM Z or LinuxONE systems administrator, typically performed from the Hardware Management Console (HMC). The systems administrator must 1 dedicate one or more domains of one or more Crypto Express cards to the Hyper Protect Virtual Servers LPAR in order to use the GREP11 server. These Crypto Express cards must be defined in EP11 mode to your IBM Z or LinuxONE server in order to be used by a GREP11 server. These tasks are documented in the Hyper Protect Virtual Servers documentation, or in IBM publications referenced in the Hyper Protect Virtual Servers documentation. The version of Hyper Protect Virtual Servers that we will be using in this lab is actually a pre-release version of 1.2.1, expected to be available soon, and this lab will be updated to include a public link to the documentation when it becomes available. A GREP11 server communicates with one and only one Crypto Express domain, and vice versa. You can run multiple GREP11 servers if you have multiple domains configured to your Hyper Protect Virtual Servers LPAR. Overview of GREP11 server setup \u00b6 This section provides an overview of what the remaining sections of this page will provide in detail. The following steps are required: Create a Certification Authority (CA) certificate and key Create a GREP11 server X.509 certificate for TLS authentication Create an X.509 certificate for your client application for TLS authentication List Crypto Domains on your Hyper Protect Virtual Servers LPAR Create YAML and/or JSON configuration files for GREP11 server initialization Start the GREP11 server Important The commands shown on this page are for reference only- they have already been performed by the lab instructors in order to set up the lab environment for you. Create a Certification Authority (CA) certificate and key \u00b6 The openssl utility is used to generate a private key and a certificate that will act as a certification authority (CA). This will be used in later steps to issue certificates for the GREP11 server and for the client application which will connect to the GREP11 server. Whenever you browse the web to a site with https , the server presents its certificate to your browser. This is known as server-side or one-way TLS authentication. Most websites do not ask you to present a certificate. The website makes itself available to anybody who browses to it. With mutual TLS authentication, the client does need to present a certificate. The server will only establish a session with a client who presents a certificate that is trusted by the server. This prevents our GREP11 server from being used by unauthorized clients. The following command was used to create the RSA private key which will be used by our soon to be created CA openssl genrsa -out ca.key 2048 This created a file named ca.key which is an RSA private key. What isn't commonly known, but is true, is that the RSA public key is contained within the private key. It is for this reason that the private key is used as input to the following command, which will create a Certification Authority X.509 certificate. X.509 certificates contain information identifying the certificate holder, the attributes of the certificate, including what the certificate can be used for, and, importantly, the public key. We used this command to create this certificate. openssl req -new -x509 -key ca.key -out ca.pem The ca.key file was input to this command, and the ca.pem file is the output of this command. This ca.pem file is our \"homegrown\" certification authority root certificate. I will use the Linux cat command to get a raw listing of the root certificate we just created: cat cat.pem Example output -----BEGIN CERTIFICATE----- MIIDtTCCAp2gAwIBAgIUe4lZppOfAoaQvSSDJ4fayWJwyd0wDQYJKoZIhvcNAQEL BQAwajELMAkGA1UEBhMCVVMxETAPBgNVBAgMCFZpcmdpbmlhMRAwDgYDVQQHDAdI ZXJuZG9uMQwwCgYDVQQKDANJQk0xEDAOBgNVBAsMB0lCTSBXU0MxFjAUBgNVBAMM DTE5Mi4xNjguMjIuNzkwHhcNMjAwNjExMTczOTM0WhcNMjAwNzExMTczOTM0WjBq MQswCQYDVQQGEwJVUzERMA8GA1UECAwIVmlyZ2luaWExEDAOBgNVBAcMB0hlcm5k b24xDDAKBgNVBAoMA0lCTTEQMA4GA1UECwwHSUJNIFdTQzEWMBQGA1UEAwwNMTky LjE2OC4yMi43OTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMporCRt +PblqQ54xamzxn6XdOTYgIGdih1ifORB+jeBUNpXOcotcP7qZarafVyHL2EFEK1e xDmPz2G69hNtwx+V3YD1uCOuTmRQQvtqAp6PTj9b4hdKs4IXzmDUxmWP7xi+VbuP E9YsxBJpLk/uzhhfAFCWWqLI+/IA9qs/O/hMDaK5pn/lDlDvjR5Cqem8xmTAzVQ3 qE6CYk4FOwyS2hNGN6rp7qCm1y7mD8igcu7yXyp7n6HGFCFn1FEZbJaRY7ls7kg6 mZWEejsH6maSN7UCmNsrFCknYD/D0FcdU4uA4sRnghesJj2pgTHZOjQs7EoXwJdn l5tBbgesnUs3Gu8CAwEAAaNTMFEwHQYDVR0OBBYEFIZjwWSeH3dt9o614z6XFcMO Tt1LMB8GA1UdIwQYMBaAFIZjwWSeH3dt9o614z6XFcMOTt1LMA8GA1UdEwEB/wQF MAMBAf8wDQYJKoZIhvcNAQELBQADggEBAFJfCqrHxxRGYhK70GkjojWSY9MZ0vvi sTFUteBz5GBKxo3P1Pk3ZvniWJH/b9UyF36mEa/iTgI0o+ffcYvvqZr3qavxDbhi PgqNgAYPiXnPDJ4MStY5+6hClzycZroJqNJVeZbleNHIOA64LO+zwFpZXLxygZGx 0xiU277HvtrO0ayWWCxHq9XNP4FPsrIw5m5RhvB3dFm6fxYSYTKbIV3vQtDNfMxW Ww7XtPnbwOm0BBkN1poL/jmeA/7lxUCGNr9IKh5PZtT1j+Laa/VhTlWt00qT6mAV 861YN3vvo2U8F36omKKnYlCxojea0ECTRNp09B3CHEDBGKv6JdBXvtQ= -----END CERTIFICATE----- The first and last lines are meant to assure you that this is a certificate, but the lines in between are less insightful. Fortunately the openssl utility comes to our rescue and allows us to print the certificate in geek- and human-readable form: openssl x509 -in ca.pem -text Example output Certificate: Data: Version: 3 ( 0x2 ) Serial Number: 7b:89:59:a6:93:9f:02:86:90:bd:24:83:27:87:da:c9:62:70:c9:dd Signature Algorithm: sha256WithRSAEncryption Issuer: C = US, ST = Virginia, L = Herndon, O = IBM, OU = IBM WSC, CN = 192 .168.22.79 Validity Not Before: Jun 11 17 :39:34 2020 GMT Not After : Jul 11 17 :39:34 2020 GMT Subject: C = US, ST = Virginia, L = Herndon, O = IBM, OU = IBM WSC, CN = 192 .168.22.79 Subject Public Key Info: Public Key Algorithm: rsaEncryption RSA Public-Key: ( 2048 bit ) Modulus: 00 :ca:68:ac:24:6d:f8:f6:e5:a9:0e:78:c5:a9:b3: c6:7e:97:74:e4:d8:80:81:9d:8a:1d:62:7c:e4:41: fa:37:81:50:da:57:39:ca:2d:70:fe:ea:65:aa:da: 7d:5c:87:2f:61:05:10:ad:5e:c4:39:8f:cf:61:ba: f6:13:6d:c3:1f:95:dd:80:f5:b8:23:ae:4e:64:50: 42 :fb:6a:02:9e:8f:4e:3f:5b:e2:17:4a:b3:82:17: ce:60:d4:c6:65:8f:ef:18:be:55:bb:8f:13:d6:2c: c4:12:69:2e:4f:ee:ce:18:5f:00:50:96:5a:a2:c8: fb:f2:00:f6:ab:3f:3b:f8:4c:0d:a2:b9:a6:7f:e5: 0e:50:ef:8d:1e:42:a9:e9:bc:c6:64:c0:cd:54:37: a8:4e:82:62:4e:05:3b:0c:92:da:13:46:37:aa:e9: ee:a0:a6:d7:2e:e6:0f:c8:a0:72:ee:f2:5f:2a:7b: 9f:a1:c6:14:21:67:d4:51:19:6c:96:91:63:b9:6c: ee:48:3a:99:95:84:7a:3b:07:ea:66:92:37:b5:02: 98 :db:2b:14:29:27:60:3f:c3:d0:57:1d:53:8b:80: e2:c4:67:82:17:ac:26:3d:a9:81:31:d9:3a:34:2c: ec:4a:17:c0:97:67:97:9b:41:6e:07:ac:9d:4b:37: 1a:ef Exponent: 65537 ( 0x10001 ) X509v3 extensions: X509v3 Subject Key Identifier: 86 :63:C1:64:9E:1F:77:6D:F6:8E:B5:E3:3E:97:15:C3:0E:4E:DD:4B X509v3 Authority Key Identifier: keyid:86:63:C1:64:9E:1F:77:6D:F6:8E:B5:E3:3E:97:15:C3:0E:4E:DD:4B X509v3 Basic Constraints: critical CA:TRUE Signature Algorithm: sha256WithRSAEncryption 52 :5f:0a:aa:c7:c7:14:46:62:12:bb:d0:69:23:a2:35:92:63: d3:19:d2:fb:e2:b1:31:54:b5:e0:73:e4:60:4a:c6:8d:cf:d4: f9:37:66:f9:e2:58:91:ff:6f:d5:32:17:7e:a6:11:af:e2:4e: 02 :34:a3:e7:df:71:8b:ef:a9:9a:f7:a9:ab:f1:0d:b8:62:3e: 0a:8d:80:06:0f:89:79:cf:0c:9e:0c:4a:d6:39:fb:a8:42:97: 3c:9c:66:ba:09:a8:d2:55:79:96:e5:78:d1:c8:38:0e:b8:2c: ef:b3:c0:5a:59:5c:bc:72:81:91:b1:d3:18:94:db:be:c7:be: da:ce:d1:ac:96:58:2c:47:ab:d5:cd:3f:81:4f:b2:b2:30:e6: 6e:51:86:f0:77:74:59:ba:7f:16:12:61:32:9b:21:5d:ef:42: d0:cd:7c:cc:56:5b:0e:d7:b4:f9:db:c0:e9:b4:04:19:0d:d6: 9a:0b:fe:39:9e:03:fe:e5:c5:40:86:36:bf:48:2a:1e:4f:66: d4:f5:8f:e2:da:6b:f5:61:4e:55:ad:d3:4a:93:ea:60:15:f3: ad:58:37:7b:ef:a3:65:3c:17:7e:a8:98:a2:a7:62:50:b1:a2: 37 :9a:d0:40:93:44:da:74:f4:1d:c2:1c:40:c1:18:ab:fa:25: d0:57:be:d4 -----BEGIN CERTIFICATE----- MIIDtTCCAp2gAwIBAgIUe4lZppOfAoaQvSSDJ4fayWJwyd0wDQYJKoZIhvcNAQEL BQAwajELMAkGA1UEBhMCVVMxETAPBgNVBAgMCFZpcmdpbmlhMRAwDgYDVQQHDAdI ZXJuZG9uMQwwCgYDVQQKDANJQk0xEDAOBgNVBAsMB0lCTSBXU0MxFjAUBgNVBAMM DTE5Mi4xNjguMjIuNzkwHhcNMjAwNjExMTczOTM0WhcNMjAwNzExMTczOTM0WjBq MQswCQYDVQQGEwJVUzERMA8GA1UECAwIVmlyZ2luaWExEDAOBgNVBAcMB0hlcm5k b24xDDAKBgNVBAoMA0lCTTEQMA4GA1UECwwHSUJNIFdTQzEWMBQGA1UEAwwNMTky LjE2OC4yMi43OTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMporCRt +PblqQ54xamzxn6XdOTYgIGdih1ifORB+jeBUNpXOcotcP7qZarafVyHL2EFEK1e xDmPz2G69hNtwx+V3YD1uCOuTmRQQvtqAp6PTj9b4hdKs4IXzmDUxmWP7xi+VbuP E9YsxBJpLk/uzhhfAFCWWqLI+/IA9qs/O/hMDaK5pn/lDlDvjR5Cqem8xmTAzVQ3 qE6CYk4FOwyS2hNGN6rp7qCm1y7mD8igcu7yXyp7n6HGFCFn1FEZbJaRY7ls7kg6 mZWEejsH6maSN7UCmNsrFCknYD/D0FcdU4uA4sRnghesJj2pgTHZOjQs7EoXwJdn l5tBbgesnUs3Gu8CAwEAAaNTMFEwHQYDVR0OBBYEFIZjwWSeH3dt9o614z6XFcMO Tt1LMB8GA1UdIwQYMBaAFIZjwWSeH3dt9o614z6XFcMOTt1LMA8GA1UdEwEB/wQF MAMBAf8wDQYJKoZIhvcNAQELBQADggEBAFJfCqrHxxRGYhK70GkjojWSY9MZ0vvi sTFUteBz5GBKxo3P1Pk3ZvniWJH/b9UyF36mEa/iTgI0o+ffcYvvqZr3qavxDbhi PgqNgAYPiXnPDJ4MStY5+6hClzycZroJqNJVeZbleNHIOA64LO+zwFpZXLxygZGx 0xiU277HvtrO0ayWWCxHq9XNP4FPsrIw5m5RhvB3dFm6fxYSYTKbIV3vQtDNfMxW Ww7XtPnbwOm0BBkN1poL/jmeA/7lxUCGNr9IKh5PZtT1j+Laa/VhTlWt00qT6mAV 861YN3vvo2U8F36omKKnYlCxojea0ECTRNp09B3CHEDBGKv6JdBXvtQ = -----END CERTIFICATE----- A few lines of the output above have been highlighted. Notice the highlighted line that says CA: TRUE . This attribute indicates that this certificate is acting as a certification authority and can issue other certificates. Notice the lines above it which have values for Subject Key Identifier and Authority Key Identifier . Subject Key Identifier is the identity of the holder of the certificate. Authority Key Identifier is the identity of the issuer of the certificate. You can see that the values for these are the same. This is known as a self-signed certificate . Certification authorities (CA) exist in a hierarchy- one CA can issue a certificate to another CA with the CA: TRUE attribute, and so forth. In our lab we have this single, homegrown certification authority that we created, with its self-signed certificate that we created per the instructions in the Hyper Protect Virtual Servers documentation. Create a GREP11 server X.509 certificate for TLS authentication \u00b6 Once we created a \"homegown\" certification authority, we next created an X.509 certificate for our GREP11 server. This certificate was issued by our certification authority. The first step was to create another RSA private key that our GREP11 server will use: openssl genrsa -out server80-9876-19876-key.pem 2048 Note The value of the -out argument, server80-9876-19876-key.pem can be whatever you want it to be. I named it what I did for a reason. the 80 in server80 is for the last octet of my Hyper Protect Virtual Servers LPAR's IP adresss, 192.168.22.80, and I intend to use this certificate for two GREP11 servers, one listening on port 9876 on one of the LPAR's Crypto Express 7S domains, and the second server will listen on port 19876 on the LPAR's second Crypto Express 7S domain. Then, this private key was used as input to openssl in order to create a certificate signing request : openssl req -new -key server80-9876-19876-key.pem -out server80-9876-19876.csr The certificate signing request will be passed to our certification authority which will use the information to create an X.509 certificate. We used openssl for this, too: openssl x509 -sha256 -req -in server80-9876-19876.csr -CA ca.pem -CAkey ca.key -set_serial 8086 -extfile openssl.cnf -extensions server -days 36500 -outform PEM -out server80-9876-19876.pem The file name of the certificate that was created by the preceding command is the value of the -out argument, server80-9876-19876.pem . openssl allows us to list this certificate in human-friendly form: openssl x509 -in server80-9876-19876.pem -noout -text Example output Certificate: Data: Version: 3 (0x2) Serial Number: 8086 (0x1f96) Signature Algorithm: sha256WithRSAEncryption Issuer: C = US, ST = Virginia, L = Herndon, O = IBM, OU = IBM WSC, CN = 192.168.22.79 Validity Not Before: Jun 30 19:45:06 2020 GMT Not After : Jun 6 19:45:06 2120 GMT Subject: C = US, ST = Virginia, L = Herndon, O = IBM, OU = IBM WSC, CN = 192.168.22.80 Subject Public Key Info: Public Key Algorithm: rsaEncryption RSA Public-Key: (2048 bit) Modulus: 00:c2:66:77:9d:ef:38:ab:48:05:8d:ad:7d:aa:03: b6:b1:23:d9:39:81:20:6b:d1:60:21:64:a2:b4:c3: 71:9d:c7:36:0b:12:f9:51:ea:75:62:bd:02:11:54: 7d:22:bd:38:75:2e:7b:77:05:4b:5e:63:a0:2d:55: 72:51:b7:28:03:0c:1a:72:8e:d3:b1:64:b2:40:4e: 25:61:ab:d7:fe:44:e7:d1:0d:5e:dd:19:d6:af:e2: 9e:1f:34:f9:44:c0:8c:c3:b0:e4:f3:43:4b:48:dd: 34:8c:82:25:01:0b:a0:ad:f7:80:92:f2:84:d9:55: 4d:e0:7d:85:78:b9:f6:de:e6:9f:61:cf:ff:b1:ed: 93:24:06:e7:51:fd:ae:c0:7f:f4:49:61:ab:c8:c8: 46:1d:da:f2:76:97:f8:87:4f:a3:3c:c4:c4:46:00: 83:77:11:86:78:4f:cb:c2:b7:7d:18:fc:15:10:78: 90:10:96:3e:9c:cb:1f:ce:c5:1d:4f:88:72:11:88: 36:8e:42:34:7f:a0:51:0c:82:ee:d5:46:d4:b3:f5: 7d:d0:53:6f:22:18:01:d5:08:fa:73:12:6c:02:d6: 9f:53:c9:23:e7:46:c9:21:7e:66:3e:e0:01:44:f8: 34:e4:d8:37:30:ff:f0:83:a2:ba:a3:fb:ec:cd:01: 89:43 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Basic Constraints: CA:FALSE X509v3 Key Usage: Digital Signature, Key Encipherment, Data Encipherment X509v3 Extended Key Usage: TLS Web Server Authentication Netscape Cert Type: SSL Server X509v3 CRL Distribution Points: Full Name: URI:http://localhost/ca.crl X509v3 Subject Alternative Name: DNS:192.168.22.80:9876, DNS:192.168.22.80:19876, IP Address:192.168.22.80 Signature Algorithm: sha256WithRSAEncryption c1:64:4d:f9:81:66:0f:a8:44:63:8f:1c:82:3b:1e:05:45:b2: 51:5f:b2:8a:cd:e3:e9:5b:1e:83:e8:a9:54:21:01:57:20:49: b6:6a:e2:a4:58:24:44:73:5c:e4:81:88:57:e1:d9:ca:ef:2c: d9:b3:20:05:e4:0d:e9:46:22:3f:82:27:1e:b5:8a:7b:84:ef: 2a:af:b2:78:58:c2:a2:37:fa:dc:8d:75:4b:09:6d:67:b7:eb: f4:91:fc:2b:14:ef:94:75:1e:93:f1:7b:5d:69:23:8e:de:1e: 69:9e:a8:b9:62:47:28:ab:18:6a:00:0b:9f:b6:5e:cf:62:74: 57:df:1f:15:a0:81:4f:21:bc:c3:08:05:c1:c1:8d:a1:fa:78: 3d:e8:be:b8:eb:03:9c:3e:fa:8a:7d:70:09:56:47:4b:20:ea: 02:3e:85:dc:a0:af:81:77:c9:1d:91:a2:68:b7:9c:c4:8f:a1: dc:48:16:4f:38:5d:c7:d3:dc:51:b0:ff:a4:1b:aa:71:fe:34: b0:59:04:43:a6:88:69:78:41:56:70:cb:7b:e1:2a:55:e1:1b: f0:2a:11:25:ac:58:81:15:b0:9b:7f:f0:45:3f:ef:70:05:ce: 81:4f:3e:9f:17:4a:70:f2:65:65:3d:52:7e:af:59:46:d3:f8: 44:71:e6:c9 Create an X.509 certificate for your client application for TLS authentication \u00b6 The client applications need a certificate that is issued by the same certification authority that the GREP11 server uses. The process is similar- create a private key, pass that as input for the creation of a certificte signing request, and then pass that to the certification authority in order to receive a certificate. We used these commands: openssl genrsa -out client-key.pem 2048 openssl req -new -key client-key.pem -out client.csr openssl x509 -req -days 1000 -in client.csr -CA ca.pem -CAcreateserial -CAkey ca.key -out client.pem Note For the lab, each student will use a copy of the same client certificate. In most production use cases each client would use their own certificate which uniquely identifies them. List Crypto Domains on your Hyper Protect Virtual Servers LPAR \u00b6 You can list your available domains with the Hyper Protect Virtual Server CLI: hpvs crypto list Example output hpvs crypto list +---------------+--------+ | CRYPTO.DOMAIN | STATUS | +---------------+--------+ | 08.0016 | online | | 0a.0016 | online | +---------------+--------+ The values shown in the CRYPTO.DOMAIN column are in hexadecimal. So, translating to decimal, our LPAR is using Crypto Express 7S cards 8 and 10, with domain 22 in both cards assigned to our LPAR. (A Crypto Express 7S card can have up to 85 domains- think of each domain as a \"virtual\" Crypto Express 7S card). Create YAML or JSON configuration files for GREP11 server \u00b6 There are two alternative ways to start your GREP11 server: Using hpvs deploy with a YAML file as input Using hpvs vs create with a JSON file as input I will show both files formats (YAML and JSON) first. Then I will show both methods of starting the GREP11 server, and then explain the difference between the two start methods. YAML file for GREP11 server configuration \u00b6 This is the YAML file for a GREP11 server that will listen for client connections on port 9876, and will use domain 22 (hex 16) of Crypto Express 7S card 08: GREP11 server YAML configuration file version: v1 # # use this file with the 'hpvs deploy' command, e.g., # # hpvs deploy --config $HOME/hpvs/config/grep11/vs_grep11_80-9876.yml # type: virtualserver virtualservers: - name: grep11-08-0016-9876 host: wsclpar80 repoid: hpcsKpGrep11_runq imagetag: 1.2.1 imagefile: hpcsKpGrep11_runq.tar.gz crypto: crypto_matrix: - 08.0016 environment: - key: EP11SERVER_EP11CRYPTO_DOMAIN value: \"08.0016\" # - key: EP11SERVER_EP11CRYPTO_CONNECTION_TLS_CERTFILEBYTES value: \"@/home/hyper-protect-lab/hpvs/config/grep11/keys/server80-9876-19876.pem\" - key: EP11SERVER_EP11CRYPTO_CONNECTION_TLS_KEYFILEBYTES value: \"@/home/hyper-protect-lab/hpvs/config/grep11/keys/server80-9876-19876-key.pem\" - key: EP11SERVER_EP11CRYPTO_CONNECTION_TLS_CACERTBYTES value: \"@/home/hyper-protect-lab/hpvs/config/grep11/keys/ca.pem\" - key: EP11SERVER_EP11CRYPTO_CONNECTION_TLS_ENABLED value: \"true\" - key: EP11SERVER_EP11CRYPTO_CONNECTION_TLS_MUTUAL value: \"true\" - key: TLS_GRPC_CERTS_DOMAIN_CRT value: \"\\\\n\" - key: TLS_GRPC_CERTS_DOMAIN_KEY value: \"\\\\n\" - key: TLS_GRPC_CERTS_ROOTCA_CRT value: \"\\\\n\" ports: - hostport: 9876 protocol: tcp containerport: 9876 JSON file for GREP11 server configuration \u00b6 This is a JSON file for a GREP11 server that will listen for client connections on port 9876, and will use domain 22 (hex 16) of Crypto Express 7S card 08: GREP11 server JSON configuration file { \"EP11SERVER_EP11CRYPTO_DOMAIN\":\"08.0016\", \"EP11SERVER_EP11CRYPTO_CONNECTION_TLS_CERTFILEBYTES\":\"@/home/hyper-protect-lab/hpvs/config/grep11/keys/server80-9876-19876.pem\", \"EP11SERVER_EP11CRYPTO_CONNECTION_TLS_KEYFILEBYTES\":\"@/home/hyper-protect-lab/hpvs/config/grep11/keys/server80-9876-19876-key.pem\", \"EP11SERVER_EP11CRYPTO_CONNECTION_TLS_CACERTBYTES\":\"@/home/hyper-protect-lab/hpvs/config/grep11/keys/ca.pem\", \"EP11SERVER_EP11CRYPTO_CONNECTION_TLS_ENABLED\":true, \"EP11SERVER_EP11CRYPTO_CONNECTION_TLS_MUTUAL\":true, \"TLS_GRPC_CERTS_DOMAIN_CRT\":\"\\\\n\", \"TLS_GRPC_CERTS_DOMAIN_KEY\":\"\\\\n\", \"TLS_GRPC_CERTS_ROOTCA_CRT\":\"\\\\n\" } Start the GREP11 server \u00b6 If you looked carefully at the JSON file and the YAML file in the previous section, you may have noticed that the YAML file contains more information than the JSON file contains. As a result, the syntax is simpler for the command that uses the YAML file. The command that uses the JSON file uses command line arguments to provide some of the information that the YAML file contained. Compare the two methods: Command to start the GREP11 server with the YAML file hpvs deploy --config $HOME/hpvs/config/grep11/vs_grep11_80-9876.yml Command to start the GREP11 server with the JSON file hpvs vs create --name grep11-08-0016-9876 --repo hpcsKpGrep11_runq --tag 1.2.1 --crypto_matrix=08.0016 --cpu 2 --ram 2048 --envjsonpath ${HOME}/hpvs/config/grep11/grep11_env_08.0016.json --ports \"{containerport = 9876, protocol = tcp, hostport = 9876}\" Difference between the two commands I like the simplicity of the hpvs deploy method much better than the long syntax of the hpvs vs create command. But the hpvs vs create command has a benefit- the hpvs deploy command uploads the GREP11 server Docker image from your workstation where you run the CLI to the Hyper Protect Virtual Server LPAR, every single time. This Docker image only needs to be sent up once. The hpvs vs create command is smart enough to have this figured out and not do the unnecessary upload of the Docker image the second and subsequent times you run it. Note Starting now, when you navigate to the next section of the lab, you should enter all the commands shown in the lab. Only the commands in this section were for reference. The GREP11 server is a feature provided by Hyper Protect Virtual Servers. You are not required to use it. If you do not use this feature, you do not have to define Crypto Express domains to the LPAR. You may wish to for other purposes, and you can use the other modes offered by Crypto Express cards for those purposes, but you must use EP11 mode for usage by the GREP11 server. \u21a9","title":"How to set up a GREP11 server"},{"location":"grep11-lab/grep11-setup/#how-to-set-up-a-grep11-server","text":"","title":"How to set up a GREP11 server"},{"location":"grep11-lab/grep11-setup/#hyper-protect-virtual-servers-lpar-setup","text":"Hyper Protect Virtual Servers runs in an LPAR that is defined in Secure Service Container (SSC) mode. Defining an LPAR is a normal task for an IBM Z or LinuxONE systems administrator, typically performed from the Hardware Management Console (HMC). The systems administrator must 1 dedicate one or more domains of one or more Crypto Express cards to the Hyper Protect Virtual Servers LPAR in order to use the GREP11 server. These Crypto Express cards must be defined in EP11 mode to your IBM Z or LinuxONE server in order to be used by a GREP11 server. These tasks are documented in the Hyper Protect Virtual Servers documentation, or in IBM publications referenced in the Hyper Protect Virtual Servers documentation. The version of Hyper Protect Virtual Servers that we will be using in this lab is actually a pre-release version of 1.2.1, expected to be available soon, and this lab will be updated to include a public link to the documentation when it becomes available. A GREP11 server communicates with one and only one Crypto Express domain, and vice versa. You can run multiple GREP11 servers if you have multiple domains configured to your Hyper Protect Virtual Servers LPAR.","title":"Hyper Protect Virtual Servers LPAR setup"},{"location":"grep11-lab/grep11-setup/#overview-of-grep11-server-setup","text":"This section provides an overview of what the remaining sections of this page will provide in detail. The following steps are required: Create a Certification Authority (CA) certificate and key Create a GREP11 server X.509 certificate for TLS authentication Create an X.509 certificate for your client application for TLS authentication List Crypto Domains on your Hyper Protect Virtual Servers LPAR Create YAML and/or JSON configuration files for GREP11 server initialization Start the GREP11 server Important The commands shown on this page are for reference only- they have already been performed by the lab instructors in order to set up the lab environment for you.","title":"Overview of GREP11 server setup"},{"location":"grep11-lab/grep11-setup/#create-a-certification-authority-ca-certificate-and-key","text":"The openssl utility is used to generate a private key and a certificate that will act as a certification authority (CA). This will be used in later steps to issue certificates for the GREP11 server and for the client application which will connect to the GREP11 server. Whenever you browse the web to a site with https , the server presents its certificate to your browser. This is known as server-side or one-way TLS authentication. Most websites do not ask you to present a certificate. The website makes itself available to anybody who browses to it. With mutual TLS authentication, the client does need to present a certificate. The server will only establish a session with a client who presents a certificate that is trusted by the server. This prevents our GREP11 server from being used by unauthorized clients. The following command was used to create the RSA private key which will be used by our soon to be created CA openssl genrsa -out ca.key 2048 This created a file named ca.key which is an RSA private key. What isn't commonly known, but is true, is that the RSA public key is contained within the private key. It is for this reason that the private key is used as input to the following command, which will create a Certification Authority X.509 certificate. X.509 certificates contain information identifying the certificate holder, the attributes of the certificate, including what the certificate can be used for, and, importantly, the public key. We used this command to create this certificate. openssl req -new -x509 -key ca.key -out ca.pem The ca.key file was input to this command, and the ca.pem file is the output of this command. This ca.pem file is our \"homegrown\" certification authority root certificate. I will use the Linux cat command to get a raw listing of the root certificate we just created: cat cat.pem Example output -----BEGIN CERTIFICATE----- MIIDtTCCAp2gAwIBAgIUe4lZppOfAoaQvSSDJ4fayWJwyd0wDQYJKoZIhvcNAQEL BQAwajELMAkGA1UEBhMCVVMxETAPBgNVBAgMCFZpcmdpbmlhMRAwDgYDVQQHDAdI ZXJuZG9uMQwwCgYDVQQKDANJQk0xEDAOBgNVBAsMB0lCTSBXU0MxFjAUBgNVBAMM DTE5Mi4xNjguMjIuNzkwHhcNMjAwNjExMTczOTM0WhcNMjAwNzExMTczOTM0WjBq MQswCQYDVQQGEwJVUzERMA8GA1UECAwIVmlyZ2luaWExEDAOBgNVBAcMB0hlcm5k b24xDDAKBgNVBAoMA0lCTTEQMA4GA1UECwwHSUJNIFdTQzEWMBQGA1UEAwwNMTky LjE2OC4yMi43OTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMporCRt +PblqQ54xamzxn6XdOTYgIGdih1ifORB+jeBUNpXOcotcP7qZarafVyHL2EFEK1e xDmPz2G69hNtwx+V3YD1uCOuTmRQQvtqAp6PTj9b4hdKs4IXzmDUxmWP7xi+VbuP E9YsxBJpLk/uzhhfAFCWWqLI+/IA9qs/O/hMDaK5pn/lDlDvjR5Cqem8xmTAzVQ3 qE6CYk4FOwyS2hNGN6rp7qCm1y7mD8igcu7yXyp7n6HGFCFn1FEZbJaRY7ls7kg6 mZWEejsH6maSN7UCmNsrFCknYD/D0FcdU4uA4sRnghesJj2pgTHZOjQs7EoXwJdn l5tBbgesnUs3Gu8CAwEAAaNTMFEwHQYDVR0OBBYEFIZjwWSeH3dt9o614z6XFcMO Tt1LMB8GA1UdIwQYMBaAFIZjwWSeH3dt9o614z6XFcMOTt1LMA8GA1UdEwEB/wQF MAMBAf8wDQYJKoZIhvcNAQELBQADggEBAFJfCqrHxxRGYhK70GkjojWSY9MZ0vvi sTFUteBz5GBKxo3P1Pk3ZvniWJH/b9UyF36mEa/iTgI0o+ffcYvvqZr3qavxDbhi PgqNgAYPiXnPDJ4MStY5+6hClzycZroJqNJVeZbleNHIOA64LO+zwFpZXLxygZGx 0xiU277HvtrO0ayWWCxHq9XNP4FPsrIw5m5RhvB3dFm6fxYSYTKbIV3vQtDNfMxW Ww7XtPnbwOm0BBkN1poL/jmeA/7lxUCGNr9IKh5PZtT1j+Laa/VhTlWt00qT6mAV 861YN3vvo2U8F36omKKnYlCxojea0ECTRNp09B3CHEDBGKv6JdBXvtQ= -----END CERTIFICATE----- The first and last lines are meant to assure you that this is a certificate, but the lines in between are less insightful. Fortunately the openssl utility comes to our rescue and allows us to print the certificate in geek- and human-readable form: openssl x509 -in ca.pem -text Example output Certificate: Data: Version: 3 ( 0x2 ) Serial Number: 7b:89:59:a6:93:9f:02:86:90:bd:24:83:27:87:da:c9:62:70:c9:dd Signature Algorithm: sha256WithRSAEncryption Issuer: C = US, ST = Virginia, L = Herndon, O = IBM, OU = IBM WSC, CN = 192 .168.22.79 Validity Not Before: Jun 11 17 :39:34 2020 GMT Not After : Jul 11 17 :39:34 2020 GMT Subject: C = US, ST = Virginia, L = Herndon, O = IBM, OU = IBM WSC, CN = 192 .168.22.79 Subject Public Key Info: Public Key Algorithm: rsaEncryption RSA Public-Key: ( 2048 bit ) Modulus: 00 :ca:68:ac:24:6d:f8:f6:e5:a9:0e:78:c5:a9:b3: c6:7e:97:74:e4:d8:80:81:9d:8a:1d:62:7c:e4:41: fa:37:81:50:da:57:39:ca:2d:70:fe:ea:65:aa:da: 7d:5c:87:2f:61:05:10:ad:5e:c4:39:8f:cf:61:ba: f6:13:6d:c3:1f:95:dd:80:f5:b8:23:ae:4e:64:50: 42 :fb:6a:02:9e:8f:4e:3f:5b:e2:17:4a:b3:82:17: ce:60:d4:c6:65:8f:ef:18:be:55:bb:8f:13:d6:2c: c4:12:69:2e:4f:ee:ce:18:5f:00:50:96:5a:a2:c8: fb:f2:00:f6:ab:3f:3b:f8:4c:0d:a2:b9:a6:7f:e5: 0e:50:ef:8d:1e:42:a9:e9:bc:c6:64:c0:cd:54:37: a8:4e:82:62:4e:05:3b:0c:92:da:13:46:37:aa:e9: ee:a0:a6:d7:2e:e6:0f:c8:a0:72:ee:f2:5f:2a:7b: 9f:a1:c6:14:21:67:d4:51:19:6c:96:91:63:b9:6c: ee:48:3a:99:95:84:7a:3b:07:ea:66:92:37:b5:02: 98 :db:2b:14:29:27:60:3f:c3:d0:57:1d:53:8b:80: e2:c4:67:82:17:ac:26:3d:a9:81:31:d9:3a:34:2c: ec:4a:17:c0:97:67:97:9b:41:6e:07:ac:9d:4b:37: 1a:ef Exponent: 65537 ( 0x10001 ) X509v3 extensions: X509v3 Subject Key Identifier: 86 :63:C1:64:9E:1F:77:6D:F6:8E:B5:E3:3E:97:15:C3:0E:4E:DD:4B X509v3 Authority Key Identifier: keyid:86:63:C1:64:9E:1F:77:6D:F6:8E:B5:E3:3E:97:15:C3:0E:4E:DD:4B X509v3 Basic Constraints: critical CA:TRUE Signature Algorithm: sha256WithRSAEncryption 52 :5f:0a:aa:c7:c7:14:46:62:12:bb:d0:69:23:a2:35:92:63: d3:19:d2:fb:e2:b1:31:54:b5:e0:73:e4:60:4a:c6:8d:cf:d4: f9:37:66:f9:e2:58:91:ff:6f:d5:32:17:7e:a6:11:af:e2:4e: 02 :34:a3:e7:df:71:8b:ef:a9:9a:f7:a9:ab:f1:0d:b8:62:3e: 0a:8d:80:06:0f:89:79:cf:0c:9e:0c:4a:d6:39:fb:a8:42:97: 3c:9c:66:ba:09:a8:d2:55:79:96:e5:78:d1:c8:38:0e:b8:2c: ef:b3:c0:5a:59:5c:bc:72:81:91:b1:d3:18:94:db:be:c7:be: da:ce:d1:ac:96:58:2c:47:ab:d5:cd:3f:81:4f:b2:b2:30:e6: 6e:51:86:f0:77:74:59:ba:7f:16:12:61:32:9b:21:5d:ef:42: d0:cd:7c:cc:56:5b:0e:d7:b4:f9:db:c0:e9:b4:04:19:0d:d6: 9a:0b:fe:39:9e:03:fe:e5:c5:40:86:36:bf:48:2a:1e:4f:66: d4:f5:8f:e2:da:6b:f5:61:4e:55:ad:d3:4a:93:ea:60:15:f3: ad:58:37:7b:ef:a3:65:3c:17:7e:a8:98:a2:a7:62:50:b1:a2: 37 :9a:d0:40:93:44:da:74:f4:1d:c2:1c:40:c1:18:ab:fa:25: d0:57:be:d4 -----BEGIN CERTIFICATE----- MIIDtTCCAp2gAwIBAgIUe4lZppOfAoaQvSSDJ4fayWJwyd0wDQYJKoZIhvcNAQEL BQAwajELMAkGA1UEBhMCVVMxETAPBgNVBAgMCFZpcmdpbmlhMRAwDgYDVQQHDAdI ZXJuZG9uMQwwCgYDVQQKDANJQk0xEDAOBgNVBAsMB0lCTSBXU0MxFjAUBgNVBAMM DTE5Mi4xNjguMjIuNzkwHhcNMjAwNjExMTczOTM0WhcNMjAwNzExMTczOTM0WjBq MQswCQYDVQQGEwJVUzERMA8GA1UECAwIVmlyZ2luaWExEDAOBgNVBAcMB0hlcm5k b24xDDAKBgNVBAoMA0lCTTEQMA4GA1UECwwHSUJNIFdTQzEWMBQGA1UEAwwNMTky LjE2OC4yMi43OTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMporCRt +PblqQ54xamzxn6XdOTYgIGdih1ifORB+jeBUNpXOcotcP7qZarafVyHL2EFEK1e xDmPz2G69hNtwx+V3YD1uCOuTmRQQvtqAp6PTj9b4hdKs4IXzmDUxmWP7xi+VbuP E9YsxBJpLk/uzhhfAFCWWqLI+/IA9qs/O/hMDaK5pn/lDlDvjR5Cqem8xmTAzVQ3 qE6CYk4FOwyS2hNGN6rp7qCm1y7mD8igcu7yXyp7n6HGFCFn1FEZbJaRY7ls7kg6 mZWEejsH6maSN7UCmNsrFCknYD/D0FcdU4uA4sRnghesJj2pgTHZOjQs7EoXwJdn l5tBbgesnUs3Gu8CAwEAAaNTMFEwHQYDVR0OBBYEFIZjwWSeH3dt9o614z6XFcMO Tt1LMB8GA1UdIwQYMBaAFIZjwWSeH3dt9o614z6XFcMOTt1LMA8GA1UdEwEB/wQF MAMBAf8wDQYJKoZIhvcNAQELBQADggEBAFJfCqrHxxRGYhK70GkjojWSY9MZ0vvi sTFUteBz5GBKxo3P1Pk3ZvniWJH/b9UyF36mEa/iTgI0o+ffcYvvqZr3qavxDbhi PgqNgAYPiXnPDJ4MStY5+6hClzycZroJqNJVeZbleNHIOA64LO+zwFpZXLxygZGx 0xiU277HvtrO0ayWWCxHq9XNP4FPsrIw5m5RhvB3dFm6fxYSYTKbIV3vQtDNfMxW Ww7XtPnbwOm0BBkN1poL/jmeA/7lxUCGNr9IKh5PZtT1j+Laa/VhTlWt00qT6mAV 861YN3vvo2U8F36omKKnYlCxojea0ECTRNp09B3CHEDBGKv6JdBXvtQ = -----END CERTIFICATE----- A few lines of the output above have been highlighted. Notice the highlighted line that says CA: TRUE . This attribute indicates that this certificate is acting as a certification authority and can issue other certificates. Notice the lines above it which have values for Subject Key Identifier and Authority Key Identifier . Subject Key Identifier is the identity of the holder of the certificate. Authority Key Identifier is the identity of the issuer of the certificate. You can see that the values for these are the same. This is known as a self-signed certificate . Certification authorities (CA) exist in a hierarchy- one CA can issue a certificate to another CA with the CA: TRUE attribute, and so forth. In our lab we have this single, homegrown certification authority that we created, with its self-signed certificate that we created per the instructions in the Hyper Protect Virtual Servers documentation.","title":"Create a Certification Authority (CA) certificate and key"},{"location":"grep11-lab/grep11-setup/#create-a-grep11-server-x509-certificate-for-tls-authentication","text":"Once we created a \"homegown\" certification authority, we next created an X.509 certificate for our GREP11 server. This certificate was issued by our certification authority. The first step was to create another RSA private key that our GREP11 server will use: openssl genrsa -out server80-9876-19876-key.pem 2048 Note The value of the -out argument, server80-9876-19876-key.pem can be whatever you want it to be. I named it what I did for a reason. the 80 in server80 is for the last octet of my Hyper Protect Virtual Servers LPAR's IP adresss, 192.168.22.80, and I intend to use this certificate for two GREP11 servers, one listening on port 9876 on one of the LPAR's Crypto Express 7S domains, and the second server will listen on port 19876 on the LPAR's second Crypto Express 7S domain. Then, this private key was used as input to openssl in order to create a certificate signing request : openssl req -new -key server80-9876-19876-key.pem -out server80-9876-19876.csr The certificate signing request will be passed to our certification authority which will use the information to create an X.509 certificate. We used openssl for this, too: openssl x509 -sha256 -req -in server80-9876-19876.csr -CA ca.pem -CAkey ca.key -set_serial 8086 -extfile openssl.cnf -extensions server -days 36500 -outform PEM -out server80-9876-19876.pem The file name of the certificate that was created by the preceding command is the value of the -out argument, server80-9876-19876.pem . openssl allows us to list this certificate in human-friendly form: openssl x509 -in server80-9876-19876.pem -noout -text Example output Certificate: Data: Version: 3 (0x2) Serial Number: 8086 (0x1f96) Signature Algorithm: sha256WithRSAEncryption Issuer: C = US, ST = Virginia, L = Herndon, O = IBM, OU = IBM WSC, CN = 192.168.22.79 Validity Not Before: Jun 30 19:45:06 2020 GMT Not After : Jun 6 19:45:06 2120 GMT Subject: C = US, ST = Virginia, L = Herndon, O = IBM, OU = IBM WSC, CN = 192.168.22.80 Subject Public Key Info: Public Key Algorithm: rsaEncryption RSA Public-Key: (2048 bit) Modulus: 00:c2:66:77:9d:ef:38:ab:48:05:8d:ad:7d:aa:03: b6:b1:23:d9:39:81:20:6b:d1:60:21:64:a2:b4:c3: 71:9d:c7:36:0b:12:f9:51:ea:75:62:bd:02:11:54: 7d:22:bd:38:75:2e:7b:77:05:4b:5e:63:a0:2d:55: 72:51:b7:28:03:0c:1a:72:8e:d3:b1:64:b2:40:4e: 25:61:ab:d7:fe:44:e7:d1:0d:5e:dd:19:d6:af:e2: 9e:1f:34:f9:44:c0:8c:c3:b0:e4:f3:43:4b:48:dd: 34:8c:82:25:01:0b:a0:ad:f7:80:92:f2:84:d9:55: 4d:e0:7d:85:78:b9:f6:de:e6:9f:61:cf:ff:b1:ed: 93:24:06:e7:51:fd:ae:c0:7f:f4:49:61:ab:c8:c8: 46:1d:da:f2:76:97:f8:87:4f:a3:3c:c4:c4:46:00: 83:77:11:86:78:4f:cb:c2:b7:7d:18:fc:15:10:78: 90:10:96:3e:9c:cb:1f:ce:c5:1d:4f:88:72:11:88: 36:8e:42:34:7f:a0:51:0c:82:ee:d5:46:d4:b3:f5: 7d:d0:53:6f:22:18:01:d5:08:fa:73:12:6c:02:d6: 9f:53:c9:23:e7:46:c9:21:7e:66:3e:e0:01:44:f8: 34:e4:d8:37:30:ff:f0:83:a2:ba:a3:fb:ec:cd:01: 89:43 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Basic Constraints: CA:FALSE X509v3 Key Usage: Digital Signature, Key Encipherment, Data Encipherment X509v3 Extended Key Usage: TLS Web Server Authentication Netscape Cert Type: SSL Server X509v3 CRL Distribution Points: Full Name: URI:http://localhost/ca.crl X509v3 Subject Alternative Name: DNS:192.168.22.80:9876, DNS:192.168.22.80:19876, IP Address:192.168.22.80 Signature Algorithm: sha256WithRSAEncryption c1:64:4d:f9:81:66:0f:a8:44:63:8f:1c:82:3b:1e:05:45:b2: 51:5f:b2:8a:cd:e3:e9:5b:1e:83:e8:a9:54:21:01:57:20:49: b6:6a:e2:a4:58:24:44:73:5c:e4:81:88:57:e1:d9:ca:ef:2c: d9:b3:20:05:e4:0d:e9:46:22:3f:82:27:1e:b5:8a:7b:84:ef: 2a:af:b2:78:58:c2:a2:37:fa:dc:8d:75:4b:09:6d:67:b7:eb: f4:91:fc:2b:14:ef:94:75:1e:93:f1:7b:5d:69:23:8e:de:1e: 69:9e:a8:b9:62:47:28:ab:18:6a:00:0b:9f:b6:5e:cf:62:74: 57:df:1f:15:a0:81:4f:21:bc:c3:08:05:c1:c1:8d:a1:fa:78: 3d:e8:be:b8:eb:03:9c:3e:fa:8a:7d:70:09:56:47:4b:20:ea: 02:3e:85:dc:a0:af:81:77:c9:1d:91:a2:68:b7:9c:c4:8f:a1: dc:48:16:4f:38:5d:c7:d3:dc:51:b0:ff:a4:1b:aa:71:fe:34: b0:59:04:43:a6:88:69:78:41:56:70:cb:7b:e1:2a:55:e1:1b: f0:2a:11:25:ac:58:81:15:b0:9b:7f:f0:45:3f:ef:70:05:ce: 81:4f:3e:9f:17:4a:70:f2:65:65:3d:52:7e:af:59:46:d3:f8: 44:71:e6:c9","title":"Create a GREP11 server X.509 certificate for TLS authentication"},{"location":"grep11-lab/grep11-setup/#create-an-x509-certificate-for-your-client-application-for-tls-authentication","text":"The client applications need a certificate that is issued by the same certification authority that the GREP11 server uses. The process is similar- create a private key, pass that as input for the creation of a certificte signing request, and then pass that to the certification authority in order to receive a certificate. We used these commands: openssl genrsa -out client-key.pem 2048 openssl req -new -key client-key.pem -out client.csr openssl x509 -req -days 1000 -in client.csr -CA ca.pem -CAcreateserial -CAkey ca.key -out client.pem Note For the lab, each student will use a copy of the same client certificate. In most production use cases each client would use their own certificate which uniquely identifies them.","title":"Create an X.509 certificate for your client application for TLS authentication"},{"location":"grep11-lab/grep11-setup/#list-crypto-domains-on-your-hyper-protect-virtual-servers-lpar","text":"You can list your available domains with the Hyper Protect Virtual Server CLI: hpvs crypto list Example output hpvs crypto list +---------------+--------+ | CRYPTO.DOMAIN | STATUS | +---------------+--------+ | 08.0016 | online | | 0a.0016 | online | +---------------+--------+ The values shown in the CRYPTO.DOMAIN column are in hexadecimal. So, translating to decimal, our LPAR is using Crypto Express 7S cards 8 and 10, with domain 22 in both cards assigned to our LPAR. (A Crypto Express 7S card can have up to 85 domains- think of each domain as a \"virtual\" Crypto Express 7S card).","title":"List Crypto Domains on your Hyper Protect Virtual Servers LPAR"},{"location":"grep11-lab/grep11-setup/#create-yaml-or-json-configuration-files-for-grep11-server","text":"There are two alternative ways to start your GREP11 server: Using hpvs deploy with a YAML file as input Using hpvs vs create with a JSON file as input I will show both files formats (YAML and JSON) first. Then I will show both methods of starting the GREP11 server, and then explain the difference between the two start methods.","title":"Create YAML or JSON configuration files for GREP11 server"},{"location":"grep11-lab/grep11-setup/#yaml-file-for-grep11-server-configuration","text":"This is the YAML file for a GREP11 server that will listen for client connections on port 9876, and will use domain 22 (hex 16) of Crypto Express 7S card 08: GREP11 server YAML configuration file version: v1 # # use this file with the 'hpvs deploy' command, e.g., # # hpvs deploy --config $HOME/hpvs/config/grep11/vs_grep11_80-9876.yml # type: virtualserver virtualservers: - name: grep11-08-0016-9876 host: wsclpar80 repoid: hpcsKpGrep11_runq imagetag: 1.2.1 imagefile: hpcsKpGrep11_runq.tar.gz crypto: crypto_matrix: - 08.0016 environment: - key: EP11SERVER_EP11CRYPTO_DOMAIN value: \"08.0016\" # - key: EP11SERVER_EP11CRYPTO_CONNECTION_TLS_CERTFILEBYTES value: \"@/home/hyper-protect-lab/hpvs/config/grep11/keys/server80-9876-19876.pem\" - key: EP11SERVER_EP11CRYPTO_CONNECTION_TLS_KEYFILEBYTES value: \"@/home/hyper-protect-lab/hpvs/config/grep11/keys/server80-9876-19876-key.pem\" - key: EP11SERVER_EP11CRYPTO_CONNECTION_TLS_CACERTBYTES value: \"@/home/hyper-protect-lab/hpvs/config/grep11/keys/ca.pem\" - key: EP11SERVER_EP11CRYPTO_CONNECTION_TLS_ENABLED value: \"true\" - key: EP11SERVER_EP11CRYPTO_CONNECTION_TLS_MUTUAL value: \"true\" - key: TLS_GRPC_CERTS_DOMAIN_CRT value: \"\\\\n\" - key: TLS_GRPC_CERTS_DOMAIN_KEY value: \"\\\\n\" - key: TLS_GRPC_CERTS_ROOTCA_CRT value: \"\\\\n\" ports: - hostport: 9876 protocol: tcp containerport: 9876","title":"YAML file for GREP11 server configuration"},{"location":"grep11-lab/grep11-setup/#json-file-for-grep11-server-configuration","text":"This is a JSON file for a GREP11 server that will listen for client connections on port 9876, and will use domain 22 (hex 16) of Crypto Express 7S card 08: GREP11 server JSON configuration file { \"EP11SERVER_EP11CRYPTO_DOMAIN\":\"08.0016\", \"EP11SERVER_EP11CRYPTO_CONNECTION_TLS_CERTFILEBYTES\":\"@/home/hyper-protect-lab/hpvs/config/grep11/keys/server80-9876-19876.pem\", \"EP11SERVER_EP11CRYPTO_CONNECTION_TLS_KEYFILEBYTES\":\"@/home/hyper-protect-lab/hpvs/config/grep11/keys/server80-9876-19876-key.pem\", \"EP11SERVER_EP11CRYPTO_CONNECTION_TLS_CACERTBYTES\":\"@/home/hyper-protect-lab/hpvs/config/grep11/keys/ca.pem\", \"EP11SERVER_EP11CRYPTO_CONNECTION_TLS_ENABLED\":true, \"EP11SERVER_EP11CRYPTO_CONNECTION_TLS_MUTUAL\":true, \"TLS_GRPC_CERTS_DOMAIN_CRT\":\"\\\\n\", \"TLS_GRPC_CERTS_DOMAIN_KEY\":\"\\\\n\", \"TLS_GRPC_CERTS_ROOTCA_CRT\":\"\\\\n\" }","title":"JSON file for GREP11 server configuration"},{"location":"grep11-lab/grep11-setup/#start-the-grep11-server","text":"If you looked carefully at the JSON file and the YAML file in the previous section, you may have noticed that the YAML file contains more information than the JSON file contains. As a result, the syntax is simpler for the command that uses the YAML file. The command that uses the JSON file uses command line arguments to provide some of the information that the YAML file contained. Compare the two methods: Command to start the GREP11 server with the YAML file hpvs deploy --config $HOME/hpvs/config/grep11/vs_grep11_80-9876.yml Command to start the GREP11 server with the JSON file hpvs vs create --name grep11-08-0016-9876 --repo hpcsKpGrep11_runq --tag 1.2.1 --crypto_matrix=08.0016 --cpu 2 --ram 2048 --envjsonpath ${HOME}/hpvs/config/grep11/grep11_env_08.0016.json --ports \"{containerport = 9876, protocol = tcp, hostport = 9876}\" Difference between the two commands I like the simplicity of the hpvs deploy method much better than the long syntax of the hpvs vs create command. But the hpvs vs create command has a benefit- the hpvs deploy command uploads the GREP11 server Docker image from your workstation where you run the CLI to the Hyper Protect Virtual Server LPAR, every single time. This Docker image only needs to be sent up once. The hpvs vs create command is smart enough to have this figured out and not do the unnecessary upload of the Docker image the second and subsequent times you run it. Note Starting now, when you navigate to the next section of the lab, you should enter all the commands shown in the lab. Only the commands in this section were for reference. The GREP11 server is a feature provided by Hyper Protect Virtual Servers. You are not required to use it. If you do not use this feature, you do not have to define Crypto Express domains to the LPAR. You may wish to for other purposes, and you can use the other modes offered by Crypto Express cards for those purposes, but you must use EP11 mode for usage by the GREP11 server. \u21a9","title":"Start the GREP11 server"},{"location":"grep11-lab/lab-exercise1/","text":"Exercise 1 - List Mechanisms \u00b6 Explanation of Mechanisms \u00b6 Mechanisms is the PKCS #11 standard's fancy word for algorithms . In the introduction of the PKCS#11 Cryptographic Token Interface Base Specification 2.40 document, there is this statement: Details of cryptographic mechanisms (algorithms) may be found in the associated PKCS#11 Mechanisms documents. And then in the PKCS#11 Cryptographic Token Interface Current Mechanisms Specification Version 2.40 it says A mechanism specifies precisely how a certain cryptographic process is to be performed. This exercise will list the mechanisms supported by the Crypto Express card in EP11 mode. The program that you will invoke in this exercise issues a GetMechanismList() function call to the GREP11 server, and then it will iterate through the list returned, calling GetMechanismInfo() against each mechanism to obtain more info about it. Run the program and then a brief discussion of the results will follow: You may wish to view the source code used by the lab exercises while running them. It is handy to expand the Outline view in the left pane of Visual Studio Code which will show the various function and type definitions of the source code you have highlighted in the main portion of the Visual Studio Code window. The Outline view may not be necessary for smaller source code files but it comes in handy for some of the larger source code files. The screen snippet below shows where the Outline view is: Change to the lab directory in your terminal: cd ../lab In the prior section, the go test command built the executable file it needed transparently to us. For our lab exercises, we need to build the executable binary. We will use a single executable for all of the exercises, and invoke the various exercises through command line arguments. Build the executable now with this command: go build Note The absence of any messages is your indication of success! The go build command should have created an excutable file that shares the name of the directory in which you are working- lab . List that file and you should see it has a recent date and timestamp. ls -l lab Example output -rwxr-xr-x 1 hyper-protect-lab hyper-protect-lab 17545825 Jul 8 06 :26 lab Tip You may be doing this lab in a virtual machine whose clock is set for a time zone different from where you are. You can always issue the date command to see what time your virtual machine thinks it is at the moment. Run the first exercise by passing the appropriate argument, shown below, to the lab program: ./lab --ex1 Example output Got mechanism list of length 92: Mechanism 0 : CKM_RSA_PKCS MinKeySize:512 MaxKeySize:4096 Flags:404224 Mechanism 1 : CKM_RSA_PKCS_OAEP MinKeySize:512 MaxKeySize:4096 Flags:393984 Mechanism 2 : CKM_RSA_PKCS_KEY_PAIR_GEN MinKeySize:512 MaxKeySize:4096 Flags:65536 Mechanism 3 : CKM_RSA_X9_31_KEY_PAIR_GEN MinKeySize:512 MaxKeySize:4096 Flags:65536 Mechanism 4 : CKM_RSA_PKCS_PSS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 5 : CKM_SHA1_RSA_X9_31 MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 6 : CKM_SHA1_RSA_PKCS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 7 : CKM_SHA1_RSA_PKCS_PSS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 8 : CKM_SHA256_RSA_PKCS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 9 : CKM_SHA256_RSA_PKCS_PSS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 10 : CKM_SHA224_RSA_PKCS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 11 : CKM_SHA224_RSA_PKCS_PSS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 12 : CKM_SHA384_RSA_PKCS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 13 : CKM_SHA384_RSA_PKCS_PSS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 14 : CKM_SHA512_RSA_PKCS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 15 : CKM_SHA512_RSA_PKCS_PSS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 16 : CKM_AES_KEY_GEN MinKeySize:16 MaxKeySize:32 Flags:32768 Mechanism 17 : CKM_AES_ECB MinKeySize:16 MaxKeySize:32 Flags:768 Mechanism 18 : CKM_AES_CBC MinKeySize:16 MaxKeySize:32 Flags:393984 Mechanism 19 : CKM_AES_CBC_PAD MinKeySize:16 MaxKeySize:32 Flags:393984 Mechanism 20 : CKM_DES2_KEY_GEN MinKeySize:16 MaxKeySize:16 Flags:32768 Mechanism 21 : CKM_DES3_KEY_GEN MinKeySize:24 MaxKeySize:24 Flags:32768 Mechanism 22 : CKM_DES3_ECB MinKeySize:16 MaxKeySize:24 Flags:768 Mechanism 23 : CKM_DES3_CBC MinKeySize:16 MaxKeySize:24 Flags:393984 Mechanism 24 : CKM_DES3_CBC_PAD MinKeySize:16 MaxKeySize:24 Flags:393984 Mechanism 25 : CKM_GENERIC_SECRET_KEY_GEN MinKeySize:8 MaxKeySize:256 Flags:557056 Mechanism 26 : CKM_SHA256 Flags:1024 Mechanism 27 : CKM_SHA256_KEY_DERIVATION Flags:524288 Mechanism 28 : CKM_SHA256_HMAC MinKeySize:16 MaxKeySize:32 Flags:10240 Mechanism 29 : CKM_SHA224 Flags:1024 Mechanism 30 : CKM_SHA224_KEY_DERIVATION Flags:524288 Mechanism 31 : CKM_SHA224_HMAC MinKeySize:14 MaxKeySize:32 Flags:10240 Mechanism 32 : CKM_SHA_1 Flags:1024 Mechanism 33 : CKM_SHA1_KEY_DERIVATION Flags:524288 Mechanism 34 : CKM_SHA_1_HMAC MinKeySize:10 MaxKeySize:32 Flags:10240 Mechanism 35 : CKM_SHA384 Flags:1024 Mechanism 36 : CKM_SHA384_KEY_DERIVATION Flags:524288 Mechanism 37 : CKM_SHA384_HMAC MinKeySize:24 MaxKeySize:32 Flags:10240 Mechanism 38 : CKM_SHA512 Flags:1024 Mechanism 39 : CKM_SHA512_KEY_DERIVATION Flags:524288 Mechanism 40 : CKM_SHA512_HMAC MinKeySize:32 MaxKeySize:32 Flags:10240 Mechanism 41 : CKM_SHA512_256 Flags:1024 Mechanism 42 : CKM_IBM_SHA512_256 Flags:1024 Mechanism 43 : CKM_SHA512_256_HMAC MinKeySize:16 MaxKeySize:32 Flags:10240 Mechanism 44 : CKM_IBM_SHA512_256_HMAC MinKeySize:16 MaxKeySize:32 Flags:10240 Mechanism 45 : CKM_SHA512_224 Flags:1024 Mechanism 46 : CKM_IBM_SHA512_224 Flags:1024 Mechanism 47 : CKM_SHA512_224_HMAC MinKeySize:14 MaxKeySize:32 Flags:10240 Mechanism 48 : CKM_IBM_SHA512_224_HMAC MinKeySize:14 MaxKeySize:32 Flags:10240 Mechanism 49 : CKM_EC_KEY_PAIR_GEN MinKeySize:192 MaxKeySize:521 Flags:26279936 Mechanism 50 : CKM_ECDSA MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 51 : CKM_ECDSA_SHA1 MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 52 : CKM_ECDH1_DERIVE MinKeySize:192 MaxKeySize:521 Flags:18350080 Mechanism 53 : CKM_IBM_ECDH1_DERIVE_RAW MinKeySize:192 MaxKeySize:521 Flags:18350080 Mechanism 54 : CKM_IBM_EC_MULTIPLY MinKeySize:192 MaxKeySize:521 Flags:256 Mechanism 55 : CKM_DSA_PARAMETER_GEN MinKeySize:1024 MaxKeySize:3072 Flags:32768 Mechanism 56 : CKM_DSA_KEY_PAIR_GEN MinKeySize:1024 MaxKeySize:3072 Flags:65536 Mechanism 57 : CKM_DSA MinKeySize:1024 MaxKeySize:3072 Flags:10240 Mechanism 58 : CKM_DSA_SHA1 MinKeySize:1024 MaxKeySize:3072 Flags:10240 Mechanism 59 : CKM_DH_PKCS_PARAMETER_GEN MinKeySize:1024 MaxKeySize:3072 Flags:32768 Mechanism 60 : CKM_DH_PKCS_KEY_PAIR_GEN MinKeySize:1024 MaxKeySize:3072 Flags:65536 Mechanism 61 : CKM_DH_PKCS_DERIVE MinKeySize:1024 MaxKeySize:3072 Flags:524288 Mechanism 62 : CKM_IBM_DH_PKCS_DERIVE_RAW MinKeySize:1024 MaxKeySize:3072 Flags:524288 Mechanism 63 : Mechanism(0x80010023) MinKeySize:256 MaxKeySize:256 Flags:75776 Mechanism 64 : CKM_RSA_X9_31 MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 65 : CKM_PBE_SHA1_DES3_EDE_CBC MinKeySize:24 MaxKeySize:24 Flags:32768 Mechanism 66 : CKM_IBM_SHA3_224 Flags:1024 Mechanism 67 : CKM_IBM_SHA3_256 Flags:1024 Mechanism 68 : CKM_IBM_SHA3_384 Flags:1024 Mechanism 69 : CKM_IBM_SHA3_512 Flags:1024 Mechanism 70 : Mechanism(0x80010025) MinKeySize:14 MaxKeySize:32 Flags:10240 Mechanism 71 : Mechanism(0x80010026) MinKeySize:16 MaxKeySize:32 Flags:10240 Mechanism 72 : Mechanism(0x80010027) MinKeySize:24 MaxKeySize:32 Flags:10240 Mechanism 73 : Mechanism(0x80010028) MinKeySize:32 MaxKeySize:32 Flags:10240 Mechanism 74 : CKM_IBM_ATTRIBUTEBOUND_WRAP MaxKeySize:4096 Flags:393216 Mechanism 75 : Mechanism(0x1043) MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 76 : CKM_IBM_ECDSA_SHA224 MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 77 : Mechanism(0x1044) MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 78 : CKM_IBM_ECDSA_SHA256 MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 79 : Mechanism(0x1045) MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 80 : CKM_IBM_ECDSA_SHA384 MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 81 : Mechanism(0x1046) MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 82 : CKM_IBM_ECDSA_SHA512 MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 83 : CKM_IBM_EC_C25519 MinKeySize:256 MaxKeySize:256 Flags:18350080 Mechanism 84 : CKM_IBM_EC_C448 MinKeySize:448 MaxKeySize:448 Flags:18350080 Mechanism 85 : CKM_IBM_EDDSA_SHA512 MinKeySize:256 MaxKeySize:256 Flags:17836032 Mechanism 86 : CKM_IBM_ED448_SHA3 MinKeySize:448 MaxKeySize:448 Flags:17836032 Mechanism 87 : CKM_IBM_EAC Flags:524288 Mechanism 88 : CKM_IBM_RETAINKEY MaxKeySize:256 Flags:131072 Mechanism 89 : CKM_IBM_CMAC MinKeySize:16 MaxKeySize:32 Flags:10240 Mechanism 90 : CKM_AES_CMAC MinKeySize:16 MaxKeySize:32 Flags:10240 Mechanism 91 : CKM_DES3_CMAC MinKeySize:16 MaxKeySize:24 Flags:10240 Explanation of exercise output \u00b6 Near the top of the output, you see the line: Got mechanism list of length 92: This indicates there were 92 mechanisms returned by the call to GetMechanismList() Then, for each mechanism, two lines of output are created, one with the mechanism name, which usually start with CKM_ . The mechanism number has no significance, this is just an index number (starting at 0), incremented by the program as it iterates over the list. The information returned by GetMechanismInfo() includes the minimum key size and maximum key size for the mechanism, if applicable, and flags that are associated with the mechanism. The numbers shown are in decimal, and the key sizes are in bits, not bytes. Tip If you are doing this lab at your leisure on your own system, you could look in golang/ep11/header_consts.go and find the flags within lines 596 through 649 of that file. You'd have to convert the decimal value shown to hexadecimal. If you are taking this lab as part of a virtual event, do not take the time now to deconstruct these flags- you can always do that later since this lab is publicly available. Observe that the large majority of mechanisms in the list have a name starting with CKM_ , while a handful, such as item 77, 79, 81, and others, do not. It appears that if the mechanism is not listed in the golang/ep11/header_consts.go file, within lines 205 to 594, then it will not have a name starting with CKM_ . Note that the PKCS #11 specification does not mandate that an implementation support all defined mechanisms. Even within the subset of the 92 mechanisms that are supported by IBM's EP11 library, some are for algorithms that are considered rather outdated, and, in some cases, downright insecure. For example, the SHA-1 cryptographic hash algorithm is considered insecure these days, so any mechanims in the list that have SHA1 or SHA_1 in their name (ane there are some) should be avoided. Let's move on to Exercise 2.","title":"Exercise 1 (List PKCS Mechanisms)"},{"location":"grep11-lab/lab-exercise1/#exercise-1-list-mechanisms","text":"","title":"Exercise 1 - List Mechanisms"},{"location":"grep11-lab/lab-exercise1/#explanation-of-mechanisms","text":"Mechanisms is the PKCS #11 standard's fancy word for algorithms . In the introduction of the PKCS#11 Cryptographic Token Interface Base Specification 2.40 document, there is this statement: Details of cryptographic mechanisms (algorithms) may be found in the associated PKCS#11 Mechanisms documents. And then in the PKCS#11 Cryptographic Token Interface Current Mechanisms Specification Version 2.40 it says A mechanism specifies precisely how a certain cryptographic process is to be performed. This exercise will list the mechanisms supported by the Crypto Express card in EP11 mode. The program that you will invoke in this exercise issues a GetMechanismList() function call to the GREP11 server, and then it will iterate through the list returned, calling GetMechanismInfo() against each mechanism to obtain more info about it. Run the program and then a brief discussion of the results will follow: You may wish to view the source code used by the lab exercises while running them. It is handy to expand the Outline view in the left pane of Visual Studio Code which will show the various function and type definitions of the source code you have highlighted in the main portion of the Visual Studio Code window. The Outline view may not be necessary for smaller source code files but it comes in handy for some of the larger source code files. The screen snippet below shows where the Outline view is: Change to the lab directory in your terminal: cd ../lab In the prior section, the go test command built the executable file it needed transparently to us. For our lab exercises, we need to build the executable binary. We will use a single executable for all of the exercises, and invoke the various exercises through command line arguments. Build the executable now with this command: go build Note The absence of any messages is your indication of success! The go build command should have created an excutable file that shares the name of the directory in which you are working- lab . List that file and you should see it has a recent date and timestamp. ls -l lab Example output -rwxr-xr-x 1 hyper-protect-lab hyper-protect-lab 17545825 Jul 8 06 :26 lab Tip You may be doing this lab in a virtual machine whose clock is set for a time zone different from where you are. You can always issue the date command to see what time your virtual machine thinks it is at the moment. Run the first exercise by passing the appropriate argument, shown below, to the lab program: ./lab --ex1 Example output Got mechanism list of length 92: Mechanism 0 : CKM_RSA_PKCS MinKeySize:512 MaxKeySize:4096 Flags:404224 Mechanism 1 : CKM_RSA_PKCS_OAEP MinKeySize:512 MaxKeySize:4096 Flags:393984 Mechanism 2 : CKM_RSA_PKCS_KEY_PAIR_GEN MinKeySize:512 MaxKeySize:4096 Flags:65536 Mechanism 3 : CKM_RSA_X9_31_KEY_PAIR_GEN MinKeySize:512 MaxKeySize:4096 Flags:65536 Mechanism 4 : CKM_RSA_PKCS_PSS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 5 : CKM_SHA1_RSA_X9_31 MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 6 : CKM_SHA1_RSA_PKCS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 7 : CKM_SHA1_RSA_PKCS_PSS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 8 : CKM_SHA256_RSA_PKCS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 9 : CKM_SHA256_RSA_PKCS_PSS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 10 : CKM_SHA224_RSA_PKCS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 11 : CKM_SHA224_RSA_PKCS_PSS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 12 : CKM_SHA384_RSA_PKCS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 13 : CKM_SHA384_RSA_PKCS_PSS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 14 : CKM_SHA512_RSA_PKCS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 15 : CKM_SHA512_RSA_PKCS_PSS MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 16 : CKM_AES_KEY_GEN MinKeySize:16 MaxKeySize:32 Flags:32768 Mechanism 17 : CKM_AES_ECB MinKeySize:16 MaxKeySize:32 Flags:768 Mechanism 18 : CKM_AES_CBC MinKeySize:16 MaxKeySize:32 Flags:393984 Mechanism 19 : CKM_AES_CBC_PAD MinKeySize:16 MaxKeySize:32 Flags:393984 Mechanism 20 : CKM_DES2_KEY_GEN MinKeySize:16 MaxKeySize:16 Flags:32768 Mechanism 21 : CKM_DES3_KEY_GEN MinKeySize:24 MaxKeySize:24 Flags:32768 Mechanism 22 : CKM_DES3_ECB MinKeySize:16 MaxKeySize:24 Flags:768 Mechanism 23 : CKM_DES3_CBC MinKeySize:16 MaxKeySize:24 Flags:393984 Mechanism 24 : CKM_DES3_CBC_PAD MinKeySize:16 MaxKeySize:24 Flags:393984 Mechanism 25 : CKM_GENERIC_SECRET_KEY_GEN MinKeySize:8 MaxKeySize:256 Flags:557056 Mechanism 26 : CKM_SHA256 Flags:1024 Mechanism 27 : CKM_SHA256_KEY_DERIVATION Flags:524288 Mechanism 28 : CKM_SHA256_HMAC MinKeySize:16 MaxKeySize:32 Flags:10240 Mechanism 29 : CKM_SHA224 Flags:1024 Mechanism 30 : CKM_SHA224_KEY_DERIVATION Flags:524288 Mechanism 31 : CKM_SHA224_HMAC MinKeySize:14 MaxKeySize:32 Flags:10240 Mechanism 32 : CKM_SHA_1 Flags:1024 Mechanism 33 : CKM_SHA1_KEY_DERIVATION Flags:524288 Mechanism 34 : CKM_SHA_1_HMAC MinKeySize:10 MaxKeySize:32 Flags:10240 Mechanism 35 : CKM_SHA384 Flags:1024 Mechanism 36 : CKM_SHA384_KEY_DERIVATION Flags:524288 Mechanism 37 : CKM_SHA384_HMAC MinKeySize:24 MaxKeySize:32 Flags:10240 Mechanism 38 : CKM_SHA512 Flags:1024 Mechanism 39 : CKM_SHA512_KEY_DERIVATION Flags:524288 Mechanism 40 : CKM_SHA512_HMAC MinKeySize:32 MaxKeySize:32 Flags:10240 Mechanism 41 : CKM_SHA512_256 Flags:1024 Mechanism 42 : CKM_IBM_SHA512_256 Flags:1024 Mechanism 43 : CKM_SHA512_256_HMAC MinKeySize:16 MaxKeySize:32 Flags:10240 Mechanism 44 : CKM_IBM_SHA512_256_HMAC MinKeySize:16 MaxKeySize:32 Flags:10240 Mechanism 45 : CKM_SHA512_224 Flags:1024 Mechanism 46 : CKM_IBM_SHA512_224 Flags:1024 Mechanism 47 : CKM_SHA512_224_HMAC MinKeySize:14 MaxKeySize:32 Flags:10240 Mechanism 48 : CKM_IBM_SHA512_224_HMAC MinKeySize:14 MaxKeySize:32 Flags:10240 Mechanism 49 : CKM_EC_KEY_PAIR_GEN MinKeySize:192 MaxKeySize:521 Flags:26279936 Mechanism 50 : CKM_ECDSA MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 51 : CKM_ECDSA_SHA1 MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 52 : CKM_ECDH1_DERIVE MinKeySize:192 MaxKeySize:521 Flags:18350080 Mechanism 53 : CKM_IBM_ECDH1_DERIVE_RAW MinKeySize:192 MaxKeySize:521 Flags:18350080 Mechanism 54 : CKM_IBM_EC_MULTIPLY MinKeySize:192 MaxKeySize:521 Flags:256 Mechanism 55 : CKM_DSA_PARAMETER_GEN MinKeySize:1024 MaxKeySize:3072 Flags:32768 Mechanism 56 : CKM_DSA_KEY_PAIR_GEN MinKeySize:1024 MaxKeySize:3072 Flags:65536 Mechanism 57 : CKM_DSA MinKeySize:1024 MaxKeySize:3072 Flags:10240 Mechanism 58 : CKM_DSA_SHA1 MinKeySize:1024 MaxKeySize:3072 Flags:10240 Mechanism 59 : CKM_DH_PKCS_PARAMETER_GEN MinKeySize:1024 MaxKeySize:3072 Flags:32768 Mechanism 60 : CKM_DH_PKCS_KEY_PAIR_GEN MinKeySize:1024 MaxKeySize:3072 Flags:65536 Mechanism 61 : CKM_DH_PKCS_DERIVE MinKeySize:1024 MaxKeySize:3072 Flags:524288 Mechanism 62 : CKM_IBM_DH_PKCS_DERIVE_RAW MinKeySize:1024 MaxKeySize:3072 Flags:524288 Mechanism 63 : Mechanism(0x80010023) MinKeySize:256 MaxKeySize:256 Flags:75776 Mechanism 64 : CKM_RSA_X9_31 MinKeySize:512 MaxKeySize:4096 Flags:10240 Mechanism 65 : CKM_PBE_SHA1_DES3_EDE_CBC MinKeySize:24 MaxKeySize:24 Flags:32768 Mechanism 66 : CKM_IBM_SHA3_224 Flags:1024 Mechanism 67 : CKM_IBM_SHA3_256 Flags:1024 Mechanism 68 : CKM_IBM_SHA3_384 Flags:1024 Mechanism 69 : CKM_IBM_SHA3_512 Flags:1024 Mechanism 70 : Mechanism(0x80010025) MinKeySize:14 MaxKeySize:32 Flags:10240 Mechanism 71 : Mechanism(0x80010026) MinKeySize:16 MaxKeySize:32 Flags:10240 Mechanism 72 : Mechanism(0x80010027) MinKeySize:24 MaxKeySize:32 Flags:10240 Mechanism 73 : Mechanism(0x80010028) MinKeySize:32 MaxKeySize:32 Flags:10240 Mechanism 74 : CKM_IBM_ATTRIBUTEBOUND_WRAP MaxKeySize:4096 Flags:393216 Mechanism 75 : Mechanism(0x1043) MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 76 : CKM_IBM_ECDSA_SHA224 MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 77 : Mechanism(0x1044) MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 78 : CKM_IBM_ECDSA_SHA256 MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 79 : Mechanism(0x1045) MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 80 : CKM_IBM_ECDSA_SHA384 MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 81 : Mechanism(0x1046) MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 82 : CKM_IBM_ECDSA_SHA512 MinKeySize:192 MaxKeySize:521 Flags:26224640 Mechanism 83 : CKM_IBM_EC_C25519 MinKeySize:256 MaxKeySize:256 Flags:18350080 Mechanism 84 : CKM_IBM_EC_C448 MinKeySize:448 MaxKeySize:448 Flags:18350080 Mechanism 85 : CKM_IBM_EDDSA_SHA512 MinKeySize:256 MaxKeySize:256 Flags:17836032 Mechanism 86 : CKM_IBM_ED448_SHA3 MinKeySize:448 MaxKeySize:448 Flags:17836032 Mechanism 87 : CKM_IBM_EAC Flags:524288 Mechanism 88 : CKM_IBM_RETAINKEY MaxKeySize:256 Flags:131072 Mechanism 89 : CKM_IBM_CMAC MinKeySize:16 MaxKeySize:32 Flags:10240 Mechanism 90 : CKM_AES_CMAC MinKeySize:16 MaxKeySize:32 Flags:10240 Mechanism 91 : CKM_DES3_CMAC MinKeySize:16 MaxKeySize:24 Flags:10240","title":"Explanation of Mechanisms"},{"location":"grep11-lab/lab-exercise1/#explanation-of-exercise-output","text":"Near the top of the output, you see the line: Got mechanism list of length 92: This indicates there were 92 mechanisms returned by the call to GetMechanismList() Then, for each mechanism, two lines of output are created, one with the mechanism name, which usually start with CKM_ . The mechanism number has no significance, this is just an index number (starting at 0), incremented by the program as it iterates over the list. The information returned by GetMechanismInfo() includes the minimum key size and maximum key size for the mechanism, if applicable, and flags that are associated with the mechanism. The numbers shown are in decimal, and the key sizes are in bits, not bytes. Tip If you are doing this lab at your leisure on your own system, you could look in golang/ep11/header_consts.go and find the flags within lines 596 through 649 of that file. You'd have to convert the decimal value shown to hexadecimal. If you are taking this lab as part of a virtual event, do not take the time now to deconstruct these flags- you can always do that later since this lab is publicly available. Observe that the large majority of mechanisms in the list have a name starting with CKM_ , while a handful, such as item 77, 79, 81, and others, do not. It appears that if the mechanism is not listed in the golang/ep11/header_consts.go file, within lines 205 to 594, then it will not have a name starting with CKM_ . Note that the PKCS #11 specification does not mandate that an implementation support all defined mechanisms. Even within the subset of the 92 mechanisms that are supported by IBM's EP11 library, some are for algorithms that are considered rather outdated, and, in some cases, downright insecure. For example, the SHA-1 cryptographic hash algorithm is considered insecure these days, so any mechanims in the list that have SHA1 or SHA_1 in their name (ane there are some) should be avoided. Let's move on to Exercise 2.","title":"Explanation of exercise output"},{"location":"grep11-lab/lab-exercise2/","text":"Exercise 2 - Encrypt and Decrypt Data \u00b6 Overview of Exercise 2 \u00b6 Exercise 2 creates an AES secret key and uses it to encrypt some plaintext data. This ciphertext is then decrypted back into plaintext using the same AES secret key that was used for encryption. The original plaintext is compared to- and is expected to be identical to- the plaintext that resulted from the encryption and decryption. Note Plaintext data is often, but not necessarily, human-readable. It is any data that could be of value to an adversary, if the adversary could obtain the data in its original, or plaintext, form. Hence the need for encryption. Encrypted data is referred to as ciphertext . If an adversary were to obtain ciphertext, it is unreadable and thus of little or no value to the adversary. Note The PKCS #11 standard uses the phrase secret key often. Secret key is synonoymous with the term symmetric key , which is also a term commonly used in cryptography. That is, a single key is used for both encryption and decryption. Run the second exercise: ./lab --ex2 Example Output 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 Generated AES Key with mechanism CKM_AES_KEY_GEN length of key blob is 256 bytes Key blob is ( values in decimal ) : [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 141 38 0 0 0 0 0 0 0 1 18 52 217 158 52 159 29 220 10 126 250 240 129 168 243 15 158 220 32 30 158 254 73 111 45 102 230 162 209 246 93 216 200 108 223 116 32 109 1 82 87 166 108 227 20 9 54 59 24 126 154 14 159 250 161 203 128 27 237 27 218 243 169 235 28 112 101 109 177 94 191 251 198 126 102 93 236 51 190 157 4 188 128 1 114 120 135 191 22 7 42 191 209 135 168 241 228 137 121 180 140 113 211 159 26 192 70 74 130 25 180 75 86 230 207 240 101 164 65 179 122 59 202 213 142 244 54 151 158 46 72 52 249 87 219 11 202 69 150 45 195 200 84 134 30 148 21 70 144 235 236 141 234 135 4 120 1 180 69 84 35 73 16 71 208 212 143 135 222 115 85 26 25 172 2 202 15 2 249 109 71 41 255 177 105 20 134 33 10 54 254 210 ] The above structure is what you would save in order to persist this key blob. Below is how the above structure would typically be saved, in PEM Format: -----BEGIN HSM ENCRYPTED AES SECRET KEY----- AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADsIIxQY2Y9lWElrfi1CQo AAAAAAAAjSYAAAAAAAAAARI02Z40nx3cCn768IGo8w+e3CAenv5Jby1m5qLR9l3Y yGzfdCBtAVJXpmzjFAk2Oxh+mg6f+qHLgBvtG9rzqesccGVtsV6/+8Z+Zl3sM76d BLyAAXJ4h78WByq/0Yeo8eSJebSMcdOfGsBGSoIZtEtW5s/wZaRBs3o7ytWO9DaX ni5INPlX2wvKRZYtw8hUhh6UFUaQ6+yN6ocEeAG0RVQjSRBH0NSPh95zVRoZrALK DwL5bUcp/7FpFIYhCjb+0g == -----END HSM ENCRYPTED AES SECRET KEY----- WK virtualization mask is [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ] See 6 .2.2 of page 179 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf WK ID is [ 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 ] See 6 .7.1 on page 182 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Blob version is [ 18 52 ] See 3 .1.1 on page 141 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Initialization Vector is [ 217 158 52 159 29 220 10 126 250 240 129 168 243 15 ] Encrypted part is [ 158 220 32 30 158 254 73 111 45 102 230 162 209 246 93 216 200 108 223 116 32 109 1 82 87 166 108 227 20 9 54 59 24 126 154 14 159 250 161 203 128 27 237 27 218 243 169 235 28 112 101 109 177 94 191 251 198 126 102 93 236 51 190 157 4 188 128 1 114 120 135 191 22 7 42 191 209 135 168 241 228 137 121 180 140 113 211 159 26 192 70 74 130 25 180 75 86 230 207 240 101 164 65 179 122 59 202 213 142 244 54 151 158 46 72 52 249 87 219 11 202 69 150 45 195 200 84 134 30 148 21 70 144 235 236 141 234 135 4 120 1 180 69 84 ] MAC is [ 35 73 16 71 208 212 143 135 222 115 85 26 25 172 2 202 15 2 249 109 71 41 255 177 105 20 134 33 10 54 254 210 ] MAC is 32 bytes, see field 15 in 3 .1 on page 140 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Checksum is [ 144 147 65 ] , length of checksum is 3 Original message, prior to any encryption or decryption operations: Hello, this is a very long and creative message without any imagination in progress ciphertext is: \ufffd\ufffd!E\ufffdS\ufffd\ufffd\ufffd } \ufffdp\ufffd!\ufffd\ufffd in progress ciphertext is: \ufffd\ufffd!E\ufffdS\ufffd\ufffd\ufffd } \ufffdp\ufffd!\ufffd\ufffd7I\ufffdH\u0019d\ufffdi\ufffd7p\ufffd/N\u02fd\u0018.\ufffdg\ufffd\ufffdK\ufffd ; \ufffd\ufffd\ufffd\u0015\ufffd_\ufffd\ufffd\ufffd\ufffdN\u00d8tk\ufffd\ufffd\ufffdYH\ufffd^\ufffd Final ciphertext is: \ufffd\ufffd!E\ufffdS\ufffd\ufffd\ufffd } \ufffdp\ufffd!\ufffd\ufffd7I\ufffdH\u0019d\ufffdi\ufffd7p\ufffd/N\u02fd\u0018.\ufffdg\ufffd\ufffdK\ufffd ; \ufffd\ufffd\ufffd\u0015\ufffd_\ufffd\ufffd\ufffd\ufffdN\u00d8tk\ufffd\ufffd\ufffdYH\ufffd^\ufffd\ufffd\ufffdH\ufffd5f\ufffd!\ufffd\u0019\u0018\ufffd>-\u001cc In progress decryption is: In progress decryption is: Hello, this is a very long and creative message without any imag Final decryption is: Hello, this is a very long and creative message without any imagination Original message equals decrypted message! Original message: Hello, this is a very long and creative message without any imagination Length of original message: 71 Encrypted message \ufffd\ufffd!E\ufffdS\ufffd\ufffd\ufffd } \ufffdp\ufffd!\ufffd\ufffd7I\ufffdH\u0019d\ufffdi\ufffd7p\ufffd/N\u02fd\u0018.\ufffdg\ufffd\ufffdK\ufffd ; \ufffd\ufffd\ufffd\u0015\ufffd_\ufffd\ufffd\ufffd\ufffdN\u00d8tk\ufffd\ufffd\ufffdYH\ufffd^\ufffd\ufffd\ufffdH\ufffd5f\ufffd!\ufffd\u0019\u0018\ufffd>-\u001cc Length of encrypted message: 80 Decrypted message: Hello, this is a very long and creative message without any imagination Length of decrypted message: 71 The mechanism used to generate the key is CKM_AES_KEY_GEN which informs us that we wish to generate an AES secret key. The length of the key blob is 256 bytes. Notice, that this key blob contains metadata used by the EP11 library, so it contains much more than the actual key, which is 256 bits, not bytes. In fact we can't even see the key in cleartext form. It is encrypted within the key blob by the Crypto Express 7S card domain's root wrapping key . The only place the key we created is every available in the clear is while it is being used inside the Crypto Express 7S card, because the root wrapping key never leaves the card. The ID of the root wrapping key of the Crypto Express 7S card domain is listed in the output in the line that starts with *WK ID is *. This ID is the first sixteen bytes of the hash of the key. It is not the full hash, and even if it was, you cannot retrieve the original data from the hash, so the root wrapping key remains secret. The ID of the root wrapping key for our Crypto Express 7S card domain is [ 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 ] As you perform the exercises in this lab, you may notice that any time I print out the WK ID , it will always be this value. The encryption in this exercise takes place in multiple calls. One may either encrypt all of the data in a single call to a function named Encrypt() , or may make multiple calls by performing one or more caalls to EncryptUpdate() followed by a call to EncryptFinal() . This sample program uses the latter approach, so in the output you see two lines that say In progress ciphertext is that show the results so far after each EncryptUpdate() call and then a line that says Final ciphertext is after the call to EncryptFinal() . Decryption follows the same pattern- two calls to DecryptUpdate() followed by a call to *DecryptFinal(), and the output in the program indicates this. The program for this exercise defaults to a key length of 256 bits. Try running with a key length of 128 bits: ./lab --ex2 --keyLength 128 Example Output Generated AES Key with mechanism CKM_AES_KEY_GEN length of key blob is 256 bytes Key blob is (values in decimal): [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 141 38 0 0 0 0 0 0 0 1 18 52 3 221 177 141 112 242 216 176 144 18 6 175 10 206 202 162 226 99 67 216 88 101 201 3 114 172 228 151 134 15 141 183 46 209 125 119 136 246 196 223 189 56 243 204 100 151 226 149 160 128 229 255 216 226 133 171 65 244 16 197 245 172 136 232 118 184 206 173 34 79 215 214 202 250 8 237 80 168 235 252 137 221 202 76 92 21 176 127 119 178 212 220 235 169 231 144 203 67 92 32 243 99 83 171 234 198 118 71 201 176 223 202 214 117 107 152 139 105 99 39 22 243 21 20 173 175 57 84 114 199 115 225 125 30 230 123 50 120 157 37 32 151 24 77 118 170 12 222 17 3 53 7 177 238 226 18 192 102 80 131 223 195 188 205 133 31 172 138 123 48 4 244 81 224 205 165 108 128 163 226 55 208 117 70 166 128 111 166 213 158] The above structure is what you would save in order to persist this key blob. Below is how the above structure would typically be saved, in PEM Format: -----BEGIN HSM ENCRYPTED AES SECRET KEY----- AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADsIIxQY2Y9lWElrfi1CQo AAAAAAAAjSYAAAAAAAAAARI0A92xjXDy2LCQEgavCs7KouJjQ9hYZckDcqzkl4YP jbcu0X13iPbE370488xkl+KVoIDl/9jihatB9BDF9ayI6Ha4zq0iT9fWyvoI7VCo 6/yJ3cpMXBWwf3ey1NzrqeeQy0NcIPNjU6vqxnZHybDfytZ1a5iLaWMnFvMVFK2v OVRyx3PhfR7mezJ4nSUglxhNdqoM3hEDNQex7uISwGZQg9/DvM2FH6yKezAE9FHg zaVsgKPiN9B1RqaAb6bVng== -----END HSM ENCRYPTED AES SECRET KEY----- WK virtualization mask is [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] See 6.2.2 of page 179 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf WK ID is [3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40] See 6.7.1 on page 182 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Blob version is [18 52] See 3.1.1 on page 141 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Initialization Vector is [3 221 177 141 112 242 216 176 144 18 6 175 10 206] Encrypted part is [202 162 226 99 67 216 88 101 201 3 114 172 228 151 134 15 141 183 46 209 125 119 136 246 196 223 189 56 243 204 100 151 226 149 160 128 229 255 216 226 133 171 65 244 16 197 245 172 136 232 118 184 206 173 34 79 215 214 202 250 8 237 80 168 235 252 137 221 202 76 92 21 176 127 119 178 212 220 235 169 231 144 203 67 92 32 243 99 83 171 234 198 118 71 201 176 223 202 214 117 107 152 139 105 99 39 22 243 21 20 173 175 57 84 114 199 115 225 125 30 230 123 50 120 157 37 32 151 24 77 118 170 12 222 17 3 53 7 177 238 226 18 192 102] MAC is [80 131 223 195 188 205 133 31 172 138 123 48 4 244 81 224 205 165 108 128 163 226 55 208 117 70 166 128 111 166 213 158] MAC is 32 bytes, see field 15 in 3.1 on page 140 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Checksum is [132 58 194], length of checksum is 3 Original message, prior to any encryption or decryption operations: Hello, this is a very long and creative message without any imagination in progress ciphertext is: \ufffd\ufffd\ufffd\u001d[\ufffdF\ufffdVl in progress ciphertext is: \ufffd\ufffd\ufffd\u001d[\u0336:\ufffd\ufffd\ufffdl \ufffd.\ufffdW\ufffd+\ufffd]n,\ufffd\u0013#\ufffd-\ufffd\u0011\ufffd{\ufffd\ufffd\u001b\ufffd\ufffd\ufffd\ufffd\u00134\u0006\ufffd\ufffduj\ufffd\ufffd!\ufffd v Final ciphertext is: \ufffd\ufffd\ufffd\u001d[\u0336:\ufffd\ufffd\ufffdl \ufffd.\ufffdW\ufffd+\ufffd]n,\ufffd\u0013#\ufffd-\ufffd\u0011\ufffd{\ufffd\ufffd\u001b\ufffd\ufffd\ufffd\ufffd\u00134\u0006\ufffd\ufffduj\ufffd\ufffd!\ufffd v\ufffd\ufffd7\u0474\ufffd\ufffd,\ufffd\ufffd5\u001c-\ufffd\ufffd In progress decryption is: In progress decryption is: Hello, this is a very long and creative message without any imag Final decryption is: Hello, this is a very long and creative message without any imagination Original message equals decrypted message! Original message: Hello, this is a very long and creative message without any imagination Length of original message: 71 Encrypted message \ufffd\ufffd\ufffd\u001d[\u0336:\ufffd\ufffd\ufffdl \ufffd.\ufffdW\ufffd+\ufffd]n,\ufffd\u0013#\ufffd-\ufffd\u0011\ufffd{\ufffd\ufffd\u001b\ufffd\ufffd\ufffd\ufffd\u00134\u0006\ufffd\ufffduj\ufffd\ufffd!\ufffd v\ufffd\ufffd7\u0474\ufffd\ufffd,\ufffd\ufffd5\u001c-\ufffd\ufffd Length of encrypted message: 80 Decrypted message: Hello, this is a very long and creative message without any imagination Length of decrypted message: 71 Our first run of this program used a key length of 256 bits, and this run used a key length of 128 bits. Notice that the key blob itself is still 256 bytes in length. By the way, the gibberish printed out in the encrypted message portion of the output is because a byte of ciphertext is likely to contain any value from 0 to 255 and only a portion of those will turn out to be printable characters if you try to treat it as if it was a character string and try to print it out like this program does- you may see one or more lines, if one of the ciphertext bytes produced happens to be the value of a linefeed character, and if it is a carriage return without a line feed it may have \"overwritten\" some of the preceding gibberish. Real life use cases aren't typically going to require you to print ciphertext as this program did for education purposes. Try with a key length of 192 bits: ./lab --ex2 --keyLength 192 Note Output not shown here, it should be similar to the prior two commands. Try with a key length of 384 bits: ./lab --ex2 --keyLength 384 Example Output panic: GenerateKey Error: rpc error: code = Unknown desc = CKR_KEY_SIZE_RANGE goroutine 1 [running]: main.encryptAndDecrypt(0x180, 0xa28e3b, 0x47) /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/lab/exercise2.go:55 +0x2c89 main.main() /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/lab/main.go:73 +0x3a3 Don't panic! (Even if Go did). I meant for this to happen. This exercise uses the CKM_AES_KEY_GEN mechanism. (This is in the first line of the progrram output). If we run exercise one again and pipe its output to grep, with a fancy argument to print one extra line, we can see that the minimum key size is 128 bits and the maximum key size is 256 bits. Try it: ./lab --ex1 | grep CKM_AES_KEY_GEN --after-context 1 So our key size must be in a range from 128 to 256 bits. Let's try a key length of 224 bits: ./lab --ex2 --keyLength 224 Example Output panic: GenerateKey Error: rpc error: code = Unknown desc = CKR_KEY_SIZE_RANGE goroutine 1 [running]: main.encryptAndDecrypt(0xe0, 0xa28e3b, 0x47) /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/lab/exercise2.go:55 +0x2c89 main.main() /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/lab/main.go:73 +0x3a3 Is this the new math where 224 is not between 128 and 256? No. What's going on here is that the AES standard supports keys of a certain length- 128, 192, and 256 bits. So while the mechanism information told us the minimum and maximum key size, the expectation is that the programmer knows a little bit about the AES standard when using it! Would you like to encrypt and decrypt your own text? Try it like this- feel free to copy and paste what is provided here, or substitute your own witty banter for the value of the --plaintext argument. ./lab --ex2 --plaintext \"The quick brown fox jumped over the lazy dog\" Note Output not shown, but you should see the message being encrypted and decrypted. Unless... Troubleshooting If you received this message in your output, panic: Failed Encrypt [rpc error: code = Unknown desc = CKR_ARGUMENTS_BAD] , then there is a pretty good chance that you supplied a plaintext value less than twenty-one characters in length. This exercise was based on the sample code, which performs the encryption in two steps. The first step passsed the first twenty bytes of input to the crypto card, and the second step passed the remainder of the input. The input was hard-coded and of length greater than twenty bytes, so the sample does not have logic to handle input of twenty bytes or less. The sample has not been modified to handle the case where that second pass isn't needed. Don't worry, in the real world, you can probably solve this problem if you throw enough money at it. :-)","title":"Exercise 2 (Encryption and Decryption)"},{"location":"grep11-lab/lab-exercise2/#exercise-2-encrypt-and-decrypt-data","text":"","title":"Exercise 2 - Encrypt and Decrypt Data"},{"location":"grep11-lab/lab-exercise2/#overview-of-exercise-2","text":"Exercise 2 creates an AES secret key and uses it to encrypt some plaintext data. This ciphertext is then decrypted back into plaintext using the same AES secret key that was used for encryption. The original plaintext is compared to- and is expected to be identical to- the plaintext that resulted from the encryption and decryption. Note Plaintext data is often, but not necessarily, human-readable. It is any data that could be of value to an adversary, if the adversary could obtain the data in its original, or plaintext, form. Hence the need for encryption. Encrypted data is referred to as ciphertext . If an adversary were to obtain ciphertext, it is unreadable and thus of little or no value to the adversary. Note The PKCS #11 standard uses the phrase secret key often. Secret key is synonoymous with the term symmetric key , which is also a term commonly used in cryptography. That is, a single key is used for both encryption and decryption. Run the second exercise: ./lab --ex2 Example Output 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 Generated AES Key with mechanism CKM_AES_KEY_GEN length of key blob is 256 bytes Key blob is ( values in decimal ) : [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 141 38 0 0 0 0 0 0 0 1 18 52 217 158 52 159 29 220 10 126 250 240 129 168 243 15 158 220 32 30 158 254 73 111 45 102 230 162 209 246 93 216 200 108 223 116 32 109 1 82 87 166 108 227 20 9 54 59 24 126 154 14 159 250 161 203 128 27 237 27 218 243 169 235 28 112 101 109 177 94 191 251 198 126 102 93 236 51 190 157 4 188 128 1 114 120 135 191 22 7 42 191 209 135 168 241 228 137 121 180 140 113 211 159 26 192 70 74 130 25 180 75 86 230 207 240 101 164 65 179 122 59 202 213 142 244 54 151 158 46 72 52 249 87 219 11 202 69 150 45 195 200 84 134 30 148 21 70 144 235 236 141 234 135 4 120 1 180 69 84 35 73 16 71 208 212 143 135 222 115 85 26 25 172 2 202 15 2 249 109 71 41 255 177 105 20 134 33 10 54 254 210 ] The above structure is what you would save in order to persist this key blob. Below is how the above structure would typically be saved, in PEM Format: -----BEGIN HSM ENCRYPTED AES SECRET KEY----- AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADsIIxQY2Y9lWElrfi1CQo AAAAAAAAjSYAAAAAAAAAARI02Z40nx3cCn768IGo8w+e3CAenv5Jby1m5qLR9l3Y yGzfdCBtAVJXpmzjFAk2Oxh+mg6f+qHLgBvtG9rzqesccGVtsV6/+8Z+Zl3sM76d BLyAAXJ4h78WByq/0Yeo8eSJebSMcdOfGsBGSoIZtEtW5s/wZaRBs3o7ytWO9DaX ni5INPlX2wvKRZYtw8hUhh6UFUaQ6+yN6ocEeAG0RVQjSRBH0NSPh95zVRoZrALK DwL5bUcp/7FpFIYhCjb+0g == -----END HSM ENCRYPTED AES SECRET KEY----- WK virtualization mask is [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ] See 6 .2.2 of page 179 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf WK ID is [ 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 ] See 6 .7.1 on page 182 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Blob version is [ 18 52 ] See 3 .1.1 on page 141 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Initialization Vector is [ 217 158 52 159 29 220 10 126 250 240 129 168 243 15 ] Encrypted part is [ 158 220 32 30 158 254 73 111 45 102 230 162 209 246 93 216 200 108 223 116 32 109 1 82 87 166 108 227 20 9 54 59 24 126 154 14 159 250 161 203 128 27 237 27 218 243 169 235 28 112 101 109 177 94 191 251 198 126 102 93 236 51 190 157 4 188 128 1 114 120 135 191 22 7 42 191 209 135 168 241 228 137 121 180 140 113 211 159 26 192 70 74 130 25 180 75 86 230 207 240 101 164 65 179 122 59 202 213 142 244 54 151 158 46 72 52 249 87 219 11 202 69 150 45 195 200 84 134 30 148 21 70 144 235 236 141 234 135 4 120 1 180 69 84 ] MAC is [ 35 73 16 71 208 212 143 135 222 115 85 26 25 172 2 202 15 2 249 109 71 41 255 177 105 20 134 33 10 54 254 210 ] MAC is 32 bytes, see field 15 in 3 .1 on page 140 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Checksum is [ 144 147 65 ] , length of checksum is 3 Original message, prior to any encryption or decryption operations: Hello, this is a very long and creative message without any imagination in progress ciphertext is: \ufffd\ufffd!E\ufffdS\ufffd\ufffd\ufffd } \ufffdp\ufffd!\ufffd\ufffd in progress ciphertext is: \ufffd\ufffd!E\ufffdS\ufffd\ufffd\ufffd } \ufffdp\ufffd!\ufffd\ufffd7I\ufffdH\u0019d\ufffdi\ufffd7p\ufffd/N\u02fd\u0018.\ufffdg\ufffd\ufffdK\ufffd ; \ufffd\ufffd\ufffd\u0015\ufffd_\ufffd\ufffd\ufffd\ufffdN\u00d8tk\ufffd\ufffd\ufffdYH\ufffd^\ufffd Final ciphertext is: \ufffd\ufffd!E\ufffdS\ufffd\ufffd\ufffd } \ufffdp\ufffd!\ufffd\ufffd7I\ufffdH\u0019d\ufffdi\ufffd7p\ufffd/N\u02fd\u0018.\ufffdg\ufffd\ufffdK\ufffd ; \ufffd\ufffd\ufffd\u0015\ufffd_\ufffd\ufffd\ufffd\ufffdN\u00d8tk\ufffd\ufffd\ufffdYH\ufffd^\ufffd\ufffd\ufffdH\ufffd5f\ufffd!\ufffd\u0019\u0018\ufffd>-\u001cc In progress decryption is: In progress decryption is: Hello, this is a very long and creative message without any imag Final decryption is: Hello, this is a very long and creative message without any imagination Original message equals decrypted message! Original message: Hello, this is a very long and creative message without any imagination Length of original message: 71 Encrypted message \ufffd\ufffd!E\ufffdS\ufffd\ufffd\ufffd } \ufffdp\ufffd!\ufffd\ufffd7I\ufffdH\u0019d\ufffdi\ufffd7p\ufffd/N\u02fd\u0018.\ufffdg\ufffd\ufffdK\ufffd ; \ufffd\ufffd\ufffd\u0015\ufffd_\ufffd\ufffd\ufffd\ufffdN\u00d8tk\ufffd\ufffd\ufffdYH\ufffd^\ufffd\ufffd\ufffdH\ufffd5f\ufffd!\ufffd\u0019\u0018\ufffd>-\u001cc Length of encrypted message: 80 Decrypted message: Hello, this is a very long and creative message without any imagination Length of decrypted message: 71 The mechanism used to generate the key is CKM_AES_KEY_GEN which informs us that we wish to generate an AES secret key. The length of the key blob is 256 bytes. Notice, that this key blob contains metadata used by the EP11 library, so it contains much more than the actual key, which is 256 bits, not bytes. In fact we can't even see the key in cleartext form. It is encrypted within the key blob by the Crypto Express 7S card domain's root wrapping key . The only place the key we created is every available in the clear is while it is being used inside the Crypto Express 7S card, because the root wrapping key never leaves the card. The ID of the root wrapping key of the Crypto Express 7S card domain is listed in the output in the line that starts with *WK ID is *. This ID is the first sixteen bytes of the hash of the key. It is not the full hash, and even if it was, you cannot retrieve the original data from the hash, so the root wrapping key remains secret. The ID of the root wrapping key for our Crypto Express 7S card domain is [ 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 ] As you perform the exercises in this lab, you may notice that any time I print out the WK ID , it will always be this value. The encryption in this exercise takes place in multiple calls. One may either encrypt all of the data in a single call to a function named Encrypt() , or may make multiple calls by performing one or more caalls to EncryptUpdate() followed by a call to EncryptFinal() . This sample program uses the latter approach, so in the output you see two lines that say In progress ciphertext is that show the results so far after each EncryptUpdate() call and then a line that says Final ciphertext is after the call to EncryptFinal() . Decryption follows the same pattern- two calls to DecryptUpdate() followed by a call to *DecryptFinal(), and the output in the program indicates this. The program for this exercise defaults to a key length of 256 bits. Try running with a key length of 128 bits: ./lab --ex2 --keyLength 128 Example Output Generated AES Key with mechanism CKM_AES_KEY_GEN length of key blob is 256 bytes Key blob is (values in decimal): [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 141 38 0 0 0 0 0 0 0 1 18 52 3 221 177 141 112 242 216 176 144 18 6 175 10 206 202 162 226 99 67 216 88 101 201 3 114 172 228 151 134 15 141 183 46 209 125 119 136 246 196 223 189 56 243 204 100 151 226 149 160 128 229 255 216 226 133 171 65 244 16 197 245 172 136 232 118 184 206 173 34 79 215 214 202 250 8 237 80 168 235 252 137 221 202 76 92 21 176 127 119 178 212 220 235 169 231 144 203 67 92 32 243 99 83 171 234 198 118 71 201 176 223 202 214 117 107 152 139 105 99 39 22 243 21 20 173 175 57 84 114 199 115 225 125 30 230 123 50 120 157 37 32 151 24 77 118 170 12 222 17 3 53 7 177 238 226 18 192 102 80 131 223 195 188 205 133 31 172 138 123 48 4 244 81 224 205 165 108 128 163 226 55 208 117 70 166 128 111 166 213 158] The above structure is what you would save in order to persist this key blob. Below is how the above structure would typically be saved, in PEM Format: -----BEGIN HSM ENCRYPTED AES SECRET KEY----- AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADsIIxQY2Y9lWElrfi1CQo AAAAAAAAjSYAAAAAAAAAARI0A92xjXDy2LCQEgavCs7KouJjQ9hYZckDcqzkl4YP jbcu0X13iPbE370488xkl+KVoIDl/9jihatB9BDF9ayI6Ha4zq0iT9fWyvoI7VCo 6/yJ3cpMXBWwf3ey1NzrqeeQy0NcIPNjU6vqxnZHybDfytZ1a5iLaWMnFvMVFK2v OVRyx3PhfR7mezJ4nSUglxhNdqoM3hEDNQex7uISwGZQg9/DvM2FH6yKezAE9FHg zaVsgKPiN9B1RqaAb6bVng== -----END HSM ENCRYPTED AES SECRET KEY----- WK virtualization mask is [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] See 6.2.2 of page 179 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf WK ID is [3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40] See 6.7.1 on page 182 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Blob version is [18 52] See 3.1.1 on page 141 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Initialization Vector is [3 221 177 141 112 242 216 176 144 18 6 175 10 206] Encrypted part is [202 162 226 99 67 216 88 101 201 3 114 172 228 151 134 15 141 183 46 209 125 119 136 246 196 223 189 56 243 204 100 151 226 149 160 128 229 255 216 226 133 171 65 244 16 197 245 172 136 232 118 184 206 173 34 79 215 214 202 250 8 237 80 168 235 252 137 221 202 76 92 21 176 127 119 178 212 220 235 169 231 144 203 67 92 32 243 99 83 171 234 198 118 71 201 176 223 202 214 117 107 152 139 105 99 39 22 243 21 20 173 175 57 84 114 199 115 225 125 30 230 123 50 120 157 37 32 151 24 77 118 170 12 222 17 3 53 7 177 238 226 18 192 102] MAC is [80 131 223 195 188 205 133 31 172 138 123 48 4 244 81 224 205 165 108 128 163 226 55 208 117 70 166 128 111 166 213 158] MAC is 32 bytes, see field 15 in 3.1 on page 140 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Checksum is [132 58 194], length of checksum is 3 Original message, prior to any encryption or decryption operations: Hello, this is a very long and creative message without any imagination in progress ciphertext is: \ufffd\ufffd\ufffd\u001d[\ufffdF\ufffdVl in progress ciphertext is: \ufffd\ufffd\ufffd\u001d[\u0336:\ufffd\ufffd\ufffdl \ufffd.\ufffdW\ufffd+\ufffd]n,\ufffd\u0013#\ufffd-\ufffd\u0011\ufffd{\ufffd\ufffd\u001b\ufffd\ufffd\ufffd\ufffd\u00134\u0006\ufffd\ufffduj\ufffd\ufffd!\ufffd v Final ciphertext is: \ufffd\ufffd\ufffd\u001d[\u0336:\ufffd\ufffd\ufffdl \ufffd.\ufffdW\ufffd+\ufffd]n,\ufffd\u0013#\ufffd-\ufffd\u0011\ufffd{\ufffd\ufffd\u001b\ufffd\ufffd\ufffd\ufffd\u00134\u0006\ufffd\ufffduj\ufffd\ufffd!\ufffd v\ufffd\ufffd7\u0474\ufffd\ufffd,\ufffd\ufffd5\u001c-\ufffd\ufffd In progress decryption is: In progress decryption is: Hello, this is a very long and creative message without any imag Final decryption is: Hello, this is a very long and creative message without any imagination Original message equals decrypted message! Original message: Hello, this is a very long and creative message without any imagination Length of original message: 71 Encrypted message \ufffd\ufffd\ufffd\u001d[\u0336:\ufffd\ufffd\ufffdl \ufffd.\ufffdW\ufffd+\ufffd]n,\ufffd\u0013#\ufffd-\ufffd\u0011\ufffd{\ufffd\ufffd\u001b\ufffd\ufffd\ufffd\ufffd\u00134\u0006\ufffd\ufffduj\ufffd\ufffd!\ufffd v\ufffd\ufffd7\u0474\ufffd\ufffd,\ufffd\ufffd5\u001c-\ufffd\ufffd Length of encrypted message: 80 Decrypted message: Hello, this is a very long and creative message without any imagination Length of decrypted message: 71 Our first run of this program used a key length of 256 bits, and this run used a key length of 128 bits. Notice that the key blob itself is still 256 bytes in length. By the way, the gibberish printed out in the encrypted message portion of the output is because a byte of ciphertext is likely to contain any value from 0 to 255 and only a portion of those will turn out to be printable characters if you try to treat it as if it was a character string and try to print it out like this program does- you may see one or more lines, if one of the ciphertext bytes produced happens to be the value of a linefeed character, and if it is a carriage return without a line feed it may have \"overwritten\" some of the preceding gibberish. Real life use cases aren't typically going to require you to print ciphertext as this program did for education purposes. Try with a key length of 192 bits: ./lab --ex2 --keyLength 192 Note Output not shown here, it should be similar to the prior two commands. Try with a key length of 384 bits: ./lab --ex2 --keyLength 384 Example Output panic: GenerateKey Error: rpc error: code = Unknown desc = CKR_KEY_SIZE_RANGE goroutine 1 [running]: main.encryptAndDecrypt(0x180, 0xa28e3b, 0x47) /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/lab/exercise2.go:55 +0x2c89 main.main() /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/lab/main.go:73 +0x3a3 Don't panic! (Even if Go did). I meant for this to happen. This exercise uses the CKM_AES_KEY_GEN mechanism. (This is in the first line of the progrram output). If we run exercise one again and pipe its output to grep, with a fancy argument to print one extra line, we can see that the minimum key size is 128 bits and the maximum key size is 256 bits. Try it: ./lab --ex1 | grep CKM_AES_KEY_GEN --after-context 1 So our key size must be in a range from 128 to 256 bits. Let's try a key length of 224 bits: ./lab --ex2 --keyLength 224 Example Output panic: GenerateKey Error: rpc error: code = Unknown desc = CKR_KEY_SIZE_RANGE goroutine 1 [running]: main.encryptAndDecrypt(0xe0, 0xa28e3b, 0x47) /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/lab/exercise2.go:55 +0x2c89 main.main() /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/lab/main.go:73 +0x3a3 Is this the new math where 224 is not between 128 and 256? No. What's going on here is that the AES standard supports keys of a certain length- 128, 192, and 256 bits. So while the mechanism information told us the minimum and maximum key size, the expectation is that the programmer knows a little bit about the AES standard when using it! Would you like to encrypt and decrypt your own text? Try it like this- feel free to copy and paste what is provided here, or substitute your own witty banter for the value of the --plaintext argument. ./lab --ex2 --plaintext \"The quick brown fox jumped over the lazy dog\" Note Output not shown, but you should see the message being encrypted and decrypted. Unless... Troubleshooting If you received this message in your output, panic: Failed Encrypt [rpc error: code = Unknown desc = CKR_ARGUMENTS_BAD] , then there is a pretty good chance that you supplied a plaintext value less than twenty-one characters in length. This exercise was based on the sample code, which performs the encryption in two steps. The first step passsed the first twenty bytes of input to the crypto card, and the second step passed the remainder of the input. The input was hard-coded and of length greater than twenty bytes, so the sample does not have logic to handle input of twenty bytes or less. The sample has not been modified to handle the case where that second pass isn't needed. Don't worry, in the real world, you can probably solve this problem if you throw enough money at it. :-)","title":"Overview of Exercise 2"},{"location":"grep11-lab/lab-exercise3/","text":"Exercise 3 - Sign and Verify Data \u00b6 Overview of Exercise 3 \u00b6 Exercise three uses public key cryptography to demonstrate signing of data and then verifying the signature. Other terms often used that are associated with public key cryptography are asymmetric keys or public and private key pairs . The major characteristic is that an asymmetric key is actually a pair of keys that are related. One key is called the public key and can be shared with anyone. The other key is called the private key and is kept secret. These key pairs can be used for encryption and decryption, as well as for creating and verifying digital signatures. Public key cryptography in simple terms \u00b6 Public key cryptography and encryption When using public key cryptography, the assumption is that anybody in the world could have your public key, but you have kept your private key to yourself. For encryption, anybody who has your public key could encrypt data with it and send you that encrypted data, or ciphertext. If an adversary possessed the ciphertext, they could not decrypt it. Only you, with your private key, can decrypt it. Technically, you could encrypt data with your private key that holders of your public key could decrypt, but this use case doesn't make sense- since anybody could have your public key, you have not managed to achieve privacy with your encryption. Public key cryptography and digital signatures Your private key can be used to allow you to digitally \"sign\" data, which is an attestation that you have seen the data that you have signed, analagous to your signing by pen a letter or contract on a piece of paper. There are different digital signature algorithms, but in general, they follow the following pattern. Assume you want to digitally sign some data you send to somebody: You create a digest, or hash, over some data, using some algorithm. This hash uniquely identifies the data. You encrypt this hash with your private key. This is your digital signature. You send the data, and your digital signature, to the intended recipient. The recipient calculates the digest, or hash, of the data, using the same algorithm that you used in step 1. If the data has remained intact in transit, they will calculate the same hash that you did in step 1. They then decrypt your signature (from step 2) with your public key. This retrieves in plaintext the hash you signed in step 1. If the hash they calculated in step 4 matches the hash that you encrypted with your private key in step 2 (and retrieved by them in step 5), then it is proof that you have seen the data they have received. The fundamental assumption is that you have kept your private key in your sole possession. If an adversary stole your private key they could impersonate you. Also, observe that the validity of this digital signature is independent of whether or not the data that you send is plaintext or ciphertext. The two most commonly used forms of public key cryptography are RSA cryptography and elliptic curve cryptography. RSA cryptography was developed first and is built upon the difficulty of factoring the product of two very large prime numbers. It is easy for a computer to find two very large prime numbers and multiply them together to obtain a product. On the other hand, given this product, it is extremely difficult, if not impossible, for even today's powerful computers to figure out what two prime numbers were used to produce that product! It seems like a preposterous statement, but it's true! Elliptic curve cryptography is based on algebraic equations called elliptic curves. The idea is that a mathematical addition function can be defined on this curve, such that it is very easy for a computer to do a large number of additions on the curve which results in a point on the curve. But if you give someone the equation for the curve, and the point on the curve that you have calculated, but you don't tell them how many additions you did to calculate this point, even today's powerful computers cannot figure out how many additions were performed! It seems like a preposterous statement, but it's true! In simple terms, an RSA public key contains the product of the two primes, and the RSA private key contains the hidden information- the two primes. An elliptic curve public key contains all of the information about the curve, including the point that was calculated, except for the number of additions used to calculate the point, while the elliptic curve private key includes the hidden information- the number of additions that were used to create the point. If I multiplied two small prime numbers like 7 x 13 and gave you the product 91, it probably wouldn't take you too long to factor it back to 7 and 13. Computers need to use incredibliy large prime numbers in order to calculate a product that another computer can't quickly factor. That is why RSA keys are usually 2048 or 4096 bits in length. You can create smaller RSA keys but today's computers can factor the product contained in the public key quicker, the smaller the key. On the other hand, the size of elliptic curve public keys can be much smaller than RSA public keys, and provide the equivalent strength. That is, a relatively small-sized ellipctic curve key is just as difficult for a computer to crack by brute force than it is for a much larger-sized RSA key. For this reason, elliptic curve cryptography is becoming increasingly popular- the smaller key size means less computational power is needed to work with these keys, so they are more efficient and use less power, which is more appealing for devices that are typically drawing on battery power, like smartphones and tablets. EP11 supports both RSA and elliptic curve cryptography, as you saw in the GREP11 sample. This exercise will dig a little deeper into elliptic curves. Run Exercise 3 \u00b6 Run the third exercise: ./lab --ex3 Example Output selected curve P521 with ObjectID of 1.3.132.0.35 Curve ObjectID in ASN.1 BER encoding is [6 5 43 129 4 0 35] Generated ECDSA PKCS key pair with mechanism CKM_EC_KEY_PAIR_GEN key pair public key blob length is 286 bytes key pair public key blob is [48 129 155 48 16 6 7 42 134 72 206 61 2 1 6 5 43 129 4 0 35 3 129 134 0 4 1 251 93 197 238 11 2 165 14 39 212 27 175 77 65 78 70 252 221 242 195 236 163 3 63 184 70 158 146 51 22 230 181 30 78 101 47 150 133 100 197 101 31 144 59 192 199 237 14 94 86 237 73 52 79 1 45 220 65 57 113 117 113 173 220 70 0 48 137 50 146 141 22 219 122 151 69 232 10 132 29 121 198 108 226 233 9 117 185 16 125 236 113 235 136 54 127 109 229 150 26 117 63 231 242 158 101 248 86 80 17 69 31 217 156 122 140 30 75 132 155 187 35 148 239 49 81 172 10 210 181 169 4 16 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 4 32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4 8 255 72 74 131 146 172 234 187 4 8 0 0 0 0 0 0 0 1 4 20 16 1 0 0 0 1 128 128 0 1 128 128 128 1 0 10 0 0 0 1 4 32 217 93 11 148 136 24 62 138 168 213 244 131 187 81 107 102 114 120 167 70 193 179 233 4 32 228 144 160 232 167 125 167] key pair private key blob length is 896 bytes key pair private key blob is [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 1 38 0 0 0 0 0 0 0 1 18 52 145 242 100 209 252 135 97 118 108 26 68 196 204 214 35 186 208 121 174 78 194 146 179 179 92 26 100 178 30 39 144 58 232 153 47 120 177 131 143 109 255 143 188 55 83 243 168 100 93 113 176 50 33 176 209 178 137 124 13 64 217 65 230 242 127 41 206 53 149 52 238 111 241 174 206 137 141 251 17 145 233 76 219 82 103 108 35 168 57 114 44 179 164 157 12 81 167 193 171 27 42 69 50 108 161 45 227 151 199 15 59 120 177 122 62 66 95 9 115 57 85 29 132 224 146 162 177 224 143 36 125 126 210 113 18 73 145 60 48 109 176 162 41 145 33 242 93 154 122 118 216 252 111 7 253 207 195 227 151 15 112 99 44 177 14 14 193 35 199 207 79 29 219 88 146 132 3 80 128 196 150 37 18 7 192 185 68 38 158 232 84 145 198 24 210 154 34 157 76 53 244 18 31 194 99 80 36 31 225 41 141 69 135 116 43 239 186 193 84 112 103 110 56 148 66 115 76 202 125 45 15 86 124 24 19 247 208 131 51 37 186 172 94 58 155 214 238 131 253 48 86 125 62 240 123 236 237 88 76 218 21 215 202 210 90 29 119 239 2 237 11 242 202 214 116 98 88 90 15 0 12 170 20 96 132 49 224 57 22 113 123 27 19 173 121 50 99 116 175 20 153 192 223 84 121 17 154 88 74 118 245 131 21 179 162 154 44 182 15 66 240 9 154 118 1 122 101 101 103 14 207 47 167 133 152 187 147 221 241 84 223 72 136 243 239 77 65 121 219 208 223 95 175 139 39 100 52 227 185 126 22 143 41 183 28 57 63 238 117 196 172 63 131 116 248 74 165 132 160 77 148 174 44 102 91 29 49 74 230 85 215 83 154 130 46 164 163 212 85 82 103 5 205 233 181 126 160 118 154 65 120 155 89 224 218 132 99 158 134 210 225 219 252 254 167 208 170 164 148 97 226 25 236 152 47 113 74 5 73 177 157 60 120 4 62 87 17 116 190 73 132 124 17 61 46 63 12 184 8 74 177 100 119 151 58 163 126 181 199 95 202 99 112 64 55 97 66 138 83 168 62 160 62 8 160 148 126 215 124 65 228 200 122 192 129 121 18 135 244 95 4 94 0 231 246 49 195 181 35 72 161 110 97 180 135 111 33 28 173 49 235 8 58 56 217 31 159 195 61 195 34 10 160 111 224 53 22 175 9 79 39 142 46 43 91 210 69 183 229 68 114 86 142 221 196 206 234 143 244 49 236 231 253 226 95 36 14 131 74 48 31 144 4 254 235 158 189 98 28 1 100 181 19 139 69 29 166 136 227 85 21 131 130 138 197 249 29 222 65 128 252 16 217 121 157 232 150 126 54 245 116 145 127 175 167 125 46 94 214 38 224 85 172 87 97 163 231 181 218 248 103 211 224 79 122 157 160 76 54 242 13 46 182 10 105 119 6 51 91 11 116 120 2 188 148 108 191 158 100 28 40 158 212 35 94 53 6 59 84 216 207 101 112 40 178 164 252 110 116 39 59 78 78 7 204 241 147 2 234 244 153 214 32 151 187 250 112 162 173 136 214 67 114 195 102 170 240 228 160 123 41 178 7 2 147 66 5 236 100 170 198 233 8 218 163 244 224 211 8 127 36 60 220 185 158 17 171 78 156 168 141 73 86 146 47 252 55 247 12 105 21 170 199 27 69 149 217 78 89 37 125 246 220 29 177 15 18 78 153 170 123 109 248 47 4 130 121 174 88 44 96 61 71 208 112 34 236 111 189 240 195 15 45 176 84 140 35 171 110 124 164 98 0 122 173 69 82 27 118 51 226 30 193 106 51 21 83 194 189 110 18 92 156 198 221 189 211 84 220 207] Some of the fields in the private key blob follow: WK ID is [3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40] See 6.7.1 of page 182 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Blob version is [18 52] See 3.1.1 on page 141 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf IV is [145 242 100 209 252 135 97 118 108 26 68 196 204 214] Encrypted part is [35 186 208 121 174 78 194 146 179 179 92 26 100 178 30 39 144 58 232 153 47 120 177 131 143 109 255 143 188 55 83 243 168 100 93 113 176 50 33 176 209 178 137 124 13 64 217 65 230 242 127 41 206 53 149 52 238 111 241 174 206 137 141 251 17 145 233 76 219 82 103 108 35 168 57 114 44 179 164 157 12 81 167 193 171 27 42 69 50 108 161 45 227 151 199 15 59 120 177 122 62 66 95 9 115 57 85 29 132 224 146 162 177 224 143 36 125 126 210 113 18 73 145 60 48 109 176 162 41 145 33 242 93 154 122 118 216 252 111 7 253 207 195 227 151 15 112 99 44 177 14 14 193 35 199 207 79 29 219 88 146 132 3 80 128 196 150 37 18 7 192 185 68 38 158 232 84 145 198 24 210 154 34 157 76 53 244 18 31 194 99 80 36 31 225 41 141 69 135 116 43 239 186 193 84 112 103 110 56 148 66 115 76 202 125 45 15 86 124 24 19 247 208 131 51 37 186 172 94 58 155 214 238 131 253 48 86 125 62 240 123 236 237 88 76 218 21 215 202 210 90 29 119 239 2 237 11 242 202 214 116 98 88 90 15 0 12 170 20 96 132 49 224 57 22 113 123 27 19 173 121 50 99 116 175 20 153 192 223 84 121 17 154 88 74 118 245 131 21 179 162 154 44 182 15 66 240 9 154 118 1 122 101 101 103 14 207 47 167 133 152 187 147 221 241 84 223 72 136 243 239 77 65 121 219 208 223 95 175 139 39 100 52 227 185 126 22 143 41 183 28 57 63 238 117 196 172 63 131 116 248 74 165 132 160 77 148 174 44 102 91 29 49 74 230 85 215 83 154 130 46 164 163 212 85 82 103 5 205 233 181 126 160 118 154 65 120 155 89 224 218 132 99 158 134 210 225 219 252 254 167 208 170 164 148 97 226 25 236 152 47 113 74 5 73 177 157 60 120 4 62 87 17 116 190 73 132 124 17 61 46 63 12 184 8 74 177 100 119 151 58 163 126 181 199 95 202 99 112 64 55 97 66 138 83 168 62 160 62 8 160 148 126 215 124 65 228 200 122 192 129 121 18 135 244 95 4 94 0 231 246 49 195 181 35 72 161 110 97 180 135 111 33 28 173 49 235 8 58 56 217 31 159 195 61 195 34 10 160 111 224 53 22 175 9 79 39 142 46 43 91 210 69 183 229 68 114 86 142 221 196 206 234 143 244 49 236 231 253 226 95 36 14 131 74 48 31 144 4 254 235 158 189 98 28 1 100 181 19 139 69 29 166 136 227 85 21 131 130 138 197 249 29 222 65 128 252 16 217 121 157 232 150 126 54 245 116 145 127 175 167 125 46 94 214 38 224 85 172 87 97 163 231 181 218 248 103 211 224 79 122 157 160 76 54 242 13 46 182 10 105 119 6 51 91 11 116 120 2 188 148 108 191 158 100 28 40 158 212 35 94 53 6 59 84 216 207 101 112 40 178 164 252 110 116 39 59 78 78 7 204 241 147 2 234 244 153 214 32 151 187 250 112 162 173 136 214 67 114 195 102 170 240 228 160 123 41 178 7 2 147 66 5 236 100 170 198 233 8 218 163 244 224 211 8 127 36 60 220 185 158 17 171 78 156 168 141 73 86 146 47 252 55 247 12 105 21 170 199 27 69 149 217 78 89 37 125 246 220 29 177 15 18 78 153 170 123 109 248 47 4 130 121 174 88 44 96 61 71 208 112 34 236 111 189 240 195 15 45 176 84 140 35 171] MAC is [110 124 164 98 0 122 173 69 82 27 118 51 226 30 193 106 51 21 83 194 189 110 18 92 156 198 221 189 211 84 220 207] MAC is 32 bytes, see field 15 in 3.1 on page 140 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf -----BEGIN HSM ENCRYPTED PRIVATE KEY----- AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADsIIxQY2Y9lWElrfi1CQo AAAAAAAAASYAAAAAAAAAARI0kfJk0fyHYXZsGkTEzNYjutB5rk7CkrOzXBpksh4n kDromS94sYOPbf+PvDdT86hkXXGwMiGw0bKJfA1A2UHm8n8pzjWVNO5v8a7OiY37 EZHpTNtSZ2wjqDlyLLOknQxRp8GrGypFMmyhLeOXxw87eLF6PkJfCXM5VR2E4JKi seCPJH1+0nESSZE8MG2woimRIfJdmnp22PxvB/3Pw+OXD3BjLLEODsEjx89PHdtY koQDUIDEliUSB8C5RCae6FSRxhjSmiKdTDX0Eh/CY1AkH+EpjUWHdCvvusFUcGdu OJRCc0zKfS0PVnwYE/fQgzMluqxeOpvW7oP9MFZ9PvB77O1YTNoV18rSWh137wLt C/LK1nRiWFoPAAyqFGCEMeA5FnF7GxOteTJjdK8UmcDfVHkRmlhKdvWDFbOimiy2 D0LwCZp2AXplZWcOzy+nhZi7k93xVN9IiPPvTUF529DfX6+LJ2Q047l+Fo8ptxw5 P+51xKw/g3T4SqWEoE2UrixmWx0xSuZV11Oagi6ko9RVUmcFzem1fqB2mkF4m1ng 2oRjnobS4dv8/qfQqqSUYeIZ7JgvcUoFSbGdPHgEPlcRdL5JhHwRPS4/DLgISrFk d5c6o361x1/KY3BAN2FCilOoPqA+CKCUftd8QeTIesCBeRKH9F8EXgDn9jHDtSNI oW5htIdvIRytMesIOjjZH5/DPcMiCqBv4DUWrwlPJ44uK1vSRbflRHJWjt3EzuqP 9DHs5/3iXyQOg0owH5AE/uuevWIcAWS1E4tFHaaI41UVg4KKxfkd3kGA/BDZeZ3o ln429XSRf6+nfS5e1ibgVaxXYaPntdr4Z9PgT3qdoEw28g0utgppdwYzWwt0eAK8 lGy/nmQcKJ7UI141BjtU2M9lcCiypPxudCc7Tk4HzPGTAur0mdYgl7v6cKKtiNZD csNmqvDkoHspsgcCk0IF7GSqxukI2qP04NMIfyQ83LmeEatOnKiNSVaSL/w39wxp FarHG0WV2U5ZJX323B2xDxJOmap7bfgvBIJ5rlgsYD1H0HAi7G+98MMPLbBUjCOr bnykYgB6rUVSG3Yz4h7BajMVU8K9bhJcnMbdvdNU3M8= -----END HSM ENCRYPTED PRIVATE KEY----- -----BEGIN PUBLIC KEY----- MIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQB+13F7gsCpQ4n1BuvTUFORvzd8sPs owM/uEaekjMW5rUeTmUvloVkxWUfkDvAx+0OXlbtSTRPAS3cQTlxdXGt3EYAMIky ko0W23qXRegKhB15xmzi6Ql1uRB97HHriDZ/beWWGnU/5/KeZfhWUBFFH9mceowe S4SbuyOU7zFRrArStakEEAOwgjFBjZj2VYSWt+LUJCgEIAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAABAj/SEqDkqzquwQIAAAAAAAAAAEEFBABAAAAAYCA AAGAgIABAAoAAAABBCDZXQuUiBg+iqjV9IO7UWtmcninRsGz6QQg5JCg6Kd9pw== -----END PUBLIC KEY----- Data signed Signature verified The first line of the output shows the Object ID of the curve that was used. These Object IDs are assigned by standards bodies. The Object ID used here is 1.3.132.0.35 . Stick 1.3.132.0.35 in your favorite Google machine and see what you find. Or take my word for it that this identifies the secp521r1 curve. The second line of the output shows ASN.1 BER encoding of 1.3.132.0.35, which is 6 5 43 129 4 0 35 . If you were to look up how ASN.1 BER encoding works, your first question would be, \"Why?\". Don't go there now. But I bring it up because you will notice that a few lines down in the output, in the key pair public key blob section, you'll see that encoded string, 6 5 43 129 4 0 35 , about 14 bytes from the beginning. In fact, while the whole point of using the GREP11 server and the Crypto Express 7S cards is to keep secrets from an adversary, the information shown in the key pair public key blob section is \"in the clear\"- you could give this to your adversary without fear of having your secrets compromised. The list of decimal bytes of these keys is mostly gibberish to us humans, I'm not sure why I even bothered to print them out, but take a look at the output at the end, where there are several lines between a header and footer for HSM ENCRYPTED PRIVATE KEY (BEGIN and END), and several lines between a header and footer for a PUBLIC KEY. To use these keys in the future, you would need to persist both of these to separate files. You wouldn't have a reason to give your adversary the HSM ENCRYPTED PRIVATE KEY, but, if he did obtain it, it would be of no value to him unless he was able to access your Crypto Express 7S card that had the same root wrapping key. The contents of this file are encrypted and are usuable only within the Crypto Express card that created it, or in another Crypto Express card that had the same root wrapping key. Since the PUBLIC KEY is, by definition, shareable with the world, we can use the common openssl utility to look at it. Try it like this: Copy the lines from near the bottom of your output that have your public key , including the BEGIN PUBLIC KEY and END PUBLIC KEY header and footer lines, and the dashes, into your clipboard In a terminal window, type echo \" (that is a single pair of double-quotes) and then paste your clipboard contents onto the command line Type \" | openssl ec -in - -pubin -noout -text and then press Enter You should see output similar to this: read EC key Public-Key: (521 bit) pub: 04:00:59:fe:0c:b3:d0:6e:b2:d7:b0:c0:05:86:66: dd:62:bc:fe:96:5c:fa:08:6d:f3:be:5f:6d:a1:3d: 8f:40:13:83:23:ec:34:e4:e5:20:6c:f9:75:34:bd: 30:cd:be:1f:5b:aa:ee:44:99:d9:ae:69:50:24:c7: 82:7c:f4:f2:18:d1:b0:00:be:5c:64:f5:dd:16:79: eb:d4:9c:28:ae:43:9b:f4:13:a4:f3:db:3c:a2:e5: 52:bb:0f:9f:e1:c4:a4:c1:29:63:4e:bc:2f:73:4c: da:fd:4f:42:63:0d:3d:9d:bb:29:76:57:85:13:57: 3a:ae:8f:20:64:0a:cf:c2:f1:41:d3:fc:8a ASN1 OID: secp521r1 NIST CURVE: P-521 Tip If you are a Linux guru you could create a file with vi and copy the key into the file, and then provide that as input to the openssl command, e.g., openssl ec -in baz -pubin -noout -text if baz was the file you created. In the exercise output I first printed the public key as an array of decimal numbers (worthless!), then I printed it in PEM-encoded format (boring!) but now you see the key in hexadecimal format (that's incredible!!). You also get the added bonus of knowing it's a legit public key since the openssl utility made sense of it. Try using a different curve: ./lab --ex3 --curve P224 Example Output selected curve P224 with ObjectID of 1.3.132.0.33 Curve ObjectID in ASN.1 BER encoding is [6 5 43 129 4 0 33] Generated ECDSA PKCS key pair with mechanism CKM_EC_KEY_PAIR_GEN key pair public key blob length is 208 bytes key pair public key blob is [48 78 48 16 6 7 42 134 72 206 61 2 1 6 5 43 129 4 0 33 3 58 0 4 177 164 170 83 241 4 140 49 236 115 12 22 130 206 48 90 174 181 135 16 59 31 11 122 14 254 13 172 129 64 249 1 40 44 231 155 52 110 38 67 175 244 45 81 157 5 213 125 224 199 126 65 251 200 159 53 4 16 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 4 32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4 8 6 63 231 63 240 230 179 88 4 8 0 0 0 0 0 0 0 1 4 20 16 1 0 0 0 1 128 128 0 1 128 128 128 1 0 10 0 0 0 1 4 32 90 61 58 127 30 244 119 154 65 27 170 14 182 232 45 237 92 61 188 238 138 237 84 7 5 209 228 172 195 235 219 189] key pair private key blob length is 544 bytes key pair private key blob is [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 1 38 0 0 0 0 0 0 0 1 18 52 1 7 210 186 20 15 180 182 68 217 17 251 23 142 218 85 206 228 75 16 37 108 9 47 216 5 160 29 100 235 78 164 63 25 232 181 251 214 113 69 26 198 9 222 119 149 66 64 233 183 172 93 96 41 223 99 201 110 138 227 51 26 197 166 9 8 190 40 129 254 49 89 54 38 209 21 60 137 118 113 174 145 254 145 152 119 73 114 11 144 41 25 106 152 140 167 192 88 82 199 100 234 18 255 129 213 111 25 126 2 200 3 44 90 252 84 48 191 106 98 2 77 78 7 165 189 227 52 167 78 188 5 185 254 178 206 180 171 47 110 54 38 87 16 191 167 134 237 48 49 153 168 54 225 251 75 223 3 55 239 48 119 76 89 103 20 30 222 104 167 219 210 46 17 75 224 196 191 55 238 236 156 205 119 182 199 12 58 144 248 124 216 181 38 11 17 139 144 123 31 108 76 171 91 154 112 6 160 188 2 181 110 212 46 66 153 211 21 184 1 51 194 12 245 73 155 192 206 80 213 51 187 166 3 207 127 151 127 59 158 192 7 92 113 247 118 108 55 217 84 183 34 24 144 57 215 193 96 179 93 2 190 84 85 119 199 179 96 119 2 9 160 231 251 214 187 5 206 224 207 111 52 58 181 131 237 11 245 106 181 223 217 240 98 162 190 11 116 18 46 225 218 17 130 79 19 4 171 94 129 197 59 201 54 63 31 60 90 84 225 223 121 94 173 42 103 3 204 128 187 143 209 78 80 151 157 90 44 76 20 254 18 96 197 70 36 135 24 13 156 77 112 196 22 35 123 199 169 17 195 156 0 212 50 140 50 126 70 132 126 149 172 94 173 49 156 173 207 208 109 166 88 148 204 25 122 119 58 130 215 130 101 13 235 96 29 210 130 229 51 232 250 206 124 162 68 112 3 191 129 184 195 34 186 72 103 159 228 155 244 43 108 205 37 82 176 243 200 233 88 91 31 243 33 232 44 178 19 57 182 239 63 238 130 33 1 127 250 215 109 121 187 134 218 173 74 112 88 230 152 90 147 20 43 28 254 173 28 25 255 0 147 78 51 231 175 190 29] Some of the fields in the private key blob follow: WK ID is [3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40] See 6.7.1 of page 182 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Blob version is [18 52] See 3.1.1 on page 141 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf IV is [1 7 210 186 20 15 180 182 68 217 17 251 23 142] Encrypted part is [218 85 206 228 75 16 37 108 9 47 216 5 160 29 100 235 78 164 63 25 232 181 251 214 113 69 26 198 9 222 119 149 66 64 233 183 172 93 96 41 223 99 201 110 138 227 51 26 197 166 9 8 190 40 129 254 49 89 54 38 209 21 60 137 118 113 174 145 254 145 152 119 73 114 11 144 41 25 106 152 140 167 192 88 82 199 100 234 18 255 129 213 111 25 126 2 200 3 44 90 252 84 48 191 106 98 2 77 78 7 165 189 227 52 167 78 188 5 185 254 178 206 180 171 47 110 54 38 87 16 191 167 134 237 48 49 153 168 54 225 251 75 223 3 55 239 48 119 76 89 103 20 30 222 104 167 219 210 46 17 75 224 196 191 55 238 236 156 205 119 182 199 12 58 144 248 124 216 181 38 11 17 139 144 123 31 108 76 171 91 154 112 6 160 188 2 181 110 212 46 66 153 211 21 184 1 51 194 12 245 73 155 192 206 80 213 51 187 166 3 207 127 151 127 59 158 192 7 92 113 247 118 108 55 217 84 183 34 24 144 57 215 193 96 179 93 2 190 84 85 119 199 179 96 119 2 9 160 231 251 214 187 5 206 224 207 111 52 58 181 131 237 11 245 106 181 223 217 240 98 162 190 11 116 18 46 225 218 17 130 79 19 4 171 94 129 197 59 201 54 63 31 60 90 84 225 223 121 94 173 42 103 3 204 128 187 143 209 78 80 151 157 90 44 76 20 254 18 96 197 70 36 135 24 13 156 77 112 196 22 35 123 199 169 17 195 156 0 212 50 140 50 126 70 132 126 149 172 94 173 49 156 173 207 208 109 166 88 148 204 25 122 119 58 130 215 130 101 13 235 96 29 210 130 229 51 232 250 206 124 162 68 112 3 191 129 184 195 34 186 72 103 159 228 155 244 43 108 205 37 82 176 243 200 233 88 91 31 243 33 232 44 178 19 57 182 239 63 238 130 33 1] MAC is [127 250 215 109 121 187 134 218 173 74 112 88 230 152 90 147 20 43 28 254 173 28 25 255 0 147 78 51 231 175 190 29] MAC is 32 bytes, see field 15 in 3.1 on page 140 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf -----BEGIN HSM ENCRYPTED PRIVATE KEY----- AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADsIIxQY2Y9lWElrfi1CQo AAAAAAAAASYAAAAAAAAAARI0AQfSuhQPtLZE2RH7F47aVc7kSxAlbAkv2AWgHWTr TqQ/Gei1+9ZxRRrGCd53lUJA6besXWAp32PJborjMxrFpgkIviiB/jFZNibRFTyJ dnGukf6RmHdJcguQKRlqmIynwFhSx2TqEv+B1W8ZfgLIAyxa/FQwv2piAk1OB6W9 4zSnTrwFuf6yzrSrL242JlcQv6eG7TAxmag24ftL3wM37zB3TFlnFB7eaKfb0i4R S+DEvzfu7JzNd7bHDDqQ+HzYtSYLEYuQex9sTKtbmnAGoLwCtW7ULkKZ0xW4ATPC DPVJm8DOUNUzu6YDz3+XfzuewAdccfd2bDfZVLciGJA518Fgs10CvlRVd8ezYHcC CaDn+9a7Bc7gz280OrWD7Qv1arXf2fBior4LdBIu4doRgk8TBKtegcU7yTY/Hzxa VOHfeV6tKmcDzIC7j9FOUJedWixMFP4SYMVGJIcYDZxNcMQWI3vHqRHDnADUMowy fkaEfpWsXq0xnK3P0G2mWJTMGXp3OoLXgmUN62Ad0oLlM+j6znyiRHADv4G4wyK6 SGef5Jv0K2zNJVKw88jpWFsf8yHoLLITObbvP+6CIQF/+tdtebuG2q1KcFjmmFqT FCsc/q0cGf8Ak04z56++HQ== -----END HSM ENCRYPTED PRIVATE KEY----- -----BEGIN PUBLIC KEY----- ME4wEAYHKoZIzj0CAQYFK4EEACEDOgAEsaSqU/EEjDHscwwWgs4wWq61hxA7Hwt6 Dv4NrIFA+QEoLOebNG4mQ6/0LVGdBdV94Md+QfvInzUEEAOwgjFBjZj2VYSWt+LU JCgEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAgGP+c/8OazWAQI AAAAAAAAAAEEFBABAAAAAYCAAAGAgIABAAoAAAABBCBaPTp/HvR3mkEbqg626C3t XD287ortVAcF0eSsw+vbvQ== -----END PUBLIC KEY----- Data signed Signature verified Try the P256 curve: ./lab --ex3 --curve P256 Example output selected curve P256 with ObjectID of 1.2.840.10045.3.1.7 Curve ObjectID in ASN.1 BER encoding is [6 8 42 134 72 206 61 3 1 7] Generated ECDSA PKCS key pair with mechanism CKM_EC_KEY_PAIR_GEN key pair public key blob length is 219 bytes key pair public key blob is [48 89 48 19 6 7 42 134 72 206 61 2 1 6 8 42 134 72 206 61 3 1 7 3 66 0 4 110 106 106 221 176 75 119 181 154 179 115 108 192 148 127 80 203 20 154 165 194 20 40 117 94 117 223 125 118 133 226 230 18 128 20 46 239 61 241 136 41 9 78 202 124 188 192 93 181 229 245 210 78 187 156 152 192 132 255 162 17 51 187 117 4 16 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 4 32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4 8 203 203 135 115 66 126 231 150 4 8 0 0 0 0 0 0 0 1 4 20 16 1 0 0 0 1 128 128 0 1 128 128 128 1 0 10 0 0 0 1 4 32 117 106 180 43 131 151 71 204 222 211 38 32 214 138 208 98 235 7 172 87 236 205 51 122 54 65 64 58 70 89 127 218] key pair private key blob length is 576 bytes key pair private key blob is [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 1 38 0 0 0 0 0 0 0 1 18 52 234 153 96 242 234 92 129 26 151 136 72 248 23 66 196 52 4 170 78 111 124 89 151 169 22 232 12 154 65 246 71 238 229 101 98 135 230 50 24 66 130 82 190 65 48 151 138 8 183 43 229 56 95 235 90 163 68 81 9 77 56 28 104 192 150 105 31 193 133 24 224 125 104 86 165 104 162 87 247 209 66 173 168 45 232 4 229 134 211 133 24 229 196 10 32 90 129 146 138 115 39 163 206 102 141 49 142 143 55 114 160 210 56 132 237 137 157 136 203 0 20 217 144 233 140 198 26 179 60 218 95 201 29 214 100 144 55 226 195 23 83 105 50 175 174 214 216 130 2 71 17 191 197 26 180 89 147 168 61 236 49 230 64 190 217 199 13 244 173 182 255 91 144 51 231 177 252 232 210 156 130 70 14 30 129 255 82 247 162 116 213 100 248 100 190 125 48 3 168 85 249 192 75 26 221 95 113 27 1 123 130 248 176 164 140 61 141 190 157 241 193 100 2 180 163 73 141 252 213 35 213 158 95 46 85 0 94 159 101 16 31 97 109 63 64 35 238 255 208 175 121 180 84 162 66 210 119 10 131 119 187 27 116 152 2 41 62 175 176 244 123 70 42 51 244 113 238 102 113 195 54 242 80 148 90 145 226 10 180 122 94 143 119 125 187 118 7 28 184 214 205 205 97 18 71 235 186 245 199 246 57 3 208 121 40 73 6 28 64 217 154 216 108 59 46 158 80 133 8 196 11 223 201 199 234 77 99 219 238 244 6 254 96 55 5 88 109 181 57 85 82 64 67 46 13 114 56 74 117 215 61 161 26 37 221 210 18 229 131 11 232 38 101 190 54 241 253 217 100 80 205 45 113 51 237 105 252 159 11 126 74 152 22 138 45 30 188 157 151 101 139 134 16 221 153 56 216 167 210 214 79 150 96 170 83 161 118 219 162 45 113 179 106 87 147 99 222 42 122 194 24 249 53 210 222 206 2 74 232 110 135 6 12 110 53 2 15 144 180 185 58 249 41 54 36 128 61 116 221 158 154 95 142 32 213 89 48 209 47 155 239 2 142 171 218 207 130 140 18 125 86 224 20 5 4 83 108 163 82 243 62 254 77 103 87 90 32 112 50 169 54 139 200 219 92 84 191 177 139 94] Some of the fields in the private key blob follow: WK ID is [3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40] See 6.7.1 of page 182 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Blob version is [18 52] See 3.1.1 on page 141 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf IV is [234 153 96 242 234 92 129 26 151 136 72 248 23 66] Encrypted part is [196 52 4 170 78 111 124 89 151 169 22 232 12 154 65 246 71 238 229 101 98 135 230 50 24 66 130 82 190 65 48 151 138 8 183 43 229 56 95 235 90 163 68 81 9 77 56 28 104 192 150 105 31 193 133 24 224 125 104 86 165 104 162 87 247 209 66 173 168 45 232 4 229 134 211 133 24 229 196 10 32 90 129 146 138 115 39 163 206 102 141 49 142 143 55 114 160 210 56 132 237 137 157 136 203 0 20 217 144 233 140 198 26 179 60 218 95 201 29 214 100 144 55 226 195 23 83 105 50 175 174 214 216 130 2 71 17 191 197 26 180 89 147 168 61 236 49 230 64 190 217 199 13 244 173 182 255 91 144 51 231 177 252 232 210 156 130 70 14 30 129 255 82 247 162 116 213 100 248 100 190 125 48 3 168 85 249 192 75 26 221 95 113 27 1 123 130 248 176 164 140 61 141 190 157 241 193 100 2 180 163 73 141 252 213 35 213 158 95 46 85 0 94 159 101 16 31 97 109 63 64 35 238 255 208 175 121 180 84 162 66 210 119 10 131 119 187 27 116 152 2 41 62 175 176 244 123 70 42 51 244 113 238 102 113 195 54 242 80 148 90 145 226 10 180 122 94 143 119 125 187 118 7 28 184 214 205 205 97 18 71 235 186 245 199 246 57 3 208 121 40 73 6 28 64 217 154 216 108 59 46 158 80 133 8 196 11 223 201 199 234 77 99 219 238 244 6 254 96 55 5 88 109 181 57 85 82 64 67 46 13 114 56 74 117 215 61 161 26 37 221 210 18 229 131 11 232 38 101 190 54 241 253 217 100 80 205 45 113 51 237 105 252 159 11 126 74 152 22 138 45 30 188 157 151 101 139 134 16 221 153 56 216 167 210 214 79 150 96 170 83 161 118 219 162 45 113 179 106 87 147 99 222 42 122 194 24 249 53 210 222 206 2 74 232 110 135 6 12 110 53 2 15 144 180 185 58 249 41 54 36 128 61 116 221 158 154 95 142 32 213 89 48 209 47 155 239 2 142 171 218 207 130 140] MAC is [18 125 86 224 20 5 4 83 108 163 82 243 62 254 77 103 87 90 32 112 50 169 54 139 200 219 92 84 191 177 139 94] MAC is 32 bytes, see field 15 in 3.1 on page 140 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf -----BEGIN HSM ENCRYPTED PRIVATE KEY----- AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADsIIxQY2Y9lWElrfi1CQo AAAAAAAAASYAAAAAAAAAARI06plg8upcgRqXiEj4F0LENASqTm98WZepFugMmkH2 R+7lZWKH5jIYQoJSvkEwl4oItyvlOF/rWqNEUQlNOBxowJZpH8GFGOB9aFalaKJX 99FCragt6ATlhtOFGOXECiBagZKKcyejzmaNMY6PN3Kg0jiE7YmdiMsAFNmQ6YzG GrM82l/JHdZkkDfiwxdTaTKvrtbYggJHEb/FGrRZk6g97DHmQL7Zxw30rbb/W5Az 57H86NKcgkYOHoH/UveidNVk+GS+fTADqFX5wEsa3V9xGwF7gviwpIw9jb6d8cFk ArSjSY381SPVnl8uVQBen2UQH2FtP0Aj7v/Qr3m0VKJC0ncKg3e7G3SYAik+r7D0 e0YqM/Rx7mZxwzbyUJRakeIKtHpej3d9u3YHHLjWzc1hEkfruvXH9jkD0HkoSQYc QNma2Gw7Lp5QhQjEC9/Jx+pNY9vu9Ab+YDcFWG21OVVSQEMuDXI4SnXXPaEaJd3S EuWDC+gmZb428f3ZZFDNLXEz7Wn8nwt+SpgWii0evJ2XZYuGEN2ZONin0tZPlmCq U6F226ItcbNqV5Nj3ip6whj5NdLezgJK6G6HBgxuNQIPkLS5OvkpNiSAPXTdnppf jiDVWTDRL5vvAo6r2s+CjBJ9VuAUBQRTbKNS8z7+TWdXWiBwMqk2i8jbXFS/sYte -----END HSM ENCRYPTED PRIVATE KEY----- -----BEGIN PUBLIC KEY----- MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEbmpq3bBLd7Was3NswJR/UMsUmqXC FCh1XnXffXaF4uYSgBQu7z3xiCkJTsp8vMBdteX10k67nJjAhP+iETO7dQQQA7CC MUGNmPZVhJa34tQkKAQgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE CMvLh3NCfueWBAgAAAAAAAAAAQQUEAEAAAABgIAAAYCAgAEACgAAAAEEIHVqtCuD l0fM3tMmINaK0GLrB6xX7M0zejZBQDpGWX/a -----END PUBLIC KEY----- Data signed Signature verified Finally, try the fourth suupported curve, P384: ./lab --ex3 --curve P384 Example output selected curve P384 with ObjectID of 1.3.132.0.34 Curve ObjectID in ASN.1 BER encoding is [6 5 43 129 4 0 34] Generated ECDSA PKCS key pair with mechanism CKM_EC_KEY_PAIR_GEN key pair public key blob length is 248 bytes key pair public key blob is [48 118 48 16 6 7 42 134 72 206 61 2 1 6 5 43 129 4 0 34 3 98 0 4 20 236 106 175 76 209 142 54 136 119 12 96 68 207 237 15 207 93 133 101 224 190 191 207 252 8 13 111 41 146 195 110 245 102 246 21 126 198 152 204 142 142 123 85 205 73 71 95 199 156 111 125 60 137 24 103 37 211 215 222 89 119 181 242 0 63 164 49 14 7 40 199 86 111 168 136 8 249 164 117 253 72 33 144 66 15 126 131 230 42 32 37 210 78 27 99 4 16 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 4 32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4 8 31 146 195 59 47 0 221 196 4 8 0 0 0 0 0 0 0 1 4 20 16 1 0 0 0 1 128 128 0 1 128 128 128 1 0 10 0 0 0 1 4 32 166 134 66 17 102 8 140 118 31 64 4 242 234 134 34 72 132 116 245 10 224 174 74 101 243 172 223 184 156 51 28 103] key pair private key blob length is 720 bytes key pair private key blob is [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 1 38 0 0 0 0 0 0 0 1 18 52 153 221 86 12 9 88 111 233 79 50 0 98 38 116 119 42 179 162 115 61 69 173 2 50 40 5 241 34 125 95 215 44 94 60 200 193 50 47 70 234 63 92 12 149 107 163 199 247 244 21 145 94 176 100 72 240 241 146 134 62 70 238 188 1 31 91 136 108 73 110 218 192 207 194 239 183 109 245 140 135 33 148 169 75 112 120 9 173 218 117 181 74 141 98 52 108 110 115 135 113 187 153 210 17 27 101 149 108 233 171 190 217 178 69 154 188 13 79 167 107 197 222 34 246 90 23 80 87 71 32 39 100 100 38 41 239 210 168 65 58 118 220 16 7 32 148 54 163 80 1 199 139 165 132 161 234 172 7 87 11 31 106 203 50 250 123 9 145 5 40 155 103 123 16 113 60 61 210 215 238 164 150 191 97 200 231 170 17 180 184 90 104 114 10 114 61 129 222 6 139 56 248 177 110 10 53 234 143 90 10 149 134 174 170 32 237 224 29 124 102 218 206 171 105 10 18 16 233 191 119 26 12 167 215 135 23 95 83 89 171 154 14 249 247 35 202 88 83 220 5 191 52 71 15 64 20 21 62 55 241 158 98 38 95 137 193 201 253 122 71 25 10 128 22 53 60 199 175 192 194 104 68 187 83 136 228 246 102 194 153 119 139 178 33 170 80 237 242 75 179 107 184 194 221 45 216 161 217 150 100 224 22 7 94 142 242 114 3 52 237 105 123 39 61 185 226 37 38 159 64 208 219 25 170 246 223 126 122 120 135 86 193 101 6 105 148 156 12 77 162 221 200 34 202 29 228 198 5 193 112 96 95 16 225 1 6 41 252 234 218 227 64 95 16 221 124 2 4 42 209 138 212 11 35 149 12 240 152 187 36 87 60 156 4 138 76 214 193 233 17 174 49 119 133 96 215 49 137 139 45 36 162 230 79 83 100 87 83 13 159 146 143 170 144 34 248 76 97 244 226 63 124 122 121 35 177 81 219 119 21 42 42 40 92 37 220 93 118 245 215 76 129 128 251 187 202 225 112 82 171 55 8 158 70 93 209 70 31 31 251 22 170 11 215 35 190 122 0 48 146 182 84 180 106 192 119 0 227 114 134 98 247 100 13 30 56 20 232 87 56 120 132 197 194 244 138 6 31 224 220 50 114 202 129 226 170 8 168 37 184 206 16 11 55 229 59 26 38 6 74 4 191 232 77 70 242 232 80 3 144 192 248 102 68 155 22 34 97 12 221 63 106 55 248 185 169 207 239 178 95 71 220 127 87 74 14 241 233 45 248 208 51 92 103 59 39 218 52 53 177 164 7 135 195 99 49 135 89 18 132 8 185 51 41 0 0 210 46 166 22 59 21 223 44 65 60 83 41 211 102 10 123 89 57 98 87 183 212 197 96 149 236 104 175 109 207 180 77 52 123 170 159 77 29 255 146 246 94 95 71 63 156 183 227 45 82 160 148 152 87 53 42 161 58] Some of the fields in the private key blob follow: WK ID is [3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40] See 6.7.1 of page 182 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Blob version is [18 52] See 3.1.1 on page 141 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf IV is [153 221 86 12 9 88 111 233 79 50 0 98 38 116] Encrypted part is [119 42 179 162 115 61 69 173 2 50 40 5 241 34 125 95 215 44 94 60 200 193 50 47 70 234 63 92 12 149 107 163 199 247 244 21 145 94 176 100 72 240 241 146 134 62 70 238 188 1 31 91 136 108 73 110 218 192 207 194 239 183 109 245 140 135 33 148 169 75 112 120 9 173 218 117 181 74 141 98 52 108 110 115 135 113 187 153 210 17 27 101 149 108 233 171 190 217 178 69 154 188 13 79 167 107 197 222 34 246 90 23 80 87 71 32 39 100 100 38 41 239 210 168 65 58 118 220 16 7 32 148 54 163 80 1 199 139 165 132 161 234 172 7 87 11 31 106 203 50 250 123 9 145 5 40 155 103 123 16 113 60 61 210 215 238 164 150 191 97 200 231 170 17 180 184 90 104 114 10 114 61 129 222 6 139 56 248 177 110 10 53 234 143 90 10 149 134 174 170 32 237 224 29 124 102 218 206 171 105 10 18 16 233 191 119 26 12 167 215 135 23 95 83 89 171 154 14 249 247 35 202 88 83 220 5 191 52 71 15 64 20 21 62 55 241 158 98 38 95 137 193 201 253 122 71 25 10 128 22 53 60 199 175 192 194 104 68 187 83 136 228 246 102 194 153 119 139 178 33 170 80 237 242 75 179 107 184 194 221 45 216 161 217 150 100 224 22 7 94 142 242 114 3 52 237 105 123 39 61 185 226 37 38 159 64 208 219 25 170 246 223 126 122 120 135 86 193 101 6 105 148 156 12 77 162 221 200 34 202 29 228 198 5 193 112 96 95 16 225 1 6 41 252 234 218 227 64 95 16 221 124 2 4 42 209 138 212 11 35 149 12 240 152 187 36 87 60 156 4 138 76 214 193 233 17 174 49 119 133 96 215 49 137 139 45 36 162 230 79 83 100 87 83 13 159 146 143 170 144 34 248 76 97 244 226 63 124 122 121 35 177 81 219 119 21 42 42 40 92 37 220 93 118 245 215 76 129 128 251 187 202 225 112 82 171 55 8 158 70 93 209 70 31 31 251 22 170 11 215 35 190 122 0 48 146 182 84 180 106 192 119 0 227 114 134 98 247 100 13 30 56 20 232 87 56 120 132 197 194 244 138 6 31 224 220 50 114 202 129 226 170 8 168 37 184 206 16 11 55 229 59 26 38 6 74 4 191 232 77 70 242 232 80 3 144 192 248 102 68 155 22 34 97 12 221 63 106 55 248 185 169 207 239 178 95 71 220 127 87 74 14 241 233 45 248 208 51 92 103 59 39 218 52 53 177 164 7 135 195 99 49 135 89 18 132 8 185 51 41 0 0 210 46 166 22 59 21 223 44 65 60 83 41 211 102 10 123 89 57 98 87 183 212 197 96 149 236] MAC is [104 175 109 207 180 77 52 123 170 159 77 29 255 146 246 94 95 71 63 156 183 227 45 82 160 148 152 87 53 42 161 58] MAC is 32 bytes, see field 15 in 3.1 on page 140 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf -----BEGIN HSM ENCRYPTED PRIVATE KEY----- AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADsIIxQY2Y9lWElrfi1CQo AAAAAAAAASYAAAAAAAAAARI0md1WDAlYb+lPMgBiJnR3KrOicz1FrQIyKAXxIn1f 1yxePMjBMi9G6j9cDJVro8f39BWRXrBkSPDxkoY+Ru68AR9biGxJbtrAz8Lvt231 jIchlKlLcHgJrdp1tUqNYjRsbnOHcbuZ0hEbZZVs6au+2bJFmrwNT6drxd4i9loX UFdHICdkZCYp79KoQTp23BAHIJQ2o1ABx4ulhKHqrAdXCx9qyzL6ewmRBSibZ3sQ cTw90tfupJa/YcjnqhG0uFpocgpyPYHeBos4+LFuCjXqj1oKlYauqiDt4B18ZtrO q2kKEhDpv3caDKfXhxdfU1mrmg759yPKWFPcBb80Rw9AFBU+N/GeYiZficHJ/XpH GQqAFjU8x6/AwmhEu1OI5PZmwpl3i7IhqlDt8kuza7jC3S3YodmWZOAWB16O8nID NO1peyc9ueIlJp9A0NsZqvbffnp4h1bBZQZplJwMTaLdyCLKHeTGBcFwYF8Q4QEG Kfzq2uNAXxDdfAIEKtGK1AsjlQzwmLskVzycBIpM1sHpEa4xd4Vg1zGJiy0kouZP U2RXUw2fko+qkCL4TGH04j98enkjsVHbdxUqKihcJdxddvXXTIGA+7vK4XBSqzcI nkZd0UYfH/sWqgvXI756ADCStlS0asB3AONyhmL3ZA0eOBToVzh4hMXC9IoGH+Dc MnLKgeKqCKgluM4QCzflOxomBkoEv+hNRvLoUAOQwPhmRJsWImEM3T9qN/i5qc/v sl9H3H9XSg7x6S340DNcZzsn2jQ1saQHh8NjMYdZEoQIuTMpAADSLqYWOxXfLEE8 UynTZgp7WTliV7fUxWCV7Givbc+0TTR7qp9NHf+S9l5fRz+ct+MtUqCUmFc1KqE6 -----END HSM ENCRYPTED PRIVATE KEY----- -----BEGIN PUBLIC KEY----- MHYwEAYHKoZIzj0CAQYFK4EEACIDYgAEFOxqr0zRjjaIdwxgRM/tD89dhWXgvr/P /AgNbymSw271ZvYVfsaYzI6Oe1XNSUdfx5xvfTyJGGcl09feWXe18gA/pDEOByjH Vm+oiAj5pHX9SCGQQg9+g+YqICXSThtjBBADsIIxQY2Y9lWElrfi1CQoBCAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQIH5LDOy8A3cQECAAAAAAAAAAB BBQQAQAAAAGAgAABgICAAQAKAAAAAQQgpoZCEWYIjHYfQATy6oYiSIR09Qrgrkpl 86zfuJwzHGc= -----END PUBLIC KEY----- Data signed Signature verified Each of the curves had a number in its name that indicates how large the key is, in bits. We worked with 224-, 256-, 384-, and 521-bit keys (yes that is 521 bits and not 512 bits but don't ask me why- I first have to get smart enough to understand it myself before I get smart enough to explain it to you coherently- besides, I'm sure Google has the answer). I am smart enough to know that there are 8 bits in a byte and while the key lengths in cryptographic algorithms are usually expressed in bits, the lengths in our exercise output for the various blobs are expressed in bytes. And there's nothing wrong with that, because our key blobs have lots of other metadata and attributes and fields besides just the key itself. That's why I purposely referred to them as key blobs and not keys. Try this handy \"one-line script\" that runs this exercise four times, once for each curve, and then pipes the output to egrep so that we can pick out some lines of interest. You can see how the curve strength impacts the size of the public and private key blobs: for curve in P224 P256 P384 P521 ; do ./lab --ex3 --curve ${ curve } ; done | egrep -ie 'curve|key blob length' Expected Output selected curve P224 with ObjectID of 1.3.132.0.33 Curve ObjectID in ASN.1 BER encoding is [6 5 43 129 4 0 33] key pair public key blob length is 208 bytes key pair private key blob length is 544 bytes selected curve P256 with ObjectID of 1.2.840.10045.3.1.7 Curve ObjectID in ASN.1 BER encoding is [6 8 42 134 72 206 61 3 1 7] key pair public key blob length is 219 bytes key pair private key blob length is 576 bytes selected curve P384 with ObjectID of 1.3.132.0.34 Curve ObjectID in ASN.1 BER encoding is [6 5 43 129 4 0 34] key pair public key blob length is 248 bytes key pair private key blob length is 720 bytes selected curve P521 with ObjectID of 1.3.132.0.35 Curve ObjectID in ASN.1 BER encoding is [6 5 43 129 4 0 35] key pair public key blob length is 286 bytes key pair private key blob length is 896 bytes It makes sense that the larger key sizes produce bigger key blobs. If I ever figure out enough to give a full accounting of the difference in blob sizes, I'll update the lab. If you ever figure it out, please create a GitHub pull request with the answer. Let's move on to our fourth and final exercise.","title":"Exercise 3 (Sign and Verify)"},{"location":"grep11-lab/lab-exercise3/#exercise-3-sign-and-verify-data","text":"","title":"Exercise 3 - Sign and Verify Data"},{"location":"grep11-lab/lab-exercise3/#overview-of-exercise-3","text":"Exercise three uses public key cryptography to demonstrate signing of data and then verifying the signature. Other terms often used that are associated with public key cryptography are asymmetric keys or public and private key pairs . The major characteristic is that an asymmetric key is actually a pair of keys that are related. One key is called the public key and can be shared with anyone. The other key is called the private key and is kept secret. These key pairs can be used for encryption and decryption, as well as for creating and verifying digital signatures.","title":"Overview of Exercise 3"},{"location":"grep11-lab/lab-exercise3/#public-key-cryptography-in-simple-terms","text":"Public key cryptography and encryption When using public key cryptography, the assumption is that anybody in the world could have your public key, but you have kept your private key to yourself. For encryption, anybody who has your public key could encrypt data with it and send you that encrypted data, or ciphertext. If an adversary possessed the ciphertext, they could not decrypt it. Only you, with your private key, can decrypt it. Technically, you could encrypt data with your private key that holders of your public key could decrypt, but this use case doesn't make sense- since anybody could have your public key, you have not managed to achieve privacy with your encryption. Public key cryptography and digital signatures Your private key can be used to allow you to digitally \"sign\" data, which is an attestation that you have seen the data that you have signed, analagous to your signing by pen a letter or contract on a piece of paper. There are different digital signature algorithms, but in general, they follow the following pattern. Assume you want to digitally sign some data you send to somebody: You create a digest, or hash, over some data, using some algorithm. This hash uniquely identifies the data. You encrypt this hash with your private key. This is your digital signature. You send the data, and your digital signature, to the intended recipient. The recipient calculates the digest, or hash, of the data, using the same algorithm that you used in step 1. If the data has remained intact in transit, they will calculate the same hash that you did in step 1. They then decrypt your signature (from step 2) with your public key. This retrieves in plaintext the hash you signed in step 1. If the hash they calculated in step 4 matches the hash that you encrypted with your private key in step 2 (and retrieved by them in step 5), then it is proof that you have seen the data they have received. The fundamental assumption is that you have kept your private key in your sole possession. If an adversary stole your private key they could impersonate you. Also, observe that the validity of this digital signature is independent of whether or not the data that you send is plaintext or ciphertext. The two most commonly used forms of public key cryptography are RSA cryptography and elliptic curve cryptography. RSA cryptography was developed first and is built upon the difficulty of factoring the product of two very large prime numbers. It is easy for a computer to find two very large prime numbers and multiply them together to obtain a product. On the other hand, given this product, it is extremely difficult, if not impossible, for even today's powerful computers to figure out what two prime numbers were used to produce that product! It seems like a preposterous statement, but it's true! Elliptic curve cryptography is based on algebraic equations called elliptic curves. The idea is that a mathematical addition function can be defined on this curve, such that it is very easy for a computer to do a large number of additions on the curve which results in a point on the curve. But if you give someone the equation for the curve, and the point on the curve that you have calculated, but you don't tell them how many additions you did to calculate this point, even today's powerful computers cannot figure out how many additions were performed! It seems like a preposterous statement, but it's true! In simple terms, an RSA public key contains the product of the two primes, and the RSA private key contains the hidden information- the two primes. An elliptic curve public key contains all of the information about the curve, including the point that was calculated, except for the number of additions used to calculate the point, while the elliptic curve private key includes the hidden information- the number of additions that were used to create the point. If I multiplied two small prime numbers like 7 x 13 and gave you the product 91, it probably wouldn't take you too long to factor it back to 7 and 13. Computers need to use incredibliy large prime numbers in order to calculate a product that another computer can't quickly factor. That is why RSA keys are usually 2048 or 4096 bits in length. You can create smaller RSA keys but today's computers can factor the product contained in the public key quicker, the smaller the key. On the other hand, the size of elliptic curve public keys can be much smaller than RSA public keys, and provide the equivalent strength. That is, a relatively small-sized ellipctic curve key is just as difficult for a computer to crack by brute force than it is for a much larger-sized RSA key. For this reason, elliptic curve cryptography is becoming increasingly popular- the smaller key size means less computational power is needed to work with these keys, so they are more efficient and use less power, which is more appealing for devices that are typically drawing on battery power, like smartphones and tablets. EP11 supports both RSA and elliptic curve cryptography, as you saw in the GREP11 sample. This exercise will dig a little deeper into elliptic curves.","title":"Public key cryptography in simple terms"},{"location":"grep11-lab/lab-exercise3/#run-exercise-3","text":"Run the third exercise: ./lab --ex3 Example Output selected curve P521 with ObjectID of 1.3.132.0.35 Curve ObjectID in ASN.1 BER encoding is [6 5 43 129 4 0 35] Generated ECDSA PKCS key pair with mechanism CKM_EC_KEY_PAIR_GEN key pair public key blob length is 286 bytes key pair public key blob is [48 129 155 48 16 6 7 42 134 72 206 61 2 1 6 5 43 129 4 0 35 3 129 134 0 4 1 251 93 197 238 11 2 165 14 39 212 27 175 77 65 78 70 252 221 242 195 236 163 3 63 184 70 158 146 51 22 230 181 30 78 101 47 150 133 100 197 101 31 144 59 192 199 237 14 94 86 237 73 52 79 1 45 220 65 57 113 117 113 173 220 70 0 48 137 50 146 141 22 219 122 151 69 232 10 132 29 121 198 108 226 233 9 117 185 16 125 236 113 235 136 54 127 109 229 150 26 117 63 231 242 158 101 248 86 80 17 69 31 217 156 122 140 30 75 132 155 187 35 148 239 49 81 172 10 210 181 169 4 16 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 4 32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4 8 255 72 74 131 146 172 234 187 4 8 0 0 0 0 0 0 0 1 4 20 16 1 0 0 0 1 128 128 0 1 128 128 128 1 0 10 0 0 0 1 4 32 217 93 11 148 136 24 62 138 168 213 244 131 187 81 107 102 114 120 167 70 193 179 233 4 32 228 144 160 232 167 125 167] key pair private key blob length is 896 bytes key pair private key blob is [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 1 38 0 0 0 0 0 0 0 1 18 52 145 242 100 209 252 135 97 118 108 26 68 196 204 214 35 186 208 121 174 78 194 146 179 179 92 26 100 178 30 39 144 58 232 153 47 120 177 131 143 109 255 143 188 55 83 243 168 100 93 113 176 50 33 176 209 178 137 124 13 64 217 65 230 242 127 41 206 53 149 52 238 111 241 174 206 137 141 251 17 145 233 76 219 82 103 108 35 168 57 114 44 179 164 157 12 81 167 193 171 27 42 69 50 108 161 45 227 151 199 15 59 120 177 122 62 66 95 9 115 57 85 29 132 224 146 162 177 224 143 36 125 126 210 113 18 73 145 60 48 109 176 162 41 145 33 242 93 154 122 118 216 252 111 7 253 207 195 227 151 15 112 99 44 177 14 14 193 35 199 207 79 29 219 88 146 132 3 80 128 196 150 37 18 7 192 185 68 38 158 232 84 145 198 24 210 154 34 157 76 53 244 18 31 194 99 80 36 31 225 41 141 69 135 116 43 239 186 193 84 112 103 110 56 148 66 115 76 202 125 45 15 86 124 24 19 247 208 131 51 37 186 172 94 58 155 214 238 131 253 48 86 125 62 240 123 236 237 88 76 218 21 215 202 210 90 29 119 239 2 237 11 242 202 214 116 98 88 90 15 0 12 170 20 96 132 49 224 57 22 113 123 27 19 173 121 50 99 116 175 20 153 192 223 84 121 17 154 88 74 118 245 131 21 179 162 154 44 182 15 66 240 9 154 118 1 122 101 101 103 14 207 47 167 133 152 187 147 221 241 84 223 72 136 243 239 77 65 121 219 208 223 95 175 139 39 100 52 227 185 126 22 143 41 183 28 57 63 238 117 196 172 63 131 116 248 74 165 132 160 77 148 174 44 102 91 29 49 74 230 85 215 83 154 130 46 164 163 212 85 82 103 5 205 233 181 126 160 118 154 65 120 155 89 224 218 132 99 158 134 210 225 219 252 254 167 208 170 164 148 97 226 25 236 152 47 113 74 5 73 177 157 60 120 4 62 87 17 116 190 73 132 124 17 61 46 63 12 184 8 74 177 100 119 151 58 163 126 181 199 95 202 99 112 64 55 97 66 138 83 168 62 160 62 8 160 148 126 215 124 65 228 200 122 192 129 121 18 135 244 95 4 94 0 231 246 49 195 181 35 72 161 110 97 180 135 111 33 28 173 49 235 8 58 56 217 31 159 195 61 195 34 10 160 111 224 53 22 175 9 79 39 142 46 43 91 210 69 183 229 68 114 86 142 221 196 206 234 143 244 49 236 231 253 226 95 36 14 131 74 48 31 144 4 254 235 158 189 98 28 1 100 181 19 139 69 29 166 136 227 85 21 131 130 138 197 249 29 222 65 128 252 16 217 121 157 232 150 126 54 245 116 145 127 175 167 125 46 94 214 38 224 85 172 87 97 163 231 181 218 248 103 211 224 79 122 157 160 76 54 242 13 46 182 10 105 119 6 51 91 11 116 120 2 188 148 108 191 158 100 28 40 158 212 35 94 53 6 59 84 216 207 101 112 40 178 164 252 110 116 39 59 78 78 7 204 241 147 2 234 244 153 214 32 151 187 250 112 162 173 136 214 67 114 195 102 170 240 228 160 123 41 178 7 2 147 66 5 236 100 170 198 233 8 218 163 244 224 211 8 127 36 60 220 185 158 17 171 78 156 168 141 73 86 146 47 252 55 247 12 105 21 170 199 27 69 149 217 78 89 37 125 246 220 29 177 15 18 78 153 170 123 109 248 47 4 130 121 174 88 44 96 61 71 208 112 34 236 111 189 240 195 15 45 176 84 140 35 171 110 124 164 98 0 122 173 69 82 27 118 51 226 30 193 106 51 21 83 194 189 110 18 92 156 198 221 189 211 84 220 207] Some of the fields in the private key blob follow: WK ID is [3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40] See 6.7.1 of page 182 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Blob version is [18 52] See 3.1.1 on page 141 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf IV is [145 242 100 209 252 135 97 118 108 26 68 196 204 214] Encrypted part is [35 186 208 121 174 78 194 146 179 179 92 26 100 178 30 39 144 58 232 153 47 120 177 131 143 109 255 143 188 55 83 243 168 100 93 113 176 50 33 176 209 178 137 124 13 64 217 65 230 242 127 41 206 53 149 52 238 111 241 174 206 137 141 251 17 145 233 76 219 82 103 108 35 168 57 114 44 179 164 157 12 81 167 193 171 27 42 69 50 108 161 45 227 151 199 15 59 120 177 122 62 66 95 9 115 57 85 29 132 224 146 162 177 224 143 36 125 126 210 113 18 73 145 60 48 109 176 162 41 145 33 242 93 154 122 118 216 252 111 7 253 207 195 227 151 15 112 99 44 177 14 14 193 35 199 207 79 29 219 88 146 132 3 80 128 196 150 37 18 7 192 185 68 38 158 232 84 145 198 24 210 154 34 157 76 53 244 18 31 194 99 80 36 31 225 41 141 69 135 116 43 239 186 193 84 112 103 110 56 148 66 115 76 202 125 45 15 86 124 24 19 247 208 131 51 37 186 172 94 58 155 214 238 131 253 48 86 125 62 240 123 236 237 88 76 218 21 215 202 210 90 29 119 239 2 237 11 242 202 214 116 98 88 90 15 0 12 170 20 96 132 49 224 57 22 113 123 27 19 173 121 50 99 116 175 20 153 192 223 84 121 17 154 88 74 118 245 131 21 179 162 154 44 182 15 66 240 9 154 118 1 122 101 101 103 14 207 47 167 133 152 187 147 221 241 84 223 72 136 243 239 77 65 121 219 208 223 95 175 139 39 100 52 227 185 126 22 143 41 183 28 57 63 238 117 196 172 63 131 116 248 74 165 132 160 77 148 174 44 102 91 29 49 74 230 85 215 83 154 130 46 164 163 212 85 82 103 5 205 233 181 126 160 118 154 65 120 155 89 224 218 132 99 158 134 210 225 219 252 254 167 208 170 164 148 97 226 25 236 152 47 113 74 5 73 177 157 60 120 4 62 87 17 116 190 73 132 124 17 61 46 63 12 184 8 74 177 100 119 151 58 163 126 181 199 95 202 99 112 64 55 97 66 138 83 168 62 160 62 8 160 148 126 215 124 65 228 200 122 192 129 121 18 135 244 95 4 94 0 231 246 49 195 181 35 72 161 110 97 180 135 111 33 28 173 49 235 8 58 56 217 31 159 195 61 195 34 10 160 111 224 53 22 175 9 79 39 142 46 43 91 210 69 183 229 68 114 86 142 221 196 206 234 143 244 49 236 231 253 226 95 36 14 131 74 48 31 144 4 254 235 158 189 98 28 1 100 181 19 139 69 29 166 136 227 85 21 131 130 138 197 249 29 222 65 128 252 16 217 121 157 232 150 126 54 245 116 145 127 175 167 125 46 94 214 38 224 85 172 87 97 163 231 181 218 248 103 211 224 79 122 157 160 76 54 242 13 46 182 10 105 119 6 51 91 11 116 120 2 188 148 108 191 158 100 28 40 158 212 35 94 53 6 59 84 216 207 101 112 40 178 164 252 110 116 39 59 78 78 7 204 241 147 2 234 244 153 214 32 151 187 250 112 162 173 136 214 67 114 195 102 170 240 228 160 123 41 178 7 2 147 66 5 236 100 170 198 233 8 218 163 244 224 211 8 127 36 60 220 185 158 17 171 78 156 168 141 73 86 146 47 252 55 247 12 105 21 170 199 27 69 149 217 78 89 37 125 246 220 29 177 15 18 78 153 170 123 109 248 47 4 130 121 174 88 44 96 61 71 208 112 34 236 111 189 240 195 15 45 176 84 140 35 171] MAC is [110 124 164 98 0 122 173 69 82 27 118 51 226 30 193 106 51 21 83 194 189 110 18 92 156 198 221 189 211 84 220 207] MAC is 32 bytes, see field 15 in 3.1 on page 140 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf -----BEGIN HSM ENCRYPTED PRIVATE KEY----- AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADsIIxQY2Y9lWElrfi1CQo AAAAAAAAASYAAAAAAAAAARI0kfJk0fyHYXZsGkTEzNYjutB5rk7CkrOzXBpksh4n kDromS94sYOPbf+PvDdT86hkXXGwMiGw0bKJfA1A2UHm8n8pzjWVNO5v8a7OiY37 EZHpTNtSZ2wjqDlyLLOknQxRp8GrGypFMmyhLeOXxw87eLF6PkJfCXM5VR2E4JKi seCPJH1+0nESSZE8MG2woimRIfJdmnp22PxvB/3Pw+OXD3BjLLEODsEjx89PHdtY koQDUIDEliUSB8C5RCae6FSRxhjSmiKdTDX0Eh/CY1AkH+EpjUWHdCvvusFUcGdu OJRCc0zKfS0PVnwYE/fQgzMluqxeOpvW7oP9MFZ9PvB77O1YTNoV18rSWh137wLt C/LK1nRiWFoPAAyqFGCEMeA5FnF7GxOteTJjdK8UmcDfVHkRmlhKdvWDFbOimiy2 D0LwCZp2AXplZWcOzy+nhZi7k93xVN9IiPPvTUF529DfX6+LJ2Q047l+Fo8ptxw5 P+51xKw/g3T4SqWEoE2UrixmWx0xSuZV11Oagi6ko9RVUmcFzem1fqB2mkF4m1ng 2oRjnobS4dv8/qfQqqSUYeIZ7JgvcUoFSbGdPHgEPlcRdL5JhHwRPS4/DLgISrFk d5c6o361x1/KY3BAN2FCilOoPqA+CKCUftd8QeTIesCBeRKH9F8EXgDn9jHDtSNI oW5htIdvIRytMesIOjjZH5/DPcMiCqBv4DUWrwlPJ44uK1vSRbflRHJWjt3EzuqP 9DHs5/3iXyQOg0owH5AE/uuevWIcAWS1E4tFHaaI41UVg4KKxfkd3kGA/BDZeZ3o ln429XSRf6+nfS5e1ibgVaxXYaPntdr4Z9PgT3qdoEw28g0utgppdwYzWwt0eAK8 lGy/nmQcKJ7UI141BjtU2M9lcCiypPxudCc7Tk4HzPGTAur0mdYgl7v6cKKtiNZD csNmqvDkoHspsgcCk0IF7GSqxukI2qP04NMIfyQ83LmeEatOnKiNSVaSL/w39wxp FarHG0WV2U5ZJX323B2xDxJOmap7bfgvBIJ5rlgsYD1H0HAi7G+98MMPLbBUjCOr bnykYgB6rUVSG3Yz4h7BajMVU8K9bhJcnMbdvdNU3M8= -----END HSM ENCRYPTED PRIVATE KEY----- -----BEGIN PUBLIC KEY----- MIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQB+13F7gsCpQ4n1BuvTUFORvzd8sPs owM/uEaekjMW5rUeTmUvloVkxWUfkDvAx+0OXlbtSTRPAS3cQTlxdXGt3EYAMIky ko0W23qXRegKhB15xmzi6Ql1uRB97HHriDZ/beWWGnU/5/KeZfhWUBFFH9mceowe S4SbuyOU7zFRrArStakEEAOwgjFBjZj2VYSWt+LUJCgEIAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAABAj/SEqDkqzquwQIAAAAAAAAAAEEFBABAAAAAYCA AAGAgIABAAoAAAABBCDZXQuUiBg+iqjV9IO7UWtmcninRsGz6QQg5JCg6Kd9pw== -----END PUBLIC KEY----- Data signed Signature verified The first line of the output shows the Object ID of the curve that was used. These Object IDs are assigned by standards bodies. The Object ID used here is 1.3.132.0.35 . Stick 1.3.132.0.35 in your favorite Google machine and see what you find. Or take my word for it that this identifies the secp521r1 curve. The second line of the output shows ASN.1 BER encoding of 1.3.132.0.35, which is 6 5 43 129 4 0 35 . If you were to look up how ASN.1 BER encoding works, your first question would be, \"Why?\". Don't go there now. But I bring it up because you will notice that a few lines down in the output, in the key pair public key blob section, you'll see that encoded string, 6 5 43 129 4 0 35 , about 14 bytes from the beginning. In fact, while the whole point of using the GREP11 server and the Crypto Express 7S cards is to keep secrets from an adversary, the information shown in the key pair public key blob section is \"in the clear\"- you could give this to your adversary without fear of having your secrets compromised. The list of decimal bytes of these keys is mostly gibberish to us humans, I'm not sure why I even bothered to print them out, but take a look at the output at the end, where there are several lines between a header and footer for HSM ENCRYPTED PRIVATE KEY (BEGIN and END), and several lines between a header and footer for a PUBLIC KEY. To use these keys in the future, you would need to persist both of these to separate files. You wouldn't have a reason to give your adversary the HSM ENCRYPTED PRIVATE KEY, but, if he did obtain it, it would be of no value to him unless he was able to access your Crypto Express 7S card that had the same root wrapping key. The contents of this file are encrypted and are usuable only within the Crypto Express card that created it, or in another Crypto Express card that had the same root wrapping key. Since the PUBLIC KEY is, by definition, shareable with the world, we can use the common openssl utility to look at it. Try it like this: Copy the lines from near the bottom of your output that have your public key , including the BEGIN PUBLIC KEY and END PUBLIC KEY header and footer lines, and the dashes, into your clipboard In a terminal window, type echo \" (that is a single pair of double-quotes) and then paste your clipboard contents onto the command line Type \" | openssl ec -in - -pubin -noout -text and then press Enter You should see output similar to this: read EC key Public-Key: (521 bit) pub: 04:00:59:fe:0c:b3:d0:6e:b2:d7:b0:c0:05:86:66: dd:62:bc:fe:96:5c:fa:08:6d:f3:be:5f:6d:a1:3d: 8f:40:13:83:23:ec:34:e4:e5:20:6c:f9:75:34:bd: 30:cd:be:1f:5b:aa:ee:44:99:d9:ae:69:50:24:c7: 82:7c:f4:f2:18:d1:b0:00:be:5c:64:f5:dd:16:79: eb:d4:9c:28:ae:43:9b:f4:13:a4:f3:db:3c:a2:e5: 52:bb:0f:9f:e1:c4:a4:c1:29:63:4e:bc:2f:73:4c: da:fd:4f:42:63:0d:3d:9d:bb:29:76:57:85:13:57: 3a:ae:8f:20:64:0a:cf:c2:f1:41:d3:fc:8a ASN1 OID: secp521r1 NIST CURVE: P-521 Tip If you are a Linux guru you could create a file with vi and copy the key into the file, and then provide that as input to the openssl command, e.g., openssl ec -in baz -pubin -noout -text if baz was the file you created. In the exercise output I first printed the public key as an array of decimal numbers (worthless!), then I printed it in PEM-encoded format (boring!) but now you see the key in hexadecimal format (that's incredible!!). You also get the added bonus of knowing it's a legit public key since the openssl utility made sense of it. Try using a different curve: ./lab --ex3 --curve P224 Example Output selected curve P224 with ObjectID of 1.3.132.0.33 Curve ObjectID in ASN.1 BER encoding is [6 5 43 129 4 0 33] Generated ECDSA PKCS key pair with mechanism CKM_EC_KEY_PAIR_GEN key pair public key blob length is 208 bytes key pair public key blob is [48 78 48 16 6 7 42 134 72 206 61 2 1 6 5 43 129 4 0 33 3 58 0 4 177 164 170 83 241 4 140 49 236 115 12 22 130 206 48 90 174 181 135 16 59 31 11 122 14 254 13 172 129 64 249 1 40 44 231 155 52 110 38 67 175 244 45 81 157 5 213 125 224 199 126 65 251 200 159 53 4 16 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 4 32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4 8 6 63 231 63 240 230 179 88 4 8 0 0 0 0 0 0 0 1 4 20 16 1 0 0 0 1 128 128 0 1 128 128 128 1 0 10 0 0 0 1 4 32 90 61 58 127 30 244 119 154 65 27 170 14 182 232 45 237 92 61 188 238 138 237 84 7 5 209 228 172 195 235 219 189] key pair private key blob length is 544 bytes key pair private key blob is [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 1 38 0 0 0 0 0 0 0 1 18 52 1 7 210 186 20 15 180 182 68 217 17 251 23 142 218 85 206 228 75 16 37 108 9 47 216 5 160 29 100 235 78 164 63 25 232 181 251 214 113 69 26 198 9 222 119 149 66 64 233 183 172 93 96 41 223 99 201 110 138 227 51 26 197 166 9 8 190 40 129 254 49 89 54 38 209 21 60 137 118 113 174 145 254 145 152 119 73 114 11 144 41 25 106 152 140 167 192 88 82 199 100 234 18 255 129 213 111 25 126 2 200 3 44 90 252 84 48 191 106 98 2 77 78 7 165 189 227 52 167 78 188 5 185 254 178 206 180 171 47 110 54 38 87 16 191 167 134 237 48 49 153 168 54 225 251 75 223 3 55 239 48 119 76 89 103 20 30 222 104 167 219 210 46 17 75 224 196 191 55 238 236 156 205 119 182 199 12 58 144 248 124 216 181 38 11 17 139 144 123 31 108 76 171 91 154 112 6 160 188 2 181 110 212 46 66 153 211 21 184 1 51 194 12 245 73 155 192 206 80 213 51 187 166 3 207 127 151 127 59 158 192 7 92 113 247 118 108 55 217 84 183 34 24 144 57 215 193 96 179 93 2 190 84 85 119 199 179 96 119 2 9 160 231 251 214 187 5 206 224 207 111 52 58 181 131 237 11 245 106 181 223 217 240 98 162 190 11 116 18 46 225 218 17 130 79 19 4 171 94 129 197 59 201 54 63 31 60 90 84 225 223 121 94 173 42 103 3 204 128 187 143 209 78 80 151 157 90 44 76 20 254 18 96 197 70 36 135 24 13 156 77 112 196 22 35 123 199 169 17 195 156 0 212 50 140 50 126 70 132 126 149 172 94 173 49 156 173 207 208 109 166 88 148 204 25 122 119 58 130 215 130 101 13 235 96 29 210 130 229 51 232 250 206 124 162 68 112 3 191 129 184 195 34 186 72 103 159 228 155 244 43 108 205 37 82 176 243 200 233 88 91 31 243 33 232 44 178 19 57 182 239 63 238 130 33 1 127 250 215 109 121 187 134 218 173 74 112 88 230 152 90 147 20 43 28 254 173 28 25 255 0 147 78 51 231 175 190 29] Some of the fields in the private key blob follow: WK ID is [3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40] See 6.7.1 of page 182 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Blob version is [18 52] See 3.1.1 on page 141 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf IV is [1 7 210 186 20 15 180 182 68 217 17 251 23 142] Encrypted part is [218 85 206 228 75 16 37 108 9 47 216 5 160 29 100 235 78 164 63 25 232 181 251 214 113 69 26 198 9 222 119 149 66 64 233 183 172 93 96 41 223 99 201 110 138 227 51 26 197 166 9 8 190 40 129 254 49 89 54 38 209 21 60 137 118 113 174 145 254 145 152 119 73 114 11 144 41 25 106 152 140 167 192 88 82 199 100 234 18 255 129 213 111 25 126 2 200 3 44 90 252 84 48 191 106 98 2 77 78 7 165 189 227 52 167 78 188 5 185 254 178 206 180 171 47 110 54 38 87 16 191 167 134 237 48 49 153 168 54 225 251 75 223 3 55 239 48 119 76 89 103 20 30 222 104 167 219 210 46 17 75 224 196 191 55 238 236 156 205 119 182 199 12 58 144 248 124 216 181 38 11 17 139 144 123 31 108 76 171 91 154 112 6 160 188 2 181 110 212 46 66 153 211 21 184 1 51 194 12 245 73 155 192 206 80 213 51 187 166 3 207 127 151 127 59 158 192 7 92 113 247 118 108 55 217 84 183 34 24 144 57 215 193 96 179 93 2 190 84 85 119 199 179 96 119 2 9 160 231 251 214 187 5 206 224 207 111 52 58 181 131 237 11 245 106 181 223 217 240 98 162 190 11 116 18 46 225 218 17 130 79 19 4 171 94 129 197 59 201 54 63 31 60 90 84 225 223 121 94 173 42 103 3 204 128 187 143 209 78 80 151 157 90 44 76 20 254 18 96 197 70 36 135 24 13 156 77 112 196 22 35 123 199 169 17 195 156 0 212 50 140 50 126 70 132 126 149 172 94 173 49 156 173 207 208 109 166 88 148 204 25 122 119 58 130 215 130 101 13 235 96 29 210 130 229 51 232 250 206 124 162 68 112 3 191 129 184 195 34 186 72 103 159 228 155 244 43 108 205 37 82 176 243 200 233 88 91 31 243 33 232 44 178 19 57 182 239 63 238 130 33 1] MAC is [127 250 215 109 121 187 134 218 173 74 112 88 230 152 90 147 20 43 28 254 173 28 25 255 0 147 78 51 231 175 190 29] MAC is 32 bytes, see field 15 in 3.1 on page 140 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf -----BEGIN HSM ENCRYPTED PRIVATE KEY----- AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADsIIxQY2Y9lWElrfi1CQo AAAAAAAAASYAAAAAAAAAARI0AQfSuhQPtLZE2RH7F47aVc7kSxAlbAkv2AWgHWTr TqQ/Gei1+9ZxRRrGCd53lUJA6besXWAp32PJborjMxrFpgkIviiB/jFZNibRFTyJ dnGukf6RmHdJcguQKRlqmIynwFhSx2TqEv+B1W8ZfgLIAyxa/FQwv2piAk1OB6W9 4zSnTrwFuf6yzrSrL242JlcQv6eG7TAxmag24ftL3wM37zB3TFlnFB7eaKfb0i4R S+DEvzfu7JzNd7bHDDqQ+HzYtSYLEYuQex9sTKtbmnAGoLwCtW7ULkKZ0xW4ATPC DPVJm8DOUNUzu6YDz3+XfzuewAdccfd2bDfZVLciGJA518Fgs10CvlRVd8ezYHcC CaDn+9a7Bc7gz280OrWD7Qv1arXf2fBior4LdBIu4doRgk8TBKtegcU7yTY/Hzxa VOHfeV6tKmcDzIC7j9FOUJedWixMFP4SYMVGJIcYDZxNcMQWI3vHqRHDnADUMowy fkaEfpWsXq0xnK3P0G2mWJTMGXp3OoLXgmUN62Ad0oLlM+j6znyiRHADv4G4wyK6 SGef5Jv0K2zNJVKw88jpWFsf8yHoLLITObbvP+6CIQF/+tdtebuG2q1KcFjmmFqT FCsc/q0cGf8Ak04z56++HQ== -----END HSM ENCRYPTED PRIVATE KEY----- -----BEGIN PUBLIC KEY----- ME4wEAYHKoZIzj0CAQYFK4EEACEDOgAEsaSqU/EEjDHscwwWgs4wWq61hxA7Hwt6 Dv4NrIFA+QEoLOebNG4mQ6/0LVGdBdV94Md+QfvInzUEEAOwgjFBjZj2VYSWt+LU JCgEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAgGP+c/8OazWAQI AAAAAAAAAAEEFBABAAAAAYCAAAGAgIABAAoAAAABBCBaPTp/HvR3mkEbqg626C3t XD287ortVAcF0eSsw+vbvQ== -----END PUBLIC KEY----- Data signed Signature verified Try the P256 curve: ./lab --ex3 --curve P256 Example output selected curve P256 with ObjectID of 1.2.840.10045.3.1.7 Curve ObjectID in ASN.1 BER encoding is [6 8 42 134 72 206 61 3 1 7] Generated ECDSA PKCS key pair with mechanism CKM_EC_KEY_PAIR_GEN key pair public key blob length is 219 bytes key pair public key blob is [48 89 48 19 6 7 42 134 72 206 61 2 1 6 8 42 134 72 206 61 3 1 7 3 66 0 4 110 106 106 221 176 75 119 181 154 179 115 108 192 148 127 80 203 20 154 165 194 20 40 117 94 117 223 125 118 133 226 230 18 128 20 46 239 61 241 136 41 9 78 202 124 188 192 93 181 229 245 210 78 187 156 152 192 132 255 162 17 51 187 117 4 16 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 4 32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4 8 203 203 135 115 66 126 231 150 4 8 0 0 0 0 0 0 0 1 4 20 16 1 0 0 0 1 128 128 0 1 128 128 128 1 0 10 0 0 0 1 4 32 117 106 180 43 131 151 71 204 222 211 38 32 214 138 208 98 235 7 172 87 236 205 51 122 54 65 64 58 70 89 127 218] key pair private key blob length is 576 bytes key pair private key blob is [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 1 38 0 0 0 0 0 0 0 1 18 52 234 153 96 242 234 92 129 26 151 136 72 248 23 66 196 52 4 170 78 111 124 89 151 169 22 232 12 154 65 246 71 238 229 101 98 135 230 50 24 66 130 82 190 65 48 151 138 8 183 43 229 56 95 235 90 163 68 81 9 77 56 28 104 192 150 105 31 193 133 24 224 125 104 86 165 104 162 87 247 209 66 173 168 45 232 4 229 134 211 133 24 229 196 10 32 90 129 146 138 115 39 163 206 102 141 49 142 143 55 114 160 210 56 132 237 137 157 136 203 0 20 217 144 233 140 198 26 179 60 218 95 201 29 214 100 144 55 226 195 23 83 105 50 175 174 214 216 130 2 71 17 191 197 26 180 89 147 168 61 236 49 230 64 190 217 199 13 244 173 182 255 91 144 51 231 177 252 232 210 156 130 70 14 30 129 255 82 247 162 116 213 100 248 100 190 125 48 3 168 85 249 192 75 26 221 95 113 27 1 123 130 248 176 164 140 61 141 190 157 241 193 100 2 180 163 73 141 252 213 35 213 158 95 46 85 0 94 159 101 16 31 97 109 63 64 35 238 255 208 175 121 180 84 162 66 210 119 10 131 119 187 27 116 152 2 41 62 175 176 244 123 70 42 51 244 113 238 102 113 195 54 242 80 148 90 145 226 10 180 122 94 143 119 125 187 118 7 28 184 214 205 205 97 18 71 235 186 245 199 246 57 3 208 121 40 73 6 28 64 217 154 216 108 59 46 158 80 133 8 196 11 223 201 199 234 77 99 219 238 244 6 254 96 55 5 88 109 181 57 85 82 64 67 46 13 114 56 74 117 215 61 161 26 37 221 210 18 229 131 11 232 38 101 190 54 241 253 217 100 80 205 45 113 51 237 105 252 159 11 126 74 152 22 138 45 30 188 157 151 101 139 134 16 221 153 56 216 167 210 214 79 150 96 170 83 161 118 219 162 45 113 179 106 87 147 99 222 42 122 194 24 249 53 210 222 206 2 74 232 110 135 6 12 110 53 2 15 144 180 185 58 249 41 54 36 128 61 116 221 158 154 95 142 32 213 89 48 209 47 155 239 2 142 171 218 207 130 140 18 125 86 224 20 5 4 83 108 163 82 243 62 254 77 103 87 90 32 112 50 169 54 139 200 219 92 84 191 177 139 94] Some of the fields in the private key blob follow: WK ID is [3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40] See 6.7.1 of page 182 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Blob version is [18 52] See 3.1.1 on page 141 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf IV is [234 153 96 242 234 92 129 26 151 136 72 248 23 66] Encrypted part is [196 52 4 170 78 111 124 89 151 169 22 232 12 154 65 246 71 238 229 101 98 135 230 50 24 66 130 82 190 65 48 151 138 8 183 43 229 56 95 235 90 163 68 81 9 77 56 28 104 192 150 105 31 193 133 24 224 125 104 86 165 104 162 87 247 209 66 173 168 45 232 4 229 134 211 133 24 229 196 10 32 90 129 146 138 115 39 163 206 102 141 49 142 143 55 114 160 210 56 132 237 137 157 136 203 0 20 217 144 233 140 198 26 179 60 218 95 201 29 214 100 144 55 226 195 23 83 105 50 175 174 214 216 130 2 71 17 191 197 26 180 89 147 168 61 236 49 230 64 190 217 199 13 244 173 182 255 91 144 51 231 177 252 232 210 156 130 70 14 30 129 255 82 247 162 116 213 100 248 100 190 125 48 3 168 85 249 192 75 26 221 95 113 27 1 123 130 248 176 164 140 61 141 190 157 241 193 100 2 180 163 73 141 252 213 35 213 158 95 46 85 0 94 159 101 16 31 97 109 63 64 35 238 255 208 175 121 180 84 162 66 210 119 10 131 119 187 27 116 152 2 41 62 175 176 244 123 70 42 51 244 113 238 102 113 195 54 242 80 148 90 145 226 10 180 122 94 143 119 125 187 118 7 28 184 214 205 205 97 18 71 235 186 245 199 246 57 3 208 121 40 73 6 28 64 217 154 216 108 59 46 158 80 133 8 196 11 223 201 199 234 77 99 219 238 244 6 254 96 55 5 88 109 181 57 85 82 64 67 46 13 114 56 74 117 215 61 161 26 37 221 210 18 229 131 11 232 38 101 190 54 241 253 217 100 80 205 45 113 51 237 105 252 159 11 126 74 152 22 138 45 30 188 157 151 101 139 134 16 221 153 56 216 167 210 214 79 150 96 170 83 161 118 219 162 45 113 179 106 87 147 99 222 42 122 194 24 249 53 210 222 206 2 74 232 110 135 6 12 110 53 2 15 144 180 185 58 249 41 54 36 128 61 116 221 158 154 95 142 32 213 89 48 209 47 155 239 2 142 171 218 207 130 140] MAC is [18 125 86 224 20 5 4 83 108 163 82 243 62 254 77 103 87 90 32 112 50 169 54 139 200 219 92 84 191 177 139 94] MAC is 32 bytes, see field 15 in 3.1 on page 140 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf -----BEGIN HSM ENCRYPTED PRIVATE KEY----- AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADsIIxQY2Y9lWElrfi1CQo AAAAAAAAASYAAAAAAAAAARI06plg8upcgRqXiEj4F0LENASqTm98WZepFugMmkH2 R+7lZWKH5jIYQoJSvkEwl4oItyvlOF/rWqNEUQlNOBxowJZpH8GFGOB9aFalaKJX 99FCragt6ATlhtOFGOXECiBagZKKcyejzmaNMY6PN3Kg0jiE7YmdiMsAFNmQ6YzG GrM82l/JHdZkkDfiwxdTaTKvrtbYggJHEb/FGrRZk6g97DHmQL7Zxw30rbb/W5Az 57H86NKcgkYOHoH/UveidNVk+GS+fTADqFX5wEsa3V9xGwF7gviwpIw9jb6d8cFk ArSjSY381SPVnl8uVQBen2UQH2FtP0Aj7v/Qr3m0VKJC0ncKg3e7G3SYAik+r7D0 e0YqM/Rx7mZxwzbyUJRakeIKtHpej3d9u3YHHLjWzc1hEkfruvXH9jkD0HkoSQYc QNma2Gw7Lp5QhQjEC9/Jx+pNY9vu9Ab+YDcFWG21OVVSQEMuDXI4SnXXPaEaJd3S EuWDC+gmZb428f3ZZFDNLXEz7Wn8nwt+SpgWii0evJ2XZYuGEN2ZONin0tZPlmCq U6F226ItcbNqV5Nj3ip6whj5NdLezgJK6G6HBgxuNQIPkLS5OvkpNiSAPXTdnppf jiDVWTDRL5vvAo6r2s+CjBJ9VuAUBQRTbKNS8z7+TWdXWiBwMqk2i8jbXFS/sYte -----END HSM ENCRYPTED PRIVATE KEY----- -----BEGIN PUBLIC KEY----- MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEbmpq3bBLd7Was3NswJR/UMsUmqXC FCh1XnXffXaF4uYSgBQu7z3xiCkJTsp8vMBdteX10k67nJjAhP+iETO7dQQQA7CC MUGNmPZVhJa34tQkKAQgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE CMvLh3NCfueWBAgAAAAAAAAAAQQUEAEAAAABgIAAAYCAgAEACgAAAAEEIHVqtCuD l0fM3tMmINaK0GLrB6xX7M0zejZBQDpGWX/a -----END PUBLIC KEY----- Data signed Signature verified Finally, try the fourth suupported curve, P384: ./lab --ex3 --curve P384 Example output selected curve P384 with ObjectID of 1.3.132.0.34 Curve ObjectID in ASN.1 BER encoding is [6 5 43 129 4 0 34] Generated ECDSA PKCS key pair with mechanism CKM_EC_KEY_PAIR_GEN key pair public key blob length is 248 bytes key pair public key blob is [48 118 48 16 6 7 42 134 72 206 61 2 1 6 5 43 129 4 0 34 3 98 0 4 20 236 106 175 76 209 142 54 136 119 12 96 68 207 237 15 207 93 133 101 224 190 191 207 252 8 13 111 41 146 195 110 245 102 246 21 126 198 152 204 142 142 123 85 205 73 71 95 199 156 111 125 60 137 24 103 37 211 215 222 89 119 181 242 0 63 164 49 14 7 40 199 86 111 168 136 8 249 164 117 253 72 33 144 66 15 126 131 230 42 32 37 210 78 27 99 4 16 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 4 32 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4 8 31 146 195 59 47 0 221 196 4 8 0 0 0 0 0 0 0 1 4 20 16 1 0 0 0 1 128 128 0 1 128 128 128 1 0 10 0 0 0 1 4 32 166 134 66 17 102 8 140 118 31 64 4 242 234 134 34 72 132 116 245 10 224 174 74 101 243 172 223 184 156 51 28 103] key pair private key blob length is 720 bytes key pair private key blob is [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 1 38 0 0 0 0 0 0 0 1 18 52 153 221 86 12 9 88 111 233 79 50 0 98 38 116 119 42 179 162 115 61 69 173 2 50 40 5 241 34 125 95 215 44 94 60 200 193 50 47 70 234 63 92 12 149 107 163 199 247 244 21 145 94 176 100 72 240 241 146 134 62 70 238 188 1 31 91 136 108 73 110 218 192 207 194 239 183 109 245 140 135 33 148 169 75 112 120 9 173 218 117 181 74 141 98 52 108 110 115 135 113 187 153 210 17 27 101 149 108 233 171 190 217 178 69 154 188 13 79 167 107 197 222 34 246 90 23 80 87 71 32 39 100 100 38 41 239 210 168 65 58 118 220 16 7 32 148 54 163 80 1 199 139 165 132 161 234 172 7 87 11 31 106 203 50 250 123 9 145 5 40 155 103 123 16 113 60 61 210 215 238 164 150 191 97 200 231 170 17 180 184 90 104 114 10 114 61 129 222 6 139 56 248 177 110 10 53 234 143 90 10 149 134 174 170 32 237 224 29 124 102 218 206 171 105 10 18 16 233 191 119 26 12 167 215 135 23 95 83 89 171 154 14 249 247 35 202 88 83 220 5 191 52 71 15 64 20 21 62 55 241 158 98 38 95 137 193 201 253 122 71 25 10 128 22 53 60 199 175 192 194 104 68 187 83 136 228 246 102 194 153 119 139 178 33 170 80 237 242 75 179 107 184 194 221 45 216 161 217 150 100 224 22 7 94 142 242 114 3 52 237 105 123 39 61 185 226 37 38 159 64 208 219 25 170 246 223 126 122 120 135 86 193 101 6 105 148 156 12 77 162 221 200 34 202 29 228 198 5 193 112 96 95 16 225 1 6 41 252 234 218 227 64 95 16 221 124 2 4 42 209 138 212 11 35 149 12 240 152 187 36 87 60 156 4 138 76 214 193 233 17 174 49 119 133 96 215 49 137 139 45 36 162 230 79 83 100 87 83 13 159 146 143 170 144 34 248 76 97 244 226 63 124 122 121 35 177 81 219 119 21 42 42 40 92 37 220 93 118 245 215 76 129 128 251 187 202 225 112 82 171 55 8 158 70 93 209 70 31 31 251 22 170 11 215 35 190 122 0 48 146 182 84 180 106 192 119 0 227 114 134 98 247 100 13 30 56 20 232 87 56 120 132 197 194 244 138 6 31 224 220 50 114 202 129 226 170 8 168 37 184 206 16 11 55 229 59 26 38 6 74 4 191 232 77 70 242 232 80 3 144 192 248 102 68 155 22 34 97 12 221 63 106 55 248 185 169 207 239 178 95 71 220 127 87 74 14 241 233 45 248 208 51 92 103 59 39 218 52 53 177 164 7 135 195 99 49 135 89 18 132 8 185 51 41 0 0 210 46 166 22 59 21 223 44 65 60 83 41 211 102 10 123 89 57 98 87 183 212 197 96 149 236 104 175 109 207 180 77 52 123 170 159 77 29 255 146 246 94 95 71 63 156 183 227 45 82 160 148 152 87 53 42 161 58] Some of the fields in the private key blob follow: WK ID is [3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40] See 6.7.1 of page 182 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf Blob version is [18 52] See 3.1.1 on page 141 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf IV is [153 221 86 12 9 88 111 233 79 50 0 98 38 116] Encrypted part is [119 42 179 162 115 61 69 173 2 50 40 5 241 34 125 95 215 44 94 60 200 193 50 47 70 234 63 92 12 149 107 163 199 247 244 21 145 94 176 100 72 240 241 146 134 62 70 238 188 1 31 91 136 108 73 110 218 192 207 194 239 183 109 245 140 135 33 148 169 75 112 120 9 173 218 117 181 74 141 98 52 108 110 115 135 113 187 153 210 17 27 101 149 108 233 171 190 217 178 69 154 188 13 79 167 107 197 222 34 246 90 23 80 87 71 32 39 100 100 38 41 239 210 168 65 58 118 220 16 7 32 148 54 163 80 1 199 139 165 132 161 234 172 7 87 11 31 106 203 50 250 123 9 145 5 40 155 103 123 16 113 60 61 210 215 238 164 150 191 97 200 231 170 17 180 184 90 104 114 10 114 61 129 222 6 139 56 248 177 110 10 53 234 143 90 10 149 134 174 170 32 237 224 29 124 102 218 206 171 105 10 18 16 233 191 119 26 12 167 215 135 23 95 83 89 171 154 14 249 247 35 202 88 83 220 5 191 52 71 15 64 20 21 62 55 241 158 98 38 95 137 193 201 253 122 71 25 10 128 22 53 60 199 175 192 194 104 68 187 83 136 228 246 102 194 153 119 139 178 33 170 80 237 242 75 179 107 184 194 221 45 216 161 217 150 100 224 22 7 94 142 242 114 3 52 237 105 123 39 61 185 226 37 38 159 64 208 219 25 170 246 223 126 122 120 135 86 193 101 6 105 148 156 12 77 162 221 200 34 202 29 228 198 5 193 112 96 95 16 225 1 6 41 252 234 218 227 64 95 16 221 124 2 4 42 209 138 212 11 35 149 12 240 152 187 36 87 60 156 4 138 76 214 193 233 17 174 49 119 133 96 215 49 137 139 45 36 162 230 79 83 100 87 83 13 159 146 143 170 144 34 248 76 97 244 226 63 124 122 121 35 177 81 219 119 21 42 42 40 92 37 220 93 118 245 215 76 129 128 251 187 202 225 112 82 171 55 8 158 70 93 209 70 31 31 251 22 170 11 215 35 190 122 0 48 146 182 84 180 106 192 119 0 227 114 134 98 247 100 13 30 56 20 232 87 56 120 132 197 194 244 138 6 31 224 220 50 114 202 129 226 170 8 168 37 184 206 16 11 55 229 59 26 38 6 74 4 191 232 77 70 242 232 80 3 144 192 248 102 68 155 22 34 97 12 221 63 106 55 248 185 169 207 239 178 95 71 220 127 87 74 14 241 233 45 248 208 51 92 103 59 39 218 52 53 177 164 7 135 195 99 49 135 89 18 132 8 185 51 41 0 0 210 46 166 22 59 21 223 44 65 60 83 41 211 102 10 123 89 57 98 87 183 212 197 96 149 236] MAC is [104 175 109 207 180 77 52 123 170 159 77 29 255 146 246 94 95 71 63 156 183 227 45 82 160 148 152 87 53 42 161 58] MAC is 32 bytes, see field 15 in 3.1 on page 140 of http://public.dhe.ibm.com/security/cryptocards/pciecc4/EP11/docs/ep11-structure.pdf -----BEGIN HSM ENCRYPTED PRIVATE KEY----- AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADsIIxQY2Y9lWElrfi1CQo AAAAAAAAASYAAAAAAAAAARI0md1WDAlYb+lPMgBiJnR3KrOicz1FrQIyKAXxIn1f 1yxePMjBMi9G6j9cDJVro8f39BWRXrBkSPDxkoY+Ru68AR9biGxJbtrAz8Lvt231 jIchlKlLcHgJrdp1tUqNYjRsbnOHcbuZ0hEbZZVs6au+2bJFmrwNT6drxd4i9loX UFdHICdkZCYp79KoQTp23BAHIJQ2o1ABx4ulhKHqrAdXCx9qyzL6ewmRBSibZ3sQ cTw90tfupJa/YcjnqhG0uFpocgpyPYHeBos4+LFuCjXqj1oKlYauqiDt4B18ZtrO q2kKEhDpv3caDKfXhxdfU1mrmg759yPKWFPcBb80Rw9AFBU+N/GeYiZficHJ/XpH GQqAFjU8x6/AwmhEu1OI5PZmwpl3i7IhqlDt8kuza7jC3S3YodmWZOAWB16O8nID NO1peyc9ueIlJp9A0NsZqvbffnp4h1bBZQZplJwMTaLdyCLKHeTGBcFwYF8Q4QEG Kfzq2uNAXxDdfAIEKtGK1AsjlQzwmLskVzycBIpM1sHpEa4xd4Vg1zGJiy0kouZP U2RXUw2fko+qkCL4TGH04j98enkjsVHbdxUqKihcJdxddvXXTIGA+7vK4XBSqzcI nkZd0UYfH/sWqgvXI756ADCStlS0asB3AONyhmL3ZA0eOBToVzh4hMXC9IoGH+Dc MnLKgeKqCKgluM4QCzflOxomBkoEv+hNRvLoUAOQwPhmRJsWImEM3T9qN/i5qc/v sl9H3H9XSg7x6S340DNcZzsn2jQ1saQHh8NjMYdZEoQIuTMpAADSLqYWOxXfLEE8 UynTZgp7WTliV7fUxWCV7Givbc+0TTR7qp9NHf+S9l5fRz+ct+MtUqCUmFc1KqE6 -----END HSM ENCRYPTED PRIVATE KEY----- -----BEGIN PUBLIC KEY----- MHYwEAYHKoZIzj0CAQYFK4EEACIDYgAEFOxqr0zRjjaIdwxgRM/tD89dhWXgvr/P /AgNbymSw271ZvYVfsaYzI6Oe1XNSUdfx5xvfTyJGGcl09feWXe18gA/pDEOByjH Vm+oiAj5pHX9SCGQQg9+g+YqICXSThtjBBADsIIxQY2Y9lWElrfi1CQoBCAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQIH5LDOy8A3cQECAAAAAAAAAAB BBQQAQAAAAGAgAABgICAAQAKAAAAAQQgpoZCEWYIjHYfQATy6oYiSIR09Qrgrkpl 86zfuJwzHGc= -----END PUBLIC KEY----- Data signed Signature verified Each of the curves had a number in its name that indicates how large the key is, in bits. We worked with 224-, 256-, 384-, and 521-bit keys (yes that is 521 bits and not 512 bits but don't ask me why- I first have to get smart enough to understand it myself before I get smart enough to explain it to you coherently- besides, I'm sure Google has the answer). I am smart enough to know that there are 8 bits in a byte and while the key lengths in cryptographic algorithms are usually expressed in bits, the lengths in our exercise output for the various blobs are expressed in bytes. And there's nothing wrong with that, because our key blobs have lots of other metadata and attributes and fields besides just the key itself. That's why I purposely referred to them as key blobs and not keys. Try this handy \"one-line script\" that runs this exercise four times, once for each curve, and then pipes the output to egrep so that we can pick out some lines of interest. You can see how the curve strength impacts the size of the public and private key blobs: for curve in P224 P256 P384 P521 ; do ./lab --ex3 --curve ${ curve } ; done | egrep -ie 'curve|key blob length' Expected Output selected curve P224 with ObjectID of 1.3.132.0.33 Curve ObjectID in ASN.1 BER encoding is [6 5 43 129 4 0 33] key pair public key blob length is 208 bytes key pair private key blob length is 544 bytes selected curve P256 with ObjectID of 1.2.840.10045.3.1.7 Curve ObjectID in ASN.1 BER encoding is [6 8 42 134 72 206 61 3 1 7] key pair public key blob length is 219 bytes key pair private key blob length is 576 bytes selected curve P384 with ObjectID of 1.3.132.0.34 Curve ObjectID in ASN.1 BER encoding is [6 5 43 129 4 0 34] key pair public key blob length is 248 bytes key pair private key blob length is 720 bytes selected curve P521 with ObjectID of 1.3.132.0.35 Curve ObjectID in ASN.1 BER encoding is [6 5 43 129 4 0 35] key pair public key blob length is 286 bytes key pair private key blob length is 896 bytes It makes sense that the larger key sizes produce bigger key blobs. If I ever figure out enough to give a full accounting of the difference in blob sizes, I'll update the lab. If you ever figure it out, please create a GitHub pull request with the answer. Let's move on to our fourth and final exercise.","title":"Run Exercise 3"},{"location":"grep11-lab/lab-exercise4/","text":"Exercise 4 - Wrap and Unwrap a Key \u00b6 Overview of Exercise 4 \u00b6 Data that is not encrypted is referrd to as plaintext. Data that is encrypted is referred to as ciphertext. Whether this data is human readable text, like this sentence, or binary data (like a lot of the output in our exercises!), or whatever, is usually of little concern to encryption and decryption algorithms. The input is just a bunch of bits- either 1 or 0 . Keys themselves are just a bunch of bits- 1 's and 0 's. Can you encrypt and decrypt keys with other keys? You sure can. There's nothing magical about that. But, like all disciplines, cryptographers have special terms for encrypting and decrypting keys- they use the term wrapping a key to refer to encrypting a key, and unwrapping a key refers to decrypting a key. There are valid reasons to make the distinction- for example, the PKCS #11 standard allows you to assign attributes to keys, and you can create keys such that they can or cannot wrap or unwrap keys, and you may wish to create different keys for different purposes. In fact, it is considered best practice to not use the same key to encrypt both data and keys, so using different terminology- encrypting data versus wrapping keys allows for easier separation of duties and may make key management easier. In this exercise, the following use case will be demonstrated- securely transmitting a secret key so that both parties have the same secret key and can use it for encryption during a session: Sender wishes to send a secret (i.e., symmetric) key to a recipient. Sender generates a secret key and wraps it with the recipient's public key Sender sends the wrapped key to the recipient- this is safe since it is wrapped with the recipient's public key Recipient receives the wrapped key, and unwrarps it with her private key Run Exercise 4 \u00b6 Run the fourth exercise: ./lab --ex4 Example Output Generated AES key Generated PKCS RSA key pair the AES key prior to being wrapped is: [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 141 37 0 0 0 0 0 0 0 1 18 52 228 123 210 48 148 72 67 55 62 73 210 121 66 247 116 178 245 24 106 221 115 156 71 47 218 46 103 246 124 74 119 150 39 244 103 45 22 196 216 35 98 215 63 143 111 10 217 35 1 34 26 127 84 98 120 216 45 88 92 129 231 135 244 57 118 125 8 141 119 168 29 141 122 29 224 59 1 244 174 182 103 220 131 195 114 27 143 94 112 118 185 49 140 147 51 10 26 16 150 95 130 1 239 21 212 148 246 182 10 159 243 69 233 30 202 254 52 241 146 79 66 44 9 199 32 56 113 169 227 133 51 177 98 204 240 57 244 188 254 99 38 243 227 153 119 170 28 38 109 86 197 175 193 64 255 113 106 40 94 90 204 5 241 135 72 79 76 42 166 180 59 93 91 62 94 248 153 138 201 11 2 155 224 41 66 230 89 253 94 74] the checksum of the AES key is: [147 241 235] the AES key has been wrapped with a PKCS RSA Public Key The AES key has been unwrapped with the PKCS Private Key corresponding to the PKCS Public Key we used to wrap it with. the AES key after being wrapped and unwrapped is: [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 12 0 0 0 0 0 0 0 0 1 18 52 206 249 87 66 227 239 81 119 120 21 113 29 123 27 2 52 241 6 31 39 195 183 118 39 98 185 255 179 31 44 217 72 38 56 126 190 23 230 112 120 180 74 27 118 70 9 145 247 109 197 15 92 126 232 161 192 140 63 241 178 29 188 70 79 29 240 6 39 76 22 244 149 99 241 220 160 157 40 58 42 255 121 3 181 9 118 15 96 170 49 208 117 127 248 187 202 226 92 76 198 142 164 39 85 247 74 203 28 50 106 162 144 217 93 110 120 157 126 106 37 202 133 10 133 162 89 201 186 210 12 93 124 74 231 120 172 149 134 196 232 247 5 228 92 146 119 245 115 107 124 153 218 87 65 119 80 131 101 53 219 210 111 107 216 117 6 45 153 176 221 49 121 208 77 164 68 230 219 190 45 238 82 201 112 126 205 97 110 201 187 28 240 134 33 223 206 209 45 207 159 132 178 222 232 63 160] the checksum of the unwrapped AES key is: [147 241 235 0 0 1 0] I mentioned in the overview of this exercise that you can assign attributes to keys when you create them. The code for this exercise, by default, assigns an attribute that allows the public key it creates to wrap keys, and it assigns an attribute to the private key to unwrap keys. Run this command which will cause the program to set the applicable attribute for the private key such that it is not allowed to unwrap a key. Observe in the output that, while the wrap operation proceeds, the unwrap fails: ./lab --ex4 --unwrap = false Example output Generated AES key Generated PKCS RSA key pair the AES key prior to being wrapped is: [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 141 37 0 0 0 0 0 0 0 1 18 52 120 27 243 16 225 139 153 149 120 188 137 72 50 120 131 243 65 98 62 77 65 60 178 184 93 56 192 2 202 179 211 210 240 252 246 171 56 100 172 203 61 233 216 102 186 60 207 208 1 173 188 223 4 45 199 93 159 251 80 32 171 131 10 228 235 131 98 191 70 58 116 218 179 225 62 235 136 76 246 39 55 21 247 126 181 47 3 130 64 70 198 91 136 21 133 177 138 190 118 139 183 195 32 110 107 230 101 253 127 40 171 124 1 146 32 138 11 148 175 180 54 21 123 51 144 234 167 228 218 128 47 74 26 203 250 95 110 208 47 245 229 198 164 121 76 226 138 122 31 168 169 251 74 149 174 62 88 86 122 204 149 195 200 41 139 250 0 242 226 34 193 78 32 151 250 220 249 249 106 106 231 217 34 139 118 29 206 140 217 75] the checksum of the AES key is: [79 136 190] the AES key has been wrapped with a PKCS RSA Public Key panic: Unwrap AES key error: rpc error: code = Unknown desc = CKR_KEY_FUNCTION_NOT_PERMITTED goroutine 1 [running]: main.wrapAndUnwrapKey(0xc420030001) /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/lab/exercise4.go:110 +0x1543 main.main() /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/lab/main.go:79 +0x35e This command will cause the public key to be created without the ability to wrap a key. The command will fail when trying to wrap the key: ./lab --ex4 --wrap = false Example output Generated AES key Generated PKCS RSA key pair the AES key prior to being wrapped is: [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 141 37 0 0 0 0 0 0 0 1 18 52 94 240 28 56 111 164 179 172 71 8 202 169 163 165 249 244 192 122 26 215 148 231 8 62 1 127 152 148 45 31 45 189 172 0 97 131 35 17 231 104 88 103 196 2 96 167 213 198 9 62 10 241 154 128 94 206 4 229 36 89 125 38 231 94 155 212 43 90 44 253 221 170 164 83 13 228 232 156 205 205 183 65 252 45 183 191 75 243 56 130 64 170 140 197 150 91 224 229 88 47 185 97 138 145 93 241 181 206 4 141 225 214 249 62 21 4 83 105 12 209 109 187 124 171 112 222 107 44 203 204 240 23 236 60 27 190 248 201 189 3 112 89 163 28 91 254 220 95 74 11 247 137 54 107 93 106 21 199 166 152 208 200 151 220 233 4 125 105 139 235 83 211 121 166 15 209 229 173 92 2 74 50 107 41 73 150 197 116 162 37] the checksum of the AES key is: [229 2 226] panic: Wrap AES key error: rpc error: code = Unknown desc = CKR_KEY_FUNCTION_NOT_PERMITTED goroutine 1 [running]: main.wrapAndUnwrapKey(0xc420030100) /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/lab/exercise4.go:90 +0x1553 main.main() /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/lab/main.go:79 +0x35e Note The public key has been prevented from wrapping a key, but it could still be used to encrypt data. Congratulations for reaching the end of the lab!","title":"Exercise 4 (Wrap and Unwrap Key)"},{"location":"grep11-lab/lab-exercise4/#exercise-4-wrap-and-unwrap-a-key","text":"","title":"Exercise 4 - Wrap and Unwrap a Key"},{"location":"grep11-lab/lab-exercise4/#overview-of-exercise-4","text":"Data that is not encrypted is referrd to as plaintext. Data that is encrypted is referred to as ciphertext. Whether this data is human readable text, like this sentence, or binary data (like a lot of the output in our exercises!), or whatever, is usually of little concern to encryption and decryption algorithms. The input is just a bunch of bits- either 1 or 0 . Keys themselves are just a bunch of bits- 1 's and 0 's. Can you encrypt and decrypt keys with other keys? You sure can. There's nothing magical about that. But, like all disciplines, cryptographers have special terms for encrypting and decrypting keys- they use the term wrapping a key to refer to encrypting a key, and unwrapping a key refers to decrypting a key. There are valid reasons to make the distinction- for example, the PKCS #11 standard allows you to assign attributes to keys, and you can create keys such that they can or cannot wrap or unwrap keys, and you may wish to create different keys for different purposes. In fact, it is considered best practice to not use the same key to encrypt both data and keys, so using different terminology- encrypting data versus wrapping keys allows for easier separation of duties and may make key management easier. In this exercise, the following use case will be demonstrated- securely transmitting a secret key so that both parties have the same secret key and can use it for encryption during a session: Sender wishes to send a secret (i.e., symmetric) key to a recipient. Sender generates a secret key and wraps it with the recipient's public key Sender sends the wrapped key to the recipient- this is safe since it is wrapped with the recipient's public key Recipient receives the wrapped key, and unwrarps it with her private key","title":"Overview of Exercise 4"},{"location":"grep11-lab/lab-exercise4/#run-exercise-4","text":"Run the fourth exercise: ./lab --ex4 Example Output Generated AES key Generated PKCS RSA key pair the AES key prior to being wrapped is: [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 141 37 0 0 0 0 0 0 0 1 18 52 228 123 210 48 148 72 67 55 62 73 210 121 66 247 116 178 245 24 106 221 115 156 71 47 218 46 103 246 124 74 119 150 39 244 103 45 22 196 216 35 98 215 63 143 111 10 217 35 1 34 26 127 84 98 120 216 45 88 92 129 231 135 244 57 118 125 8 141 119 168 29 141 122 29 224 59 1 244 174 182 103 220 131 195 114 27 143 94 112 118 185 49 140 147 51 10 26 16 150 95 130 1 239 21 212 148 246 182 10 159 243 69 233 30 202 254 52 241 146 79 66 44 9 199 32 56 113 169 227 133 51 177 98 204 240 57 244 188 254 99 38 243 227 153 119 170 28 38 109 86 197 175 193 64 255 113 106 40 94 90 204 5 241 135 72 79 76 42 166 180 59 93 91 62 94 248 153 138 201 11 2 155 224 41 66 230 89 253 94 74] the checksum of the AES key is: [147 241 235] the AES key has been wrapped with a PKCS RSA Public Key The AES key has been unwrapped with the PKCS Private Key corresponding to the PKCS Public Key we used to wrap it with. the AES key after being wrapped and unwrapped is: [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 12 0 0 0 0 0 0 0 0 1 18 52 206 249 87 66 227 239 81 119 120 21 113 29 123 27 2 52 241 6 31 39 195 183 118 39 98 185 255 179 31 44 217 72 38 56 126 190 23 230 112 120 180 74 27 118 70 9 145 247 109 197 15 92 126 232 161 192 140 63 241 178 29 188 70 79 29 240 6 39 76 22 244 149 99 241 220 160 157 40 58 42 255 121 3 181 9 118 15 96 170 49 208 117 127 248 187 202 226 92 76 198 142 164 39 85 247 74 203 28 50 106 162 144 217 93 110 120 157 126 106 37 202 133 10 133 162 89 201 186 210 12 93 124 74 231 120 172 149 134 196 232 247 5 228 92 146 119 245 115 107 124 153 218 87 65 119 80 131 101 53 219 210 111 107 216 117 6 45 153 176 221 49 121 208 77 164 68 230 219 190 45 238 82 201 112 126 205 97 110 201 187 28 240 134 33 223 206 209 45 207 159 132 178 222 232 63 160] the checksum of the unwrapped AES key is: [147 241 235 0 0 1 0] I mentioned in the overview of this exercise that you can assign attributes to keys when you create them. The code for this exercise, by default, assigns an attribute that allows the public key it creates to wrap keys, and it assigns an attribute to the private key to unwrap keys. Run this command which will cause the program to set the applicable attribute for the private key such that it is not allowed to unwrap a key. Observe in the output that, while the wrap operation proceeds, the unwrap fails: ./lab --ex4 --unwrap = false Example output Generated AES key Generated PKCS RSA key pair the AES key prior to being wrapped is: [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 141 37 0 0 0 0 0 0 0 1 18 52 120 27 243 16 225 139 153 149 120 188 137 72 50 120 131 243 65 98 62 77 65 60 178 184 93 56 192 2 202 179 211 210 240 252 246 171 56 100 172 203 61 233 216 102 186 60 207 208 1 173 188 223 4 45 199 93 159 251 80 32 171 131 10 228 235 131 98 191 70 58 116 218 179 225 62 235 136 76 246 39 55 21 247 126 181 47 3 130 64 70 198 91 136 21 133 177 138 190 118 139 183 195 32 110 107 230 101 253 127 40 171 124 1 146 32 138 11 148 175 180 54 21 123 51 144 234 167 228 218 128 47 74 26 203 250 95 110 208 47 245 229 198 164 121 76 226 138 122 31 168 169 251 74 149 174 62 88 86 122 204 149 195 200 41 139 250 0 242 226 34 193 78 32 151 250 220 249 249 106 106 231 217 34 139 118 29 206 140 217 75] the checksum of the AES key is: [79 136 190] the AES key has been wrapped with a PKCS RSA Public Key panic: Unwrap AES key error: rpc error: code = Unknown desc = CKR_KEY_FUNCTION_NOT_PERMITTED goroutine 1 [running]: main.wrapAndUnwrapKey(0xc420030001) /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/lab/exercise4.go:110 +0x1543 main.main() /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/lab/main.go:79 +0x35e This command will cause the public key to be created without the ability to wrap a key. The command will fail when trying to wrap the key: ./lab --ex4 --wrap = false Example output Generated AES key Generated PKCS RSA key pair the AES key prior to being wrapped is: [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 3 176 130 49 65 141 152 246 85 132 150 183 226 212 36 40 0 0 0 0 0 0 141 37 0 0 0 0 0 0 0 1 18 52 94 240 28 56 111 164 179 172 71 8 202 169 163 165 249 244 192 122 26 215 148 231 8 62 1 127 152 148 45 31 45 189 172 0 97 131 35 17 231 104 88 103 196 2 96 167 213 198 9 62 10 241 154 128 94 206 4 229 36 89 125 38 231 94 155 212 43 90 44 253 221 170 164 83 13 228 232 156 205 205 183 65 252 45 183 191 75 243 56 130 64 170 140 197 150 91 224 229 88 47 185 97 138 145 93 241 181 206 4 141 225 214 249 62 21 4 83 105 12 209 109 187 124 171 112 222 107 44 203 204 240 23 236 60 27 190 248 201 189 3 112 89 163 28 91 254 220 95 74 11 247 137 54 107 93 106 21 199 166 152 208 200 151 220 233 4 125 105 139 235 83 211 121 166 15 209 229 173 92 2 74 50 107 41 73 150 197 116 162 37] the checksum of the AES key is: [229 2 226] panic: Wrap AES key error: rpc error: code = Unknown desc = CKR_KEY_FUNCTION_NOT_PERMITTED goroutine 1 [running]: main.wrapAndUnwrapKey(0xc420030100) /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/lab/exercise4.go:90 +0x1553 main.main() /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/lab/main.go:79 +0x35e Note The public key has been prevented from wrapping a key, but it could still be used to encrypt data. Congratulations for reaching the end of the lab!","title":"Run Exercise 4"},{"location":"grep11-lab/overview/","text":"GREP11 Lab Overview \u00b6 GREP11 Overview \u00b6 In this lab you will be working with the GREP11 feature of the Hyper Protect Virtual Servers on-premises offering. GREP11 is a shorthand term for gRPC protocol-based Enterprise PKCS#11 . PKCS #11 refers to the Public Key Cryptography Standard #11 Cryptographic Token Interface, which is a standard for devices that hold cryptographic information and perform cryptographic functions. gRPC stands for Google Remote Procedure Call, which is a protocol developed by Google, and contributed to open source. gRPC uses HTTP/2 for its transport protocol. Enterprise PKCS#11 , often referred to as EP11 , refers to IBM's library, designed for enterprise usage, that is very similar to the PKCS #11 standard. The PKCS #11 standard covers the following cryptographic categories, and the GREP11 library provides functions in each of these categories: Encryption Decryption Message digests (also known as hashes) Signing and MACing (Message Authentication Codes) Verifying signatures and MACs Key Management- creating symmetric keys, creating asymmetric keys, wrapping and unwrapping keys, and deriving keys from other keys Random number generation - strictly speaking not a cryptographic operation unto itself, but random numbers are often used in cryptographic operations Lab Environment \u00b6 You will be working with the Hyper Protect Virtual Server command line interface (CLI) running on an x86_64 virtual machine running the Ubuntu 18.04.4 Linux distribution. You will also be using this virtual machine to run programs, written in the Go programming language, that will communicate with the GREP11 server. This virtual machine is provisioned on SkyTap in the IBM Cloud, and you will access it through your web browser. Your instructor will provide you the information needed to access your virtual machine under separate cover. The GREP11 server runs as a Docker container running in a Hyper Protect Virtual Servers LPAR that runs as a Secure Service Container (SSC) LPAR on an IBM z15 server in the IBM Washington Systems Center in Herndon, Virginia, USA. The Hyper Protect Virtual Servers LPAR is in a private network at the IBM Washington Systems Center and your Ubuntu virtual machine communicates with it through a VPN connection. Your instructor will provide you the information needed to establish a VPN connection under separate cover. What has been done for you already \u00b6 Our starting point for the lab is having the GREP11 servers running on our Hyper Protect Virtual Servers LPAR. Each GREP11 server is connected to a single domain on an IBM Crypto Express 7S card that is configured to our LPAR. Our Hyper Protect Virtual Servers LPAR has two Crypto Expess 7S cards configured to it, with one domain on each card dedicated to our LPAR. So, with only two domains and many students, we had to provision the GREP11 servers ahead of time. We will describe the process of setting this up so that you will have a reference. Detailed Lab Process \u00b6 Read about how we configured the GREP11 servers Issue relevant Hyper Protect Virtual Servers CLI commands Clone the GitHub repository which the lab uses Run Hyper Protect Virtual Server commands to inspect the GREP11 setup Run the GREP11 samples that IBM documentation points to Run custom lab exercises that go into greater depth","title":"Lab overview"},{"location":"grep11-lab/overview/#grep11-lab-overview","text":"","title":"GREP11 Lab Overview"},{"location":"grep11-lab/overview/#grep11-overview","text":"In this lab you will be working with the GREP11 feature of the Hyper Protect Virtual Servers on-premises offering. GREP11 is a shorthand term for gRPC protocol-based Enterprise PKCS#11 . PKCS #11 refers to the Public Key Cryptography Standard #11 Cryptographic Token Interface, which is a standard for devices that hold cryptographic information and perform cryptographic functions. gRPC stands for Google Remote Procedure Call, which is a protocol developed by Google, and contributed to open source. gRPC uses HTTP/2 for its transport protocol. Enterprise PKCS#11 , often referred to as EP11 , refers to IBM's library, designed for enterprise usage, that is very similar to the PKCS #11 standard. The PKCS #11 standard covers the following cryptographic categories, and the GREP11 library provides functions in each of these categories: Encryption Decryption Message digests (also known as hashes) Signing and MACing (Message Authentication Codes) Verifying signatures and MACs Key Management- creating symmetric keys, creating asymmetric keys, wrapping and unwrapping keys, and deriving keys from other keys Random number generation - strictly speaking not a cryptographic operation unto itself, but random numbers are often used in cryptographic operations","title":"GREP11 Overview"},{"location":"grep11-lab/overview/#lab-environment","text":"You will be working with the Hyper Protect Virtual Server command line interface (CLI) running on an x86_64 virtual machine running the Ubuntu 18.04.4 Linux distribution. You will also be using this virtual machine to run programs, written in the Go programming language, that will communicate with the GREP11 server. This virtual machine is provisioned on SkyTap in the IBM Cloud, and you will access it through your web browser. Your instructor will provide you the information needed to access your virtual machine under separate cover. The GREP11 server runs as a Docker container running in a Hyper Protect Virtual Servers LPAR that runs as a Secure Service Container (SSC) LPAR on an IBM z15 server in the IBM Washington Systems Center in Herndon, Virginia, USA. The Hyper Protect Virtual Servers LPAR is in a private network at the IBM Washington Systems Center and your Ubuntu virtual machine communicates with it through a VPN connection. Your instructor will provide you the information needed to establish a VPN connection under separate cover.","title":"Lab Environment"},{"location":"grep11-lab/overview/#what-has-been-done-for-you-already","text":"Our starting point for the lab is having the GREP11 servers running on our Hyper Protect Virtual Servers LPAR. Each GREP11 server is connected to a single domain on an IBM Crypto Express 7S card that is configured to our LPAR. Our Hyper Protect Virtual Servers LPAR has two Crypto Expess 7S cards configured to it, with one domain on each card dedicated to our LPAR. So, with only two domains and many students, we had to provision the GREP11 servers ahead of time. We will describe the process of setting this up so that you will have a reference.","title":"What has been done for you already"},{"location":"grep11-lab/overview/#detailed-lab-process","text":"Read about how we configured the GREP11 servers Issue relevant Hyper Protect Virtual Servers CLI commands Clone the GitHub repository which the lab uses Run Hyper Protect Virtual Server commands to inspect the GREP11 setup Run the GREP11 samples that IBM documentation points to Run custom lab exercises that go into greater depth","title":"Detailed Lab Process"},{"location":"grep11-lab/run-grep11-samples/","text":"Run the GREP11 Sample code \u00b6 Clone the GitHub repository which has the source code \u00b6 Change to the /home/hyper-protect-lab/go/src/github.com/ibm-developer directory cd ${ HOME } /go/src/github.com/ibm-developer Ensure you are in the directory mentioned in the prior step. You may be able to tell from the command prompt. You can also enter the pwd (\"print working directory\") to be sure, e.g.,: pwd Example Output /home/hyper-protect-lab/go/src/github.com/ibm-developer Clone the GitHub repository used in this lab: git clone https://github.com/silliman/ibm-cloud-hyperprotectcrypto.git Example Output Cloning into 'ibm-cloud-hyperprotectcrypto'... remote: Enumerating objects: 821, done. remote: Counting objects: 100% (821/821), done. remote: Compressing objects: 100% (551/551), done. remote: Total 821 (delta 227), reused 821 (delta 227), pack-reused 0 Receiving objects: 100% (821/821), 9.30 MiB | 8.42 MiB/s, done. Resolving deltas: 100% (227/227), done. Change to the ibm-cloud-hyperprotectcrypto directory which the prior git clone command created: cd ibm-cloud-hyperprotect-crypto Tip Use the pwd command if you cannot already tell by your command prompt that you are in the /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto directory. Run the GREP11 sample code \u00b6 Start Visual Studio Code within your current directory: code In a moment you should see the Visual Studio Code window with your current directory structure shown in the Explorer pane in the upper left corner of the window: Expand the golang folder, and then expand the examples folder underneath it. Your Explorer pane should then look similar to this: From the Visual Studio Code menu, select View then Terminal , as shown below: You will see a terminal appear within Visual Studio Code at the bottom: Tip If you hover your mouse over the line above the terminal, when it turns into the \"double arrow\" as highlighted in the above screen snippet, you can drag the line to resize your terminal window. This tip may come in handy for you during the course of the lab. Change to the golang/examples directory within the Visual Studio Code terminal that you just opened: cd golang/examples Your terminal will look like this: Tip I have shown you how to use the Terminal window with Visual Studio Code, which you may find convenient. Your Ubuntu Desktop also provides a Terminal application that you can use to open one or more terminal windows with. They behave the same, and which one you use is a personal choice, as long as you are in the correct directory that the instructions expect you to be in. It is convenient to have a terminal window inside Visual Studio Code, but it comes at the expense of some screen real estate being taken away from the source code used in the exercises. Use whichever method works best for you. Test the GREP11 sample code: go test -v Example Output === RUN Example_getMechanismInfo --- PASS: Example_getMechanismInfo (0.29s) === RUN Example_encryptAndDecrypt --- PASS: Example_encryptAndDecrypt (0.84s) === RUN Example_digest --- PASS: Example_digest (0.55s) === RUN Example_signAndVerifyUsingRSAKeyPair --- PASS: Example_signAndVerifyUsingRSAKeyPair (0.50s) === RUN Example_signAndVerifyUsingECDSAKeyPair --- PASS: Example_signAndVerifyUsingECDSAKeyPair (0.52s) === RUN Example_signAndVerifyToTestErrorHandling --- PASS: Example_signAndVerifyToTestErrorHandling (0.51s) === RUN Example_wrapAndUnwrapKey --- PASS: Example_wrapAndUnwrapKey (0.41s) === RUN Example_deriveKey --- PASS: Example_deriveKey (0.61s) === RUN Example_tls --- PASS: Example_tls (0.40s) PASS ok github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/examples 4.653s Explanation of GREP11 sample code \u00b6 The test used the go test subcommand, which does the following: It looks for any file in the current directory named something _test.go. There are two such files in our directory, server_test.go and tls_test.go . It looks for functions in these files named Example_ something , and executes these functions. At the bottom of each of these functions, a series of comment lines, starting with a header line, specifies what the expected output from the function should be. If the output from the function call matches the lines (except for the header line), then the test passes. Otherwise the test fails. In the explorer pane, click on server_test.go or tls_test.go and examine the source code to see these lines. For example, lines 211-216 in server_test.go indicate what the expected output of the Example_encryptAndDecrypt function should be: // Output: // Generated AES Key // Generated IV // Encrypted message // Decrypted message // Hello, this is a very long and creative message without any imagination Note Go is a compiled language, and there are no executable files in this directory- the 'go test' command compiles the source code in the directory into an executable file in order to run the tests, and then cleans up afterwards by removing this executable. Here is an itemization of the functions that our go test -v command tested, with a brief description of each. Our lab exercises in the subsequent sections will go into a little more depth on some of the more interesting of these functions. Example_getMechanismInfo gets a list of PKCS #11 Mechanisms and then retrieves information about one of them. We will delve deeper into this in the first exercise. Example_encryptAndDecrypt creates a secret (i.e., symmetric) key, encrypts data with it, then decrypts it, and ensures the data was unchanged after going through the encryption and decryption. We will look more into this in the second exercise. Example_digest creates a digest, or hash, against some data. A hash is a fixed-length, unique fingerprint for a set of input data of any size. Since there are an infinite number of possible input combinations, and the hash is fixed-length, in theory two different sets of data could produce the same hash. This is called a collision . In practice, the hash is of sufficient size, and the algorithm to produce it sufficiently complex, that it is computationally infeasible to produce the same hash with two different sets of input. Digests are used in digital signatures, which the next two tests cover. Example_signAndVerifyUsingRSAKeyPair creates an RSA public and private key pair and uses the private key to create a digital signature and the public key to verify the digital signature. Example_signAndVerifyUsingECDSAKeyPair creates and elliptic curve public and private key pair and uses the private key to create a digital signature and uses the public key to verify the digital signature. We go into greater depth (and discuss the differences between RSA and Elliptic Curves) in the third exercise. Example_signAndVerifyToTestErrorHandling intentionally causes an error- after a signature is created, the program modifies a byte in it, so that when the signature is verified later, an error occurs- the test passes because the expected error message is listed in the expected test output. Example_wrapAndUnwrapKey creates a public and private key pair and uses the public key to encrypt, or wrap, a symmetric key, which can then only be decrypted, or unwrapped, by the private key. The fourth and final exercise covers this topic. Example_deriveKey illustrates a common algorithm where two sides of a connection each have a public and private key pair, and they use each other's public key in an algorithm that allows each of them to derive an identical secret, i.e., symmetric, key, without ever having sent that secret key across the connection. This is a common use case because encryption and decryption with a symmetric key is much faster than encryption and decryption with public and private keys. The two parties use relatively slow public key cryptography to derive this shared symmetric key at the beginning of their session, and then switch to using this symmetric key for the remainder of the session. This function and all of the functions preceding it in this list are in the server_test.go source file. Example_tls creates an X.509 certificate, starts up an http server that uses this certificate, and has a client connect to the server with TLS authentication, which uses this certificate to establish a session. This test is in the tls_test.go source file.","title":"Run the GREP11 sample code"},{"location":"grep11-lab/run-grep11-samples/#run-the-grep11-sample-code","text":"","title":"Run the GREP11 Sample code"},{"location":"grep11-lab/run-grep11-samples/#clone-the-github-repository-which-has-the-source-code","text":"Change to the /home/hyper-protect-lab/go/src/github.com/ibm-developer directory cd ${ HOME } /go/src/github.com/ibm-developer Ensure you are in the directory mentioned in the prior step. You may be able to tell from the command prompt. You can also enter the pwd (\"print working directory\") to be sure, e.g.,: pwd Example Output /home/hyper-protect-lab/go/src/github.com/ibm-developer Clone the GitHub repository used in this lab: git clone https://github.com/silliman/ibm-cloud-hyperprotectcrypto.git Example Output Cloning into 'ibm-cloud-hyperprotectcrypto'... remote: Enumerating objects: 821, done. remote: Counting objects: 100% (821/821), done. remote: Compressing objects: 100% (551/551), done. remote: Total 821 (delta 227), reused 821 (delta 227), pack-reused 0 Receiving objects: 100% (821/821), 9.30 MiB | 8.42 MiB/s, done. Resolving deltas: 100% (227/227), done. Change to the ibm-cloud-hyperprotectcrypto directory which the prior git clone command created: cd ibm-cloud-hyperprotect-crypto Tip Use the pwd command if you cannot already tell by your command prompt that you are in the /home/hyper-protect-lab/go/src/github.com/ibm-developer/ibm-cloud-hyperprotectcrypto directory.","title":"Clone the GitHub repository which has the source code"},{"location":"grep11-lab/run-grep11-samples/#run-the-grep11-sample-code_1","text":"Start Visual Studio Code within your current directory: code In a moment you should see the Visual Studio Code window with your current directory structure shown in the Explorer pane in the upper left corner of the window: Expand the golang folder, and then expand the examples folder underneath it. Your Explorer pane should then look similar to this: From the Visual Studio Code menu, select View then Terminal , as shown below: You will see a terminal appear within Visual Studio Code at the bottom: Tip If you hover your mouse over the line above the terminal, when it turns into the \"double arrow\" as highlighted in the above screen snippet, you can drag the line to resize your terminal window. This tip may come in handy for you during the course of the lab. Change to the golang/examples directory within the Visual Studio Code terminal that you just opened: cd golang/examples Your terminal will look like this: Tip I have shown you how to use the Terminal window with Visual Studio Code, which you may find convenient. Your Ubuntu Desktop also provides a Terminal application that you can use to open one or more terminal windows with. They behave the same, and which one you use is a personal choice, as long as you are in the correct directory that the instructions expect you to be in. It is convenient to have a terminal window inside Visual Studio Code, but it comes at the expense of some screen real estate being taken away from the source code used in the exercises. Use whichever method works best for you. Test the GREP11 sample code: go test -v Example Output === RUN Example_getMechanismInfo --- PASS: Example_getMechanismInfo (0.29s) === RUN Example_encryptAndDecrypt --- PASS: Example_encryptAndDecrypt (0.84s) === RUN Example_digest --- PASS: Example_digest (0.55s) === RUN Example_signAndVerifyUsingRSAKeyPair --- PASS: Example_signAndVerifyUsingRSAKeyPair (0.50s) === RUN Example_signAndVerifyUsingECDSAKeyPair --- PASS: Example_signAndVerifyUsingECDSAKeyPair (0.52s) === RUN Example_signAndVerifyToTestErrorHandling --- PASS: Example_signAndVerifyToTestErrorHandling (0.51s) === RUN Example_wrapAndUnwrapKey --- PASS: Example_wrapAndUnwrapKey (0.41s) === RUN Example_deriveKey --- PASS: Example_deriveKey (0.61s) === RUN Example_tls --- PASS: Example_tls (0.40s) PASS ok github.com/ibm-developer/ibm-cloud-hyperprotectcrypto/golang/examples 4.653s","title":"Run the GREP11 sample code"},{"location":"grep11-lab/run-grep11-samples/#explanation-of-grep11-sample-code","text":"The test used the go test subcommand, which does the following: It looks for any file in the current directory named something _test.go. There are two such files in our directory, server_test.go and tls_test.go . It looks for functions in these files named Example_ something , and executes these functions. At the bottom of each of these functions, a series of comment lines, starting with a header line, specifies what the expected output from the function should be. If the output from the function call matches the lines (except for the header line), then the test passes. Otherwise the test fails. In the explorer pane, click on server_test.go or tls_test.go and examine the source code to see these lines. For example, lines 211-216 in server_test.go indicate what the expected output of the Example_encryptAndDecrypt function should be: // Output: // Generated AES Key // Generated IV // Encrypted message // Decrypted message // Hello, this is a very long and creative message without any imagination Note Go is a compiled language, and there are no executable files in this directory- the 'go test' command compiles the source code in the directory into an executable file in order to run the tests, and then cleans up afterwards by removing this executable. Here is an itemization of the functions that our go test -v command tested, with a brief description of each. Our lab exercises in the subsequent sections will go into a little more depth on some of the more interesting of these functions. Example_getMechanismInfo gets a list of PKCS #11 Mechanisms and then retrieves information about one of them. We will delve deeper into this in the first exercise. Example_encryptAndDecrypt creates a secret (i.e., symmetric) key, encrypts data with it, then decrypts it, and ensures the data was unchanged after going through the encryption and decryption. We will look more into this in the second exercise. Example_digest creates a digest, or hash, against some data. A hash is a fixed-length, unique fingerprint for a set of input data of any size. Since there are an infinite number of possible input combinations, and the hash is fixed-length, in theory two different sets of data could produce the same hash. This is called a collision . In practice, the hash is of sufficient size, and the algorithm to produce it sufficiently complex, that it is computationally infeasible to produce the same hash with two different sets of input. Digests are used in digital signatures, which the next two tests cover. Example_signAndVerifyUsingRSAKeyPair creates an RSA public and private key pair and uses the private key to create a digital signature and the public key to verify the digital signature. Example_signAndVerifyUsingECDSAKeyPair creates and elliptic curve public and private key pair and uses the private key to create a digital signature and uses the public key to verify the digital signature. We go into greater depth (and discuss the differences between RSA and Elliptic Curves) in the third exercise. Example_signAndVerifyToTestErrorHandling intentionally causes an error- after a signature is created, the program modifies a byte in it, so that when the signature is verified later, an error occurs- the test passes because the expected error message is listed in the expected test output. Example_wrapAndUnwrapKey creates a public and private key pair and uses the public key to encrypt, or wrap, a symmetric key, which can then only be decrypted, or unwrapped, by the private key. The fourth and final exercise covers this topic. Example_deriveKey illustrates a common algorithm where two sides of a connection each have a public and private key pair, and they use each other's public key in an algorithm that allows each of them to derive an identical secret, i.e., symmetric, key, without ever having sent that secret key across the connection. This is a common use case because encryption and decryption with a symmetric key is much faster than encryption and decryption with public and private keys. The two parties use relatively slow public key cryptography to derive this shared symmetric key at the beginning of their session, and then switch to using this symmetric key for the remainder of the session. This function and all of the functions preceding it in this list are in the server_test.go source file. Example_tls creates an X.509 certificate, starts up an http server that uses this certificate, and has a client connect to the server with TLS authentication, which uses this certificate to establish a session. This test is in the tls_test.go source file.","title":"Explanation of GREP11 sample code"},{"location":"securebuild-lab/assignment/","text":"Lab Assignments \u00b6 You will be given the VPN address, and passwords for your VPN ID and CLI Server at the start of the lab. Name Team Number VPN ID CLI Server Address Anand Subramanian 01 zblock01 192.168.22.101 Andrea Corbelli 02 zblock02 192.168.22.102 Angelina Rohrer 03 zblock03 192.168.22.103 Anna Shugol 04 zblock04 192.168.22.104 Bradley Banerd 05 zblock05 192.168.22.105 Chris Poole 06 zblock06 192.168.22.106 Fabio Keller 07 zblock07 192.168.22.107 Jean-Yves Girard 08 zblock08 192.168.22.108 Jenn Francis 09 zblock09 192.168.22.109 Lena Roesch 10 zblock10 192.168.22.110 Peter Demeo 11 zblock11 192.168.22.111 Simon Vogel 12 zblock12 192.168.22.112 Timothy Sipples 13 zblock13 192.168.22.113","title":"Assignments"},{"location":"securebuild-lab/assignment/#lab-assignments","text":"You will be given the VPN address, and passwords for your VPN ID and CLI Server at the start of the lab. Name Team Number VPN ID CLI Server Address Anand Subramanian 01 zblock01 192.168.22.101 Andrea Corbelli 02 zblock02 192.168.22.102 Angelina Rohrer 03 zblock03 192.168.22.103 Anna Shugol 04 zblock04 192.168.22.104 Bradley Banerd 05 zblock05 192.168.22.105 Chris Poole 06 zblock06 192.168.22.106 Fabio Keller 07 zblock07 192.168.22.107 Jean-Yves Girard 08 zblock08 192.168.22.108 Jenn Francis 09 zblock09 192.168.22.109 Lena Roesch 10 zblock10 192.168.22.110 Peter Demeo 11 zblock11 192.168.22.111 Simon Vogel 12 zblock12 192.168.22.112 Timothy Sipples 13 zblock13 192.168.22.113","title":"Lab Assignments"},{"location":"securebuild-lab/bitcoin_wallet/","text":"Welcome to the Secure Bitcoin Wallet on IBM LinuxONE \u00b6 Overview \u00b6 This application is a secure Electrum Bitcoin wallet found at this GitHub repository . You can use it to store the identities necessary to transact on the Bitcoin public blockchain network. While this version of the wallet is just a proof of concept, running this type of wallet on Hyper Protect enables you to protect your digital assets from bad actors such as malicious server administrators. Info This Electrum Bitcoin wallet functions regularly, while inheriting the security benefits of the Hyper Protect Virtual Server platform. This ensures that a legitimate version of the application is running (Secure Image Build process) and that administrators cannot compromise the application (Hyper Protect Virtual Server deployment). Account Registration \u00b6 Registering a fake account for lab purposes. Choose Register since you won't have an existing account on the newly deployed server. Enter the registration details you desire. Tip Do not worry about the information you enter on the registration page (shown below) as it won't map to anything. You just need your password to log back in if you log out of the application. Wallet initialization \u00b6 It's time to set up your Secure Electrum Bitcoin wallet itself! Bring up the wallet screen Enter in a password for your wallet and click Create Wallet Load your newly created wallet to enable it Reload the page. Your wallet is ready for use in all of its glory Receiving Bitcoins \u00b6 A wallet without currency is blasphemy, so it's time to fill it on up with fake bitcoins. Go to the Receive section of the wallet and get the bitcoin wallet address. Info This is the address whose alloted bitcoins you lay claim to. Open this bitcoin test faucet site [click on the link] and use it to transfer bitcoin value to the Receiving address in your wallet from step 1 above . Note Instead of transacting on the \"real\" bitcoin blockchain network, we are using a testnet . This means that the network participants agree that the assets on the network have no value. Testnets are used for testing changes to the network, testing applications and introducing new users to the technical aspects of network. There are testnets for many of the public blockchain networks including of course bitcoin and ethereum. Test faucets (like the one we are using) act as distributors of tokens to other users on the testnet. Switch back to your wallet tab and go to the History section and then reload the page. You should now see your wallet address as the recipient of a pending transaction from the bitcoin testnet faucet. After clicking for more information you get a detailed transaction overview Info The number of confirmations a block receives is the number of blocks deep the block that has included the blockchain transaction is. In other words, 1 confirmation means that the current head block includes the transaction. 2 confirmations means that the current head blocks parent block contains the transaction and so on. The deeper the transaction is (more confirmations it has) the more mining power it would take to \"reverse history\" and undo the transaction. Since there are 0 confirmations in the picture above, it means that the transaction is not yet included in a block. This is why it has no timestamp yet and it's block number is listed as 0 . After waiting anywhere from a minute to a few minutes (depending on the current testnet traffic) you should see a confirmation on your transaction. Tip You will need to keep reloading the page for it to update. It doesn't update automatically. There is now a timestamp and a block number! Info As time passes more confirmations will accumulate. You can check on the confirmations again at the end of the lab to show yourself this (Given enough time has passed for one or more additional confirmation(s) to occur). Returning Bitcoins \u00b6 Since you are feeling charitable you decide to transfer your testnet value back to the faucet's address. Go back to the faucet site and get it's bitcoin address Tip This address is here for easy copy and paste: 2NGZrVvZG92qGYqzTLjCAewvPZ7JE8S8VxE Send bitcoins to faucet using Send section of wallet Once sent you will see the Signed transaction information filled out on your wallet page. You can go back to the bitcoin faucet site and see the transaction as green there with a sender of your address and a transaction ID matching the one you sent. You can view both the initial received transaction and the newly sent transaction in the History tab of your bitcoin wallet. Tip You have to keep reloading the page for it to update with new confirmations. Info If you wait long enough, eventually these transactions will gain confirmations as in the picture below You can continue to play around with the electrum wallet before moving on. Summary \u00b6 Success You have participated in the bitcoin testnet using a securely built electrum bitcoin wallet powered by a Hyper Protect Virtual Server. Congratulations!!! Now, it's time to clean up...","title":"Welcome to the Secure Bitcoin Wallet on IBM LinuxONE"},{"location":"securebuild-lab/bitcoin_wallet/#welcome-to-the-secure-bitcoin-wallet-on-ibm-linuxone","text":"","title":"Welcome to the Secure Bitcoin Wallet on IBM LinuxONE"},{"location":"securebuild-lab/bitcoin_wallet/#overview","text":"This application is a secure Electrum Bitcoin wallet found at this GitHub repository . You can use it to store the identities necessary to transact on the Bitcoin public blockchain network. While this version of the wallet is just a proof of concept, running this type of wallet on Hyper Protect enables you to protect your digital assets from bad actors such as malicious server administrators. Info This Electrum Bitcoin wallet functions regularly, while inheriting the security benefits of the Hyper Protect Virtual Server platform. This ensures that a legitimate version of the application is running (Secure Image Build process) and that administrators cannot compromise the application (Hyper Protect Virtual Server deployment).","title":"Overview"},{"location":"securebuild-lab/bitcoin_wallet/#account-registration","text":"Registering a fake account for lab purposes. Choose Register since you won't have an existing account on the newly deployed server. Enter the registration details you desire. Tip Do not worry about the information you enter on the registration page (shown below) as it won't map to anything. You just need your password to log back in if you log out of the application.","title":"Account Registration"},{"location":"securebuild-lab/bitcoin_wallet/#wallet-initialization","text":"It's time to set up your Secure Electrum Bitcoin wallet itself! Bring up the wallet screen Enter in a password for your wallet and click Create Wallet Load your newly created wallet to enable it Reload the page. Your wallet is ready for use in all of its glory","title":"Wallet initialization"},{"location":"securebuild-lab/bitcoin_wallet/#receiving-bitcoins","text":"A wallet without currency is blasphemy, so it's time to fill it on up with fake bitcoins. Go to the Receive section of the wallet and get the bitcoin wallet address. Info This is the address whose alloted bitcoins you lay claim to. Open this bitcoin test faucet site [click on the link] and use it to transfer bitcoin value to the Receiving address in your wallet from step 1 above . Note Instead of transacting on the \"real\" bitcoin blockchain network, we are using a testnet . This means that the network participants agree that the assets on the network have no value. Testnets are used for testing changes to the network, testing applications and introducing new users to the technical aspects of network. There are testnets for many of the public blockchain networks including of course bitcoin and ethereum. Test faucets (like the one we are using) act as distributors of tokens to other users on the testnet. Switch back to your wallet tab and go to the History section and then reload the page. You should now see your wallet address as the recipient of a pending transaction from the bitcoin testnet faucet. After clicking for more information you get a detailed transaction overview Info The number of confirmations a block receives is the number of blocks deep the block that has included the blockchain transaction is. In other words, 1 confirmation means that the current head block includes the transaction. 2 confirmations means that the current head blocks parent block contains the transaction and so on. The deeper the transaction is (more confirmations it has) the more mining power it would take to \"reverse history\" and undo the transaction. Since there are 0 confirmations in the picture above, it means that the transaction is not yet included in a block. This is why it has no timestamp yet and it's block number is listed as 0 . After waiting anywhere from a minute to a few minutes (depending on the current testnet traffic) you should see a confirmation on your transaction. Tip You will need to keep reloading the page for it to update. It doesn't update automatically. There is now a timestamp and a block number! Info As time passes more confirmations will accumulate. You can check on the confirmations again at the end of the lab to show yourself this (Given enough time has passed for one or more additional confirmation(s) to occur).","title":"Receiving Bitcoins"},{"location":"securebuild-lab/bitcoin_wallet/#returning-bitcoins","text":"Since you are feeling charitable you decide to transfer your testnet value back to the faucet's address. Go back to the faucet site and get it's bitcoin address Tip This address is here for easy copy and paste: 2NGZrVvZG92qGYqzTLjCAewvPZ7JE8S8VxE Send bitcoins to faucet using Send section of wallet Once sent you will see the Signed transaction information filled out on your wallet page. You can go back to the bitcoin faucet site and see the transaction as green there with a sender of your address and a transaction ID matching the one you sent. You can view both the initial received transaction and the newly sent transaction in the History tab of your bitcoin wallet. Tip You have to keep reloading the page for it to update with new confirmations. Info If you wait long enough, eventually these transactions will gain confirmations as in the picture below You can continue to play around with the electrum wallet before moving on.","title":"Returning Bitcoins"},{"location":"securebuild-lab/bitcoin_wallet/#summary","text":"Success You have participated in the bitcoin testnet using a securely built electrum bitcoin wallet powered by a Hyper Protect Virtual Server. Congratulations!!! Now, it's time to clean up...","title":"Summary"},{"location":"securebuild-lab/build/","text":"Securely Build your Application \u00b6 Export Variables set in previous sections to current terminal session \u00b6 Source bashrc to set necessary variables if unset source \" ${ HOME } /.bashrc\" Create repository registration GPG signing key \u00b6 Set key name export keyName = \"secure_bitcoin_key ${ RANDOM } \" Info ${RANDOM} stores a pseudo-random number to use since GPG keys on a system must each have a unique key name (uid). This will make sure users can safely re-run commands for multiple runs if they so choose. Set key passphrase Command Syntax export passphrase = \"your_passphrase\" Example Command export passphrase = \"most_secure_pw_i_could_think_of\" Create directory to store Docker repository registration signing key material mkdir -p \" ${ SB_DIR } /registration_keys\" Create Key Definition cat > \" ${ SB_DIR } /registration_keys/ ${ keyName } _definition_keys\" <<EOF %echo Generating registration definition key Key-Type: RSA Key-Length: 4096 Subkey-Type: RSA Subkey-Length: 4096 Name-Real: ${keyName} Expire-Date: 0 Passphrase: ${passphrase} # Do a commit here, so that we can later print \"done\" :-) %commit %echo done EOF Generate Key pair gpg --armor --batch \\ --generate-key \" ${ SB_DIR } /registration_keys/ ${ keyName } _definition_keys\" Example Output gpg: directory '/home/multiarch-lab/.gnupg' created gpg: keybox '/home/multiarch-lab/.gnupg/pubring.kbx' created gpg: Generating registration definition key gpg: /home/multiarch-lab/.gnupg/trustdb.gpg: trustdb created gpg: key 7E05CE05DFEBA2BC marked as ultimately trusted gpg: directory '/home/multiarch-lab/.gnupg/openpgp-revocs.d' created gpg: revocation certificate stored as '/home/multiarch-lab/.gnupg/openpgp-revocs.d/27FB55DC5F7FDF0598C9B1007E05CE05DFEBA2BC.rev' gpg: done Export Private key gpg --armor --pinentry-mode = loopback --passphrase \" ${ passphrase } \" \\ --export-secret-keys \" ${ keyName } \" > \" ${ SB_DIR } /registration_keys/ ${ keyName } .private\" Export Public key gpg --armor --export ${ keyName } > \" ${ SB_DIR } /registration_keys/ ${ keyName } .pub\" List newly generated key files ls ${ SB_DIR } /registration_keys/ Example Output secure_bitcoin_key_definition_keys secure_bitcoin_key.pub secure_bitcoin_key.private Set Build Configuration \u00b6 Set Secure Build Lab IP Address export SB_IP = 192 .168.22.80 Save Secure Build Lab IP Address for later use echo \"export SB_IP=' ${ SB_IP } '\" >> \" ${ HOME } /.bashrc\" Set Secure Build GitHub repository export GH_REPO = \"git@github.com:IBM/secure-bitcoin-wallet.git\" Set Docker Image Name export IMAGE_NAME = \"hpvs_bc\" Set repository registration name export REPO_ID = \" ${ IMAGE_NAME } _ ${ HPVS_NUMBER } \" Save repository registration name for later use echo \"export REPO_ID=' ${ REPO_ID } '\" >> \" ${ HOME } /.bashrc\" Create config file cat > \"${SB_DIR}/sb_config.yaml\" <<EOF secure_build_workers: sbs: url: 'https://${SB_IP}' port: '${SB_PORT}' cert_path: '${SB_DIR}/sbs_keys/sbs.cert' key_path: '${SB_DIR}/sbs_keys/sbs.key' regfile: id: '${REPO_ID}' github: url: '${GH_REPO}' branch: 'master' ssh_private_key_path: '${GITHUB_SSH_KEY}' recurse_submodules: 'False' dockerfile_path: './Dockerfile' docker_build_path: './' docker: push_server: '${REGISTRY_NAME}' #base_server: '${REGISTRY_NAME}' pull_server: '${REGISTRY_NAME}' repo: '${DOCKER_USERNAME}/${IMAGE_NAME}' image_tag_prefix: 'latest' content_trust_base: 'False' env: whitelist: [] build: args: [] signing_key: private_key_path: '${SB_DIR}/registration_keys/${keyName}.private' public_key_path: '${SB_DIR}/registration_keys/${keyName}.pub' EOF 8. Continue to the Build Application section if you are launching secure build for the first time or the Troubleshooting Secure Build section if things didn't go as planned your first go-round and you are trying to get back on the right track. Build Application \u00b6 Initialize Secure Build Hyper Protect Virtual server with configuration file generated in the Set Build Configuration section hpvs sb init --config \" ${ SB_DIR } /sb_config.yaml\" Example Output { \"status\" : \"OK\" } Launch secure build with a timeout of 20 minutes (1200 seconds) to complete using the configuration file generated in the Set Build Configuration section hpvs sb build \\ --timeout 1200 \\ --config \" ${ SB_DIR } /sb_config.yaml\" Tip The following build will take anywhere from 15-20 minutes to complete. While this is ongoing, you should open a new tab in your terminal to check the automatically updating logs and build status (steps for doing this are detailed in the next few steps). If this command times out please check the status in the step 3 to make sure nothing went wrong. It might just be that your build took to long and everything will be ok. If something did go wrong, visit the Troubleshooting Secure Build section Note The secure build is asynchronous so if the command gets interrupted here don't worry! Warning If the secure build command gets an error this command will keep on waiting until eventually timing out. If you see an error in the status you can interrupt this command with ctrl+c instead of waiting for it to time out. Example Output after running 15-20 minutes to completion +--------+-------------------------+ | status | OK: async build started | +--------+-------------------------+ ############################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################## +---------------------+--------------------------------------------------------------------------------------------+ | root_ssh_enabled | false | | status | success | | build_name | docker.io.gmoney23.hpvs_bc_a.latest-b3416d8.2020-06-23_22-12-54.183641 | | image_tag | latest-b3416d8 | | manifest_key_gen | soft_crypto | | manifest_public_key | manifest.docker.io.gmoney23.hpvs_bc_a.latest-b3416d8.2020-06-23_22-12-54.183641-public.pem | +---------------------+--------------------------------------------------------------------------------------------+ Please look at the logs in another terminal window while the secure build is running (don't interrupt the current terminal window which is waiting for the secure build) hpvs sb log --config \" ${ SB_DIR } /sb_config.yaml\" Example Truncated Output 2020-06-23 05:25:42,453 root INFO starting a build 2020-06-23 05:25:42,454 root INFO cleaning up the local github repo and the github access credential 2020-06-23 05:25:42,454 root INFO github_dir=secure-bitcoin-wallet 2020-06-23 05:25:42,454 root INFO cloning a github repo 2020-06-23 05:25:42,454 root INFO github_host=github.com 2020-06-23 05:25:42,454 root INFO cmd=ssh-keyscan github.com 2020-06-23 05:25:47,659 root INFO # github.com:22 SSH-2.0-babeld-7c96ae41 # github.com:22 SSH-2.0-babeld-b6072416 # github.com:22 SSH-2.0-babeld-b6072416 github.com ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAq2A7hRGmdnm9tUDbO9IDSwBK6TbQa+PXYPCPy6rbTrTtw7PHkccKrpp0yVhp5HdEIcKr6pL ..... You can also look at the secure build status in another window. This can be useful if you accidentally interrupted the secure build command or it times out due to the timeout not being long enough. It will also fill out the additional fields that are initially blank when the build completes (such as build_name and manifest_public_key , etc.). hpvs sb status --config \" ${ SB_DIR } /sb_config.yaml\" Example Output +---------------------+---------------+ | manifest_public_key | | | root_ssh_enabled | false | | status | github cloned | | build_name | | | image_tag | | | manifest_key_gen | | +---------------------+---------------+ If you see an error in your status If you see that your build ran into an error please visit the Troubleshooting Secure Build section You can continue to check the logs to monitor the progress of your secure build with the previous logs command hpvs sb log --config \" ${ SB_DIR } /sb_config.yaml\" When the secure build successfully completes, it will have ending logs similar to the following: Example Output 2020 -06-23 08 :39:46,463 root INFO run: latest: digest: sha256:ffbaf396807659d5a4d66fe54c0ebf382a9f170c4eaf187b9b4c8582ca8fdec2 size: 5133 2020 -06-23 08 :39:46,463 root INFO run: Signing and pushing trust metadata 2020 -06-23 08 :39:48,299 root INFO run: Successfully signed docker.io/gmoney23/hpvs_bc:latest 2020 -06-23 08 :39:48,300 root INFO run: return code = 0 2020 -06-23 08 :39:48,300 root INFO extracting an image keyid and key 2020 -06-23 08 :39:48,301 root INFO keyid = 0cc264a565c452ea6aca776b2787be54e94b905113e77edae00d5ec267a07ffc 2020 -06-23 08 :39:48,301 root INFO publickey = LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJmVENDQVNTZ0F3SUJBZ0lSQUt3cTlRWEZhMzRYMXdIRmZST2NJZXN3Q2dZSUtvWkl6ajBFQXdJd0pURWoKTUNFR0ExVUVBd3dhWkc5amEyVnlMbWx2TDJkdGIyNWxlVEl6TDJod2RuTmZZbU13SGhjTk1qQXdOakl6TURnegpPVFF4V2hjTk16QXdOakl4TURnek9UUXhXakFsTVNNd0lRWURWUVFEREJwa2IyTnJaWEl1YVc4dloyMXZibVY1Ck1qTXZhSEIyYzE5aVl6QlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJKU3ZPdWlSaHJNcjJmQVYKcmZLcHZncVRYNXZwSFlodnEvZXc1SFRuMzRMcnBrQ0xJMjBkdmxjcTUyc1ZvQjVxYkpzeEdTbkphOU5sM0tYYQpZUlRjQ2Z1ak5UQXpNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WSFNVRUREQUtCZ2dyQmdFRkJRY0RBekFNCkJnTlZIUk1CQWY4RUFqQUFNQW9HQ0NxR1NNNDlCQU1DQTBjQU1FUUNJRlhFWE9iZTdHR1NsSjEzTzZicTR6T0IKamhoMlZSbmRYOVJYMytrSFpnVVVBaUJBWXAyNTkwTkpVelJIK1lhR2JzQ1hMRmxOUWRzT2ltWW9NMzlqR0IwRAp5dz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K 2020 -06-23 08 :39:48,301 root INFO generating a config file 2020 -06-23 08 :39:48,301 root INFO create_and_push: SoftCrypto 2020 -06-23 08 :39:48,819 root INFO digest = 1f0b1f65b1462f16930b200c77ce5fbe654e1d624405bc243d713de1aade36b7 2020 -06-23 08 :39:48,819 root INFO block_size = 64 2020 -06-23 08 :39:48,821 root INFO digest = 1f0b1f65b1462f16930b200c77ce5fbe654e1d624405bc243d713de1aade36b7 2020 -06-23 08 :39:48,824 root INFO signature = 114157a8bd98d7f5a5c2ca33f81496563af7f18d23123fc35c8aa84a5bfadc709ecb17e5e79d42d6bd6ac8a815053d9cfd039b7f01ab84b9a75a23e2917b0bc4f0c1b5bd5664dfebd573c2355c34115762b8fea56285d65cd8db4877c9b95ab3149b65d14ce1a23b1065a34c2d4ba9a1526286a03d87d307a5972cf1425e586c9d213b34fe53407c79a527e78779b7a70b426516db35f22a09329dfac76a8505613249ad2b46070ad7d932a8c4bbe1981d0370150528cb9e6f5a426be6734405435393a8d6d8e145418398f85bc28be6c332d2fa2e84f5465618051b110a3efcd25600dc95ee0d7f8bc0d36b8ddaa9ce1c4be78f38928d9213e5171078e22930 2020 -06-23 08 :39:48,824 root INFO verify = OK 2020 -06-23 08 :39:49,214 root WARNING undefined MANIFEST_BUCKET_NAME 2020 -06-23 08 :39:49,214 root WARNING skipping transferring a manifest to COS 2020 -06-23 08 :39:49,214 root INFO cleaning up the build environment 2020 -06-23 08 :39:49,214 root INFO github_dir = secure-bitcoin-wallet 2020 -06-23 08 :39:49,217 root INFO completed a build When the secure build successfully completes, you can check the status again to see a completed status. hpvs sb status --config \" ${ SB_DIR } /sb_config.yaml\" Example Output +---------------------+------------------------------------------------------------------------------------------+ | build_name | docker.io.gmoney23.hpvs_bc.latest-b3416d8.2020-06-23_08-39-48.301849 | | image_tag | latest-b3416d8 | | manifest_key_gen | soft_crypto | | manifest_public_key | manifest.docker.io.gmoney23.hpvs_bc.latest-b3416d8.2020-06-23_08-39-48.301849-public.pem | | root_ssh_enabled | false | | status | success | +---------------------+------------------------------------------------------------------------------------------+ If you see an error in your status If you see that your build ran into an error please visit the Troubleshooting Secure Build section From the original terminal window that you ran hpvs sb init , output the repository registration file. echo \" ${ passphrase } \" | hpvs sb regfile \\ --config \" ${ SB_DIR } /sb_config.yaml\" \\ --out \" ${ SB_DIR } /yaml. ${ REPO_ID } .enc\" Example Output Enter Sigining Private key passphrase: Tip The echo command takes care of the passphrase so you don't need to enter it manually. Warning If you run this command from a terminal window where you did not set the passphrase environment variable you will get an error saying openpgp: invalid data: private key checksum failure . You can also check to make sure you are in the right terminal window by running echo \"${passphrase}\" and the output should be the passphrase you set in the beginning of the \"Create repository registration GPG signing key\" section. Troubleshooting Secure Build \u00b6 Troubleshooting Instructions If your build completed successfully, feel free to SKIP this section If your build failed continue for instructions on how to find the happy path yet again. If at any point you see an error in the status command you will need to restart your build with the following steps. If the secure build command is still running in its own window please interrupt it with ctrl + c Check the logs for more error information using: hpvs sb log --config \" ${ SB_DIR } /sb_config.yaml\" Correct whatever information was incorrect and go back through the steps in the Set Build Configuration section Clean up the data (i.e. logs) from the old build with: hpvs sb clean --config \" ${ SB_DIR } /sb_config.yaml\" Update the secure build server with the new configuration hpvs sb update --config \" ${ SB_DIR } /sb_config.yaml\" Continue onward like you just initialized your build server (You did ... just for another time ) at Step 2 in the Build Application Section Info The next command you should run will be hpvs sb build ( Step 2 in the Build Application Section ) Verify your application \u00b6 Create directories for your manifest file information and change into your new manifest directory. mkdir -p \" ${ SB_DIR } /manifest/manifest_files\" && cd \" ${ SB_DIR } /manifest\" Save the build name from the status command as a variable export BUILD_NAME = \" $( hpvs sb status --config \" ${ SB_DIR } /sb_config.yaml\" \\ | grep build_name | egrep -ow 'docker.*[[:digit:]]' ) \" && echo \" ${ BUILD_NAME } \" Example Output docker.io.gmoney23.hpvs_bc.latest-b3416d8.2020-06-23_08-39-48.301849 Get your application manifest hpvs sb manifest --config \" ${ SB_DIR } /sb_config.yaml\" --name \" ${ BUILD_NAME } \" Get your manifest public verification key hpvs sb pubkey --config \" ${ SB_DIR } /sb_config.yaml\" --name \" ${ BUILD_NAME } \" Info Connections to the secure build server are secured using mutual tls. This means that proper certificates and keys have to be used on the client side to access these files (as well as when doing the previous secure build commands). This adds a layer of security to make sure that the public key and manifest files are authentic and securely distributed. Check that your application manifest and signing key were retrieved ls Example Output docker.io.gmoney23.hpvs_bc_a.latest-b3416d8.2020-06-23_22-12-54.183641-public.pem manifest.docker.io.gmoney23.hpvs_bc_a.latest-b3416d8.2020-06-23_22-12-54.183641.sig.tbz manifest_files Set MANIFEST to point to your manifest files. export MANIFEST = \" ${ SB_DIR } /manifest/manifest. ${ BUILD_NAME } \" Set MAN_PUBKEY to point to your manifest public key. export MAN_PUBKEY = \" ${ SB_DIR } /manifest/ ${ BUILD_NAME } -public.pem\" Untar and unzip the manifest .sig.tbz file to reveal the .sig and .tbz files (and remove the original .sig.tbz ) tar -xjvf \" ${ MANIFEST } .sig.tbz\" && rm \" ${ MANIFEST } .sig.tbz\" Example Output manifest.docker.io.gmoney23.hpvs_bc_a.latest-b3416d8.2020-06-23_22-12-54.183641.tbz manifest.docker.io.gmoney23.hpvs_bc_a.latest-b3416d8.2020-06-23_22-12-54.183641.sig Note The .sig.tbz was a tarball compressed using bzip2 compression of both a nested .tbz file (containing the manifest files) and a .sig file containing a signature of the nested .tbz to verify it with the public key retrieved using the hpvs sb pubkey command above saved in the file referenced by MAN_PUBKEY . Convert the signature file to binary format cat \" ${ MANIFEST } .sig\" | xxd -r -p > \" ${ MANIFEST } .sig.bin\" Hash ( SHA256 ) the manifest .tbz file (containing the manifest files) openssl dgst -sha256 -binary -out \" ${ MANIFEST } .tbz.sha256\" \" ${ MANIFEST } .tbz\" Verify that the .tbz manifest package was the one signed on the secure build server. openssl dgst -sha256 -verify \" ${ MAN_PUBKEY } \" \\ -signature \" ${ MANIFEST } .sig.bin\" \" ${ MANIFEST } .tbz.sha256\" Success Verified OK Info On the secure build server, the .tbz manifest file was hashed and then signed by the manifest private key which only exists on the server (inside its secure environment). Here, you are using the matching public key you received from the secure build server (using a mutual tls connection) in step 4 to \"undo\" this signature to reveal the original hash of the file. We then compare this hash to the hash of the file we have using the above verify command. Verification OK means they are the same, implying that the .tbz file we have now was the same one that was signed by the manifest private key inside the safe confines of the secure build server. Note In this case, we are double hashing the .tbz file on the signature side which is why we hash the .tbz before the verify command here. Untar and unzip the manifest .tbz file into the manifest_files directory. tar -xjf \" ${ MANIFEST } .tbz\" -C \" ${ SB_DIR } /manifest/manifest_files\" Change into the manifest_files directory with your manifest files and view the files in the directory. cd \" ${ SB_DIR } /manifest/manifest_files\" && ls Example Output data git root_ssh Manifest explanation This manifest package contains three directories as shown above. The data directory contains the build.json (containing the build status of the directory updated after the image was pushed to its Docker Registry) and build.log (containing the logs from the secure build). The git directory contains the source code used for the build (cloned from git). Finally, the root_ssh directory contains any ssh material provided (if the user chose to use ssh) which is empty for us because we didn't enable ssh and provide ssh keys. This way no one can ssh into our secure build container. What does this give me? This gives you a way to see the collection of files used for your build at the time of the build and signed by the manifest private key which is secured in your secure build container. By retrieving the public key and verifying the signature of the package we and auditors can verify what was used for our secure image build. (Since the private key was generated in the secure build server we can trust it) This gives us verification of what was used in the build as well as the verification of the images themselves we get from Docker Content Trust . Note The secure build server also generates the keys for Docker Content Trust and stores them safely to provide a secure root of trust. Remember the secure build server is running as a Hyper Protect Virtual Server and thus inherits all of the security features and assurances of Hyper Protect Virtual Servers. Summary \u00b6 Congratulations!!! You have securely built your application and are ready to deploy it into a Hyper Protect Virtual Server in the next section.","title":"Securely Build your Application"},{"location":"securebuild-lab/build/#securely-build-your-application","text":"","title":"Securely Build your Application"},{"location":"securebuild-lab/build/#export-variables-set-in-previous-sections-to-current-terminal-session","text":"Source bashrc to set necessary variables if unset source \" ${ HOME } /.bashrc\"","title":"Export Variables set in previous sections to current terminal session"},{"location":"securebuild-lab/build/#create-repository-registration-gpg-signing-key","text":"Set key name export keyName = \"secure_bitcoin_key ${ RANDOM } \" Info ${RANDOM} stores a pseudo-random number to use since GPG keys on a system must each have a unique key name (uid). This will make sure users can safely re-run commands for multiple runs if they so choose. Set key passphrase Command Syntax export passphrase = \"your_passphrase\" Example Command export passphrase = \"most_secure_pw_i_could_think_of\" Create directory to store Docker repository registration signing key material mkdir -p \" ${ SB_DIR } /registration_keys\" Create Key Definition cat > \" ${ SB_DIR } /registration_keys/ ${ keyName } _definition_keys\" <<EOF %echo Generating registration definition key Key-Type: RSA Key-Length: 4096 Subkey-Type: RSA Subkey-Length: 4096 Name-Real: ${keyName} Expire-Date: 0 Passphrase: ${passphrase} # Do a commit here, so that we can later print \"done\" :-) %commit %echo done EOF Generate Key pair gpg --armor --batch \\ --generate-key \" ${ SB_DIR } /registration_keys/ ${ keyName } _definition_keys\" Example Output gpg: directory '/home/multiarch-lab/.gnupg' created gpg: keybox '/home/multiarch-lab/.gnupg/pubring.kbx' created gpg: Generating registration definition key gpg: /home/multiarch-lab/.gnupg/trustdb.gpg: trustdb created gpg: key 7E05CE05DFEBA2BC marked as ultimately trusted gpg: directory '/home/multiarch-lab/.gnupg/openpgp-revocs.d' created gpg: revocation certificate stored as '/home/multiarch-lab/.gnupg/openpgp-revocs.d/27FB55DC5F7FDF0598C9B1007E05CE05DFEBA2BC.rev' gpg: done Export Private key gpg --armor --pinentry-mode = loopback --passphrase \" ${ passphrase } \" \\ --export-secret-keys \" ${ keyName } \" > \" ${ SB_DIR } /registration_keys/ ${ keyName } .private\" Export Public key gpg --armor --export ${ keyName } > \" ${ SB_DIR } /registration_keys/ ${ keyName } .pub\" List newly generated key files ls ${ SB_DIR } /registration_keys/ Example Output secure_bitcoin_key_definition_keys secure_bitcoin_key.pub secure_bitcoin_key.private","title":"Create repository registration GPG signing key"},{"location":"securebuild-lab/build/#set-build-configuration","text":"Set Secure Build Lab IP Address export SB_IP = 192 .168.22.80 Save Secure Build Lab IP Address for later use echo \"export SB_IP=' ${ SB_IP } '\" >> \" ${ HOME } /.bashrc\" Set Secure Build GitHub repository export GH_REPO = \"git@github.com:IBM/secure-bitcoin-wallet.git\" Set Docker Image Name export IMAGE_NAME = \"hpvs_bc\" Set repository registration name export REPO_ID = \" ${ IMAGE_NAME } _ ${ HPVS_NUMBER } \" Save repository registration name for later use echo \"export REPO_ID=' ${ REPO_ID } '\" >> \" ${ HOME } /.bashrc\" Create config file cat > \"${SB_DIR}/sb_config.yaml\" <<EOF secure_build_workers: sbs: url: 'https://${SB_IP}' port: '${SB_PORT}' cert_path: '${SB_DIR}/sbs_keys/sbs.cert' key_path: '${SB_DIR}/sbs_keys/sbs.key' regfile: id: '${REPO_ID}' github: url: '${GH_REPO}' branch: 'master' ssh_private_key_path: '${GITHUB_SSH_KEY}' recurse_submodules: 'False' dockerfile_path: './Dockerfile' docker_build_path: './' docker: push_server: '${REGISTRY_NAME}' #base_server: '${REGISTRY_NAME}' pull_server: '${REGISTRY_NAME}' repo: '${DOCKER_USERNAME}/${IMAGE_NAME}' image_tag_prefix: 'latest' content_trust_base: 'False' env: whitelist: [] build: args: [] signing_key: private_key_path: '${SB_DIR}/registration_keys/${keyName}.private' public_key_path: '${SB_DIR}/registration_keys/${keyName}.pub' EOF 8. Continue to the Build Application section if you are launching secure build for the first time or the Troubleshooting Secure Build section if things didn't go as planned your first go-round and you are trying to get back on the right track.","title":"Set Build Configuration"},{"location":"securebuild-lab/build/#build-application","text":"Initialize Secure Build Hyper Protect Virtual server with configuration file generated in the Set Build Configuration section hpvs sb init --config \" ${ SB_DIR } /sb_config.yaml\" Example Output { \"status\" : \"OK\" } Launch secure build with a timeout of 20 minutes (1200 seconds) to complete using the configuration file generated in the Set Build Configuration section hpvs sb build \\ --timeout 1200 \\ --config \" ${ SB_DIR } /sb_config.yaml\" Tip The following build will take anywhere from 15-20 minutes to complete. While this is ongoing, you should open a new tab in your terminal to check the automatically updating logs and build status (steps for doing this are detailed in the next few steps). If this command times out please check the status in the step 3 to make sure nothing went wrong. It might just be that your build took to long and everything will be ok. If something did go wrong, visit the Troubleshooting Secure Build section Note The secure build is asynchronous so if the command gets interrupted here don't worry! Warning If the secure build command gets an error this command will keep on waiting until eventually timing out. If you see an error in the status you can interrupt this command with ctrl+c instead of waiting for it to time out. Example Output after running 15-20 minutes to completion +--------+-------------------------+ | status | OK: async build started | +--------+-------------------------+ ############################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################## +---------------------+--------------------------------------------------------------------------------------------+ | root_ssh_enabled | false | | status | success | | build_name | docker.io.gmoney23.hpvs_bc_a.latest-b3416d8.2020-06-23_22-12-54.183641 | | image_tag | latest-b3416d8 | | manifest_key_gen | soft_crypto | | manifest_public_key | manifest.docker.io.gmoney23.hpvs_bc_a.latest-b3416d8.2020-06-23_22-12-54.183641-public.pem | +---------------------+--------------------------------------------------------------------------------------------+ Please look at the logs in another terminal window while the secure build is running (don't interrupt the current terminal window which is waiting for the secure build) hpvs sb log --config \" ${ SB_DIR } /sb_config.yaml\" Example Truncated Output 2020-06-23 05:25:42,453 root INFO starting a build 2020-06-23 05:25:42,454 root INFO cleaning up the local github repo and the github access credential 2020-06-23 05:25:42,454 root INFO github_dir=secure-bitcoin-wallet 2020-06-23 05:25:42,454 root INFO cloning a github repo 2020-06-23 05:25:42,454 root INFO github_host=github.com 2020-06-23 05:25:42,454 root INFO cmd=ssh-keyscan github.com 2020-06-23 05:25:47,659 root INFO # github.com:22 SSH-2.0-babeld-7c96ae41 # github.com:22 SSH-2.0-babeld-b6072416 # github.com:22 SSH-2.0-babeld-b6072416 github.com ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAq2A7hRGmdnm9tUDbO9IDSwBK6TbQa+PXYPCPy6rbTrTtw7PHkccKrpp0yVhp5HdEIcKr6pL ..... You can also look at the secure build status in another window. This can be useful if you accidentally interrupted the secure build command or it times out due to the timeout not being long enough. It will also fill out the additional fields that are initially blank when the build completes (such as build_name and manifest_public_key , etc.). hpvs sb status --config \" ${ SB_DIR } /sb_config.yaml\" Example Output +---------------------+---------------+ | manifest_public_key | | | root_ssh_enabled | false | | status | github cloned | | build_name | | | image_tag | | | manifest_key_gen | | +---------------------+---------------+ If you see an error in your status If you see that your build ran into an error please visit the Troubleshooting Secure Build section You can continue to check the logs to monitor the progress of your secure build with the previous logs command hpvs sb log --config \" ${ SB_DIR } /sb_config.yaml\" When the secure build successfully completes, it will have ending logs similar to the following: Example Output 2020 -06-23 08 :39:46,463 root INFO run: latest: digest: sha256:ffbaf396807659d5a4d66fe54c0ebf382a9f170c4eaf187b9b4c8582ca8fdec2 size: 5133 2020 -06-23 08 :39:46,463 root INFO run: Signing and pushing trust metadata 2020 -06-23 08 :39:48,299 root INFO run: Successfully signed docker.io/gmoney23/hpvs_bc:latest 2020 -06-23 08 :39:48,300 root INFO run: return code = 0 2020 -06-23 08 :39:48,300 root INFO extracting an image keyid and key 2020 -06-23 08 :39:48,301 root INFO keyid = 0cc264a565c452ea6aca776b2787be54e94b905113e77edae00d5ec267a07ffc 2020 -06-23 08 :39:48,301 root INFO publickey = LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJmVENDQVNTZ0F3SUJBZ0lSQUt3cTlRWEZhMzRYMXdIRmZST2NJZXN3Q2dZSUtvWkl6ajBFQXdJd0pURWoKTUNFR0ExVUVBd3dhWkc5amEyVnlMbWx2TDJkdGIyNWxlVEl6TDJod2RuTmZZbU13SGhjTk1qQXdOakl6TURnegpPVFF4V2hjTk16QXdOakl4TURnek9UUXhXakFsTVNNd0lRWURWUVFEREJwa2IyTnJaWEl1YVc4dloyMXZibVY1Ck1qTXZhSEIyYzE5aVl6QlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJKU3ZPdWlSaHJNcjJmQVYKcmZLcHZncVRYNXZwSFlodnEvZXc1SFRuMzRMcnBrQ0xJMjBkdmxjcTUyc1ZvQjVxYkpzeEdTbkphOU5sM0tYYQpZUlRjQ2Z1ak5UQXpNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WSFNVRUREQUtCZ2dyQmdFRkJRY0RBekFNCkJnTlZIUk1CQWY4RUFqQUFNQW9HQ0NxR1NNNDlCQU1DQTBjQU1FUUNJRlhFWE9iZTdHR1NsSjEzTzZicTR6T0IKamhoMlZSbmRYOVJYMytrSFpnVVVBaUJBWXAyNTkwTkpVelJIK1lhR2JzQ1hMRmxOUWRzT2ltWW9NMzlqR0IwRAp5dz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K 2020 -06-23 08 :39:48,301 root INFO generating a config file 2020 -06-23 08 :39:48,301 root INFO create_and_push: SoftCrypto 2020 -06-23 08 :39:48,819 root INFO digest = 1f0b1f65b1462f16930b200c77ce5fbe654e1d624405bc243d713de1aade36b7 2020 -06-23 08 :39:48,819 root INFO block_size = 64 2020 -06-23 08 :39:48,821 root INFO digest = 1f0b1f65b1462f16930b200c77ce5fbe654e1d624405bc243d713de1aade36b7 2020 -06-23 08 :39:48,824 root INFO signature = 114157a8bd98d7f5a5c2ca33f81496563af7f18d23123fc35c8aa84a5bfadc709ecb17e5e79d42d6bd6ac8a815053d9cfd039b7f01ab84b9a75a23e2917b0bc4f0c1b5bd5664dfebd573c2355c34115762b8fea56285d65cd8db4877c9b95ab3149b65d14ce1a23b1065a34c2d4ba9a1526286a03d87d307a5972cf1425e586c9d213b34fe53407c79a527e78779b7a70b426516db35f22a09329dfac76a8505613249ad2b46070ad7d932a8c4bbe1981d0370150528cb9e6f5a426be6734405435393a8d6d8e145418398f85bc28be6c332d2fa2e84f5465618051b110a3efcd25600dc95ee0d7f8bc0d36b8ddaa9ce1c4be78f38928d9213e5171078e22930 2020 -06-23 08 :39:48,824 root INFO verify = OK 2020 -06-23 08 :39:49,214 root WARNING undefined MANIFEST_BUCKET_NAME 2020 -06-23 08 :39:49,214 root WARNING skipping transferring a manifest to COS 2020 -06-23 08 :39:49,214 root INFO cleaning up the build environment 2020 -06-23 08 :39:49,214 root INFO github_dir = secure-bitcoin-wallet 2020 -06-23 08 :39:49,217 root INFO completed a build When the secure build successfully completes, you can check the status again to see a completed status. hpvs sb status --config \" ${ SB_DIR } /sb_config.yaml\" Example Output +---------------------+------------------------------------------------------------------------------------------+ | build_name | docker.io.gmoney23.hpvs_bc.latest-b3416d8.2020-06-23_08-39-48.301849 | | image_tag | latest-b3416d8 | | manifest_key_gen | soft_crypto | | manifest_public_key | manifest.docker.io.gmoney23.hpvs_bc.latest-b3416d8.2020-06-23_08-39-48.301849-public.pem | | root_ssh_enabled | false | | status | success | +---------------------+------------------------------------------------------------------------------------------+ If you see an error in your status If you see that your build ran into an error please visit the Troubleshooting Secure Build section From the original terminal window that you ran hpvs sb init , output the repository registration file. echo \" ${ passphrase } \" | hpvs sb regfile \\ --config \" ${ SB_DIR } /sb_config.yaml\" \\ --out \" ${ SB_DIR } /yaml. ${ REPO_ID } .enc\" Example Output Enter Sigining Private key passphrase: Tip The echo command takes care of the passphrase so you don't need to enter it manually. Warning If you run this command from a terminal window where you did not set the passphrase environment variable you will get an error saying openpgp: invalid data: private key checksum failure . You can also check to make sure you are in the right terminal window by running echo \"${passphrase}\" and the output should be the passphrase you set in the beginning of the \"Create repository registration GPG signing key\" section.","title":"Build Application"},{"location":"securebuild-lab/build/#troubleshooting-secure-build","text":"Troubleshooting Instructions If your build completed successfully, feel free to SKIP this section If your build failed continue for instructions on how to find the happy path yet again. If at any point you see an error in the status command you will need to restart your build with the following steps. If the secure build command is still running in its own window please interrupt it with ctrl + c Check the logs for more error information using: hpvs sb log --config \" ${ SB_DIR } /sb_config.yaml\" Correct whatever information was incorrect and go back through the steps in the Set Build Configuration section Clean up the data (i.e. logs) from the old build with: hpvs sb clean --config \" ${ SB_DIR } /sb_config.yaml\" Update the secure build server with the new configuration hpvs sb update --config \" ${ SB_DIR } /sb_config.yaml\" Continue onward like you just initialized your build server (You did ... just for another time ) at Step 2 in the Build Application Section Info The next command you should run will be hpvs sb build ( Step 2 in the Build Application Section )","title":"Troubleshooting Secure Build"},{"location":"securebuild-lab/build/#verify-your-application","text":"Create directories for your manifest file information and change into your new manifest directory. mkdir -p \" ${ SB_DIR } /manifest/manifest_files\" && cd \" ${ SB_DIR } /manifest\" Save the build name from the status command as a variable export BUILD_NAME = \" $( hpvs sb status --config \" ${ SB_DIR } /sb_config.yaml\" \\ | grep build_name | egrep -ow 'docker.*[[:digit:]]' ) \" && echo \" ${ BUILD_NAME } \" Example Output docker.io.gmoney23.hpvs_bc.latest-b3416d8.2020-06-23_08-39-48.301849 Get your application manifest hpvs sb manifest --config \" ${ SB_DIR } /sb_config.yaml\" --name \" ${ BUILD_NAME } \" Get your manifest public verification key hpvs sb pubkey --config \" ${ SB_DIR } /sb_config.yaml\" --name \" ${ BUILD_NAME } \" Info Connections to the secure build server are secured using mutual tls. This means that proper certificates and keys have to be used on the client side to access these files (as well as when doing the previous secure build commands). This adds a layer of security to make sure that the public key and manifest files are authentic and securely distributed. Check that your application manifest and signing key were retrieved ls Example Output docker.io.gmoney23.hpvs_bc_a.latest-b3416d8.2020-06-23_22-12-54.183641-public.pem manifest.docker.io.gmoney23.hpvs_bc_a.latest-b3416d8.2020-06-23_22-12-54.183641.sig.tbz manifest_files Set MANIFEST to point to your manifest files. export MANIFEST = \" ${ SB_DIR } /manifest/manifest. ${ BUILD_NAME } \" Set MAN_PUBKEY to point to your manifest public key. export MAN_PUBKEY = \" ${ SB_DIR } /manifest/ ${ BUILD_NAME } -public.pem\" Untar and unzip the manifest .sig.tbz file to reveal the .sig and .tbz files (and remove the original .sig.tbz ) tar -xjvf \" ${ MANIFEST } .sig.tbz\" && rm \" ${ MANIFEST } .sig.tbz\" Example Output manifest.docker.io.gmoney23.hpvs_bc_a.latest-b3416d8.2020-06-23_22-12-54.183641.tbz manifest.docker.io.gmoney23.hpvs_bc_a.latest-b3416d8.2020-06-23_22-12-54.183641.sig Note The .sig.tbz was a tarball compressed using bzip2 compression of both a nested .tbz file (containing the manifest files) and a .sig file containing a signature of the nested .tbz to verify it with the public key retrieved using the hpvs sb pubkey command above saved in the file referenced by MAN_PUBKEY . Convert the signature file to binary format cat \" ${ MANIFEST } .sig\" | xxd -r -p > \" ${ MANIFEST } .sig.bin\" Hash ( SHA256 ) the manifest .tbz file (containing the manifest files) openssl dgst -sha256 -binary -out \" ${ MANIFEST } .tbz.sha256\" \" ${ MANIFEST } .tbz\" Verify that the .tbz manifest package was the one signed on the secure build server. openssl dgst -sha256 -verify \" ${ MAN_PUBKEY } \" \\ -signature \" ${ MANIFEST } .sig.bin\" \" ${ MANIFEST } .tbz.sha256\" Success Verified OK Info On the secure build server, the .tbz manifest file was hashed and then signed by the manifest private key which only exists on the server (inside its secure environment). Here, you are using the matching public key you received from the secure build server (using a mutual tls connection) in step 4 to \"undo\" this signature to reveal the original hash of the file. We then compare this hash to the hash of the file we have using the above verify command. Verification OK means they are the same, implying that the .tbz file we have now was the same one that was signed by the manifest private key inside the safe confines of the secure build server. Note In this case, we are double hashing the .tbz file on the signature side which is why we hash the .tbz before the verify command here. Untar and unzip the manifest .tbz file into the manifest_files directory. tar -xjf \" ${ MANIFEST } .tbz\" -C \" ${ SB_DIR } /manifest/manifest_files\" Change into the manifest_files directory with your manifest files and view the files in the directory. cd \" ${ SB_DIR } /manifest/manifest_files\" && ls Example Output data git root_ssh Manifest explanation This manifest package contains three directories as shown above. The data directory contains the build.json (containing the build status of the directory updated after the image was pushed to its Docker Registry) and build.log (containing the logs from the secure build). The git directory contains the source code used for the build (cloned from git). Finally, the root_ssh directory contains any ssh material provided (if the user chose to use ssh) which is empty for us because we didn't enable ssh and provide ssh keys. This way no one can ssh into our secure build container. What does this give me? This gives you a way to see the collection of files used for your build at the time of the build and signed by the manifest private key which is secured in your secure build container. By retrieving the public key and verifying the signature of the package we and auditors can verify what was used for our secure image build. (Since the private key was generated in the secure build server we can trust it) This gives us verification of what was used in the build as well as the verification of the images themselves we get from Docker Content Trust . Note The secure build server also generates the keys for Docker Content Trust and stores them safely to provide a secure root of trust. Remember the secure build server is running as a Hyper Protect Virtual Server and thus inherits all of the security features and assurances of Hyper Protect Virtual Servers.","title":"Verify your application"},{"location":"securebuild-lab/build/#summary","text":"Congratulations!!! You have securely built your application and are ready to deploy it into a Hyper Protect Virtual Server in the next section.","title":"Summary"},{"location":"securebuild-lab/cleanup/","text":"Clean up your Environment \u00b6 Export Variables set in previous sections to current terminal session \u00b6 Source bashrc to set necessary variables if unset source \" ${ HOME } /.bashrc\" Cleanup Secure Build Server \u00b6 Cleanup virtual server hpvs vs delete --name sbserver_ ${ HPVS_NUMBER } Cleanup Quotagroup hpvs quotagroup delete --name \"sb_user ${ HPVS_NUMBER } \" Cleanup Application \u00b6 Cleanup HPVS deployment hpvs vs delete --name ${ REPO_ID } Cleanup Quotagroup hpvs quotagroup delete --name \" ${ REPO_ID } \" Cleanup Repository \u00b6 hpvs repository delete --id ${ REPO_ID } Example Output +-------------------+-----------------------------------------------------------------------------------------------------------------------------+ | ContainersDeleted | [] | | ImagesDeleted | map [ Deleted: [ sha256:5c0129df1b5ccb333a4dea9ed5a880cbc15654a9c1d5e32bb4e183072ce7b021 ] Untagged: [ gmoney23/hpvs_bc_a:latest ]] | | RepositoryDeleted | docker.io/gmoney23/hpvs_bc_a | +-------------------+-----------------------------------------------------------------------------------------------------------------------------+ Cleanup Docker Token \u00b6 Delete the existing Docker Token by logging into your Docker Hub account and following these instructions Cleanup GitHub ssh key \u00b6 Delete the ssh key you added for the lab following steps 1-3 of these instructions Cleanup Lab directory \u00b6 You can remove the directory you stored your files in throughout the lab. This is a personal choice as the lab machine will be deleted after the lab anyway. rm -rf \" ${ SB_DIR } \"","title":"Clean up your Environment"},{"location":"securebuild-lab/cleanup/#clean-up-your-environment","text":"","title":"Clean up your Environment"},{"location":"securebuild-lab/cleanup/#export-variables-set-in-previous-sections-to-current-terminal-session","text":"Source bashrc to set necessary variables if unset source \" ${ HOME } /.bashrc\"","title":"Export Variables set in previous sections to current terminal session"},{"location":"securebuild-lab/cleanup/#cleanup-secure-build-server","text":"Cleanup virtual server hpvs vs delete --name sbserver_ ${ HPVS_NUMBER } Cleanup Quotagroup hpvs quotagroup delete --name \"sb_user ${ HPVS_NUMBER } \"","title":"Cleanup Secure Build Server"},{"location":"securebuild-lab/cleanup/#cleanup-application","text":"Cleanup HPVS deployment hpvs vs delete --name ${ REPO_ID } Cleanup Quotagroup hpvs quotagroup delete --name \" ${ REPO_ID } \"","title":"Cleanup Application"},{"location":"securebuild-lab/cleanup/#cleanup-repository","text":"hpvs repository delete --id ${ REPO_ID } Example Output +-------------------+-----------------------------------------------------------------------------------------------------------------------------+ | ContainersDeleted | [] | | ImagesDeleted | map [ Deleted: [ sha256:5c0129df1b5ccb333a4dea9ed5a880cbc15654a9c1d5e32bb4e183072ce7b021 ] Untagged: [ gmoney23/hpvs_bc_a:latest ]] | | RepositoryDeleted | docker.io/gmoney23/hpvs_bc_a | +-------------------+-----------------------------------------------------------------------------------------------------------------------------+","title":"Cleanup Repository"},{"location":"securebuild-lab/cleanup/#cleanup-docker-token","text":"Delete the existing Docker Token by logging into your Docker Hub account and following these instructions","title":"Cleanup Docker Token"},{"location":"securebuild-lab/cleanup/#cleanup-github-ssh-key","text":"Delete the ssh key you added for the lab following steps 1-3 of these instructions","title":"Cleanup GitHub ssh key"},{"location":"securebuild-lab/cleanup/#cleanup-lab-directory","text":"You can remove the directory you stored your files in throughout the lab. This is a personal choice as the lab machine will be deleted after the lab anyway. rm -rf \" ${ SB_DIR } \"","title":"Cleanup Lab directory"},{"location":"securebuild-lab/create-server/","text":"Create your HPVS Secure Build Server \u00b6 Export Variables set in previous sections to current terminal session \u00b6 Source bashrc to set necessary variables if unset source \" ${ HOME } /.bashrc\" Create Certificate and Key for mutual tls \u00b6 Generate rand file openssl rand -out \" ${ HOME } /.rnd\" -hex 256 Make SB_DIR/sbs_keys directory to store secure build server keys. mkdir -p \" ${ SB_DIR } /sbs_keys\" Generate cert and key to use mutual tls openssl req -newkey rsa:2048 \\ -new -nodes -x509 \\ -days 3650 \\ -out \" ${ SB_DIR } /sbs_keys/sbs.cert\" \\ -keyout \" ${ SB_DIR } /sbs_keys/sbs.key\" \\ -subj \"/C=US/O=IBM/CN=hpvs.example.com\" Example Output Generating a RSA private key ................................+++++ ...............................+++++ writing new private key to '/home/multiarch-lab/securebuild-lab/sbs_keys/sbs.key' ----- Change cert to base64 encoding and save to new file. echo $( cat \" ${ SB_DIR } /sbs_keys/sbs.cert\" | base64 ) \\ | tr -d ' ' > \" ${ SB_DIR } /sbs_keys/sbs_base64.cert\" Save the cert as an environment variable export cert = $( cat \" ${ SB_DIR } /sbs_keys/sbs_base64.cert\" ) Check your cert with: echo $cert It should be long and have no spaces LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURUVENDQWpXZ0F3SUJBZ0lVUERITlQ3Y3YrZWNzZ1Y0QnZHSmhhaVAyOERnd0RRWUpLb1pJaHZjTkFRRUwKQlFBd05qRUxNQWtHQTFVRUJoTUNWVk14RERBS0JnTlZCQW9NQTBsQ1RURVpNQmNHQTFVRUF3d1FhSEIyY3k1bAplR0Z0Y0d4bExtTnZiVEFlRncweU1EQTJNall3TXpVM016RmFGdzB6TURBMk1qUXdNelUzTXpGYU1EWXhDekFKCkJnTlZCQVlUQWxWVE1Rd3dDZ1lEVlFRS0RBTkpRazB4R1RBWEJnTlZCQU1NRUdod2RuTXVaWGhoYlhCc1pTNWoKYjIwd2dnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUURWbTBveGI5N3pnYTc2REtwWAptSC9XaWh0OGJCOUZMMEY0U3dxRjdhQ3I4RkZBUHhIYnFieVQvTVhZcVYwdGlWU1JNSHhDd2hhR1FlSXJhWDlKCjRVZ2FCaUEwQ2krWVFZWmF1SXcvVmI4SEtUYkxERC9SblMwai9SSFk1Tzl1TXJ3NXNpQzBydElTRXBwa1VFdFEKWGZTdGFDMU82bmlLUXY1NDZkRGdRRmVGbUI5WHZVeHdzK2pES1g4aW1XaWhIeERLYVN1cEkwRk9JQ094dVhVWQpZSTVPeWVrbDVNaGttMitVTjhFekowY3JtSGJTQnh2Rlg2amh4UkhWNTd6VjR2Tm5VTGQwL1ZCNTBxZ2ZtcmVPCk5PMUJOMGtOMk1vV1N1R3lRdDZNS0NvSHAyUzgxTmJMcXRERndjMkxtbGxkc21hVEFqTVdkTjFyNjlXdVlkTmUKYjlJaEFnTUJBQUdqVXpCUk1CMEdBMVVkRGdRV0JCVFMrNEJKTUhZbG9RS2kvZjVlR2N1MDg3U3Q4VEFmQmdOVgpIU01FR0RBV2dCVFMrNEJKTUhZbG9RS2kvZjVlR2N1MDg3U3Q4VEFQQmdOVkhSTUJBZjhFQlRBREFRSC9NQTBHCkNTcUdTSWIzRFFFQkN3VUFBNElCQVFDQk9KdjVkbllLSUpmdXQ3VlVyWS9FYThzby9oaDhTdTQwK0NoRTYreVcKazFPSkV6NnorU3FrTFlwZ0hqV1JQL1VVY3ZzdCtnZVVNR2dZeThCZ01HaGFRVUdESm9NYzdvcDcyN2w1akdMcApjWGE3cDU0aWtqYnN3QzllL000a0tKRVVRWTEyUU42TDQrVDZBRUtZcnRUVnZCMURGLzhndW9ZNjFLbDEzOVNFCmVockllWGE4THVGTmY3STc1bHpJZHpTSHpieXp0empUeW9IYTN1cmloNUNnMkhISkpsTXlNaVIwQUVKMURMQmMKMmo0SFp2V0hrYWZaTEtuRnBKUHJNa01DSXpwdFQ1SnlHOW5pUlh3RmkxdzR6UDlJRHBCRVh1UGNuU1ZacFJFawpRSHNrSzY1Nm1xRndvY2pBMXNSMmZjS1pUbkJjMlhmM0NUelVxSVoyYStSVQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg== Set your provided number and save it for later use \u00b6 You will be assigned a number for the lab so as not to interfere with other users. Note This table tells you which number you are assigned. Set the HPVS_NUMBER variable with your assigned 2 digit number Command Syntax export HPVS_NUMBER = \"your_assigned_number\" Example Command export HPVS_NUMBER = \"00\" Warning Your user will NOT be 00 . Please set the appropriate user you have been assigned. Save your number to bashrc for later use. echo \"export HPVS_NUMBER=' ${ HPVS_NUMBER } '\" >> \" ${ HOME } /.bashrc\" 3. Set Secure Build Server Port export SB_PORT = 300 ${ HPVS_NUMBER } Save SB_PORT to bashrc for later use. echo \"export SB_PORT=' ${ SB_PORT } '\" >> \" ${ HOME } /.bashrc\" Create Quotagroup with storage for secure build server \u00b6 hpvs quotagroup create --name \"sb_user ${ HPVS_NUMBER } \" --size = 30GB Example Ouput +-------------+--------------+ | name | sb_user00 | | filesystem | btrfs | | passthrough | false | | pool_id | lv_data_pool | | size | 30GB | | available | 30GB | | containers | [] | +-------------+--------------+ Create Securebuild server \u00b6 hpvs vs create --name sbserver_ ${ HPVS_NUMBER } --repo SecureDockerBuild \\ --tag 1 .2.1-release-9b63b43 --cpu 2 --ram 2048 \\ --quotagroup \"{quotagroup = sb_user ${ HPVS_NUMBER } , mountid = new, mount = /newroot, filesystem = ext4, size = 10GB}\" \\ --quotagroup \"{quotagroup = sb_user ${ HPVS_NUMBER } , mountid = data, mount = /data, filesystem = ext4, size = 2GB}\" \\ --quotagroup \"{quotagroup = sb_user ${ HPVS_NUMBER } , mountid = docker, mount = /docker, filesystem = ext4, size = 16GB}\" \\ --env ={ EX_VOLUMES = \"/docker,/data\" ,ROOTFS_LOCK = y,CLIENT_CRT = $cert } \\ --ports \"{containerport = 443, protocol = tcp, hostport = ${ SB_PORT } }\" Example Output \u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502 PROPERTIES \u2502 VALUES \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 Name \u2502 sbserver_00 \u2502 \u2502 Status \u2502 Up Less than a second \u2502 \u2502 CPU \u2502 2 \u2502 \u2502 Memory \u2502 2048 \u2502 \u2502 Networks \u2502 Network:bridge \u2502 \u2502 \u2502 IPAddress:172.31.0.5 \u2502 \u2502 \u2502 Gateway:172.31.0.1 \u2502 \u2502 \u2502 Subnet:16 \u2502 \u2502 \u2502 MacAddress:02:42:ac:1f:00:05 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 Ports \u2502 LocalPort:443/tcp \u2502 \u2502 \u2502 GuestPort:30000 \u2502 \u2502 \u2502 \u2502 \u2502 Quotagroups \u2502 appliance_data \u2502 \u2502 \u2502 sb_user00 \u2502 \u2502 \u2502 \u2502 \u2502 State \u2502 running \u2502 \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f We can see the quotagroup is now being used with hpvs quotagroup show --name \"sb_user ${ HPVS_NUMBER } \" Example Output +-------------+--------------------------------+ | PROPERTIES | VALUES | +-------------+--------------------------------+ | name | sb_user00 | | filesystem | btrfs | | passthrough | false | | pool_id | lv_data_pool | | size | 30GB | | available | 2GB | | containers | Container:sbserver_00 | | | Mountids: \"new\" , \"data\" , \"docker\" | | | | | | | +-------------+--------------------------------+ The show output for the Hyper Protect Virtual Server was shown when it was deployed but we can bring it back up with hpvs vs show --name \"sbserver_ ${ HPVS_NUMBER } \" Example Output \u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502 PROPERTIES \u2502 VALUES \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 Name \u2502 sbserver_00 \u2502 \u2502 Status \u2502 Up About a minute \u2502 \u2502 CPU \u2502 2 \u2502 \u2502 Memory \u2502 2048 \u2502 \u2502 Networks \u2502 Network:bridge \u2502 \u2502 \u2502 IPAddress:172.31.0.5 \u2502 \u2502 \u2502 Gateway:172.31.0.1 \u2502 \u2502 \u2502 Subnet:16 \u2502 \u2502 \u2502 MacAddress:02:42:ac:1f:00:05 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 Ports \u2502 LocalPort:443/tcp \u2502 \u2502 \u2502 GuestPort:30000 \u2502 \u2502 \u2502 \u2502 \u2502 Quotagroups \u2502 appliance_data \u2502 \u2502 \u2502 sb_user00 \u2502 \u2502 \u2502 \u2502 \u2502 State \u2502 running \u2502 \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f Your secure build server is now up and running! It is available at the IP Address of the Hyper Protect Virtual Server LPAR and port (GuestPort) specified. You will use this secure build server to securely build your application in the next section. Note You can assign IP addresses and hostnames for containers as necessary for your purposes but using the docker network and host ports is a nice way to quickly get running without having to use up IP addresses on your network.","title":"Create your HPVS Secure Build Server"},{"location":"securebuild-lab/create-server/#create-your-hpvs-secure-build-server","text":"","title":"Create your HPVS Secure Build Server"},{"location":"securebuild-lab/create-server/#export-variables-set-in-previous-sections-to-current-terminal-session","text":"Source bashrc to set necessary variables if unset source \" ${ HOME } /.bashrc\"","title":"Export Variables set in previous sections to current terminal session"},{"location":"securebuild-lab/create-server/#create-certificate-and-key-for-mutual-tls","text":"Generate rand file openssl rand -out \" ${ HOME } /.rnd\" -hex 256 Make SB_DIR/sbs_keys directory to store secure build server keys. mkdir -p \" ${ SB_DIR } /sbs_keys\" Generate cert and key to use mutual tls openssl req -newkey rsa:2048 \\ -new -nodes -x509 \\ -days 3650 \\ -out \" ${ SB_DIR } /sbs_keys/sbs.cert\" \\ -keyout \" ${ SB_DIR } /sbs_keys/sbs.key\" \\ -subj \"/C=US/O=IBM/CN=hpvs.example.com\" Example Output Generating a RSA private key ................................+++++ ...............................+++++ writing new private key to '/home/multiarch-lab/securebuild-lab/sbs_keys/sbs.key' ----- Change cert to base64 encoding and save to new file. echo $( cat \" ${ SB_DIR } /sbs_keys/sbs.cert\" | base64 ) \\ | tr -d ' ' > \" ${ SB_DIR } /sbs_keys/sbs_base64.cert\" Save the cert as an environment variable export cert = $( cat \" ${ SB_DIR } /sbs_keys/sbs_base64.cert\" ) Check your cert with: echo $cert It should be long and have no spaces LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURUVENDQWpXZ0F3SUJBZ0lVUERITlQ3Y3YrZWNzZ1Y0QnZHSmhhaVAyOERnd0RRWUpLb1pJaHZjTkFRRUwKQlFBd05qRUxNQWtHQTFVRUJoTUNWVk14RERBS0JnTlZCQW9NQTBsQ1RURVpNQmNHQTFVRUF3d1FhSEIyY3k1bAplR0Z0Y0d4bExtTnZiVEFlRncweU1EQTJNall3TXpVM016RmFGdzB6TURBMk1qUXdNelUzTXpGYU1EWXhDekFKCkJnTlZCQVlUQWxWVE1Rd3dDZ1lEVlFRS0RBTkpRazB4R1RBWEJnTlZCQU1NRUdod2RuTXVaWGhoYlhCc1pTNWoKYjIwd2dnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUURWbTBveGI5N3pnYTc2REtwWAptSC9XaWh0OGJCOUZMMEY0U3dxRjdhQ3I4RkZBUHhIYnFieVQvTVhZcVYwdGlWU1JNSHhDd2hhR1FlSXJhWDlKCjRVZ2FCaUEwQ2krWVFZWmF1SXcvVmI4SEtUYkxERC9SblMwai9SSFk1Tzl1TXJ3NXNpQzBydElTRXBwa1VFdFEKWGZTdGFDMU82bmlLUXY1NDZkRGdRRmVGbUI5WHZVeHdzK2pES1g4aW1XaWhIeERLYVN1cEkwRk9JQ094dVhVWQpZSTVPeWVrbDVNaGttMitVTjhFekowY3JtSGJTQnh2Rlg2amh4UkhWNTd6VjR2Tm5VTGQwL1ZCNTBxZ2ZtcmVPCk5PMUJOMGtOMk1vV1N1R3lRdDZNS0NvSHAyUzgxTmJMcXRERndjMkxtbGxkc21hVEFqTVdkTjFyNjlXdVlkTmUKYjlJaEFnTUJBQUdqVXpCUk1CMEdBMVVkRGdRV0JCVFMrNEJKTUhZbG9RS2kvZjVlR2N1MDg3U3Q4VEFmQmdOVgpIU01FR0RBV2dCVFMrNEJKTUhZbG9RS2kvZjVlR2N1MDg3U3Q4VEFQQmdOVkhSTUJBZjhFQlRBREFRSC9NQTBHCkNTcUdTSWIzRFFFQkN3VUFBNElCQVFDQk9KdjVkbllLSUpmdXQ3VlVyWS9FYThzby9oaDhTdTQwK0NoRTYreVcKazFPSkV6NnorU3FrTFlwZ0hqV1JQL1VVY3ZzdCtnZVVNR2dZeThCZ01HaGFRVUdESm9NYzdvcDcyN2w1akdMcApjWGE3cDU0aWtqYnN3QzllL000a0tKRVVRWTEyUU42TDQrVDZBRUtZcnRUVnZCMURGLzhndW9ZNjFLbDEzOVNFCmVockllWGE4THVGTmY3STc1bHpJZHpTSHpieXp0empUeW9IYTN1cmloNUNnMkhISkpsTXlNaVIwQUVKMURMQmMKMmo0SFp2V0hrYWZaTEtuRnBKUHJNa01DSXpwdFQ1SnlHOW5pUlh3RmkxdzR6UDlJRHBCRVh1UGNuU1ZacFJFawpRSHNrSzY1Nm1xRndvY2pBMXNSMmZjS1pUbkJjMlhmM0NUelVxSVoyYStSVQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==","title":"Create Certificate and Key for mutual tls"},{"location":"securebuild-lab/create-server/#set-your-provided-number-and-save-it-for-later-use","text":"You will be assigned a number for the lab so as not to interfere with other users. Note This table tells you which number you are assigned. Set the HPVS_NUMBER variable with your assigned 2 digit number Command Syntax export HPVS_NUMBER = \"your_assigned_number\" Example Command export HPVS_NUMBER = \"00\" Warning Your user will NOT be 00 . Please set the appropriate user you have been assigned. Save your number to bashrc for later use. echo \"export HPVS_NUMBER=' ${ HPVS_NUMBER } '\" >> \" ${ HOME } /.bashrc\" 3. Set Secure Build Server Port export SB_PORT = 300 ${ HPVS_NUMBER } Save SB_PORT to bashrc for later use. echo \"export SB_PORT=' ${ SB_PORT } '\" >> \" ${ HOME } /.bashrc\"","title":"Set your provided number and save it for later use"},{"location":"securebuild-lab/create-server/#create-quotagroup-with-storage-for-secure-build-server","text":"hpvs quotagroup create --name \"sb_user ${ HPVS_NUMBER } \" --size = 30GB Example Ouput +-------------+--------------+ | name | sb_user00 | | filesystem | btrfs | | passthrough | false | | pool_id | lv_data_pool | | size | 30GB | | available | 30GB | | containers | [] | +-------------+--------------+","title":"Create Quotagroup with storage for secure build server"},{"location":"securebuild-lab/create-server/#create-securebuild-server","text":"hpvs vs create --name sbserver_ ${ HPVS_NUMBER } --repo SecureDockerBuild \\ --tag 1 .2.1-release-9b63b43 --cpu 2 --ram 2048 \\ --quotagroup \"{quotagroup = sb_user ${ HPVS_NUMBER } , mountid = new, mount = /newroot, filesystem = ext4, size = 10GB}\" \\ --quotagroup \"{quotagroup = sb_user ${ HPVS_NUMBER } , mountid = data, mount = /data, filesystem = ext4, size = 2GB}\" \\ --quotagroup \"{quotagroup = sb_user ${ HPVS_NUMBER } , mountid = docker, mount = /docker, filesystem = ext4, size = 16GB}\" \\ --env ={ EX_VOLUMES = \"/docker,/data\" ,ROOTFS_LOCK = y,CLIENT_CRT = $cert } \\ --ports \"{containerport = 443, protocol = tcp, hostport = ${ SB_PORT } }\" Example Output \u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502 PROPERTIES \u2502 VALUES \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 Name \u2502 sbserver_00 \u2502 \u2502 Status \u2502 Up Less than a second \u2502 \u2502 CPU \u2502 2 \u2502 \u2502 Memory \u2502 2048 \u2502 \u2502 Networks \u2502 Network:bridge \u2502 \u2502 \u2502 IPAddress:172.31.0.5 \u2502 \u2502 \u2502 Gateway:172.31.0.1 \u2502 \u2502 \u2502 Subnet:16 \u2502 \u2502 \u2502 MacAddress:02:42:ac:1f:00:05 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 Ports \u2502 LocalPort:443/tcp \u2502 \u2502 \u2502 GuestPort:30000 \u2502 \u2502 \u2502 \u2502 \u2502 Quotagroups \u2502 appliance_data \u2502 \u2502 \u2502 sb_user00 \u2502 \u2502 \u2502 \u2502 \u2502 State \u2502 running \u2502 \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f We can see the quotagroup is now being used with hpvs quotagroup show --name \"sb_user ${ HPVS_NUMBER } \" Example Output +-------------+--------------------------------+ | PROPERTIES | VALUES | +-------------+--------------------------------+ | name | sb_user00 | | filesystem | btrfs | | passthrough | false | | pool_id | lv_data_pool | | size | 30GB | | available | 2GB | | containers | Container:sbserver_00 | | | Mountids: \"new\" , \"data\" , \"docker\" | | | | | | | +-------------+--------------------------------+ The show output for the Hyper Protect Virtual Server was shown when it was deployed but we can bring it back up with hpvs vs show --name \"sbserver_ ${ HPVS_NUMBER } \" Example Output \u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502 PROPERTIES \u2502 VALUES \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 Name \u2502 sbserver_00 \u2502 \u2502 Status \u2502 Up About a minute \u2502 \u2502 CPU \u2502 2 \u2502 \u2502 Memory \u2502 2048 \u2502 \u2502 Networks \u2502 Network:bridge \u2502 \u2502 \u2502 IPAddress:172.31.0.5 \u2502 \u2502 \u2502 Gateway:172.31.0.1 \u2502 \u2502 \u2502 Subnet:16 \u2502 \u2502 \u2502 MacAddress:02:42:ac:1f:00:05 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 Ports \u2502 LocalPort:443/tcp \u2502 \u2502 \u2502 GuestPort:30000 \u2502 \u2502 \u2502 \u2502 \u2502 Quotagroups \u2502 appliance_data \u2502 \u2502 \u2502 sb_user00 \u2502 \u2502 \u2502 \u2502 \u2502 State \u2502 running \u2502 \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f Your secure build server is now up and running! It is available at the IP Address of the Hyper Protect Virtual Server LPAR and port (GuestPort) specified. You will use this secure build server to securely build your application in the next section. Note You can assign IP addresses and hostnames for containers as necessary for your purposes but using the docker network and host ports is a nice way to quickly get running without having to use up IP addresses on your network.","title":"Create Securebuild server"},{"location":"securebuild-lab/deploy-app/","text":"Deploy your Securely Built Application as a Hyper Protect Virtual Server \u00b6 Export Variables set in previous sections to current terminal session \u00b6 Source bashrc to set necessary variables if unset source \" ${ HOME } /.bashrc\" Set up you Docker Image Repository \u00b6 Register your repository hpvs repository register \\ --pgp = \" ${ SB_DIR } /yaml. ${ REPO_ID } .enc\" \\ --id = \" ${ REPO_ID } \" Example Output +-----------------+------------------------------+ | repository name | docker.io/gmoney23/hpvs_bc_a | | runtime | runq | +-----------------+------------------------------+ View your newly registered repository hpvs repository show --id \" ${ REPO_ID } \" Example Output +-----------------+------------------------------+ | repository name | docker.io/gmoney23/hpvs_bc_a | | runtime | runq | +-----------------+------------------------------+ Set up your Quotagroup for storage \u00b6 Create Quotagroup hpvs quotagroup create --name = \" ${ REPO_ID } \" --size = 5GB Example Output +-------------+--------------+ | name | hpvs_bc_a_00 | | filesystem | btrfs | | passthrough | false | | pool_id | lv_data_pool | | size | 5GB | | available | 5GB | | containers | [] | +-------------+--------------+ View your newly created quotagroup hpvs quotagroup show --name \" ${ REPO_ID } \" Example Output +-------------+--------------+ | name | hpvs_bc_a_00 | | filesystem | btrfs | | passthrough | false | | pool_id | lv_data_pool | | size | 5GB | | available | 5GB | | containers | [] | +-------------+--------------+ Deploy your Application \u00b6 Set App port export APP_PORT = 301 ${ HPVS_NUMBER } Create your Hyper Protect Virtual Server hpvs vs create --name = ${ REPO_ID } --repo ${ REPO_ID } \\ --tag latest --cpu 2 --ram 2048 \\ --quotagroup \"{quotagroup = ${ REPO_ID } , mountid = new, mount = /newroot, filesystem = btrfs, size = 4GB}\" \\ --ports \"{containerport = 443, protocol = tcp, hostport = ${ APP_PORT } }\" Example Output \u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502 PROPERTIES \u2502 VALUES \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 Name \u2502 hpvs_bc_a_00 \u2502 \u2502 Status \u2502 Up Less than a second \u2502 \u2502 CPU \u2502 2 \u2502 \u2502 Memory \u2502 2048 \u2502 \u2502 Networks \u2502 Network:bridge \u2502 \u2502 \u2502 IPAddress:172.31.0.8 \u2502 \u2502 \u2502 Gateway:172.31.0.1 \u2502 \u2502 \u2502 Subnet:16 \u2502 \u2502 \u2502 MacAddress:02:42:ac:1f:00:08 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 Ports \u2502 LocalPort:443/tcp \u2502 \u2502 \u2502 GuestPort:30100 \u2502 \u2502 \u2502 \u2502 \u2502 Quotagroups \u2502 appliance_data \u2502 \u2502 \u2502 hpvs_bc_a_00 \u2502 \u2502 \u2502 \u2502 \u2502 State \u2502 running \u2502 \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f Check on the Quotagroup (and see the application is indeed using it) hpvs quotagroup show --name \" ${ REPO_ID } \" Example Output +-------------+------------------------+ | PROPERTIES | VALUES | +-------------+------------------------+ | name | hpvs_bc_a_00 | | filesystem | btrfs | | passthrough | false | | pool_id | lv_data_pool | | size | 5GB | | available | 751MB | | containers | Container:hpvs_bc_a_00 | | | Mountids:\"new\" | | | | | | | +-------------+------------------------+ We can see the Hyper Protect Virtual Server for our application is now taking up the majority of our Quotagroup. If you ever need to check the Hyper Protect Virtual Server you can use the show command hpvs vs show --name = ${ REPO_ID } Example Output \u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502 PROPERTIES \u2502 VALUES \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 Name \u2502 hpvs_bc_a_00 \u2502 \u2502 Status \u2502 Up 6 minutes \u2502 \u2502 CPU \u2502 2 \u2502 \u2502 Memory \u2502 2048 \u2502 \u2502 Networks \u2502 Network:bridge \u2502 \u2502 \u2502 IPAddress:172.31.0.8 \u2502 \u2502 \u2502 Gateway:172.31.0.1 \u2502 \u2502 \u2502 Subnet:16 \u2502 \u2502 \u2502 MacAddress:02:42:ac:1f:00:08 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 Ports \u2502 LocalPort:443/tcp \u2502 \u2502 \u2502 GuestPort:30100 \u2502 \u2502 \u2502 \u2502 \u2502 Quotagroups \u2502 appliance_data \u2502 \u2502 \u2502 hpvs_bc_a_00 \u2502 \u2502 \u2502 \u2502 \u2502 State \u2502 running \u2502 \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f Access your application \u00b6 Run the following command to print the address for your electrum wallet application: echo \"https:// ${ SB_IP } : ${ APP_PORT } /electrum\" Example Output https://192.168.22.80:30100/electrum Your app is now up and running at the address printed in your terminal! Tip You can visit the IP address easily by right-clicking on the link (wih the line under it) in your terminal and selecting Open Link Info This application uses self-signed certificates so don't worry about the certificate warning you'll need to accept in your browser. Just click Advanced and then Accept the Risk and Continue In the final part of this lab you will use your newly built application...","title":"Deploy your Securely Built Application as a Hyper Protect Virtual Server"},{"location":"securebuild-lab/deploy-app/#deploy-your-securely-built-application-as-a-hyper-protect-virtual-server","text":"","title":"Deploy your Securely Built Application as a Hyper Protect Virtual Server"},{"location":"securebuild-lab/deploy-app/#export-variables-set-in-previous-sections-to-current-terminal-session","text":"Source bashrc to set necessary variables if unset source \" ${ HOME } /.bashrc\"","title":"Export Variables set in previous sections to current terminal session"},{"location":"securebuild-lab/deploy-app/#set-up-you-docker-image-repository","text":"Register your repository hpvs repository register \\ --pgp = \" ${ SB_DIR } /yaml. ${ REPO_ID } .enc\" \\ --id = \" ${ REPO_ID } \" Example Output +-----------------+------------------------------+ | repository name | docker.io/gmoney23/hpvs_bc_a | | runtime | runq | +-----------------+------------------------------+ View your newly registered repository hpvs repository show --id \" ${ REPO_ID } \" Example Output +-----------------+------------------------------+ | repository name | docker.io/gmoney23/hpvs_bc_a | | runtime | runq | +-----------------+------------------------------+","title":"Set up you Docker Image Repository"},{"location":"securebuild-lab/deploy-app/#set-up-your-quotagroup-for-storage","text":"Create Quotagroup hpvs quotagroup create --name = \" ${ REPO_ID } \" --size = 5GB Example Output +-------------+--------------+ | name | hpvs_bc_a_00 | | filesystem | btrfs | | passthrough | false | | pool_id | lv_data_pool | | size | 5GB | | available | 5GB | | containers | [] | +-------------+--------------+ View your newly created quotagroup hpvs quotagroup show --name \" ${ REPO_ID } \" Example Output +-------------+--------------+ | name | hpvs_bc_a_00 | | filesystem | btrfs | | passthrough | false | | pool_id | lv_data_pool | | size | 5GB | | available | 5GB | | containers | [] | +-------------+--------------+","title":"Set up your Quotagroup for storage"},{"location":"securebuild-lab/deploy-app/#deploy-your-application","text":"Set App port export APP_PORT = 301 ${ HPVS_NUMBER } Create your Hyper Protect Virtual Server hpvs vs create --name = ${ REPO_ID } --repo ${ REPO_ID } \\ --tag latest --cpu 2 --ram 2048 \\ --quotagroup \"{quotagroup = ${ REPO_ID } , mountid = new, mount = /newroot, filesystem = btrfs, size = 4GB}\" \\ --ports \"{containerport = 443, protocol = tcp, hostport = ${ APP_PORT } }\" Example Output \u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502 PROPERTIES \u2502 VALUES \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 Name \u2502 hpvs_bc_a_00 \u2502 \u2502 Status \u2502 Up Less than a second \u2502 \u2502 CPU \u2502 2 \u2502 \u2502 Memory \u2502 2048 \u2502 \u2502 Networks \u2502 Network:bridge \u2502 \u2502 \u2502 IPAddress:172.31.0.8 \u2502 \u2502 \u2502 Gateway:172.31.0.1 \u2502 \u2502 \u2502 Subnet:16 \u2502 \u2502 \u2502 MacAddress:02:42:ac:1f:00:08 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 Ports \u2502 LocalPort:443/tcp \u2502 \u2502 \u2502 GuestPort:30100 \u2502 \u2502 \u2502 \u2502 \u2502 Quotagroups \u2502 appliance_data \u2502 \u2502 \u2502 hpvs_bc_a_00 \u2502 \u2502 \u2502 \u2502 \u2502 State \u2502 running \u2502 \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f Check on the Quotagroup (and see the application is indeed using it) hpvs quotagroup show --name \" ${ REPO_ID } \" Example Output +-------------+------------------------+ | PROPERTIES | VALUES | +-------------+------------------------+ | name | hpvs_bc_a_00 | | filesystem | btrfs | | passthrough | false | | pool_id | lv_data_pool | | size | 5GB | | available | 751MB | | containers | Container:hpvs_bc_a_00 | | | Mountids:\"new\" | | | | | | | +-------------+------------------------+ We can see the Hyper Protect Virtual Server for our application is now taking up the majority of our Quotagroup. If you ever need to check the Hyper Protect Virtual Server you can use the show command hpvs vs show --name = ${ REPO_ID } Example Output \u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e \u2502 PROPERTIES \u2502 VALUES \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 Name \u2502 hpvs_bc_a_00 \u2502 \u2502 Status \u2502 Up 6 minutes \u2502 \u2502 CPU \u2502 2 \u2502 \u2502 Memory \u2502 2048 \u2502 \u2502 Networks \u2502 Network:bridge \u2502 \u2502 \u2502 IPAddress:172.31.0.8 \u2502 \u2502 \u2502 Gateway:172.31.0.1 \u2502 \u2502 \u2502 Subnet:16 \u2502 \u2502 \u2502 MacAddress:02:42:ac:1f:00:08 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 \u2502 Ports \u2502 LocalPort:443/tcp \u2502 \u2502 \u2502 GuestPort:30100 \u2502 \u2502 \u2502 \u2502 \u2502 Quotagroups \u2502 appliance_data \u2502 \u2502 \u2502 hpvs_bc_a_00 \u2502 \u2502 \u2502 \u2502 \u2502 State \u2502 running \u2502 \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f","title":"Deploy your Application"},{"location":"securebuild-lab/deploy-app/#access-your-application","text":"Run the following command to print the address for your electrum wallet application: echo \"https:// ${ SB_IP } : ${ APP_PORT } /electrum\" Example Output https://192.168.22.80:30100/electrum Your app is now up and running at the address printed in your terminal! Tip You can visit the IP address easily by right-clicking on the link (wih the line under it) in your terminal and selecting Open Link Info This application uses self-signed certificates so don't worry about the certificate warning you'll need to accept in your browser. Just click Advanced and then Accept the Risk and Continue In the final part of this lab you will use your newly built application...","title":"Access your application"},{"location":"securebuild-lab/overview/","text":"Hyper Protect Virtual Servers (HPVS) Lab Process Overview \u00b6 Prerequisites \u00b6 See the Prerequisites page to complete the prerequisites for this lab. This includes creating accounts and credentials to access the Source Code Management (SCM) GitHub and the Docker Image Management (Docker Registry) Docker Hub for the lab. Detailed Lab Process \u00b6 Configure your environment with the necessary credentials to connect to GitHub and Docker Hub respectively. ( See Configuring your Environment ) Securely Build a Docker Image for the Secure Electrum Bitcoin Wallet Application . ( see Create your HPVS Secure Build Server and Securely Build your Application ). This uses the Secure Build Process detailed below 1 : Info This secure build process leverages Docker Content Trust to verify images using the Notary service architecture . Tip The Secure Build server used is deployed as a Hyper Protect Virtual Server which generates the repository and root keys used to establish trust with the Docker Notary Service . This ensures that the initial keys used for a repository are trusted on first use (solving the TOFU problem). See a detailed example of where all of the keys used for the secure build process are generated below. Full list of the keys used during the Secure Build and BYOI lifecycle 2 Register your securely built Docker Image with your Secure Service Container to verify its validity 3 (see the end of Securely Build your Application and the beginning of Deploy your Securely Built Application as a Hyper Protect Virtual Server ) . Launch your Secure Bitcoin Wallet application (from the verified repository created in step 3) as a Hyper Protect Virtual Server within its own secure enclave 4 (see Deploy your Securely Built Application as a Hyper Protect Virtual Server ). . Access your Secure Electrum Bitcoin Wallet Application application to use it with security built-in (see Welcome to the Secure Bitcoin Wallet on IBM LinuxONE ). Clean up your environment for future users (see Clean up your environment ). Let's Get Started!!! \u00b6 The Secure Build Experience graphic is adapted from charts provided by the Hyper Protect Virtual Servers On-Premises development team. \u21a9 The above table is provided here for convenience. It comes from the IBM Knowledge Center \u21a9 The Image Registration Experience graphic is adapted from charts provided by the Hyper Protect Virtual Servers On-Premises development team. \u21a9 The Hyper Protect Virtual Server Experience graphic is adapted from charts provided by the Hyper Protect Virtual Servers On-Premises development team. \u21a9","title":"Hyper Protect Virtual Servers (HPVS) Lab Process Overview"},{"location":"securebuild-lab/overview/#hyper-protect-virtual-servers-hpvs-lab-process-overview","text":"","title":"Hyper Protect Virtual Servers (HPVS) Lab Process Overview"},{"location":"securebuild-lab/overview/#prerequisites","text":"See the Prerequisites page to complete the prerequisites for this lab. This includes creating accounts and credentials to access the Source Code Management (SCM) GitHub and the Docker Image Management (Docker Registry) Docker Hub for the lab.","title":"Prerequisites"},{"location":"securebuild-lab/overview/#detailed-lab-process","text":"Configure your environment with the necessary credentials to connect to GitHub and Docker Hub respectively. ( See Configuring your Environment ) Securely Build a Docker Image for the Secure Electrum Bitcoin Wallet Application . ( see Create your HPVS Secure Build Server and Securely Build your Application ). This uses the Secure Build Process detailed below 1 : Info This secure build process leverages Docker Content Trust to verify images using the Notary service architecture . Tip The Secure Build server used is deployed as a Hyper Protect Virtual Server which generates the repository and root keys used to establish trust with the Docker Notary Service . This ensures that the initial keys used for a repository are trusted on first use (solving the TOFU problem). See a detailed example of where all of the keys used for the secure build process are generated below. Full list of the keys used during the Secure Build and BYOI lifecycle 2 Register your securely built Docker Image with your Secure Service Container to verify its validity 3 (see the end of Securely Build your Application and the beginning of Deploy your Securely Built Application as a Hyper Protect Virtual Server ) . Launch your Secure Bitcoin Wallet application (from the verified repository created in step 3) as a Hyper Protect Virtual Server within its own secure enclave 4 (see Deploy your Securely Built Application as a Hyper Protect Virtual Server ). . Access your Secure Electrum Bitcoin Wallet Application application to use it with security built-in (see Welcome to the Secure Bitcoin Wallet on IBM LinuxONE ). Clean up your environment for future users (see Clean up your environment ).","title":"Detailed Lab Process"},{"location":"securebuild-lab/overview/#lets-get-started","text":"The Secure Build Experience graphic is adapted from charts provided by the Hyper Protect Virtual Servers On-Premises development team. \u21a9 The above table is provided here for convenience. It comes from the IBM Knowledge Center \u21a9 The Image Registration Experience graphic is adapted from charts provided by the Hyper Protect Virtual Servers On-Premises development team. \u21a9 The Hyper Protect Virtual Server Experience graphic is adapted from charts provided by the Hyper Protect Virtual Servers On-Premises development team. \u21a9","title":"Let's Get Started!!!"},{"location":"securebuild-lab/securebuild-setup/","text":"Configuring your Environment \u00b6 Add Docker registry to use for secure build \u00b6 See your current Docker registries with: hpvs registry list Example Output +---------------+ | REGISTRY NAME | +---------------+ +---------------+ Set your DOCKER_USERNAME to the username for your account on Docker Hub Command Syntax export DOCKER_USERNAME = \"my_username\" Example Command export DOCKER_USERNAME = \"gmoney23\" Note This will be the username you used when you created your Docker Hub account in the Prerequisites Save your DOCKER_USERNAME to bashrc for later use. echo \"export DOCKER_USERNAME=' ${ DOCKER_USERNAME } '\" >> \" ${ HOME } /.bashrc\" Set your DOCKER_PASSWORD the token you created for this lab on Docker Hub . Command Syntax export DOCKER_PASSWORD = \"my_docker_token\" Example Command export DOCKER_PASSWORD = \"123456789\" Note This will be the Docker Hub token you created for the lab in the Prerequisites Check your Docker Hub login credentials with a docker login echo \" ${ DOCKER_PASSWORD } \" | docker login -u ${ DOCKER_USERNAME } --password-stdin Successful login WARNING! Your password will be stored unencrypted in /home/multiarch-lab/.docker/config.json. Configure a credential helper to remove this warning. See https://docs.docker.com/engine/reference/commandline/login/#credentials-store Login Succeeded Failed Login Please redo this section Error response from daemon: Get https://registry-1.docker.io/v2/: unauthorized: incorrect username or password Set your REGISTRY_NAME to a Docker registry placeholder name of your choosing. Command Syntax export REGISTRY_NAME = \"my_registry\" Example Command export REGISTRY_NAME = \"g_docker_hub\" Save your REGISTRY_NAME to bashrc for future shells (in case you open new terminals) echo \"export REGISTRY_NAME=' ${ REGISTRY_NAME } '\" >> \" ${ HOME } /.bashrc\" Add your Docker registry with: echo \" ${ DOCKER_PASSWORD } \" | hpvs registry add \\ --name \" ${ REGISTRY_NAME } \" --dct https://notary.docker.io \\ --url docker.io --user \" ${ DOCKER_USERNAME } \" Example Output Enter Password: Note You can ignore the Enter Password: prompt because the command does that for you with the echo \"${DOCKER_PASSWORD}\" | before the hpvs registry add command. List your registered Docker registries again to confirm your registry has been added. hpvs registry list Example Output +---------------+ | REGISTRY NAME | +---------------+ | g_docker_hub | +---------------+ Check the details of your added registry with hpvs registry show --name \" ${ REGISTRY_NAME } \" Example Output +------+--------------------------+ | name | g_docker_hub | | user | gmoney23 | | dct | https://notary.docker.io | | url | docker.io | +------+--------------------------+ Create directory for secure build lab and change directory \u00b6 Set your secure build directory export SB_DIR = \" $HOME /securebuild-lab\" Save SB_DIR to $HOME/.bashrc for future shells (in case you open new terminals) echo \"export SB_DIR=' ${ SB_DIR } '\" >> \" ${ HOME } /.bashrc\" Create SB_DIR and change into it mkdir -p \" ${ SB_DIR } \" && cd \" ${ SB_DIR } \" Create SSH Key and Grant GitHub access \u00b6 Create GitHub keys directory mkdir -p \" ${ SB_DIR } /github_keys\" Set GITHUB_SSH_KEY variable export GITHUB_SSH_KEY = \" ${ SB_DIR } /github_keys/github_rsa\" Save GITHUB_SSH_KEY variable in bashrc for later use echo \"export GITHUB_SSH_KEY=' ${ GITHUB_SSH_KEY } '\" >> \" ${ HOME } /.bashrc\" Create Public and private key for GitHub access ssh-keygen -t rsa -b 4096 -f \" ${ GITHUB_SSH_KEY } \" -N '' Example Output Generating public/private rsa key pair. Your identification has been saved in /home/multiarch-lab/securebuild-lab/github_keys/github_rsa. Your public key has been saved in /home/multiarch-lab/securebuild-lab/github_keys/github_rsa.pub. The key fingerprint is: SHA256:sbEfCzwyOz/LaZ4jSeKT+Aw7IWUr7YT6m8Hxv9Dq90k multiarch-lab@ubuntu The key ' s randomart image is: +--- [ RSA 4096 ] ----+ | | | | | o | | o . = | | = .. o S . | | +. = o...+ + o | | . = ++o++.E o | | . +*+++ = ++ | | . === oo*X+ | +---- [ SHA256 ] -----+ Cat GitHub public key to terminal cat \" ${ GITHUB_SSH_KEY } .pub\" Example Output ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC6zsnjH4fXaR/imYkzRaYVgWsNVIY4LzCftygKGTFJVBDMqVErsbkvF810RUTPIIowwe7Bx2UGLtwv3kL2omUJaHjol/+nzQjdmFrV2qnZosMUCn4xSpdffCmMyFWE8FnWw1ZSc7STcTD/NFzLjrN/vbJgMvla0aSxsENio2RvyFQkMKbwfojE22Q/MOtJAg0wyr9/0JNXiAyLYUEwfi1qVoF4F1mvXgLtNgTSx4VzokUKBsiSaDDbEa70ik154dtWLY9nemUsrSfUluCrHLaJhUy9cg6Jc+/9tco0cZhyZDnLIhT/4+n1XGfZxb83c5WElrg/IEYHGOHfqp+lMfusMj/0ppopz+f66dWDabVQCbrkqa+yfbw0ItC0+sZ7opIYGRLt+OelkrIECo7utzCTxdCCJ+2iUIiBV14my7xAFR+fNLKzl9KD+FTT/QoUPlqTmUQNo6NFNGG15znWVRtMDOdDiA6fugl6RrFJHDpaw9/lh+7g7tqwHGF83ZomvvFdKFMsXY6JTpj6rb7gtKzEapB9imCr0aw0ZTWTdlzTs9ksSNr1gZRf/eiztP5puC4weGDRXVjPwHOFOGbUH7Wk8ywQAmUJdEg03bz01U1htYryiNTD4VD2QfVTmxTltocj/2yv7Apv6gQ+Gb0LsgTp2aWbAnbeWX7qfjpYt0j/iw == multiarch-lab@ubuntu Copy your output to the clipboard with ctrl+shift+c . Add this key to your public GitHub (paste copied content into GitHub keys textbox) Follow these instructions for adding this public key to your github.com GitHub account. Note You created this public github.com GitHub in the Prerequisites (or already had one). Warning The above copy command ( ctrl+shift+c ) is saving the .pub public key NOT the private key. You keep the private key and GitHub uses the public key to verify that it is communicating with the owner of the private key (i.e. you). Scan for GitHub's public key (Done to trust GitHub connection the first time) ssh-keyscan -H github.com >> \" ${ HOME } /.ssh/known_hosts\" Example Output # github.com:22 SSH-2.0-babeld-ffbef2ae # github.com:22 SSH-2.0-babeld-ffbef2ae # github.com:22 SSH-2.0-babeld-ffbef2ae Check your GitHub key now has access to your account with: ssh -T git@github.com -i \" ${ GITHUB_SSH_KEY } \" Your key was added successfully Warning: Permanently added the RSA host key for IP address '140.82.114.3' to the list of known hosts. Hi siler23! You ' ve successfully authenticated, but GitHub does not provide shell access. Your key was NOT added Please redo this section Warning: Permanently added the RSA host key for IP address '140.82.113.3' to the list of known hosts. git@github.com: Permission denied ( publickey ) . Feel at ease knowing you will delete this key from your Github account in the cleanup phase of this lab so access will be revoked soon enough","title":"Configuring your Environment"},{"location":"securebuild-lab/securebuild-setup/#configuring-your-environment","text":"","title":"Configuring your Environment"},{"location":"securebuild-lab/securebuild-setup/#add-docker-registry-to-use-for-secure-build","text":"See your current Docker registries with: hpvs registry list Example Output +---------------+ | REGISTRY NAME | +---------------+ +---------------+ Set your DOCKER_USERNAME to the username for your account on Docker Hub Command Syntax export DOCKER_USERNAME = \"my_username\" Example Command export DOCKER_USERNAME = \"gmoney23\" Note This will be the username you used when you created your Docker Hub account in the Prerequisites Save your DOCKER_USERNAME to bashrc for later use. echo \"export DOCKER_USERNAME=' ${ DOCKER_USERNAME } '\" >> \" ${ HOME } /.bashrc\" Set your DOCKER_PASSWORD the token you created for this lab on Docker Hub . Command Syntax export DOCKER_PASSWORD = \"my_docker_token\" Example Command export DOCKER_PASSWORD = \"123456789\" Note This will be the Docker Hub token you created for the lab in the Prerequisites Check your Docker Hub login credentials with a docker login echo \" ${ DOCKER_PASSWORD } \" | docker login -u ${ DOCKER_USERNAME } --password-stdin Successful login WARNING! Your password will be stored unencrypted in /home/multiarch-lab/.docker/config.json. Configure a credential helper to remove this warning. See https://docs.docker.com/engine/reference/commandline/login/#credentials-store Login Succeeded Failed Login Please redo this section Error response from daemon: Get https://registry-1.docker.io/v2/: unauthorized: incorrect username or password Set your REGISTRY_NAME to a Docker registry placeholder name of your choosing. Command Syntax export REGISTRY_NAME = \"my_registry\" Example Command export REGISTRY_NAME = \"g_docker_hub\" Save your REGISTRY_NAME to bashrc for future shells (in case you open new terminals) echo \"export REGISTRY_NAME=' ${ REGISTRY_NAME } '\" >> \" ${ HOME } /.bashrc\" Add your Docker registry with: echo \" ${ DOCKER_PASSWORD } \" | hpvs registry add \\ --name \" ${ REGISTRY_NAME } \" --dct https://notary.docker.io \\ --url docker.io --user \" ${ DOCKER_USERNAME } \" Example Output Enter Password: Note You can ignore the Enter Password: prompt because the command does that for you with the echo \"${DOCKER_PASSWORD}\" | before the hpvs registry add command. List your registered Docker registries again to confirm your registry has been added. hpvs registry list Example Output +---------------+ | REGISTRY NAME | +---------------+ | g_docker_hub | +---------------+ Check the details of your added registry with hpvs registry show --name \" ${ REGISTRY_NAME } \" Example Output +------+--------------------------+ | name | g_docker_hub | | user | gmoney23 | | dct | https://notary.docker.io | | url | docker.io | +------+--------------------------+","title":"Add Docker registry to use for secure build"},{"location":"securebuild-lab/securebuild-setup/#create-directory-for-secure-build-lab-and-change-directory","text":"Set your secure build directory export SB_DIR = \" $HOME /securebuild-lab\" Save SB_DIR to $HOME/.bashrc for future shells (in case you open new terminals) echo \"export SB_DIR=' ${ SB_DIR } '\" >> \" ${ HOME } /.bashrc\" Create SB_DIR and change into it mkdir -p \" ${ SB_DIR } \" && cd \" ${ SB_DIR } \"","title":"Create directory for secure build lab and change directory"},{"location":"securebuild-lab/securebuild-setup/#create-ssh-key-and-grant-github-access","text":"Create GitHub keys directory mkdir -p \" ${ SB_DIR } /github_keys\" Set GITHUB_SSH_KEY variable export GITHUB_SSH_KEY = \" ${ SB_DIR } /github_keys/github_rsa\" Save GITHUB_SSH_KEY variable in bashrc for later use echo \"export GITHUB_SSH_KEY=' ${ GITHUB_SSH_KEY } '\" >> \" ${ HOME } /.bashrc\" Create Public and private key for GitHub access ssh-keygen -t rsa -b 4096 -f \" ${ GITHUB_SSH_KEY } \" -N '' Example Output Generating public/private rsa key pair. Your identification has been saved in /home/multiarch-lab/securebuild-lab/github_keys/github_rsa. Your public key has been saved in /home/multiarch-lab/securebuild-lab/github_keys/github_rsa.pub. The key fingerprint is: SHA256:sbEfCzwyOz/LaZ4jSeKT+Aw7IWUr7YT6m8Hxv9Dq90k multiarch-lab@ubuntu The key ' s randomart image is: +--- [ RSA 4096 ] ----+ | | | | | o | | o . = | | = .. o S . | | +. = o...+ + o | | . = ++o++.E o | | . +*+++ = ++ | | . === oo*X+ | +---- [ SHA256 ] -----+ Cat GitHub public key to terminal cat \" ${ GITHUB_SSH_KEY } .pub\" Example Output ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC6zsnjH4fXaR/imYkzRaYVgWsNVIY4LzCftygKGTFJVBDMqVErsbkvF810RUTPIIowwe7Bx2UGLtwv3kL2omUJaHjol/+nzQjdmFrV2qnZosMUCn4xSpdffCmMyFWE8FnWw1ZSc7STcTD/NFzLjrN/vbJgMvla0aSxsENio2RvyFQkMKbwfojE22Q/MOtJAg0wyr9/0JNXiAyLYUEwfi1qVoF4F1mvXgLtNgTSx4VzokUKBsiSaDDbEa70ik154dtWLY9nemUsrSfUluCrHLaJhUy9cg6Jc+/9tco0cZhyZDnLIhT/4+n1XGfZxb83c5WElrg/IEYHGOHfqp+lMfusMj/0ppopz+f66dWDabVQCbrkqa+yfbw0ItC0+sZ7opIYGRLt+OelkrIECo7utzCTxdCCJ+2iUIiBV14my7xAFR+fNLKzl9KD+FTT/QoUPlqTmUQNo6NFNGG15znWVRtMDOdDiA6fugl6RrFJHDpaw9/lh+7g7tqwHGF83ZomvvFdKFMsXY6JTpj6rb7gtKzEapB9imCr0aw0ZTWTdlzTs9ksSNr1gZRf/eiztP5puC4weGDRXVjPwHOFOGbUH7Wk8ywQAmUJdEg03bz01U1htYryiNTD4VD2QfVTmxTltocj/2yv7Apv6gQ+Gb0LsgTp2aWbAnbeWX7qfjpYt0j/iw == multiarch-lab@ubuntu Copy your output to the clipboard with ctrl+shift+c . Add this key to your public GitHub (paste copied content into GitHub keys textbox) Follow these instructions for adding this public key to your github.com GitHub account. Note You created this public github.com GitHub in the Prerequisites (or already had one). Warning The above copy command ( ctrl+shift+c ) is saving the .pub public key NOT the private key. You keep the private key and GitHub uses the public key to verify that it is communicating with the owner of the private key (i.e. you). Scan for GitHub's public key (Done to trust GitHub connection the first time) ssh-keyscan -H github.com >> \" ${ HOME } /.ssh/known_hosts\" Example Output # github.com:22 SSH-2.0-babeld-ffbef2ae # github.com:22 SSH-2.0-babeld-ffbef2ae # github.com:22 SSH-2.0-babeld-ffbef2ae Check your GitHub key now has access to your account with: ssh -T git@github.com -i \" ${ GITHUB_SSH_KEY } \" Your key was added successfully Warning: Permanently added the RSA host key for IP address '140.82.114.3' to the list of known hosts. Hi siler23! You ' ve successfully authenticated, but GitHub does not provide shell access. Your key was NOT added Please redo this section Warning: Permanently added the RSA host key for IP address '140.82.113.3' to the list of known hosts. git@github.com: Permission denied ( publickey ) . Feel at ease knowing you will delete this key from your Github account in the cleanup phase of this lab so access will be revoked soon enough","title":"Create SSH Key and Grant GitHub access"}]}