
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../create-server/">
      
      
        <link rel="next" href="../deploy-app/">
      
      <link rel="icon" href="../../images/hpvs-logo.svg">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>Securely Build your Application - Hyper Protect Virtual Servers (HPVS) Workshop</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../../css/print-site.css">
    
      <link rel="stylesheet" href="../../css/print-site-material.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-N1XCHYKZ2T"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-N1XCHYKZ2T",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-N1XCHYKZ2T",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="yellow">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#securely-build-your-application" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Hyper Protect Virtual Servers (HPVS) Workshop" class="md-header__button md-logo" aria-label="Hyper Protect Virtual Servers (HPVS) Workshop" data-md-component="logo">
      
  <img src="../../images/hpvs-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hyper Protect Virtual Servers (HPVS) Workshop
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Securely Build your Application
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="yellow"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="yellow"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ibm-wsc/hyper-protect-virtual-servers-workshop" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../assignment/" class="md-tabs__link">
      Lab Assignments
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../grep11-lab/overview/" class="md-tabs__link">
        GREP11 Lab
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../prerequisites/" class="md-tabs__link md-tabs__link--active">
        Secure Image Build Lab
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../glossary/" class="md-tabs__link">
      Glossary of terms
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../resources/" class="md-tabs__link">
      Other resources
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../proposechange/" class="md-tabs__link">
      Propose a change
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../print_page/" class="md-tabs__link">
      Print Site
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Hyper Protect Virtual Servers (HPVS) Workshop" class="md-nav__button md-logo" aria-label="Hyper Protect Virtual Servers (HPVS) Workshop" data-md-component="logo">
      
  <img src="../../images/hpvs-logo.svg" alt="logo">

    </a>
    Hyper Protect Virtual Servers (HPVS) Workshop
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ibm-wsc/hyper-protect-virtual-servers-workshop" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../assignment/" class="md-nav__link">
        Lab Assignments
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          GREP11 Lab
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          GREP11 Lab
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../grep11-lab/overview/" class="md-nav__link">
        Lab overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../grep11-lab/grep11-setup/" class="md-nav__link">
        How to set up a GREP11 server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../grep11-lab/grep11-display/" class="md-nav__link">
        Displaying your GREP11 environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../grep11-lab/run-grep11-samples/" class="md-nav__link">
        Run the GREP11 sample code
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
          Run the Lab exercises
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Run the Lab exercises
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../grep11-lab/exercise-overview/" class="md-nav__link">
        An overview of the Exercises
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../grep11-lab/lab-exercise1/" class="md-nav__link">
        Exercise 1 (List PKCS Mechanisms)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../grep11-lab/lab-exercise2/" class="md-nav__link">
        Exercise 2 (Encryption and Decryption)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../grep11-lab/lab-exercise3/" class="md-nav__link">
        Exercise 3 (Sign and Verify)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../grep11-lab/lab-exercise4/" class="md-nav__link">
        Exercise 4 (Wrap and Unwrap Key)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Secure Image Build Lab
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Secure Image Build Lab
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../prerequisites/" class="md-nav__link">
        Prerequisites
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Hyper Protect Virtual Servers (HPVS) Lab Process Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../securebuild-setup/" class="md-nav__link">
        Configuring your Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../create-server/" class="md-nav__link">
        Create your HPVS Secure Build Server
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Securely Build your Application
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Securely Build your Application
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#export-variables-set-in-previous-sections-to-current-terminal-session" class="md-nav__link">
    Export Variables set in previous sections to current terminal session
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-repository-registration-gpg-signing-key" class="md-nav__link">
    Create repository registration GPG signing key
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-build-configuration" class="md-nav__link">
    Set Build Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-application" class="md-nav__link">
    Build Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-secure-build" class="md-nav__link">
    Troubleshooting Secure Build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verify-your-application" class="md-nav__link">
    Verify your application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deploy-app/" class="md-nav__link">
        Deploy your Securely Built Application as a Hyper Protect Virtual Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bitcoin_wallet/" class="md-nav__link">
        Welcome to the Secure Bitcoin Wallet on IBM LinuxONE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cleanup/" class="md-nav__link">
        Clean up your Environment
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        Glossary of terms
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../resources/" class="md-nav__link">
        Other resources
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../proposechange/" class="md-nav__link">
        Propose a change
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../print_page/" class="md-nav__link">
        Print Site
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#export-variables-set-in-previous-sections-to-current-terminal-session" class="md-nav__link">
    Export Variables set in previous sections to current terminal session
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-repository-registration-gpg-signing-key" class="md-nav__link">
    Create repository registration GPG signing key
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-build-configuration" class="md-nav__link">
    Set Build Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-application" class="md-nav__link">
    Build Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-secure-build" class="md-nav__link">
    Troubleshooting Secure Build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verify-your-application" class="md-nav__link">
    Verify your application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/ibm-wsc/hyper-protect-virtual-servers-workshop/edit/master/docs/securebuild-lab/build.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/ibm-wsc/hyper-protect-virtual-servers-workshop/raw/master/docs/securebuild-lab/build.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<h1 id="securely-build-your-application">Securely Build your Application<a class="headerlink" href="#securely-build-your-application" title="Permanent link">&para;</a></h1>
<h2 id="export-variables-set-in-previous-sections-to-current-terminal-session">Export Variables set in previous sections to current terminal session<a class="headerlink" href="#export-variables-set-in-previous-sections-to-current-terminal-session" title="Permanent link">&para;</a></h2>
<p>Source <code>bashrc</code> to set necessary variables if unset</p>
<div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/.bashrc&quot;</span>
</code></pre></div>
<h2 id="create-repository-registration-gpg-signing-key">Create repository registration GPG signing key<a class="headerlink" href="#create-repository-registration-gpg-signing-key" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This section creates the <code>Repository Registration Signing Key</code> referenced in the <a href="../overview/#fnref:2">key table</a>. <a href="https://gnupg.org/" target="_blank">The GNU Privacy Guard (GPG)</a> utility (a free implementation of the OpenPGP standard or PGP) generates this key pair (protected by a user defined password) and then exports the public and private keys to files in the <code>${SB_DIR}/registration_keys/</code> directory. Later, you will employ these keys to sign a registration file for your securely built image to register it with your Hyper Protect Virtual Servers appliance such that only the holder of the private key can change the registered repository on the Hyper Protect Virtual Servers appliance.</p>
</div>
<ol>
<li>
<p>Set key name</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">keyName</span><span class="o">=</span><span class="s2">&quot;secure_bitcoin_key</span><span class="si">${</span><span class="nv">RANDOM</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><code>${RANDOM}</code> stores a pseudo-random number to use since GPG keys on a system must each have a unique key name (uid). This will make sure users can safely re-run commands for multiple runs if they so choose.</p>
</div>
</li>
<li>
<p>Set key passphrase</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Command Syntax</label><label for="__tabbed_1_2">Example Command</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">passphrase</span><span class="o">=</span><span class="s2">&quot;your_passphrase&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">passphrase</span><span class="o">=</span><span class="s2">&quot;most_secure_pw_i_could_think_of&quot;</span>
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>Create directory to store Docker repository registration signing key material</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/registration_keys&quot;</span>
</code></pre></div>
</li>
<li>
<p>Create Key Definition</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/registration_keys/</span><span class="si">${</span><span class="nv">keyName</span><span class="si">}</span><span class="s2">_definition_keys&quot;</span><span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">%echo Generating registration definition key</span>
<span class="s">Key-Type: RSA</span>
<span class="s">Key-Length: 4096</span>
<span class="s">Subkey-Type: RSA</span>
<span class="s">Subkey-Length: 4096</span>
<span class="s">Name-Real: ${keyName}</span>
<span class="s">Expire-Date: 0</span>
<span class="s">Passphrase: ${passphrase}</span>
<span class="s"># Do a commit here, so that we can later print &quot;done&quot; :-)</span>
<span class="s">%commit</span>
<span class="s">%echo done</span>
<span class="s">EOF</span>
</code></pre></div>
</li>
<li>
<p>Generate Key pair</p>
<div class="highlight"><pre><span></span><code>gpg<span class="w"> </span>--armor<span class="w"> </span>--batch<span class="w"> </span><span class="se">\</span>
--generate-key<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/registration_keys/</span><span class="si">${</span><span class="nv">keyName</span><span class="si">}</span><span class="s2">_definition_keys&quot;</span>
</code></pre></div>
<details class="example" open="open">
<summary>Example Output</summary>
<div class="highlight"><pre><span></span><code>gpg:<span class="w"> </span>directory<span class="w"> </span><span class="s1">&#39;/home/multiarch-lab/.gnupg&#39;</span><span class="w"> </span>created
gpg:<span class="w"> </span>keybox<span class="w"> </span><span class="s1">&#39;/home/multiarch-lab/.gnupg/pubring.kbx&#39;</span><span class="w"> </span>created
gpg:<span class="w"> </span>Generating<span class="w"> </span>registration<span class="w"> </span>definition<span class="w"> </span>key
gpg:<span class="w"> </span>/home/multiarch-lab/.gnupg/trustdb.gpg:<span class="w"> </span>trustdb<span class="w"> </span>created
gpg:<span class="w"> </span>key<span class="w"> </span>7E05CE05DFEBA2BC<span class="w"> </span>marked<span class="w"> </span>as<span class="w"> </span>ultimately<span class="w"> </span>trusted
gpg:<span class="w"> </span>directory<span class="w"> </span><span class="s1">&#39;/home/multiarch-lab/.gnupg/openpgp-revocs.d&#39;</span><span class="w"> </span>created
gpg:<span class="w"> </span>revocation<span class="w"> </span>certificate<span class="w"> </span>stored<span class="w"> </span>as<span class="w"> </span><span class="s1">&#39;/home/multiarch-lab/.gnupg/openpgp-revocs.d/27FB55DC5F7FDF0598C9B1007E05CE05DFEBA2BC.rev&#39;</span>
gpg:<span class="w"> </span><span class="k">done</span>
</code></pre></div>
</details>
</li>
<li>
<p>Export Private key</p>
<div class="highlight"><pre><span></span><code>gpg<span class="w"> </span>--armor<span class="w"> </span>--pinentry-mode<span class="o">=</span>loopback<span class="w"> </span>--passphrase<span class="w">  </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">passphrase</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
--export-secret-keys<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">keyName</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/registration_keys/</span><span class="si">${</span><span class="nv">keyName</span><span class="si">}</span><span class="s2">.private&quot;</span>
</code></pre></div>
</li>
<li>
<p>Export Public key</p>
<div class="highlight"><pre><span></span><code>gpg<span class="w"> </span>--armor<span class="w"> </span>--export<span class="w"> </span><span class="si">${</span><span class="nv">keyName</span><span class="si">}</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/registration_keys/</span><span class="si">${</span><span class="nv">keyName</span><span class="si">}</span><span class="s2">.pub&quot;</span>
</code></pre></div>
</li>
<li>
<p>List newly generated key files</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span>ls<span class="w"> </span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span>/registration_keys/
</code></pre></div>
<details class="example" open="open">
<summary>Example Output</summary>
<div class="highlight"><pre><span></span><code>secure_bitcoin_key7750_definition_keys<span class="w">  </span>secure_bitcoin_key7750.private<span class="w">  </span>secure_bitcoin_key7750.pub
</code></pre></div>
</details>
</li>
</ol>
<h2 id="set-build-configuration">Set Build Configuration<a class="headerlink" href="#set-build-configuration" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Set Secure Build Lab IP Address</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">SB_IP</span><span class="o">=</span><span class="m">192</span>.168.22.79
</code></pre></div>
</li>
<li>
<p>Save Secure Build Lab IP Address for later use</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export SB_IP=&#39;</span><span class="si">${</span><span class="nv">SB_IP</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/.bashrc&quot;</span>
</code></pre></div>
</li>
<li>
<p>Set Secure Build GitHub repository</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">GH_REPO</span><span class="o">=</span><span class="s2">&quot;git@github.com:ibm-wsc/secure-bitcoin-wallet.git&quot;</span>
</code></pre></div>
</li>
<li>
<p>Set Docker Image Name</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">IMAGE_NAME</span><span class="o">=</span><span class="s2">&quot;hpvs_bc&quot;</span>
</code></pre></div>
</li>
<li>
<p>Set repository registration name</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">REPO_ID</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">IMAGE_NAME</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">HPVS_NUMBER</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
</li>
<li>
<p>Save repository registration name for later use</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export REPO_ID=&#39;</span><span class="si">${</span><span class="nv">REPO_ID</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/.bashrc&quot;</span>
</code></pre></div>
</li>
<li>
<p>Create config file</p>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">cat &gt; &quot;${SB_DIR}/sb_config.yaml&quot; &lt;&lt;EOF</span>
<span class="l l-Scalar l-Scalar-Plain">secure_build_workers</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="nt">sbs</span><span class="p">:</span>
<span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://${SB_IP}&#39;</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${SB_PORT}&#39;</span>
<span class="w">        </span><span class="nt">cert_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${SB_DIR}/sbs_keys/client_cert.pem&#39;</span>
<span class="w">        </span><span class="nt">key_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${SB_DIR}/sbs_keys/client-key.pem&#39;</span>
<span class="w">        </span><span class="nt">ca_cert_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${SB_DIR}/sbs_keys/ca.pem&#39;</span>
<span class="w">    </span><span class="nt">regfile</span><span class="p">:</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${REPO_ID}&#39;</span>
<span class="w">    </span><span class="nt">github</span><span class="p">:</span>
<span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${GH_REPO}&#39;</span>
<span class="w">        </span><span class="nt">branch</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;master&#39;</span>
<span class="w">        </span><span class="nt">ssh_private_key_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${GITHUB_SSH_KEY}&#39;</span>
<span class="w">        </span><span class="nt">recurse_submodules</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;False&#39;</span>
<span class="w">        </span><span class="nt">dockerfile_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;./Dockerfile&#39;</span>
<span class="w">        </span><span class="nt">docker_build_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;./&#39;</span>
<span class="w">    </span><span class="nt">docker</span><span class="p">:</span>
<span class="w">        </span><span class="nt">push_server</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${REGISTRY_NAME}&#39;</span>
<span class="w">        </span><span class="c1">#base_server: &#39;${REGISTRY_NAME}&#39;</span>
<span class="w">        </span><span class="nt">pull_server</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${REGISTRY_NAME}&#39;</span>
<span class="w">        </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${DOCKER_USERNAME}/${IMAGE_NAME}&#39;</span>
<span class="w">        </span><span class="nt">image_tag_prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;latest&#39;</span>
<span class="w">        </span><span class="nt">content_trust_base</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;False&#39;</span>
<span class="w">    </span><span class="c1">#env:</span>
<span class="w">    </span><span class="c1"># You would enter environment variables that you want to use in your application container in the whitelist array.</span>
<span class="w">    </span><span class="c1">#    whitelist: []</span>
<span class="w">    </span><span class="c1">#build:</span>
<span class="w">    </span><span class="c1"># You would enter build parameters such as build args you want to use in your application container</span>
<span class="w">    </span><span class="c1">#    args: { &#39;ARG1&#39; : &#39;VALUE1&#39; }</span>
<span class="w">    </span><span class="nt">signing_key</span><span class="p">:</span>
<span class="w">        </span><span class="nt">private_key_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${SB_DIR}/registration_keys/${keyName}.private&#39;</span>
<span class="w">        </span><span class="nt">public_key_path</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${SB_DIR}/registration_keys/${keyName}.pub&#39;</span>
<span class="l l-Scalar l-Scalar-Plain">EOF</span>
</code></pre></div>
</li>
<li>
<p>Continue to the <a href="#build-application">Build Application section</a> if you are launching secure build for the first time or the <a href="#troubleshooting-secure-build">Troubleshooting Secure Build section</a> if things didn't go as planned your first go-round and you are trying to get back on the right track.</p>
</li>
</ol>
<h2 id="build-application">Build Application<a class="headerlink" href="#build-application" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>In this section, you finally use all of your configuration information to build your application securely over TLS by connecting to the secure build server you deployed in the <a href="../create-server/" target="_blank">previous part of the lab</a> with the <code>Secure Build Server Client Certificate and Key</code>. This build securely updates the application using <a href="https://docs.docker.com/engine/security/trust/content_trust/" target="_blank">Docker Content Trust</a>, an implementation of <a href="https://theupdateframework.io/overview/" target="_blank">The Update Framework</a>. This involves securely signing a series of <a href="https://theupdateframework.io/metadata/" target="_blank">metadata files</a> with corresponding keys (<code>Root Key</code>, <code>Image Signing "Targets" Key</code>, <code>Snapshot Key</code>, and <code>Timestamp Key</code> referenced in the <a href="../overview/#fnref:2">key table</a>) and pushing this trust metadata to a <a href="https://docs.docker.com/notary/service_architecture/" target="_blank">Notary Server</a> to provide assurances regarding the integrity of the Docker Images when users pull them to run in their environments. This conforms to <a href="https://github.com/theupdateframework/specification/blob/master/tuf-spec.md#the-update-framework-specification" target="_blank">The Update Framework Specification</a></p>
<p>Additionally, this process generates a <code>Manifest Signing Key</code> which it employs to sign the contents of the build for attestation of the build contents by internal and/or third party auditors. The <code>Manifest Signing Key</code> is discussed in more detail in the <a href="#verify-your-application"><code>Verify your application section</code></a> later in the lab.</p>
</div>
<ol>
<li>
<p>Initialize Secure Build Hyper Protect Virtual Server with configuration file generated in the <a href="#set-build-configuration">Set Build Configuration section</a></p>
<div class="highlight"><pre><span></span><code>hpvs<span class="w"> </span>sb<span class="w"> </span>init<span class="w"> </span>--config<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/sb_config.yaml&quot;</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Example Output</p>
<div class="highlight"><pre><span></span><code><span class="o">{</span><span class="s2">&quot;status&quot;</span>:<span class="s2">&quot;OK&quot;</span><span class="o">}</span>
</code></pre></div>
</div>
</li>
<li>
<p>Launch secure build with a timeout of 20 minutes to complete using the configuration file generated in the <a href="#set-build-configuration">Set Build Configuration section</a></p>
<div class="highlight"><pre><span></span><code>hpvs<span class="w"> </span>sb<span class="w"> </span>build<span class="w"> </span><span class="se">\</span>
--timeout<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="se">\</span>
--config<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/sb_config.yaml&quot;</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The following build will take anywhere from <strong>15-20 minutes</strong> to complete. While this is ongoing, you should open a new tab in your terminal to check the automatically updating logs and build status (steps for doing this are detailed in the next few steps). If this command times out please check the status as in <code>step 4</code> to make sure nothing went wrong. It might just be that your build took too long and everything will be ok. If something did go wrong, visit the <a href="#troubleshooting-secure-build">Troubleshooting Secure Build section</a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The secure build is asynchronous so if the command gets interrupted here don't worry! <img alt="😁" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f601.svg" title=":grin:" /></p>
</div>
<details class="example" open="open">
<summary>Example Output after running 15-20 minutes to completion</summary>
<div class="highlight"><pre><span></span><code>+--------+-------------------------+
<span class="p">|</span><span class="w"> </span>status<span class="w"> </span><span class="p">|</span><span class="w"> </span>OK:<span class="w"> </span>async<span class="w"> </span>build<span class="w"> </span>started<span class="w"> </span><span class="p">|</span>
+--------+-------------------------+
<span class="c1">##############################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################</span>
+---------------------+--------------------------------------------------------------------------------------------+
<span class="p">|</span><span class="w"> </span>root_ssh_enabled<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="nb">false</span><span class="w">                                                                                      </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>status<span class="w">              </span><span class="p">|</span><span class="w"> </span>success<span class="w">                                                                                    </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>build_name<span class="w">          </span><span class="p">|</span><span class="w"> </span>docker.io.gmoney23.hpvs_bc_a.latest-b3416d8.2020-06-23_22-12-54.183641<span class="w">                     </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>image_tag<span class="w">           </span><span class="p">|</span><span class="w"> </span>latest-b3416d8<span class="w">                                                                             </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>manifest_key_gen<span class="w">    </span><span class="p">|</span><span class="w"> </span>soft_crypto<span class="w">                                                                                </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>manifest_public_key<span class="w"> </span><span class="p">|</span><span class="w"> </span>manifest.docker.io.gmoney23.hpvs_bc_a.latest-b3416d8.2020-06-23_22-12-54.183641-public.pem<span class="w"> </span><span class="p">|</span>
+---------------------+--------------------------------------------------------------------------------------------+
</code></pre></div>
</details>
</li>
<li>
<p>Please look at the logs in another terminal window while the secure build is running (don't interrupt the current terminal window which is waiting for the secure build)</p>
<div class="highlight"><pre><span></span><code>hpvs<span class="w"> </span>sb<span class="w"> </span>log<span class="w"> </span>--config<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/sb_config.yaml&quot;</span>
</code></pre></div>
<details class="example" open="open">
<summary>Example Truncated Output</summary>
<div class="highlight"><pre><span></span><code>2020-06-23 05:25:42,453  root       INFO    starting a build
2020-06-23 05:25:42,454  root       INFO    cleaning up the local github repo and the github access credential
2020-06-23 05:25:42,454  root       INFO    github_dir=secure-bitcoin-wallet
2020-06-23 05:25:42,454  root       INFO    cloning a github repo
2020-06-23 05:25:42,454  root       INFO    github_host=github.com
2020-06-23 05:25:42,454  root       INFO    cmd=ssh-keyscan github.com
2020-06-23 05:25:47,659  root       INFO    # github.com:22 SSH-2.0-babeld-7c96ae41
# github.com:22 SSH-2.0-babeld-b6072416
# github.com:22 SSH-2.0-babeld-b6072416
github.com ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAq2A7hRGmdnm9tUDbO9IDSwBK6TbQa+PXYPCPy6rbTrTtw7PHkccKrpp0yVhp5HdEIcKr6pL
.....
</code></pre></div>
</details>
</li>
<li>
<p>You can also look at the secure build status in another window. This can be useful if you accidentally interrupted the secure build command or it times out due to the timeout not being long enough. It will also fill out the additional fields that are initially blank when the build completes (such as <code>build_name</code> and <code>manifest_public_key</code>, etc.).</p>
<div class="highlight"><pre><span></span><code>hpvs<span class="w"> </span>sb<span class="w"> </span>status<span class="w"> </span>--config<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/sb_config.yaml&quot;</span>
</code></pre></div>
<details class="example" open="open">
<summary>Example Output</summary>
<div class="highlight"><pre><span></span><code>+---------------------+---------------+
<span class="p">|</span><span class="w"> </span>build_name<span class="w">          </span><span class="p">|</span><span class="w">               </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>image_tag<span class="w">           </span><span class="p">|</span><span class="w">               </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>manifest_key_gen<span class="w">    </span><span class="p">|</span><span class="w">               </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>manifest_public_key<span class="w"> </span><span class="p">|</span><span class="w">               </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>root_ssh_enabled<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="nb">false</span><span class="w">         </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>status<span class="w">              </span><span class="p">|</span><span class="w"> </span>github<span class="w"> </span>cloned<span class="w"> </span><span class="p">|</span>
+---------------------+---------------+
</code></pre></div>
</details>
<div class="admonition error">
<p class="admonition-title">If you see an error in your status</p>
<p>If you see that your build ran into an error please visit the <a href="#troubleshooting-secure-build">Troubleshooting Secure Build section</a></p>
</div>
</li>
<li>
<p>You can continue to check the logs to monitor the progress of your secure build with the previous logs command</p>
<div class="highlight"><pre><span></span><code>hpvs<span class="w"> </span>sb<span class="w"> </span>log<span class="w"> </span>--config<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/sb_config.yaml&quot;</span>
</code></pre></div>
</li>
<li>
<p>When the secure build successfully completes, it will have ending logs similar to the following:</p>
<details class="example" open="open">
<summary>Example Output</summary>
<div class="highlight"><pre><span></span><code><span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:28,843<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span>run:<span class="w"> </span>latest:<span class="w"> </span>digest:<span class="w"> </span>sha256:45cd2d06a2ef978cf1ae60b58833689ff2af1aff0b3d6aa2e69ea83378f6f22d<span class="w"> </span>size:<span class="w"> </span><span class="m">5549</span>
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:28,843<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span>run:<span class="w"> </span>Signing<span class="w"> </span>and<span class="w"> </span>pushing<span class="w"> </span>trust<span class="w"> </span>metadata
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:29,656<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span>run:<span class="w"> </span>Successfully<span class="w"> </span>signed<span class="w"> </span>docker.io/gmoney23/hpvs_bc:latest
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:29,661<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span>run:<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:29,662<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span>extracting<span class="w"> </span>an<span class="w"> </span>image<span class="w"> </span>keyid<span class="w"> </span>and<span class="w"> </span>key
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:29,663<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span><span class="nv">keyid</span><span class="o">=</span>2092f4e8a72ab297e94a05c18a1ad5b558b9cdee3531018752cd23e238c02889
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:29,663<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span><span class="nv">publickey</span><span class="o">=</span>LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJrVENDQVRhZ0F3SUJBZ0lSQUlSUVpKVmR0QVJycGNnc1A3T0diRVF3Q2dZSUtvWkl6ajBFQXdJd0xqRXMKTUNvR0ExVUVBd3dqWkc5amEyVnlMbWx2TDNOcGJHeHBiV0Z1TDJod2RuTmZZbU5mTWpBeU1qQTBNall3SGhjTgpNakl3TkRJMk1UZ3dPVEkwV2hjTk16SXdOREl6TVRnd09USTBXakF1TVN3d0tnWURWUVFERENOa2IyTnJaWEl1CmFXOHZjMmxzYkdsdFlXNHZhSEIyYzE5aVkxOHlNREl5TURReU5qQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDkKQXdFSEEwSUFCSUhqM1RLaDZPYmp4Z214allOZ3ZDSGlDSTNOOTlBZy8vS0lPc0hxR25SYUR6NU5LbEdMWktvOAoxaDRYaUgwRG92d1ZFMGUvdlZzM3V3dnlwT0JEYzNtak5UQXpNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WCkhTVUVEREFLQmdnckJnRUZCUWNEQXpBTUJnTlZIUk1CQWY4RUFqQUFNQW9HQ0NxR1NNNDlCQU1DQTBrQU1FWUMKSVFEU2o4SzcvVDhRSWFLbVoyaEdSTTZnTkRsRE01L21UcUdQK09qc3NwWS9jZ0loQU43ZDM5RXlITkV3bFRUMApkMC9XaVcwejRCMWdMM1RyQVhFRDlwVUhoMVR5Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:29,663<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span>generating<span class="w"> </span>a<span class="w"> </span>config<span class="w"> </span>file
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:29,664<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span>create_and_push:<span class="w"> </span>SoftCrypto
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:30,627<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span><span class="nv">digest</span><span class="o">=</span>7b997311130b0b0984e1b7cabd45e7b4a5461337d52dcb1b99be26849d7172d9
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:30,627<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span><span class="nv">block_size</span><span class="o">=</span><span class="m">64</span>
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:30,648<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span><span class="nv">digest</span><span class="o">=</span>7b997311130b0b0984e1b7cabd45e7b4a5461337d52dcb1b99be26849d7172d9
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:30,650<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span><span class="nv">signature</span><span class="o">=</span>4e6b43530773245b8c04e016e8b112cfa8efab6621b84c9825d06c7fa7faba525c8cc97618313205bf46db123d8f53ca2377871b3daa6dec62e48fc539fd17c9796f5c395bd1a82b05e60d69796fea1baa7fb48b4f9ae0cd72c329121241b2e4f7a21d8bc6456fa921df2ab9b9a47974bfb841c540ff1bd9e9e350e9f9d1c5f4da3bef0857e3f21605e1131f4b6ca0a12db33ae57149e37718ef8e54b978769cbf8cf025d32323f1f488df6db9ffd6ec22ebad7daa67e99c3506b47bdefc0ebe3d0fe76edc6d19d38283a355f9d94eab20c3e3d32cdd6b5ae8f8e0f4748ffbfec10661f7aad9dbc3dd5017e42f4468f7ef5443303c694761d6ff8646382fda14
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:30,650<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span><span class="nv">verify</span><span class="o">=</span>OK
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:31,049<span class="w">  </span>root<span class="w">       </span>WARNING<span class="w"> </span>undefined<span class="w"> </span>MANIFEST_BUCKET_NAME
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:31,049<span class="w">  </span>root<span class="w">       </span>WARNING<span class="w"> </span>skipping<span class="w"> </span>transferring<span class="w"> </span>a<span class="w"> </span>manifest<span class="w"> </span>to<span class="w"> </span>COS
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:31,049<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span>cleaning<span class="w"> </span>up<span class="w"> </span>the<span class="w"> </span>build<span class="w"> </span>environment
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:31,049<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span><span class="nv">github_dir</span><span class="o">=</span>secure-bitcoin-wallet
<span class="m">2022</span>-04-26<span class="w"> </span><span class="m">18</span>:09:31,110<span class="w">  </span>root<span class="w">       </span>INFO<span class="w">    </span>completed<span class="w"> </span>a<span class="w"> </span>build
</code></pre></div>
</details>
</li>
<li>
<p>When the secure build successfully completes, you can check the status again to see a status of <code>success</code>.</p>
<div class="highlight"><pre><span></span><code>hpvs<span class="w"> </span>sb<span class="w"> </span>status<span class="w"> </span>--config<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/sb_config.yaml&quot;</span>
</code></pre></div>
<details class="example" open="open">
<summary>Example Output</summary>
<div class="highlight"><pre><span></span><code>+---------------------+---------------------------------------------------------------------------------------------------+
<span class="p">|</span><span class="w"> </span>manifest_public_key<span class="w"> </span><span class="p">|</span><span class="w"> </span>manifest.docker.io.gmoney23.hpvs_bc.latest-941893e.2022-04-26_18-09-29.663558-public.pem<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>root_ssh_enabled<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="nb">false</span><span class="w">                                                                                    </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>status<span class="w">              </span><span class="p">|</span><span class="w"> </span>success<span class="w">                                                                                  </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>build_name<span class="w">          </span><span class="p">|</span><span class="w"> </span>docker.io.gmoney23.hpvs_bc.latest-941893e.2022-04-26_18-09-29.663558<span class="w">                     </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>image_tag<span class="w">           </span><span class="p">|</span><span class="w"> </span>latest-941893e<span class="w">                                                                           </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>manifest_key_gen<span class="w">    </span><span class="p">|</span><span class="w"> </span>soft_crypto<span class="w">                                                                              </span><span class="p">|</span>
+---------------------+------------------------------------------------------------------------------------------+
</code></pre></div>
</details>
<div class="admonition error">
<p class="admonition-title">If you see an error in your status</p>
<p>If you see that your build ran into an error please visit the <a href="#troubleshooting-secure-build">Troubleshooting Secure Build section</a></p>
</div>
</li>
<li>
<p>From the original terminal window, where you ran <code>hpvs sb init</code>, output the repository registration file.</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">passphrase</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>hpvs<span class="w"> </span>sb<span class="w"> </span>regfile<span class="w"> </span><span class="se">\</span>
--config<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/sb_config.yaml&quot;</span><span class="w"> </span><span class="se">\</span>
--out<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/yaml.</span><span class="si">${</span><span class="nv">REPO_ID</span><span class="si">}</span><span class="s2">.enc&quot;</span>
</code></pre></div>
<details class="example" open="open">
<summary>Example Output</summary>
<div class="highlight"><pre><span></span><code>Enter<span class="w"> </span>Signing<span class="w"> </span>Private<span class="w"> </span>key<span class="w"> </span>passphrase:
</code></pre></div>
</details>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <code>echo</code> command takes care of the passphrase so you don't need to enter it manually.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you run this command from a terminal window where you did not set the <code>passphrase</code> environment variable you will get an error saying <code>openpgp: invalid data: private key checksum failure</code>. You can also check to make sure you are in the right terminal window by running <code>echo "${passphrase}"</code> and the output should be the passphrase you set in the beginning of the "Create repository registration GPG signing key" section.</p>
</div>
</li>
</ol>
<h2 id="troubleshooting-secure-build">Troubleshooting Secure Build<a class="headerlink" href="#troubleshooting-secure-build" title="Permanent link">&para;</a></h2>
<details open="open">
<summary>Troubleshooting Instructions</summary>
<p>If your build completed successfully, feel free to <a href="#verify-your-application">SKIP this section</a> <img alt="😄" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f604.svg" title=":smile:" /></p>
<div class="admonition error">
<p class="admonition-title">If your build failed continue for instructions on how to find the happy path yet again.</p>
<p>If at any point you see an error in the status command you will need to restart your build with the following steps.</p>
<ol>
<li>If the secure build command is still running in its own window please interrupt it with <code>ctrl + c</code></li>
<li>Check the logs for more error information using:
    <div class="highlight"><pre><span></span><code>hpvs<span class="w"> </span>sb<span class="w"> </span>log<span class="w"> </span>--config<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/sb_config.yaml&quot;</span>
</code></pre></div></li>
<li>Correct whatever information was incorrect and go back through the steps in the <a href="#set-build-configuration">Set Build Configuration section</a></li>
<li>Clean up the data (i.e. logs) from the old build with:
    <div class="highlight"><pre><span></span><code>hpvs<span class="w"> </span>sb<span class="w"> </span>clean<span class="w"> </span>--config<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/sb_config.yaml&quot;</span>
</code></pre></div></li>
<li>Update the secure build server with the new configuration
    <div class="highlight"><pre><span></span><code>hpvs<span class="w"> </span>sb<span class="w"> </span>update<span class="w"> </span>--config<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/sb_config.yaml&quot;</span>
</code></pre></div></li>
<li>Continue onward like you just initialized your build server (You did ... just for another time <img alt="😁" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f601.svg" title=":grin:" />) at <code>Step 2</code> in the <a href="#build-application">Build Application Section</a></li>
</ol>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The next command you should run will be <code>hpvs sb build</code> (<code>Step 2</code> in the <a href="#build-application">Build Application Section</a>)</p>
</div>
</div>
</details>
<h2 id="verify-your-application">Verify your application<a class="headerlink" href="#verify-your-application" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>On the secure build server, the <code>.tbz</code> manifest file was hashed and then signed by the <code>Manifest Signing Key</code> referenced in the <a href="../overview/#fnref:2">key table</a> which only exists on the server (inside its secure environment). In steps 1-11 below, you are using the matching public key you will receive from the secure build server (using a secure TLS connection) in <code>step 4</code> to "undo" this signature to reveal the original hash of the file. We then compare this hash to the hash of the file we have using the <code>verify</code> command in <code>step 11</code>. <code>Verification OK</code> means they are the same, implying that the <code>.tbz</code> file we have now was the same one that was signed by the manifest private key inside the safe confines of the secure build server.</p>
</div>
<ol>
<li>
<p>Create directories for your manifest file information and change into your new <code>manifest</code> directory.</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/manifest/manifest_files&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/manifest&quot;</span>
</code></pre></div>
</li>
<li>
<p>Save the build name from the status command as a variable</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">BUILD_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>hpvs<span class="w"> </span>sb<span class="w"> </span>status<span class="w"> </span>--config<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/sb_config.yaml&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>build_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>egrep<span class="w"> </span>-ow<span class="w"> </span><span class="s1">&#39;docker.*[[:digit:]]&#39;</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BUILD_NAME</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
<details class="example" open="open">
<summary>Example Output</summary>
<div class="highlight"><pre><span></span><code>docker.io.gmoney23.hpvs_bc.latest-941893e.2022-04-26_18-09-29.663558
</code></pre></div>
</details>
</li>
<li>
<p>Get your application manifest</p>
<div class="highlight"><pre><span></span><code>hpvs<span class="w"> </span>sb<span class="w"> </span>manifest<span class="w"> </span>--config<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/sb_config.yaml&quot;</span><span class="w"> </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BUILD_NAME</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
</li>
<li>
<p>Get your manifest public verification key</p>
<div class="highlight"><pre><span></span><code>hpvs<span class="w"> </span>sb<span class="w"> </span>pubkey<span class="w"> </span>--config<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/sb_config.yaml&quot;</span><span class="w"> </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BUILD_NAME</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Connections to the secure build server are secured using mutual TLS. This means that proper certificates and keys have to be used on the client side to access these files (as well as when doing the previous secure build commands). This adds a layer of security to make sure that the <code>public key</code> and <code>manifest files</code> are authentic and securely distributed.</p>
</div>
</li>
<li>
<p>Check that your application manifest and signing key were retrieved</p>
<div class="highlight"><pre><span></span><code>ls
</code></pre></div>
<details class="example" open="open">
<summary>Example Output</summary>
<div class="highlight"><pre><span></span><code>docker.io.gmoney23.hpvs_bc.latest-941893e.2022-04-26_18-09-29.663558-public.pem
manifest.docker.io.gmoney23.hpvs_bc.latest-941893e.2022-04-26_18-09-29.663558.sig.tbz
manifest_files
</code></pre></div>
</details>
</li>
<li>
<p>Set <code>MANIFEST</code> to point to your manifest files.</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">MANIFEST</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/manifest/manifest.</span><span class="si">${</span><span class="nv">BUILD_NAME</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
</li>
<li>
<p>Set <code>MAN_PUBKEY</code> to point to your manifest public key.</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">MAN_PUBKEY</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/manifest/</span><span class="si">${</span><span class="nv">BUILD_NAME</span><span class="si">}</span><span class="s2">-public.pem&quot;</span>
</code></pre></div>
</li>
<li>
<p>Untar and unzip the manifest <code>.sig.tbz</code> file to reveal the <code>.sig</code> and <code>.tbz</code> files (and remove the original <code>.sig.tbz</code>)</p>
<div class="highlight"><pre><span></span><code>tar<span class="w"> </span>-xjvf<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">MANIFEST</span><span class="si">}</span><span class="s2">.sig.tbz&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">MANIFEST</span><span class="si">}</span><span class="s2">.sig.tbz&quot;</span>
</code></pre></div>
<details class="example" open="open">
<summary>Example Output</summary>
<div class="highlight"><pre><span></span><code>manifest.docker.io.gmoney23.hpvs_bc.latest-941893e.2022-04-26_18-09-29.663558.tbz
manifest.docker.io.gmoney23.hpvs_bc.latest-941893e.2022-04-26_18-09-29.663558.sig
</code></pre></div>
</details>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>.sig.tbz</code> was a tarball compressed using bzip2 compression of both a nested <code>.tbz</code> file (containing the manifest files) and a <code>.sig</code> file containing a signature of the nested <code>.tbz</code> to verify it with the public key retrieved using the <code>hpvs sb pubkey</code> command above saved in the file referenced by <code>MAN_PUBKEY</code>.</p>
</div>
</li>
<li>
<p>Convert the signature file to binary format</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">MANIFEST</span><span class="si">}</span><span class="s2">.sig&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xxd<span class="w"> </span>-r<span class="w"> </span>-p<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">MANIFEST</span><span class="si">}</span><span class="s2">.sig.bin&quot;</span>
</code></pre></div>
</li>
<li>
<p>Hash (<code>SHA256</code>) the manifest <code>.tbz</code> file (containing the manifest files)</p>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>dgst<span class="w"> </span>-sha256<span class="w"> </span>-binary<span class="w"> </span>-out<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">MANIFEST</span><span class="si">}</span><span class="s2">.tbz.sha256&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">MANIFEST</span><span class="si">}</span><span class="s2">.tbz&quot;</span>
</code></pre></div>
</li>
<li>
<p>Verify that the <code>.tbz</code> manifest package was the one signed on the secure build server.</p>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>dgst<span class="w"> </span>-sha256<span class="w"> </span>-verify<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">MAN_PUBKEY</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
-signature<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">MANIFEST</span><span class="si">}</span><span class="s2">.sig.bin&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">MANIFEST</span><span class="si">}</span><span class="s2">.tbz.sha256&quot;</span>
</code></pre></div>
<details class="success" open="open">
<summary>Success</summary>
<div class="highlight"><pre><span></span><code>Verified<span class="w"> </span>OK
</code></pre></div>
</details>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this case, we are double hashing the <code>.tbz</code> file on the signature side which is why we hash the <code>.tbz</code> before the verify command here.</p>
</div>
</li>
<li>
<p>Untar and unzip the manifest <code>.tbz</code> file into the <code>manifest_files</code> directory.</p>
<div class="highlight"><pre><span></span><code>tar<span class="w"> </span>-xjf<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">MANIFEST</span><span class="si">}</span><span class="s2">.tbz&quot;</span><span class="w"> </span>-C<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/manifest/manifest_files&quot;</span>
</code></pre></div>
</li>
<li>
<p>Change into the <code>manifest_files</code> directory with your manifest files and view the files in the directory.</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SB_DIR</span><span class="si">}</span><span class="s2">/manifest/manifest_files&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ls
</code></pre></div>
<details class="example" open="open">
<summary>Example Output</summary>
<div class="highlight"><pre><span></span><code>data<span class="w">  </span>git<span class="w">  </span>root_ssh
</code></pre></div>
</details>
<div class="admonition info">
<p class="admonition-title">Manifest explanation</p>
<p>This <code>manifest</code> package contains three directories as shown above. The <code>data</code> directory contains the <code>build.json</code> (containing the build status of the directory updated after the image was pushed to its Docker Registry) and <code>build.log</code> (containing the logs from the secure build). The <code>git</code> directory contains the source code used for the build (cloned from git). Finally, the <code>root_ssh</code> directory contains any <code>ssh</code> material provided (if the user chose to use ssh) which is empty for us because we didn't enable ssh and provide ssh keys. This way no one can ssh into our secure build container.</p>
</div>
</li>
<li>
<p>What does this give me?</p>
<p>This gives you a way to see the collection of files used for your build at the time of the build and signed by the manifest private key which is secured in your secure build container. By retrieving the public key and verifying the signature of the package we <em>and auditors</em> can verify what was used for our secure image build. (Since the private key was generated in the secure build server we can trust it). This gives us verification of what was used in the build as well as the verification of the images themselves we get from <a href="https://docs.docker.com/engine/security/trust/content_trust/" target="_blank">Docker Content Trust</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The secure build server also generates the keys for Docker Content Trust and stores them safely to provide a secure root of trust.</p>
<p><em>Remember the secure build server is running as a Hyper Protect Virtual Server and thus inherits all of the security features and assurances of Hyper Protect Virtual Servers.</em></p>
</div>
</li>
</ol>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>Congratulations!!! <img alt="🎉" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f389.svg" title=":tada:" /></p>
<p>You have securely built your application and are ready to deploy it into a Hyper Protect Virtual Server in the next section.</p>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">June 13, 2023</span>
      
        <br>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">June 20, 2020</span>
      
    
  </small>
</div>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12 21.35-1.45-1.32C5.4 15.36 2 12.27 2 8.5 2 5.41 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.08C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53L12 21.35Z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12 21.35-1.45-1.32C5.4 15.36 2 12.27 2 8.5 2 5.41 4.42 3 7.5 3c.67 0 1.32.12 1.94.33L13 9.35l-4 5 3 7M16.5 3C19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53L12 21.35l-1-7 4.5-5-2.65-5.08C13.87 3.47 15.17 3 16.5 3Z"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/ibm-wsc/hyper-protect-virtual-servers-workshop/issues/new/?title=[Feedback]+Securely%20Build%20your%20Application+-+/securebuild-lab/build/" target="_blank" rel="noopener">feedback form</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../create-server/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Create your HPVS Secure Build Server" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Create your HPVS Secure Build Server
              </div>
            </div>
          </a>
        
        
          
          <a href="../deploy-app/" class="md-footer__link md-footer__link--next" aria-label="Next: Deploy your Securely Built Application as a Hyper Protect Virtual Server" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Deploy your Securely Built Application as a Hyper Protect Virtual Server
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/ibm-wsc" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://hub.docker.com/u/s390x" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  


  
    
  



  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make the documentation as good as possible.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["header.autohide", "navigation.sections", "navigation.expand", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.footer", "search.share", "navigation.indexes", "announce.dismiss", "content.tabs.link", "content.code.copy", "content.action.edit", "content.action.view"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
    
  </body>
</html>